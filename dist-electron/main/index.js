"use strict";var i_=Object.create;var ma=Object.defineProperty;var s_=Object.getOwnPropertyDescriptor;var a_=Object.getOwnPropertyNames;var o_=Object.getPrototypeOf,c_=Object.prototype.hasOwnProperty;var u_=(n,e,t)=>e in n?ma(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var l_=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of a_(e))!c_.call(n,i)&&i!==t&&ma(n,i,{get:()=>e[i],enumerable:!(r=s_(e,i))||r.enumerable});return n};var Rt=(n,e,t)=>(t=n!=null?i_(o_(n)):{},l_(e||!n||!n.__esModule?ma(t,"default",{value:n,enumerable:!0}):t,n));var ue=(n,e,t)=>(u_(n,typeof e!="symbol"?e+"":e,t),t);const Rc=require("node:os"),Kt=require("node:path"),_=require("electron"),up=require("electron-store"),X=require("path"),oe=require("fs"),Xr=require("url"),d_=require("stream"),f_=require("zlib"),Co=require("worker_threads"),p_=require("module"),lp=require("async_hooks"),h_=require("events"),m_=require("perf_hooks"),Ic=require("node:util"),g_=require("diagnostics_channel"),No=require("util"),dp=require("tty"),Pc=require("os"),Cc=require("node:fs"),__=require("node:readline"),y_=require("node:worker_threads"),b_=require("node:child_process"),Lo=require("vectordb"),v_=require("remove-markdown"),E_=require("chokidar"),fp=require("@huggingface/hub"),_e=require("apache-arrow"),ol=require("child_process"),cl=require("js-tiktoken"),w_=require("fs/promises"),$=require("zod"),Ke=require("uuid"),S_=require("crypto");var ga=typeof document<"u"?document.currentScript:null;function lt(n){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(n){for(const t in n)if(t!=="default"){const r=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:()=>n[t]})}}return e.default=n,Object.freeze(e)}const Ge=lt(Rc),vi=lt(_),B=lt(X),W=lt(oe),_a=lt(Xr),T_=lt(Ic),A_=lt(Pc),O_=lt(Lo),R_=lt(w_),Wn=lt(Ke),I_=lt(S_),j=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,vt="8.51.0",se=globalThis;function Yr(n,e,t){const r=t||se,i=r.__SENTRY__=r.__SENTRY__||{},s=i[vt]=i[vt]||{};return s[n]||(s[n]=e())}const On=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,P_="Sentry Logger ",xo=["debug","info","warn","error","log","assert","trace"],ns={};function Jt(n){if(!("console"in se))return n();const e=se.console,t={},r=Object.keys(ns);r.forEach(i=>{const s=ns[i];t[i]=e[i],e[i]=s});try{return n()}finally{r.forEach(i=>{e[i]=t[i]})}}function C_(){let n=!1;const e={enable:()=>{n=!0},disable:()=>{n=!1},isEnabled:()=>n};return On?xo.forEach(t=>{e[t]=(...r)=>{n&&Jt(()=>{se.console[t](`${P_}[${t}]:`,...r)})}}):xo.forEach(t=>{e[t]=()=>{}}),e}const w=Yr("logger",C_),pp=50,Nc="?",ul=/\(error: (.*)\)/,ll=/captureMessage|captureException/;function hp(...n){const e=n.sort((t,r)=>t[0]-r[0]).map(t=>t[1]);return(t,r=0,i=0)=>{const s=[],a=t.split(`
`);for(let o=r;o<a.length;o++){const c=a[o];if(c.length>1024)continue;const u=ul.test(c)?c.replace(ul,"$1"):c;if(!u.match(/\S*Error: /)){for(const l of e){const d=l(u);if(d){s.push(d);break}}if(s.length>=pp+i)break}}return mp(s.slice(i))}}function N_(n){return Array.isArray(n)?hp(...n):n}function mp(n){if(!n.length)return[];const e=Array.from(n);return/sentryWrapped/.test(Ei(e).function||"")&&e.pop(),e.reverse(),ll.test(Ei(e).function||"")&&(e.pop(),ll.test(Ei(e).function||"")&&e.pop()),e.slice(0,pp).map(t=>({...t,filename:t.filename||Ei(e).filename,function:t.function||Nc}))}function Ei(n){return n[n.length-1]||{}}const ya="<anonymous>";function gp(n){try{return!n||typeof n!="function"?ya:n.name||ya}catch{return ya}}const qi={},dl={};function Lc(n,e){qi[n]=qi[n]||[],qi[n].push(e)}function xc(n,e){if(!dl[n]){dl[n]=!0;try{e()}catch(t){On&&w.error(`Error while instrumenting ${n}`,t)}}}function $c(n,e){const t=n&&qi[n];if(t)for(const r of t)try{r(e)}catch(i){On&&w.error(`Error while triggering instrumentation handler.
Type: ${n}
Name: ${gp(r)}
Error:`,i)}}let ba=null;function L_(n){const e="error";Lc(e,n),xc(e,x_)}function x_(){ba=se.onerror,se.onerror=function(n,e,t,r,i){return $c("error",{column:r,error:i,line:t,msg:n,url:e}),ba?ba.apply(this,arguments):!1},se.onerror.__SENTRY_INSTRUMENTED__=!0}let va=null;function $_(n){const e="unhandledrejection";Lc(e,n),xc(e,M_)}function M_(){va=se.onunhandledrejection,se.onunhandledrejection=function(n){return $c("unhandledrejection",n),va?va.apply(this,arguments):!0},se.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}function nn(){return Is(se),se}function Is(n){const e=n.__SENTRY__=n.__SENTRY__||{};return e.version=e.version||vt,e[vt]=e[vt]||{}}const _p=Object.prototype.toString;function yp(n){switch(_p.call(n)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return wn(n,Error)}}function Ps(n,e){return _p.call(n)===`[object ${e}]`}function k_(n){return Ps(n,"ErrorEvent")}function rs(n){return Ps(n,"String")}function Mc(n){return typeof n=="object"&&n!==null&&"__sentry_template_string__"in n&&"__sentry_template_values__"in n}function D_(n){return n===null||Mc(n)||typeof n!="object"&&typeof n!="function"}function Xn(n){return Ps(n,"Object")}function F_(n){return typeof Event<"u"&&wn(n,Event)}function j_(n){return typeof Element<"u"&&wn(n,Element)}function U_(n){return Ps(n,"RegExp")}function Kr(n){return!!(n&&n.then&&typeof n.then=="function")}function B_(n){return Xn(n)&&"nativeEvent"in n&&"preventDefault"in n&&"stopPropagation"in n}function wn(n,e){try{return n instanceof e}catch{return!1}}function G_(n){return!!(typeof n=="object"&&n!==null&&(n.__isVue||n._isVue))}const H_=se,W_=80;function V_(n,e={}){if(!n)return"<unknown>";try{let t=n;const r=5,i=[];let s=0,a=0;const o=" > ",c=o.length;let u;const l=Array.isArray(e)?e:e.keyAttrs,d=!Array.isArray(e)&&e.maxStringLength||W_;for(;t&&s++<r&&(u=z_(t,l),!(u==="html"||s>1&&a+i.length*c+u.length>=d));)i.push(u),a+=u.length,t=t.parentNode;return i.reverse().join(o)}catch{return"<unknown>"}}function z_(n,e){const t=n,r=[];if(!t||!t.tagName)return"";if(H_.HTMLElement&&t instanceof HTMLElement&&t.dataset){if(t.dataset.sentryComponent)return t.dataset.sentryComponent;if(t.dataset.sentryElement)return t.dataset.sentryElement}r.push(t.tagName.toLowerCase());const i=e&&e.length?e.filter(a=>t.getAttribute(a)).map(a=>[a,t.getAttribute(a)]):null;if(i&&i.length)i.forEach(a=>{r.push(`[${a[0]}="${a[1]}"]`)});else{t.id&&r.push(`#${t.id}`);const a=t.className;if(a&&rs(a)){const o=a.split(/\s+/);for(const c of o)r.push(`.${c}`)}}const s=["aria-label","type","name","title","alt"];for(const a of s){const o=t.getAttribute(a);o&&r.push(`[${a}="${o}"]`)}return r.join("")}function yn(n,e=0){return typeof n!="string"||e===0||n.length<=e?n:`${n.slice(0,e)}...`}function q_(n,e){let t=n;const r=t.length;if(r<=150)return t;e>r&&(e=r);let i=Math.max(e-60,0);i<5&&(i=0);let s=Math.min(i+140,r);return s>r-5&&(s=r),s===r&&(i=Math.max(s-140,0)),t=t.slice(i,s),i>0&&(t=`'{snip} ${t}`),s<r&&(t+=" {snip}"),t}function Z_(n,e,t=!1){return rs(n)?U_(e)?e.test(n):rs(e)?t?n===e:n.includes(e):!1:!1}function lr(n,e=[],t=!1){return e.some(r=>Z_(n,r,t))}function bp(n,e,t){if(!(e in n))return;const r=n[e],i=t(r);typeof i=="function"&&X_(i,r);try{n[e]=i}catch{On&&w.log(`Failed to replace method "${e}" in object`,n)}}function kt(n,e,t){try{Object.defineProperty(n,e,{value:t,writable:!0,configurable:!0})}catch{On&&w.log(`Failed to add non-enumerable property "${e}" to object`,n)}}function X_(n,e){try{const t=e.prototype||{};n.prototype=e.prototype=t,kt(n,"__sentry_original__",e)}catch{}}function Y_(n){return n.__sentry_original__}function vp(n){if(yp(n))return{message:n.message,name:n.name,stack:n.stack,...pl(n)};if(F_(n)){const e={type:n.type,target:fl(n.target),currentTarget:fl(n.currentTarget),...pl(n)};return typeof CustomEvent<"u"&&wn(n,CustomEvent)&&(e.detail=n.detail),e}else return n}function fl(n){try{return j_(n)?V_(n):Object.prototype.toString.call(n)}catch{return"<unknown>"}}function pl(n){if(typeof n=="object"&&n!==null){const e={};for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t]);return e}else return{}}function K_(n,e=40){const t=Object.keys(vp(n));t.sort();const r=t[0];if(!r)return"[object has no keys]";if(r.length>=e)return yn(r,e);for(let i=t.length;i>0;i--){const s=t.slice(0,i).join(", ");if(!(s.length>e))return i===t.length?s:yn(s,e)}return""}function ae(n){return $o(n,new Map)}function $o(n,e){if(J_(n)){const t=e.get(n);if(t!==void 0)return t;const r={};e.set(n,r);for(const i of Object.getOwnPropertyNames(n))typeof n[i]<"u"&&(r[i]=$o(n[i],e));return r}if(Array.isArray(n)){const t=e.get(n);if(t!==void 0)return t;const r=[];return e.set(n,r),n.forEach(i=>{r.push($o(i,e))}),r}return n}function J_(n){if(!Xn(n))return!1;try{const e=Object.getPrototypeOf(n).constructor.name;return!e||e==="Object"}catch{return!0}}const Ep=1e3;function Jr(){return Date.now()/Ep}function Q_(){const{performance:n}=se;if(!n||!n.now)return Jr;const e=Date.now()-n.now(),t=n.timeOrigin==null?e:n.timeOrigin;return()=>(t+n.now())/Ep}const Dt=Q_();(()=>{const{performance:n}=se;if(!n||!n.now)return;const e=3600*1e3,t=n.now(),r=Date.now(),i=n.timeOrigin?Math.abs(n.timeOrigin+t-r):e,s=i<e,a=n.timing&&n.timing.navigationStart,c=typeof a=="number"?Math.abs(a+t-r):e,u=c<e;return s||u?i<=c?n.timeOrigin:a:r})();function We(){const n=se,e=n.crypto||n.msCrypto;let t=()=>Math.random()*16;try{if(e&&e.randomUUID)return e.randomUUID().replace(/-/g,"");e&&e.getRandomValues&&(t=()=>{const r=new Uint8Array(1);return e.getRandomValues(r),r[0]})}catch{}return([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,r=>(r^(t()&15)>>r/4).toString(16))}function wp(n){return n.exception&&n.exception.values?n.exception.values[0]:void 0}function un(n){const{message:e,event_id:t}=n;if(e)return e;const r=wp(n);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||t||"<unknown>":t||"<unknown>"}function ey(n,e,t){const r=n.exception=n.exception||{},i=r.values=r.values||[],s=i[0]=i[0]||{};s.value||(s.value=e||""),s.type||(s.type=t||"Error")}function kc(n,e){const t=wp(n);if(!t)return;const r={type:"generic",handled:!0},i=t.mechanism;if(t.mechanism={...r,...i,...e},e&&"data"in e){const s={...i&&i.data,...e.data};t.mechanism.data=s}}const ty=/^(0|[1-9]\d*)\.(0|[1-9]\d*)\.(0|[1-9]\d*)(?:-((?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\.(?:0|[1-9]\d*|\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\+([0-9a-zA-Z-]+(?:\.[0-9a-zA-Z-]+)*))?$/;function Ea(n){return parseInt(n||"",10)}function Sp(n){const e=n.match(ty)||[],t=Ea(e[1]),r=Ea(e[2]),i=Ea(e[3]);return{buildmetadata:e[5],major:isNaN(t)?void 0:t,minor:isNaN(r)?void 0:r,patch:isNaN(i)?void 0:i,prerelease:e[4]}}function hl(n){if(ny(n))return!0;try{kt(n,"__sentry_captured__",!0)}catch{}return!1}function ny(n){try{return n.__sentry_captured__}catch{}}var Pt;(function(n){n[n.PENDING=0]="PENDING";const t=1;n[n.RESOLVED=t]="RESOLVED";const r=2;n[n.REJECTED=r]="REJECTED"})(Pt||(Pt={}));function Sn(n){return new Je(e=>{e(n)})}function Tp(n){return new Je((e,t)=>{t(n)})}class Je{constructor(e){Je.prototype.__init.call(this),Je.prototype.__init2.call(this),Je.prototype.__init3.call(this),Je.prototype.__init4.call(this),this._state=Pt.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(t){this._reject(t)}}then(e,t){return new Je((r,i)=>{this._handlers.push([!1,s=>{if(!e)r(s);else try{r(e(s))}catch(a){i(a)}},s=>{if(!t)i(s);else try{r(t(s))}catch(a){i(a)}}]),this._executeHandlers()})}catch(e){return this.then(t=>t,e)}finally(e){return new Je((t,r)=>{let i,s;return this.then(a=>{s=!1,i=a,e&&e()},a=>{s=!0,i=a,e&&e()}).then(()=>{if(s){r(i);return}t(i)})})}__init(){this._resolve=e=>{this._setResult(Pt.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(Pt.REJECTED,e)}}__init3(){this._setResult=(e,t)=>{if(this._state===Pt.PENDING){if(Kr(t)){t.then(this._resolve,this._reject);return}this._state=e,this._value=t,this._executeHandlers()}}}__init4(){this._executeHandlers=()=>{if(this._state===Pt.PENDING)return;const e=this._handlers.slice();this._handlers=[],e.forEach(t=>{t[0]||(this._state===Pt.RESOLVED&&t[1](this._value),this._state===Pt.REJECTED&&t[2](this._value),t[0]=!0)})}}}function Cs(n){const e=Dt(),t={sid:We(),init:!0,timestamp:e,started:e,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>iy(t)};return n&&Qt(t,n),t}function Qt(n,e={}){if(e.user&&(!n.ipAddress&&e.user.ip_address&&(n.ipAddress=e.user.ip_address),!n.did&&!e.did&&(n.did=e.user.id||e.user.email||e.user.username)),n.timestamp=e.timestamp||Dt(),e.abnormal_mechanism&&(n.abnormal_mechanism=e.abnormal_mechanism),e.ignoreDuration&&(n.ignoreDuration=e.ignoreDuration),e.sid&&(n.sid=e.sid.length===32?e.sid:We()),e.init!==void 0&&(n.init=e.init),!n.did&&e.did&&(n.did=`${e.did}`),typeof e.started=="number"&&(n.started=e.started),n.ignoreDuration)n.duration=void 0;else if(typeof e.duration=="number")n.duration=e.duration;else{const t=n.timestamp-n.started;n.duration=t>=0?t:0}e.release&&(n.release=e.release),e.environment&&(n.environment=e.environment),!n.ipAddress&&e.ipAddress&&(n.ipAddress=e.ipAddress),!n.userAgent&&e.userAgent&&(n.userAgent=e.userAgent),typeof e.errors=="number"&&(n.errors=e.errors),e.status&&(n.status=e.status)}function ry(n,e){let t={};e?t={status:e}:n.status==="ok"&&(t={status:"exited"}),Qt(n,t)}function iy(n){return ae({sid:`${n.sid}`,init:n.init,started:new Date(n.started*1e3).toISOString(),timestamp:new Date(n.timestamp*1e3).toISOString(),status:n.status,errors:n.errors,did:typeof n.did=="number"||typeof n.did=="string"?`${n.did}`:void 0,duration:n.duration,abnormal_mechanism:n.abnormal_mechanism,attrs:{release:n.release,environment:n.environment,ip_address:n.ipAddress,user_agent:n.userAgent}})}function Yn(){return We()}function Ft(){return We().substring(16)}function Ns(n,e,t=2){if(!e||typeof e!="object"||t<=0)return e;if(n&&e&&Object.keys(e).length===0)return n;const r={...n};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=Ns(r[i],e[i],t-1));return r}const Mo="_sentrySpan";function is(n,e){e?kt(n,Mo,e):delete n[Mo]}function Fr(n){return n[Mo]}const sy=100;class Dc{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:Yn(),spanId:Ft()}}clone(){const e=new Dc;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},this._contexts.flags&&(e._contexts.flags={values:[...this._contexts.flags.values]}),e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._requestSession=this._requestSession,e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,is(e,Fr(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&Qt(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,t){return this._tags={...this._tags,[e]:t},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,t){return this._extra={...this._extra,[e]:t},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,t){return t===null?delete this._contexts[e]:this._contexts[e]=t,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const t=typeof e=="function"?e(this):e,[r,i]=t instanceof jt?[t.getScopeData(),t.getRequestSession()]:Xn(t)?[e,e.requestSession]:[],{tags:s,extra:a,user:o,contexts:c,level:u,fingerprint:l=[],propagationContext:d}=r||{};return this._tags={...this._tags,...s},this._extra={...this._extra,...a},this._contexts={...this._contexts,...c},o&&Object.keys(o).length&&(this._user=o),u&&(this._level=u),l.length&&(this._fingerprint=l),d&&(this._propagationContext=d),i&&(this._requestSession=i),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._session=void 0,is(this,void 0),this._attachments=[],this.setPropagationContext({traceId:Yn()}),this._notifyScopeListeners(),this}addBreadcrumb(e,t){const r=typeof t=="number"?t:sy;if(r<=0)return this;const i={timestamp:Jr(),...e},s=this._breadcrumbs;return s.push(i),this._breadcrumbs=s.length>r?s.slice(-r):s,this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:Fr(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=Ns(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext={spanId:Ft(),...e},this}getPropagationContext(){return this._propagationContext}captureException(e,t){const r=t&&t.event_id?t.event_id:We();if(!this._client)return w.warn("No client configured on scope - will not capture exception!"),r;const i=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:i,...t,event_id:r},this),r}captureMessage(e,t,r){const i=r&&r.event_id?r.event_id:We();if(!this._client)return w.warn("No client configured on scope - will not capture message!"),i;const s=new Error(e);return this._client.captureMessage(e,t,{originalException:e,syntheticException:s,...r,event_id:i},this),i}captureEvent(e,t){const r=t&&t.event_id?t.event_id:We();return this._client?(this._client.captureEvent(e,{...t,event_id:r},this),r):(w.warn("No client configured on scope - will not capture event!"),r)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach(e=>{e(this)}),this._notifyingListeners=!1)}}const jt=Dc;function Fc(){return Yr("defaultCurrentScope",()=>new jt)}function jc(){return Yr("defaultIsolationScope",()=>new jt)}class ay{constructor(e,t){let r;e?r=e:r=new jt;let i;t?i=t:i=new jt,this._stack=[{scope:r}],this._isolationScope=i}withScope(e){const t=this._pushScope();let r;try{r=e(t)}catch(i){throw this._popScope(),i}return Kr(r)?r.then(i=>(this._popScope(),i),i=>{throw this._popScope(),i}):(this._popScope(),r)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return this._stack.length<=1?!1:!!this._stack.pop()}}function Kn(){const n=nn(),e=Is(n);return e.stack=e.stack||new ay(Fc(),jc())}function oy(n){return Kn().withScope(n)}function cy(n,e){const t=Kn();return t.withScope(()=>(t.getStackTop().scope=n,e(n)))}function ml(n){return Kn().withScope(()=>n(Kn().getIsolationScope()))}function uy(){return{withIsolationScope:ml,withScope:oy,withSetScope:cy,withSetIsolationScope:(n,e)=>ml(e),getCurrentScope:()=>Kn().getScope(),getIsolationScope:()=>Kn().getIsolationScope()}}function ly(n){const e=nn(),t=Is(e);t.acs=n}function dr(n){const e=Is(n);return e.acs?e.acs:uy()}function re(){const n=nn();return dr(n).getCurrentScope()}function Me(){const n=nn();return dr(n).getIsolationScope()}function Uc(){return Yr("globalScope",()=>new jt)}function Bc(...n){const e=nn(),t=dr(e);if(n.length===2){const[r,i]=n;return r?t.withSetScope(r,i):t.withScope(i)}return t.withScope(n[0])}function Q(){return re().getClient()}function Gc(n){const e=n.getPropagationContext(),{traceId:t,spanId:r,parentSpanId:i}=e;return ae({trace_id:t,span_id:r,parent_span_id:i})}const ko="_sentryMetrics";function jr(n){const e=n[ko];if(!e)return;const t={};for(const[,[r,i]]of e)(t[r]||(t[r]=[])).push(ae(i));return t}function dy(n,e,t,r,i,s,a){const c=n[ko]||(n[ko]=new Map),u=`${e}:${t}@${i}`,l=c.get(a);if(l){const[,d]=l;c.set(a,[u,{min:Math.min(d.min,r),max:Math.max(d.max,r),count:d.count+=1,sum:d.sum+=r,tags:d.tags}])}else c.set(a,[u,{min:r,max:r,count:1,sum:r,tags:s}])}const ut="sentry.source",Jn="sentry.sample_rate",St="sentry.op",Ut="sentry.origin",fy="sentry.measurement_unit",py="sentry.measurement_value",Qn="sentry.custom_span_name",hy="sentry.profile_id",my="sentry.exclusive_time",gy=0,ss=1,Ee=2;function Ap(n){if(n<400&&n>=100)return{code:ss};if(n>=400&&n<500)switch(n){case 401:return{code:Ee,message:"unauthenticated"};case 403:return{code:Ee,message:"permission_denied"};case 404:return{code:Ee,message:"not_found"};case 409:return{code:Ee,message:"already_exists"};case 413:return{code:Ee,message:"failed_precondition"};case 429:return{code:Ee,message:"resource_exhausted"};case 499:return{code:Ee,message:"cancelled"};default:return{code:Ee,message:"invalid_argument"}}if(n>=500&&n<600)switch(n){case 501:return{code:Ee,message:"unimplemented"};case 503:return{code:Ee,message:"unavailable"};case 504:return{code:Ee,message:"deadline_exceeded"};default:return{code:Ee,message:"internal_error"}}return{code:Ee,message:"unknown_error"}}function gl(n,e){n.setAttribute("http.response.status_code",e);const t=Ap(e);t.message!=="unknown_error"&&n.setStatus(t)}const Hc="sentry-",_y=/^sentry-/,yy=8192;function Ls(n){const e=Op(n);if(!e)return;const t=Object.entries(e).reduce((r,[i,s])=>{if(i.match(_y)){const a=i.slice(Hc.length);r[a]=s}return r},{});if(Object.keys(t).length>0)return t}function xs(n){if(!n)return;const e=Object.entries(n).reduce((t,[r,i])=>(i&&(t[`${Hc}${r}`]=i),t),{});return by(e)}function Op(n){if(!(!n||!rs(n)&&!Array.isArray(n)))return Array.isArray(n)?n.reduce((e,t)=>{const r=_l(t);return Object.entries(r).forEach(([i,s])=>{e[i]=s}),e},{}):_l(n)}function _l(n){return n.split(",").map(e=>e.split("=").map(t=>decodeURIComponent(t.trim()))).reduce((e,[t,r])=>(t&&r&&(e[t]=r),e),{})}function by(n){if(Object.keys(n).length!==0)return Object.entries(n).reduce((e,[t,r],i)=>{const s=`${encodeURIComponent(t)}=${encodeURIComponent(r)}`,a=i===0?s:`${e},${s}`;return a.length>yy?(On&&w.warn(`Not adding key: ${t} with val: ${r} to baggage header due to exceeding baggage size limits.`),e):a},"")}const Rp=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function vy(n){if(!n)return;const e=n.match(Rp);if(!e)return;let t;return e[3]==="1"?t=!0:e[3]==="0"&&(t=!1),{traceId:e[1],parentSampled:t,parentSpanId:e[2]}}function Ey(n,e){const t=vy(n),r=Ls(e);if(!t||!t.traceId)return{traceId:Yn(),spanId:Ft()};const{traceId:i,parentSpanId:s,parentSampled:a}=t,o=Ft();return{traceId:i,parentSpanId:s,spanId:o,sampled:a,dsc:r||{}}}function Qr(n=Yn(),e=Ft(),t){let r="";return t!==void 0&&(r=t?"-1":"-0"),`${n}-${e}${r}`}const Ip=0,Pp=1;let yl=!1;function wy(n){const{spanId:e,traceId:t}=n.spanContext(),{data:r,op:i,parent_span_id:s,status:a,origin:o}=Pe(n);return ae({parent_span_id:s,span_id:e,trace_id:t,data:r,op:i,status:a,origin:o})}function Wc(n){const{spanId:e,traceId:t,isRemote:r}=n.spanContext(),i=r?e:Pe(n).parent_span_id,s=r?Ft():e;return ae({parent_span_id:i,span_id:s,trace_id:t})}function Cp(n){const{traceId:e,spanId:t}=n.spanContext(),r=fr(n);return Qr(e,t,r)}function Et(n){return typeof n=="number"?bl(n):Array.isArray(n)?n[0]+n[1]/1e9:n instanceof Date?bl(n.getTime()):Dt()}function bl(n){return n>9999999999?n/1e3:n}function Pe(n){if(Ty(n))return n.getSpanJSON();try{const{spanId:e,traceId:t}=n.spanContext();if(Sy(n)){const{attributes:r,startTime:i,name:s,endTime:a,parentSpanId:o,status:c}=n;return ae({span_id:e,trace_id:t,data:r,description:s,parent_span_id:o,start_timestamp:Et(i),timestamp:Et(a)||void 0,status:$s(c),op:r[St],origin:r[Ut],_metrics_summary:jr(n)})}return{span_id:e,trace_id:t}}catch{return{}}}function Sy(n){const e=n;return!!e.attributes&&!!e.startTime&&!!e.name&&!!e.endTime&&!!e.status}function Ty(n){return typeof n.getSpanJSON=="function"}function fr(n){const{traceFlags:e}=n.spanContext();return e===Pp}function $s(n){if(!(!n||n.code===gy))return n.code===ss?"ok":n.message||"unknown_error"}const Pr="_sentryChildSpans",Do="_sentryRootSpan";function Vc(n,e){const t=n[Do]||n;kt(e,Do,t),n[Pr]?n[Pr].add(e):kt(n,Pr,new Set([e]))}function Ay(n){const e=new Set;function t(r){if(!e.has(r)&&fr(r)){e.add(r);const i=r[Pr]?Array.from(r[Pr]):[];for(const s of i)t(s)}}return t(n),Array.from(e)}function et(n){return n[Do]||n}function Ms(){const n=nn(),e=dr(n);return e.getActiveSpan?e.getActiveSpan():Fr(re())}function Oy(n,e,t,r,i,s){const a=Ms();a&&dy(a,n,e,t,r,i,s)}function Np(){yl||(Jt(()=>{console.warn("[Sentry] Deprecation warning: Returning null from `beforeSendSpan` will be disallowed from SDK version 9.0.0 onwards. The callback will only support mutating spans. To drop certain spans, configure the respective integrations directly.")}),yl=!0)}let vl=!1;function Ry(){vl||(vl=!0,L_(Fo),$_(Fo))}function Fo(){const n=Ms(),e=n&&et(n);if(e){const t="internal_error";j&&w.log(`[Tracing] Root span: ${t} -> Global error occurred`),e.setStatus({code:Ee,message:t})}}Fo.tag="sentry_tracingErrorCallback";const Lp="_sentryScope",xp="_sentryIsolationScope";function $p(n,e,t){n&&(kt(n,xp,t),kt(n,Lp,e))}function as(n){return{scope:n[Lp],isolationScope:n[xp]}}function ei(n){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const e=Q(),t=n||e&&e.getOptions();return!!t&&(t.enableTracing||"tracesSampleRate"in t||"tracesSampler"in t)}class ti{constructor(e={}){this._traceId=e.traceId||Yn(),this._spanId=e.spanId||Ft()}spanContext(){return{spanId:this._spanId,traceId:this._traceId,traceFlags:Ip}}end(e){}setAttribute(e,t){return this}setAttributes(e){return this}setStatus(e){return this}updateName(e){return this}isRecording(){return!1}addEvent(e,t,r){return this}addLink(e){return this}addLinks(e){return this}recordException(e,t){}}function ks(n,e,t=()=>{}){let r;try{r=n()}catch(i){throw e(i),t(),i}return Iy(r,e,t)}function Iy(n,e,t){return Kr(n)?n.then(r=>(t(),r),r=>{throw e(r),t(),r}):(t(),n)}const zc="production",Mp="_frozenDsc";function El(n,e){kt(n,Mp,e)}function qc(n,e){const t=e.getOptions(),{publicKey:r}=e.getDsn()||{},i=ae({environment:t.environment||zc,release:t.release,public_key:r,trace_id:n});return e.emit("createDsc",i),i}function ni(n,e){const t=e.getPropagationContext();return t.dsc||qc(t.traceId,n)}function Ve(n){const e=Q();if(!e)return{};const t=et(n),r=t[Mp];if(r)return r;const i=t.spanContext().traceState,s=i&&i.get("sentry.dsc"),a=s&&Ls(s);if(a)return a;const o=qc(n.spanContext().traceId,e),c=Pe(t),u=c.data||{},l=u[Jn];l!=null&&(o.sample_rate=`${l}`);const d=u[ut],f=c.description;return d!=="url"&&f&&(o.transaction=f),ei()&&(o.sampled=String(fr(t))),e.emit("createDsc",o,t),o}function kp(n){if(!j)return;const{description:e="< unknown name >",op:t="< unknown op >",parent_span_id:r}=Pe(n),{spanId:i}=n.spanContext(),s=fr(n),a=et(n),o=a===n,c=`[Tracing] Starting ${s?"sampled":"unsampled"} ${o?"root ":""}span`,u=[`op: ${t}`,`name: ${e}`,`ID: ${i}`];if(r&&u.push(`parent ID: ${r}`),!o){const{op:l,description:d}=Pe(a);u.push(`root ID: ${a.spanContext().spanId}`),l&&u.push(`root op: ${l}`),d&&u.push(`root description: ${d}`)}w.log(`${c}
  ${u.join(`
  `)}`)}function Dp(n){if(!j)return;const{description:e="< unknown name >",op:t="< unknown op >"}=Pe(n),{spanId:r}=n.spanContext(),s=et(n)===n,a=`[Tracing] Finishing "${t}" ${s?"root ":""}span "${e}" with ID ${r}`;w.log(a)}function Fp(n){if(typeof n=="boolean")return Number(n);const e=typeof n=="string"?parseFloat(n):n;if(typeof e!="number"||isNaN(e)||e<0||e>1){j&&w.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(n)} of type ${JSON.stringify(typeof n)}.`);return}return e}function jp(n,e){if(!ei(n))return[!1];const t=Me().getScopeData().sdkProcessingMetadata.normalizedRequest,r={...e,normalizedRequest:e.normalizedRequest||t};let i;typeof n.tracesSampler=="function"?i=n.tracesSampler(r):r.parentSampled!==void 0?i=r.parentSampled:typeof n.tracesSampleRate<"u"?i=n.tracesSampleRate:i=1;const s=Fp(i);return s===void 0?(j&&w.warn("[Tracing] Discarding transaction because of invalid sample rate."),[!1]):s?Math.random()<s?[!0,s]:(j&&w.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(i)})`),[!1,s]):(j&&w.log(`[Tracing] Discarding transaction because ${typeof n.tracesSampler=="function"?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0"}`),[!1,s])}const Py=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function Cy(n){return n==="http"||n==="https"}function pr(n,e=!1){const{host:t,path:r,pass:i,port:s,projectId:a,protocol:o,publicKey:c}=n;return`${o}://${c}${e&&i?`:${i}`:""}@${t}${s?`:${s}`:""}/${r&&`${r}/`}${a}`}function Ny(n){const e=Py.exec(n);if(!e){Jt(()=>{console.error(`Invalid Sentry Dsn: ${n}`)});return}const[t,r,i="",s="",a="",o=""]=e.slice(1);let c="",u=o;const l=u.split("/");if(l.length>1&&(c=l.slice(0,-1).join("/"),u=l.pop()),u){const d=u.match(/^\d+/);d&&(u=d[0])}return Up({host:s,pass:i,path:c,projectId:u,port:a,protocol:t,publicKey:r})}function Up(n){return{protocol:n.protocol,publicKey:n.publicKey||"",pass:n.pass||"",host:n.host,port:n.port||"",path:n.path||"",projectId:n.projectId}}function Ly(n){if(!On)return!0;const{port:e,projectId:t,protocol:r}=n;return["protocol","publicKey","host","projectId"].find(a=>n[a]?!1:(w.error(`Invalid Sentry Dsn: ${a} missing`),!0))?!1:t.match(/^\d+$/)?Cy(r)?e&&isNaN(parseInt(e,10))?(w.error(`Invalid Sentry Dsn: Invalid port ${e}`),!1):!0:(w.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),!1):(w.error(`Invalid Sentry Dsn: Invalid projectId ${t}`),!1)}function xy(n){const e=typeof n=="string"?Ny(n):Up(n);if(!(!e||!Ly(e)))return e}function $y(){const n=typeof WeakSet=="function",e=n?new WeakSet:[];function t(i){if(n)return e.has(i)?!0:(e.add(i),!1);for(let s=0;s<e.length;s++)if(e[s]===i)return!0;return e.push(i),!1}function r(i){if(n)e.delete(i);else for(let s=0;s<e.length;s++)if(e[s]===i){e.splice(s,1);break}}return[t,r]}function Ct(n,e=100,t=1/0){try{return jo("",n,e,t)}catch(r){return{ERROR:`**non-serializable** (${r})`}}}function Bp(n,e=3,t=100*1024){const r=Ct(n,e);return Fy(r)>t?Bp(n,e-1,t):r}function jo(n,e,t=1/0,r=1/0,i=$y()){const[s,a]=i;if(e==null||["boolean","string"].includes(typeof e)||typeof e=="number"&&Number.isFinite(e))return e;const o=My(n,e);if(!o.startsWith("[object "))return o;if(e.__sentry_skip_normalization__)return e;const c=typeof e.__sentry_override_normalization_depth__=="number"?e.__sentry_override_normalization_depth__:t;if(c===0)return o.replace("object ","");if(s(e))return"[Circular ~]";const u=e;if(u&&typeof u.toJSON=="function")try{const p=u.toJSON();return jo("",p,c-1,r,i)}catch{}const l=Array.isArray(e)?[]:{};let d=0;const f=vp(e);for(const p in f){if(!Object.prototype.hasOwnProperty.call(f,p))continue;if(d>=r){l[p]="[MaxProperties ~]";break}const h=f[p];l[p]=jo(p,h,c-1,r,i),d++}return a(e),l}function My(n,e){try{if(n==="domain"&&e&&typeof e=="object"&&e._events)return"[Domain]";if(n==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&e===global)return"[Global]";if(typeof window<"u"&&e===window)return"[Window]";if(typeof document<"u"&&e===document)return"[Document]";if(G_(e))return"[VueViewModel]";if(B_(e))return"[SyntheticEvent]";if(typeof e=="number"&&!Number.isFinite(e))return`[${e}]`;if(typeof e=="function")return`[Function: ${gp(e)}]`;if(typeof e=="symbol")return`[${String(e)}]`;if(typeof e=="bigint")return`[BigInt: ${String(e)}]`;const t=ky(e);return/^HTML(\w*)Element$/.test(t)?`[HTMLElement: ${t}]`:`[object ${t}]`}catch(t){return`**non-serializable** (${t})`}}function ky(n){const e=Object.getPrototypeOf(n);return e?e.constructor.name:"null prototype"}function Dy(n){return~-encodeURI(n).split(/%..|./).length}function Fy(n){return Dy(JSON.stringify(n))}function yt(n,e){const t=e.replace(/\\/g,"/").replace(/[|\\{}()[\]^$+*?.]/g,"\\$&");let r=n;try{r=decodeURI(n)}catch{}return r.replace(/\\/g,"/").replace(/webpack:\/?/g,"").replace(new RegExp(`(file://)?/*${t}/*`,"ig"),"app:///")}function rn(n,e=[]){return[n,e]}function Uo(n,e){const[t,r]=n;return[t,[...r,e]]}function er(n,e){const t=n[1];for(const r of t){const i=r[0].type;if(e(r,i))return!0}return!1}function wl(n,e){return er(n,(t,r)=>e.includes(r))}function os(n){return se.__SENTRY__&&se.__SENTRY__.encodePolyfill?se.__SENTRY__.encodePolyfill(n):new TextEncoder().encode(n)}function jy(n){return se.__SENTRY__&&se.__SENTRY__.decodePolyfill?se.__SENTRY__.decodePolyfill(n):new TextDecoder().decode(n)}function Gp(n){const[e,t]=n;let r=JSON.stringify(e);function i(s){typeof r=="string"?r=typeof s=="string"?r+s:[os(r),s]:r.push(typeof s=="string"?os(s):s)}for(const s of t){const[a,o]=s;if(i(`
${JSON.stringify(a)}
`),typeof o=="string"||o instanceof Uint8Array)i(o);else{let c;try{c=JSON.stringify(o)}catch{c=JSON.stringify(Ct(o))}i(c)}}return typeof r=="string"?r:Uy(r)}function Uy(n){const e=n.reduce((i,s)=>i+s.length,0),t=new Uint8Array(e);let r=0;for(const i of n)t.set(i,r),r+=i.length;return t}function Zc(n){let e=typeof n=="string"?os(n):n;function t(a){const o=e.subarray(0,a);return e=e.subarray(a+1),o}function r(){let a=e.indexOf(10);return a<0&&(a=e.length),JSON.parse(jy(t(a)))}const i=r(),s=[];for(;e.length;){const a=r(),o=typeof a.length=="number"?a.length:void 0;s.push([a,o?t(o):r()])}return[i,s]}function By(n){return[{type:"span"},n]}function Gy(n){const e=typeof n.data=="string"?os(n.data):n.data;return[ae({type:"attachment",length:e.length,filename:n.filename,content_type:n.contentType,attachment_type:n.attachmentType}),e]}const Hy={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"metric_bucket",raw_security:"security"};function Sl(n){return Hy[n]}function Hp(n){if(!n||!n.sdk)return;const{name:e,version:t}=n.sdk;return{name:e,version:t}}function Wy(n,e,t,r){const i=n.sdkProcessingMetadata&&n.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:n.event_id,sent_at:new Date().toISOString(),...e&&{sdk:e},...!!t&&r&&{dsn:pr(r)},...i&&{trace:ae({...i})}}}function Vy(n,e){return e&&(n.sdk=n.sdk||{},n.sdk.name=n.sdk.name||e.name,n.sdk.version=n.sdk.version||e.version,n.sdk.integrations=[...n.sdk.integrations||[],...e.integrations||[]],n.sdk.packages=[...n.sdk.packages||[],...e.packages||[]]),n}function zy(n,e,t,r){const i=Hp(t),s={sent_at:new Date().toISOString(),...i&&{sdk:i},...!!r&&e&&{dsn:pr(e)}},a="aggregates"in n?[{type:"sessions"},n]:[{type:"session"},n.toJSON()];return rn(s,[a])}function qy(n,e,t,r){const i=Hp(t),s=n.type&&n.type!=="replay_event"?n.type:"event";Vy(n,t&&t.sdk);const a=Wy(n,i,r,e);return delete n.sdkProcessingMetadata,rn(a,[[{type:s},n]])}function Zy(n,e){function t(l){return!!l.trace_id&&!!l.public_key}const r=Ve(n[0]),i=e&&e.getDsn(),s=e&&e.getOptions().tunnel,a={sent_at:new Date().toISOString(),...t(r)&&{trace:r},...!!s&&i&&{dsn:pr(i)}},o=e&&e.getOptions().beforeSendSpan,c=o?l=>{const d=o(Pe(l));return d||Np(),d}:l=>Pe(l),u=[];for(const l of n){const d=c(l);d&&u.push(By(d))}return rn(a,u)}function cs(n){if(!n||n.length===0)return;const e={};return n.forEach(t=>{const r=t.attributes||{},i=r[fy],s=r[py];typeof i=="string"&&typeof s=="number"&&(e[t.name]={value:s,unit:i})}),e}const Tl=1e3;class Xc{constructor(e={}){this._traceId=e.traceId||Yn(),this._spanId=e.spanId||Ft(),this._startTime=e.startTimestamp||Dt(),this._attributes={},this.setAttributes({[Ut]:"manual",[St]:e.op,...e.attributes}),this._name=e.name,e.parentSpanId&&(this._parentSpanId=e.parentSpanId),"sampled"in e&&(this._sampled=e.sampled),e.endTimestamp&&(this._endTime=e.endTimestamp),this._events=[],this._isStandaloneSpan=e.isStandalone,this._endTime&&this._onSpanEnded()}addLink(e){return this}addLinks(e){return this}recordException(e,t){}spanContext(){const{_spanId:e,_traceId:t,_sampled:r}=this;return{spanId:e,traceId:t,traceFlags:r?Pp:Ip}}setAttribute(e,t){return t===void 0?delete this._attributes[e]:this._attributes[e]=t,this}setAttributes(e){return Object.keys(e).forEach(t=>this.setAttribute(t,e[t])),this}updateStartTime(e){this._startTime=Et(e)}setStatus(e){return this._status=e,this}updateName(e){return this._name=e,this.setAttribute(ut,"custom"),this}end(e){this._endTime||(this._endTime=Et(e),Dp(this),this._onSpanEnded())}getSpanJSON(){return ae({data:this._attributes,description:this._name,op:this._attributes[St],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:$s(this._status),timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[Ut],_metrics_summary:jr(this),profile_id:this._attributes[hy],exclusive_time:this._attributes[my],measurements:cs(this._events),is_segment:this._isStandaloneSpan&&et(this)===this||void 0,segment_id:this._isStandaloneSpan?et(this).spanContext().spanId:void 0})}isRecording(){return!this._endTime&&!!this._sampled}addEvent(e,t,r){j&&w.log("[Tracing] Adding an event to span:",e);const i=Al(t)?t:r||Dt(),s=Al(t)?{}:t||{},a={name:e,time:Et(i),attributes:s};return this._events.push(a),this}isStandaloneSpan(){return!!this._isStandaloneSpan}_onSpanEnded(){const e=Q();if(e&&e.emit("spanEnd",this),!(this._isStandaloneSpan||this===et(this)))return;if(this._isStandaloneSpan){this._sampled?Yy(Zy([this],e)):(j&&w.log("[Tracing] Discarding standalone span because its trace was not chosen to be sampled."),e&&e.recordDroppedEvent("sample_rate","span"));return}const r=this._convertSpanToTransaction();r&&(as(this).scope||re()).captureEvent(r)}_convertSpanToTransaction(){if(!Ol(Pe(this)))return;this._name||(j&&w.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>");const{scope:e,isolationScope:t}=as(this),i=(e||re()).getClient()||Q();if(this._sampled!==!0){j&&w.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled."),i&&i.recordDroppedEvent("sample_rate","transaction");return}const a=Ay(this).filter(d=>d!==this&&!Xy(d)).map(d=>Pe(d)).filter(Ol),o=this._attributes[ut];delete this._attributes[Qn],a.forEach(d=>{d.data&&delete d.data[Qn]});const c={contexts:{trace:wy(this)},spans:a.length>Tl?a.sort((d,f)=>d.start_timestamp-f.start_timestamp).slice(0,Tl):a,start_timestamp:this._startTime,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:e,capturedSpanIsolationScope:t,...ae({dynamicSamplingContext:Ve(this)})},_metrics_summary:jr(this),...o&&{transaction_info:{source:o}}},u=cs(this._events);return u&&Object.keys(u).length&&(j&&w.log("[Measurements] Adding measurements to transaction event",JSON.stringify(u,void 0,2)),c.measurements=u),c}}function Al(n){return n&&typeof n=="number"||n instanceof Date||Array.isArray(n)}function Ol(n){return!!n.start_timestamp&&!!n.timestamp&&!!n.span_id&&!!n.trace_id}function Xy(n){return n instanceof Xc&&n.isStandaloneSpan()}function Yy(n){const e=Q();if(!e)return;const t=n[1];if(!t||t.length===0){e.recordDroppedEvent("before_send","span");return}e.sendEnvelope(n)}const Wp="__SENTRY_SUPPRESS_TRACING__";function Ky(n,e){const t=Yc();if(t.startSpanManual)return t.startSpanManual(n,e);const r=qp(n),{forceTransaction:i,parentSpan:s}=n;return Bc(n.scope,()=>eb(s)(()=>{const o=re(),c=Zp(o),l=n.onlyIfParent&&!c?new ti:zp({parentSpan:c,spanArguments:r,forceTransaction:i,scope:o});is(o,l);function d(){l.end()}return ks(()=>e(l,d),()=>{const{status:f}=Pe(l);l.isRecording()&&(!f||f==="ok")&&l.setStatus({code:Ee,message:"internal_error"})})}))}function Jy(n){const e=Yc();if(e.startInactiveSpan)return e.startInactiveSpan(n);const t=qp(n),{forceTransaction:r,parentSpan:i}=n;return(n.scope?a=>Bc(n.scope,a):i!==void 0?a=>Vp(i,a):a=>a())(()=>{const a=re(),o=Zp(a);return n.onlyIfParent&&!o?new ti:zp({parentSpan:o,spanArguments:t,forceTransaction:r,scope:a})})}function Vp(n,e){const t=Yc();return t.withActiveSpan?t.withActiveSpan(n,e):Bc(r=>(is(r,n||void 0),e(r)))}function zp({parentSpan:n,spanArguments:e,forceTransaction:t,scope:r}){if(!ei())return new ti;const i=Me();let s;if(n&&!t)s=Qy(n,r,e),Vc(n,s);else if(n){const a=Ve(n),{traceId:o,spanId:c}=n.spanContext(),u=fr(n);s=Rl({traceId:o,parentSpanId:c,...e},r,u),El(s,a)}else{const{traceId:a,dsc:o,parentSpanId:c,sampled:u}={...i.getPropagationContext(),...r.getPropagationContext()};s=Rl({traceId:a,parentSpanId:c,...e},r,u),o&&El(s,o)}return kp(s),$p(s,r,i),s}function qp(n){const t={isStandalone:(n.experimental||{}).standalone,...n};if(n.startTime){const r={...t};return r.startTimestamp=Et(n.startTime),delete r.startTime,r}return t}function Yc(){const n=nn();return dr(n)}function Rl(n,e,t){const r=Q(),i=r&&r.getOptions()||{},{name:s="",attributes:a}=n,[o,c]=e.getScopeData().sdkProcessingMetadata[Wp]?[!1]:jp(i,{name:s,parentSampled:t,attributes:a,transactionContext:{name:s,parentSampled:t}}),u=new Xc({...n,attributes:{[ut]:"custom",...n.attributes},sampled:o});return c!==void 0&&u.setAttribute(Jn,c),r&&r.emit("spanStart",u),u}function Qy(n,e,t){const{spanId:r,traceId:i}=n.spanContext(),s=e.getScopeData().sdkProcessingMetadata[Wp]?!1:fr(n),a=s?new Xc({...t,parentSpanId:r,traceId:i,sampled:s}):new ti({traceId:i});Vc(n,a);const o=Q();return o&&(o.emit("spanStart",a),t.endTimestamp&&o.emit("spanEnd",a)),a}function Zp(n){const e=Fr(n);if(!e)return;const t=Q();return(t?t.getOptions():{}).parentSpanIsAlwaysRootSpan?et(e):e}function eb(n){return n!==void 0?e=>Vp(n,e):e=>e()}function Bo(n,e,t,r=0){return new Je((i,s)=>{const a=n[r];if(e===null||typeof a!="function")i(e);else{const o=a({...e},t);j&&a.id&&o===null&&w.log(`Event processor "${a.id}" dropped event`),Kr(o)?o.then(c=>Bo(n,c,t,r+1).then(i)).then(null,s):Bo(n,o,t,r+1).then(i).then(null,s)}})}let wi,Il,Si;function tb(n){const e=se._sentryDebugIds;if(!e)return{};const t=Object.keys(e);return Si&&t.length===Il||(Il=t.length,Si=t.reduce((r,i)=>{wi||(wi={});const s=wi[i];if(s)r[s[0]]=s[1];else{const a=n(i);for(let o=a.length-1;o>=0;o--){const c=a[o],u=c&&c.filename,l=e[i];if(u&&l){r[u]=l,wi[i]=[u,l];break}}}return r},{})),Si}function Xp(n,e){const{fingerprint:t,span:r,breadcrumbs:i,sdkProcessingMetadata:s}=e;nb(n,e),r&&sb(n,r),ab(n,t),rb(n,i),ib(n,s)}function us(n,e){const{extra:t,tags:r,user:i,contexts:s,level:a,sdkProcessingMetadata:o,breadcrumbs:c,fingerprint:u,eventProcessors:l,attachments:d,propagationContext:f,transactionName:p,span:h}=e;Ti(n,"extra",t),Ti(n,"tags",r),Ti(n,"user",i),Ti(n,"contexts",s),n.sdkProcessingMetadata=Ns(n.sdkProcessingMetadata,o,2),a&&(n.level=a),p&&(n.transactionName=p),h&&(n.span=h),c.length&&(n.breadcrumbs=[...n.breadcrumbs,...c]),u.length&&(n.fingerprint=[...n.fingerprint,...u]),l.length&&(n.eventProcessors=[...n.eventProcessors,...l]),d.length&&(n.attachments=[...n.attachments,...d]),n.propagationContext={...n.propagationContext,...f}}function Ti(n,e,t){n[e]=Ns(n[e],t,1)}function nb(n,e){const{extra:t,tags:r,user:i,contexts:s,level:a,transactionName:o}=e,c=ae(t);c&&Object.keys(c).length&&(n.extra={...c,...n.extra});const u=ae(r);u&&Object.keys(u).length&&(n.tags={...u,...n.tags});const l=ae(i);l&&Object.keys(l).length&&(n.user={...l,...n.user});const d=ae(s);d&&Object.keys(d).length&&(n.contexts={...d,...n.contexts}),a&&(n.level=a),o&&n.type!=="transaction"&&(n.transaction=o)}function rb(n,e){const t=[...n.breadcrumbs||[],...e];n.breadcrumbs=t.length?t:void 0}function ib(n,e){n.sdkProcessingMetadata={...n.sdkProcessingMetadata,...e}}function sb(n,e){n.contexts={trace:Wc(e),...n.contexts},n.sdkProcessingMetadata={dynamicSamplingContext:Ve(e),...n.sdkProcessingMetadata};const t=et(e),r=Pe(t).description;r&&!n.transaction&&n.type==="transaction"&&(n.transaction=r)}function ab(n,e){n.fingerprint=n.fingerprint?Array.isArray(n.fingerprint)?n.fingerprint:[n.fingerprint]:[],e&&(n.fingerprint=n.fingerprint.concat(e)),n.fingerprint&&!n.fingerprint.length&&delete n.fingerprint}function ob(n,e,t,r,i,s){const{normalizeDepth:a=3,normalizeMaxBreadth:o=1e3}=n,c={...e,event_id:e.event_id||t.event_id||We(),timestamp:e.timestamp||Jr()},u=t.integrations||n.integrations.map(g=>g.name);cb(c,n),db(c,u),i&&i.emit("applyFrameMetadata",e),e.type===void 0&&ub(c,n.stackParser);const l=pb(r,t.captureContext);t.mechanism&&kc(c,t.mechanism);const d=i?i.getEventProcessors():[],f=Uc().getScopeData();if(s){const g=s.getScopeData();us(f,g)}if(l){const g=l.getScopeData();us(f,g)}const p=[...t.attachments||[],...f.attachments];p.length&&(t.attachments=p),Xp(c,f);const h=[...d,...f.eventProcessors];return Bo(h,c,t).then(g=>(g&&lb(g),typeof a=="number"&&a>0?fb(g,a,o):g))}function cb(n,e){const{environment:t,release:r,dist:i,maxValueLength:s=250}=e;n.environment=n.environment||t||zc,!n.release&&r&&(n.release=r),!n.dist&&i&&(n.dist=i),n.message&&(n.message=yn(n.message,s));const a=n.exception&&n.exception.values&&n.exception.values[0];a&&a.value&&(a.value=yn(a.value,s));const o=n.request;o&&o.url&&(o.url=yn(o.url,s))}function ub(n,e){const t=tb(e);try{n.exception.values.forEach(r=>{r.stacktrace.frames.forEach(i=>{t&&i.filename&&(i.debug_id=t[i.filename])})})}catch{}}function lb(n){const e={};try{n.exception.values.forEach(r=>{r.stacktrace.frames.forEach(i=>{i.debug_id&&(i.abs_path?e[i.abs_path]=i.debug_id:i.filename&&(e[i.filename]=i.debug_id),delete i.debug_id)})})}catch{}if(Object.keys(e).length===0)return;n.debug_meta=n.debug_meta||{},n.debug_meta.images=n.debug_meta.images||[];const t=n.debug_meta.images;Object.entries(e).forEach(([r,i])=>{t.push({type:"sourcemap",code_file:r,debug_id:i})})}function db(n,e){e.length>0&&(n.sdk=n.sdk||{},n.sdk.integrations=[...n.sdk.integrations||[],...e])}function fb(n,e,t){if(!n)return null;const r={...n,...n.breadcrumbs&&{breadcrumbs:n.breadcrumbs.map(i=>({...i,...i.data&&{data:Ct(i.data,e,t)}}))},...n.user&&{user:Ct(n.user,e,t)},...n.contexts&&{contexts:Ct(n.contexts,e,t)},...n.extra&&{extra:Ct(n.extra,e,t)}};return n.contexts&&n.contexts.trace&&r.contexts&&(r.contexts.trace=n.contexts.trace,n.contexts.trace.data&&(r.contexts.trace.data=Ct(n.contexts.trace.data,e,t))),n.spans&&(r.spans=n.spans.map(i=>({...i,...i.data&&{data:Ct(i.data,e,t)}}))),n.contexts&&n.contexts.flags&&r.contexts&&(r.contexts.flags=Ct(n.contexts.flags,3,t)),r}function pb(n,e){if(!e)return n;const t=n?n.clone():new jt;return t.update(e),t}function hb(n){if(n)return mb(n)?{captureContext:n}:_b(n)?{captureContext:n}:n}function mb(n){return n instanceof jt||typeof n=="function"}const gb=["user","level","extra","contexts","tags","fingerprint","requestSession","propagationContext"];function _b(n){return Object.keys(n).some(e=>gb.includes(e))}function Ds(n,e){return re().captureException(n,hb(e))}function Pl(n,e){const t=typeof e=="string"?e:void 0,r=typeof e!="string"?{captureContext:e}:void 0;return re().captureMessage(n,t,r)}function ri(n,e){return re().captureEvent(n,e)}async function yb(n){const e=Q();return e?e.flush(n):(j&&w.warn("Cannot flush events. No client defined."),Promise.resolve(!1))}function bb(){const n=Q();return!!n&&n.getOptions().enabled!==!1&&!!n.getTransport()}function vb(n){const e=Q(),t=Me(),r=re(),{release:i,environment:s=zc}=e&&e.getOptions()||{},{userAgent:a}=se.navigator||{},o=Cs({release:i,environment:s,user:r.getUser()||t.getUser(),...a&&{userAgent:a},...n}),c=t.getSession();return c&&c.status==="ok"&&Qt(c,{status:"exited"}),Kc(),t.setSession(o),r.setSession(o),o}function Kc(){const n=Me(),e=re(),t=e.getSession()||n.getSession();t&&ry(t),Yp(),n.setSession(),e.setSession()}function Yp(){const n=Me(),e=re(),t=Q(),r=e.getSession()||n.getSession();r&&t&&t.captureSession(r)}function Kp(n=!1){if(n){Kc();return}Yp()}class Eb{constructor(e,t){this._client=e,this.flushTimeout=60,this._pendingAggregates=new Map,this._isEnabled=!0,this._intervalId=setInterval(()=>this.flush(),this.flushTimeout*1e3),this._intervalId.unref&&this._intervalId.unref(),this._sessionAttrs=t}flush(){const e=this.getSessionAggregates();e.aggregates.length!==0&&(this._pendingAggregates=new Map,this._client.sendSession(e))}getSessionAggregates(){const e=Array.from(this._pendingAggregates.values()),t={attrs:this._sessionAttrs,aggregates:e};return ae(t)}close(){clearInterval(this._intervalId),this._isEnabled=!1,this.flush()}incrementSessionStatusCount(){if(!this._isEnabled)return;const e=Me(),t=e.getRequestSession();t&&t.status&&(this._incrementSessionStatusCount(t.status,new Date),e.setRequestSession(void 0))}_incrementSessionStatusCount(e,t){const r=new Date(t).setSeconds(0,0);let i=this._pendingAggregates.get(r);switch(i||(i={started:new Date(r).toISOString()},this._pendingAggregates.set(r,i)),e){case"errored":return i.errored=(i.errored||0)+1,i.errored;case"ok":return i.exited=(i.exited||0)+1,i.exited;default:return i.crashed=(i.crashed||0)+1,i.crashed}}}const wb="7";function Sb(n){const e=n.protocol?`${n.protocol}:`:"",t=n.port?`:${n.port}`:"";return`${e}//${n.host}${t}${n.path?`/${n.path}`:""}/api/`}function Tb(n){return`${Sb(n)}${n.projectId}/envelope/`}function Ab(n,e){const t={sentry_version:wb};return n.publicKey&&(t.sentry_key=n.publicKey),e&&(t.sentry_client=`${e.name}/${e.version}`),new URLSearchParams(t).toString()}function Ob(n,e,t){return e||`${Tb(n)}?${Ab(n,t)}`}const Cl=[];function Rb(n){const e={};return n.forEach(t=>{const{name:r}=t,i=e[r];i&&!i.isDefaultInstance&&t.isDefaultInstance||(e[r]=t)}),Object.values(e)}function Ib(n){const e=n.defaultIntegrations||[],t=n.integrations;e.forEach(a=>{a.isDefaultInstance=!0});let r;if(Array.isArray(t))r=[...e,...t];else if(typeof t=="function"){const a=t(e);r=Array.isArray(a)?a:[a]}else r=e;const i=Rb(r),s=i.findIndex(a=>a.name==="Debug");if(s>-1){const[a]=i.splice(s,1);i.push(a)}return i}function Pb(n,e){const t={};return e.forEach(r=>{r&&Jp(n,r,t)}),t}function Nl(n,e){for(const t of e)t&&t.afterAllSetup&&t.afterAllSetup(n)}function Jp(n,e,t){if(t[e.name]){j&&w.log(`Integration skipped because it was already installed: ${e.name}`);return}if(t[e.name]=e,Cl.indexOf(e.name)===-1&&typeof e.setupOnce=="function"&&(e.setupOnce(),Cl.push(e.name)),e.setup&&typeof e.setup=="function"&&e.setup(n),typeof e.preprocessEvent=="function"){const r=e.preprocessEvent.bind(e);n.on("preprocessEvent",(i,s)=>r(i,s,n))}if(typeof e.processEvent=="function"){const r=e.processEvent.bind(e),i=Object.assign((s,a)=>r(s,a,n),{id:e.name});n.addEventProcessor(i)}j&&w.log(`Integration installed: ${e.name}`)}function Cb(n,e,t){const r=[{type:"client_report"},{timestamp:t||Jr(),discarded_events:n}];return rn(e?{dsn:e}:{},[r])}class Qe extends Error{constructor(e,t="warn"){super(e),this.message=e,this.name=new.target.prototype.constructor.name,Object.setPrototypeOf(this,new.target.prototype),this.logLevel=t}}const Ll="Not capturing exception because it's already been captured.";class Nb{constructor(e){if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=xy(e.dsn):j&&w.warn("No DSN provided, client will not send events."),this._dsn){const i=Ob(this._dsn,e.tunnel,e._metadata?e._metadata.sdk:void 0);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:i})}const r=["enableTracing","tracesSampleRate","tracesSampler"].find(i=>i in e&&e[i]==null);r&&Jt(()=>{console.warn(`[Sentry] Deprecation warning: \`${r}\` is set to undefined, which leads to tracing being enabled. In v9, a value of \`undefined\` will result in tracing being disabled.`)})}captureException(e,t,r){const i=We();if(hl(e))return j&&w.log(Ll),i;const s={event_id:i,...t};return this._process(this.eventFromException(e,s).then(a=>this._captureEvent(a,s,r))),s.event_id}captureMessage(e,t,r,i){const s={event_id:We(),...r},a=Mc(e)?e:String(e),o=D_(e)?this.eventFromMessage(a,t,s):this.eventFromException(e,s);return this._process(o.then(c=>this._captureEvent(c,s,i))),s.event_id}captureEvent(e,t,r){const i=We();if(t&&t.originalException&&hl(t.originalException))return j&&w.log(Ll),i;const s={event_id:i,...t},o=(e.sdkProcessingMetadata||{}).capturedSpanScope;return this._process(this._captureEvent(e,s,o||r)),s.event_id}captureSession(e){typeof e.release!="string"?j&&w.warn("Discarded session because of missing or non-string release"):(this.sendSession(e),Qt(e,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){const t=this._transport;return t?(this.emit("flush"),this._isClientDoneProcessing(e).then(r=>t.flush(e).then(i=>r&&i))):Sn(!0)}close(e){return this.flush(e).then(t=>(this.getOptions().enabled=!1,this.emit("close"),t))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some(({name:e})=>e.startsWith("Spotlight")))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const t=this._integrations[e.name];Jp(this,e,this._integrations),t||Nl(this,[e])}sendEvent(e,t={}){this.emit("beforeSendEvent",e,t);let r=qy(e,this._dsn,this._options._metadata,this._options.tunnel);for(const s of t.attachments||[])r=Uo(r,Gy(s));const i=this.sendEnvelope(r);i&&i.then(s=>this.emit("afterSendEvent",e,s),null)}sendSession(e){const t=zy(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(t)}recordDroppedEvent(e,t,r){if(this._options.sendClientReports){const i=typeof r=="number"?r:1,s=`${e}:${t}`;j&&w.log(`Recording outcome: "${s}"${i>1?` (${i} times)`:""}`),this._outcomes[s]=(this._outcomes[s]||0)+i}}on(e,t){const r=this._hooks[e]=this._hooks[e]||[];return r.push(t),()=>{const i=r.indexOf(t);i>-1&&r.splice(i,1)}}emit(e,...t){const r=this._hooks[e];r&&r.forEach(i=>i(...t))}sendEnvelope(e){return this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport?this._transport.send(e).then(null,t=>(j&&w.error("Error while sending envelope:",t),t)):(j&&w.error("Transport disabled"),Sn({}))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=Pb(this,e),Nl(this,e)}_updateSessionFromEvent(e,t){let r=t.level==="fatal",i=!1;const s=t.exception&&t.exception.values;if(s){i=!0;for(const c of s){const u=c.mechanism;if(u&&u.handled===!1){r=!0;break}}}const a=e.status==="ok";(a&&e.errors===0||a&&r)&&(Qt(e,{...r&&{status:"crashed"},errors:e.errors||Number(i||r)}),this.captureSession(e))}_isClientDoneProcessing(e){return new Je(t=>{let r=0;const i=1,s=setInterval(()=>{this._numProcessing==0?(clearInterval(s),t(!0)):(r+=i,e&&r>=e&&(clearInterval(s),t(!1)))},i)})}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(e,t,r=re(),i=Me()){const s=this.getOptions(),a=Object.keys(this._integrations);return!t.integrations&&a.length>0&&(t.integrations=a),this.emit("preprocessEvent",e,t),e.type||i.setLastEventId(e.event_id||t.event_id),ob(s,e,t,r,this,i).then(o=>{if(o===null)return o;o.contexts={trace:Gc(r),...o.contexts};const c=ni(this,r);return o.sdkProcessingMetadata={dynamicSamplingContext:c,...o.sdkProcessingMetadata},o})}_captureEvent(e,t={},r){return this._processEvent(e,t,r).then(i=>i.event_id,i=>{if(j){const s=i;s.logLevel==="log"?w.log(s.message):w.warn(s)}})}_processEvent(e,t,r){const i=this.getOptions(),{sampleRate:s}=i,a=eh(e),o=Qp(e),c=e.type||"error",u=`before send for type \`${c}\``,l=typeof s>"u"?void 0:Fp(s);if(o&&typeof l=="number"&&Math.random()>l)return this.recordDroppedEvent("sample_rate","error",e),Tp(new Qe(`Discarding event because it's not included in the random sample (sampling rate = ${s})`,"log"));const d=c==="replay_event"?"replay":c,p=(e.sdkProcessingMetadata||{}).capturedSpanIsolationScope;return this._prepareEvent(e,t,r,p).then(h=>{if(h===null)throw this.recordDroppedEvent("event_processor",d,e),new Qe("An event processor returned `null`, will not send event.","log");if(t.data&&t.data.__sentry__===!0)return h;const g=xb(this,i,h,t);return Lb(g,u)}).then(h=>{if(h===null){if(this.recordDroppedEvent("before_send",d,e),a){const E=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",E)}throw new Qe(`${u} returned \`null\`, will not send event.`,"log")}const m=r&&r.getSession();if(!a&&m&&this._updateSessionFromEvent(m,h),a){const y=h.sdkProcessingMetadata&&h.sdkProcessingMetadata.spanCountBeforeProcessing||0,E=h.spans?h.spans.length:0,b=y-E;b>0&&this.recordDroppedEvent("before_send","span",b)}const g=h.transaction_info;if(a&&g&&h.transaction!==e.transaction){const y="custom";h.transaction_info={...g,source:y}}return this.sendEvent(h,t),h}).then(null,h=>{throw h instanceof Qe?h:(this.captureException(h,{data:{__sentry__:!0},originalException:h}),new Qe(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${h}`))})}_process(e){this._numProcessing++,e.then(t=>(this._numProcessing--,t),t=>(this._numProcessing--,t))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map(([t,r])=>{const[i,s]=t.split(":");return{reason:i,category:s,quantity:r}})}_flushOutcomes(){j&&w.log("Flushing outcomes...");const e=this._clearOutcomes();if(e.length===0){j&&w.log("No outcomes to send");return}if(!this._dsn){j&&w.log("No dsn provided, will not send outcomes");return}j&&w.log("Sending outcomes:",e);const t=Cb(e,this._options.tunnel&&pr(this._dsn));this.sendEnvelope(t)}}function Lb(n,e){const t=`${e} must return \`null\` or a valid event.`;if(Kr(n))return n.then(r=>{if(!Xn(r)&&r!==null)throw new Qe(t);return r},r=>{throw new Qe(`${e} rejected with ${r}`)});if(!Xn(n)&&n!==null)throw new Qe(t);return n}function xb(n,e,t,r){const{beforeSend:i,beforeSendTransaction:s,beforeSendSpan:a}=e;if(Qp(t)&&i)return i(t,r);if(eh(t)){if(t.spans&&a){const o=[];for(const c of t.spans){const u=a(c);u?o.push(u):(Np(),n.recordDroppedEvent("before_send","span"))}t.spans=o}if(s){if(t.spans){const o=t.spans.length;t.sdkProcessingMetadata={...t.sdkProcessingMetadata,spanCountBeforeProcessing:o}}return s(t,r)}}return t}function Qp(n){return n.type===void 0}function eh(n){return n.type==="transaction"}function $b(n,e,t,r,i){const s={sent_at:new Date().toISOString()};t&&t.sdk&&(s.sdk={name:t.sdk.name,version:t.sdk.version}),r&&i&&(s.dsn=pr(i)),e&&(s.trace=ae(e));const a=Mb(n);return rn(s,[a])}function Mb(n){return[{type:"check_in"},n]}function th(n,e){return n(e.stack||"",1)}function nh(n,e){const t={type:e.name||e.constructor.name,value:e.message},r=th(n,e);return r.length&&(t.stacktrace={frames:r}),t}function kb(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e)){const t=n[e];if(t instanceof Error)return t}}function Db(n){if("name"in n&&typeof n.name=="string"){let r=`'${n.name}' captured as exception`;return"message"in n&&typeof n.message=="string"&&(r+=` with message '${n.message}'`),r}else if("message"in n&&typeof n.message=="string")return n.message;const e=K_(n);if(k_(n))return`Event \`ErrorEvent\` captured as exception with message \`${n.message}\``;const t=Fb(n);return`${t&&t!=="Object"?`'${t}'`:"Object"} captured as exception with keys: ${e}`}function Fb(n){try{const e=Object.getPrototypeOf(n);return e?e.constructor.name:void 0}catch{}}function jb(n,e,t,r){if(yp(t))return[t,void 0];if(e.synthetic=!0,Xn(t)){const s=n&&n.getOptions().normalizeDepth,a={__serialized__:Bp(t,s)},o=kb(t);if(o)return[o,a];const c=Db(t),u=r&&r.syntheticException||new Error(c);return u.message=c,[u,a]}const i=r&&r.syntheticException||new Error(t);return i.message=`${t}`,[i,void 0]}function Ub(n,e,t,r){const s=r&&r.data&&r.data.mechanism||{handled:!0,type:"generic"},[a,o]=jb(n,s,t,r),c={exception:{values:[nh(e,a)]}};return o&&(c.extra=o),ey(c,void 0,void 0),kc(c,s),{...c,event_id:r&&r.event_id}}function Bb(n,e,t="info",r,i){const s={event_id:r&&r.event_id,level:t};if(i&&r&&r.syntheticException){const a=th(n,r.syntheticException);a.length&&(s.exception={values:[{value:e,stacktrace:{frames:a}}]},kc(s,{synthetic:!0}))}if(Mc(e)){const{__sentry_template_string__:a,__sentry_template_values__:o}=e;return s.logentry={message:a,params:o},s}return s.message=e,s}class Gb extends Nb{constructor(e){Ry(),super(e)}eventFromException(e,t){const r=Ub(this,this._options.stackParser,e,t);return r.level="error",Sn(r)}eventFromMessage(e,t="info",r){return Sn(Bb(this._options.stackParser,e,t,r,this._options.attachStacktrace))}captureException(e,t,r){if(this._options.autoSessionTracking&&this._sessionFlusher){const i=Me().getRequestSession();i&&i.status==="ok"&&(i.status="errored")}return super.captureException(e,t,r)}captureEvent(e,t,r){if(this._options.autoSessionTracking&&this._sessionFlusher&&(e.type||"exception")==="exception"&&e.exception&&e.exception.values&&e.exception.values.length>0){const a=Me().getRequestSession();a&&a.status==="ok"&&(a.status="errored")}return super.captureEvent(e,t,r)}close(e){return this._sessionFlusher&&this._sessionFlusher.close(),super.close(e)}initSessionFlusher(){const{release:e,environment:t}=this._options;e?this._sessionFlusher=new Eb(this,{release:e,environment:t}):j&&w.warn("Cannot initialize an instance of SessionFlusher if no release is provided!")}captureCheckIn(e,t,r){const i="checkInId"in e&&e.checkInId?e.checkInId:We();if(!this._isEnabled())return j&&w.warn("SDK not enabled, will not capture checkin."),i;const s=this.getOptions(),{release:a,environment:o,tunnel:c}=s,u={check_in_id:i,monitor_slug:e.monitorSlug,status:e.status,release:a,environment:o};"duration"in e&&(u.duration=e.duration),t&&(u.monitor_config={schedule:t.schedule,checkin_margin:t.checkinMargin,max_runtime:t.maxRuntime,timezone:t.timezone,failure_issue_threshold:t.failureIssueThreshold,recovery_threshold:t.recoveryThreshold});const[l,d]=this._getTraceInfoFromScope(r);d&&(u.contexts={trace:d});const f=$b(u,l,this.getSdkMetadata(),c,this.getDsn());return j&&w.info("Sending checkin:",e.monitorSlug,e.status),this.sendEnvelope(f),i}_captureRequestSession(){this._sessionFlusher?this._sessionFlusher.incrementSessionStatusCount():j&&w.warn("Discarded request mode session because autoSessionTracking option was disabled")}_prepareEvent(e,t,r,i){return this._options.platform&&(e.platform=e.platform||this._options.platform),this._options.runtime&&(e.contexts={...e.contexts,runtime:(e.contexts||{}).runtime||this._options.runtime}),this._options.serverName&&(e.server_name=e.server_name||this._options.serverName),super._prepareEvent(e,t,r,i)}_getTraceInfoFromScope(e){if(!e)return[void 0,void 0];const t=Fr(e),r=t?Wc(t):Gc(e);return[t?Ve(t):ni(this,e),r]}}function Hb(n){const e=[];function t(){return n===void 0||e.length<n}function r(a){return e.splice(e.indexOf(a),1)[0]||Promise.resolve(void 0)}function i(a){if(!t())return Tp(new Qe("Not adding Promise because buffer limit was reached."));const o=a();return e.indexOf(o)===-1&&e.push(o),o.then(()=>r(o)).then(null,()=>r(o).then(null,()=>{})),o}function s(a){return new Je((o,c)=>{let u=e.length;if(!u)return o(!0);const l=setTimeout(()=>{a&&a>0&&o(!1)},a);e.forEach(d=>{Sn(d).then(()=>{--u||(clearTimeout(l),o(!0))},c)})})}return{$:e,add:i,drain:s}}const Wb=60*1e3;function rh(n,e=Date.now()){const t=parseInt(`${n}`,10);if(!isNaN(t))return t*1e3;const r=Date.parse(`${n}`);return isNaN(r)?Wb:r-e}function Vb(n,e){return n[e]||n.all||0}function zb(n,e,t=Date.now()){return Vb(n,e)>t}function qb(n,{statusCode:e,headers:t},r=Date.now()){const i={...n},s=t&&t["x-sentry-rate-limits"],a=t&&t["retry-after"];if(s)for(const o of s.trim().split(",")){const[c,u,,,l]=o.split(":",5),d=parseInt(c,10),f=(isNaN(d)?60:d)*1e3;if(!u)i.all=r+f;else for(const p of u.split(";"))p==="metric_bucket"?(!l||l.split(";").includes("custom"))&&(i[p]=r+f):i[p]=r+f}else a?i.all=r+rh(a,r):e===429&&(i.all=r+60*1e3);return i}const Zb=64;function Xb(n,e,t=Hb(n.bufferSize||Zb)){let r={};const i=a=>t.drain(a);function s(a){const o=[];if(er(a,(d,f)=>{const p=Sl(f);if(zb(r,p)){const h=xl(d,f);n.recordDroppedEvent("ratelimit_backoff",p,h)}else o.push(d)}),o.length===0)return Sn({});const c=rn(a[0],o),u=d=>{er(c,(f,p)=>{const h=xl(f,p);n.recordDroppedEvent(d,Sl(p),h)})},l=()=>e({body:Gp(c)}).then(d=>(d.statusCode!==void 0&&(d.statusCode<200||d.statusCode>=300)&&j&&w.warn(`Sentry responded with status code ${d.statusCode} to sent event.`),r=qb(r,d),d),d=>{throw u("network_error"),d});return t.add(l).then(d=>d,d=>{if(d instanceof Qe)return j&&w.error("Skipped sending event because buffer is full."),u("queue_overflow"),Sn({});throw d})}return{send:s,flush:i}}function xl(n,e){if(!(e!=="event"&&e!=="transaction"))return Array.isArray(n)?n[1]:void 0}const wa=100,Sa=5e3,Yb=36e5;function Kb(n){function e(...t){j&&w.info("[Offline]:",...t)}return t=>{const r=n(t);if(!t.createStore)throw new Error("No `createStore` function was provided");const i=t.createStore(t);let s=Sa,a;function o(d,f,p){return wl(d,["client_report"])?!1:t.shouldStore?t.shouldStore(d,f,p):!0}function c(d){a&&clearTimeout(a),a=setTimeout(async()=>{a=void 0;const f=await i.shift();f&&(e("Attempting to send previously queued event"),f[0].sent_at=new Date().toISOString(),l(f,!0).catch(p=>{e("Failed to retry sending",p)}))},d),typeof a!="number"&&a.unref&&a.unref()}function u(){a||(c(s),s=Math.min(s*2,Yb))}async function l(d,f=!1){if(!f&&wl(d,["replay_event","replay_recording"]))return await i.push(d),c(wa),{};try{const p=await r.send(d);let h=wa;if(p){if(p.headers&&p.headers["retry-after"])h=rh(p.headers["retry-after"]);else if(p.headers&&p.headers["x-sentry-rate-limits"])h=6e4;else if((p.statusCode||0)>=400)return p}return c(h),s=Sa,p}catch(p){if(await o(d,p,s))return f?await i.unshift(d):await i.push(d),u(),e("Error sending. Event queued.",p),{};throw p}}return t.flushAtStartup&&u(),{send:l,flush:d=>(d===void 0&&(s=Sa,c(wa)),r.flush(d))}}}function Jb(n,e,t=[e],r="npm"){const i=n._metadata||{};i.sdk||(i.sdk={name:`sentry.javascript.${e}`,packages:t.map(s=>({name:`${r}:@sentry/${s}`,version:vt})),version:vt}),n._metadata=i}function Qb(n={}){const e=Q();if(!bb()||!e)return{};const t=nn(),r=dr(t);if(r.getTraceData)return r.getTraceData(n);const i=re(),s=n.span||Ms(),a=s?Cp(s):ev(i),o=s?Ve(s):ni(e,i),c=xs(o);return Rp.test(a)?{"sentry-trace":a,baggage:c}:(w.warn("Invalid sentry-trace data. Cannot generate trace data"),{})}function ev(n){const{traceId:e,sampled:t,spanId:r}=n.getPropagationContext();return Qr(e,r,t)}const tv=100;function tr(n,e){const t=Q(),r=Me();if(!t)return;const{beforeBreadcrumb:i=null,maxBreadcrumbs:s=tv}=t.getOptions();if(s<=0)return;const o={timestamp:Jr(),...n},c=i?Jt(()=>i(o,e)):o;c!==null&&(t.emit&&t.emit("beforeAddBreadcrumb",c,e),r.addBreadcrumb(c,s))}let $l;const nv="FunctionToString",Ml=new WeakMap,rv=()=>({name:nv,setupOnce(){$l=Function.prototype.toString;try{Function.prototype.toString=function(...n){const e=Y_(this),t=Ml.has(Q())&&e!==void 0?e:this;return $l.apply(t,n)}}catch{}},setup(n){Ml.set(n,!0)}}),iv=rv,sv=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,"undefined is not an object (evaluating 'a.L')",`can't redefine non-configurable property "solana"`,"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/],av="InboundFilters",ov=(n={})=>({name:av,processEvent(e,t,r){const i=r.getOptions(),s=uv(n,i);return lv(e,s)?null:e}}),cv=ov;function uv(n={},e={}){return{allowUrls:[...n.allowUrls||[],...e.allowUrls||[]],denyUrls:[...n.denyUrls||[],...e.denyUrls||[]],ignoreErrors:[...n.ignoreErrors||[],...e.ignoreErrors||[],...n.disableErrorDefaults?[]:sv],ignoreTransactions:[...n.ignoreTransactions||[],...e.ignoreTransactions||[]],ignoreInternal:n.ignoreInternal!==void 0?n.ignoreInternal:!0}}function lv(n,e){return e.ignoreInternal&&gv(n)?(j&&w.warn(`Event dropped due to being internal Sentry Error.
Event: ${un(n)}`),!0):dv(n,e.ignoreErrors)?(j&&w.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${un(n)}`),!0):yv(n)?(j&&w.warn(`Event dropped due to not having an error message, error type or stacktrace.
Event: ${un(n)}`),!0):fv(n,e.ignoreTransactions)?(j&&w.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${un(n)}`),!0):pv(n,e.denyUrls)?(j&&w.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${un(n)}.
Url: ${ls(n)}`),!0):hv(n,e.allowUrls)?!1:(j&&w.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${un(n)}.
Url: ${ls(n)}`),!0)}function dv(n,e){return n.type||!e||!e.length?!1:mv(n).some(t=>lr(t,e))}function fv(n,e){if(n.type!=="transaction"||!e||!e.length)return!1;const t=n.transaction;return t?lr(t,e):!1}function pv(n,e){if(!e||!e.length)return!1;const t=ls(n);return t?lr(t,e):!1}function hv(n,e){if(!e||!e.length)return!0;const t=ls(n);return t?lr(t,e):!0}function mv(n){const e=[];n.message&&e.push(n.message);let t;try{t=n.exception.values[n.exception.values.length-1]}catch{}return t&&t.value&&(e.push(t.value),t.type&&e.push(`${t.type}: ${t.value}`)),e}function gv(n){try{return n.exception.values[0].type==="SentryError"}catch{}return!1}function _v(n=[]){for(let e=n.length-1;e>=0;e--){const t=n[e];if(t&&t.filename!=="<anonymous>"&&t.filename!=="[native code]")return t.filename||null}return null}function ls(n){try{let e;try{e=n.exception.values[0].stacktrace.frames}catch{}return e?_v(e):null}catch{return j&&w.error(`Cannot extract url for event ${un(n)}`),null}}function yv(n){return n.type||!n.exception||!n.exception.values||n.exception.values.length===0?!1:!n.message&&!n.exception.values.some(e=>e.stacktrace||e.type&&e.type!=="Error"||e.value)}function bv(n,e,t=250,r,i,s,a){if(!s.exception||!s.exception.values||!a||!wn(a.originalException,Error))return;const o=s.exception.values.length>0?s.exception.values[s.exception.values.length-1]:void 0;o&&(s.exception.values=vv(Go(n,e,i,a.originalException,r,s.exception.values,o,0),t))}function Go(n,e,t,r,i,s,a,o){if(s.length>=t+1)return s;let c=[...s];if(wn(r[i],Error)){kl(a,o);const u=n(e,r[i]),l=c.length;Dl(u,i,l,o),c=Go(n,e,t,r[i],i,[u,...c],u,l)}return Array.isArray(r.errors)&&r.errors.forEach((u,l)=>{if(wn(u,Error)){kl(a,o);const d=n(e,u),f=c.length;Dl(d,`errors[${l}]`,f,o),c=Go(n,e,t,u,i,[d,...c],d,f)}}),c}function kl(n,e){n.mechanism=n.mechanism||{type:"generic",handled:!0},n.mechanism={...n.mechanism,...n.type==="AggregateError"&&{is_exception_group:!0},exception_id:e}}function Dl(n,e,t,r){n.mechanism=n.mechanism||{type:"generic",handled:!0},n.mechanism={...n.mechanism,type:"chained",source:e,exception_id:t,parent_id:r}}function vv(n,e){return n.map(t=>(t.value&&(t.value=yn(t.value,e)),t))}const Ev="cause",wv=5,Sv="LinkedErrors",Tv=(n={})=>{const e=n.limit||wv,t=n.key||Ev;return{name:Sv,preprocessEvent(r,i,s){const a=s.getOptions();bv(nh,a.stackParser,a.maxValueLength,t,e,r,i)}}},Av=Tv;function Jc(n){if(!n)return{};const e=n.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};const t=e[6]||"",r=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],search:t,hash:r,relative:e[5]+t+r}}function Fl(n){return n.split(/[?#]/,1)[0]}function Qc(n){const{protocol:e,host:t,path:r}=n,i=t&&t.replace(/^.*@/,"[filtered]:[filtered]@").replace(/(:80)$/,"").replace(/(:443)$/,"")||"";return`${e?`${e}://`:""}${i}${r}`}function Ov(n){const e="console";Lc(e,n),xc(e,Rv)}function Rv(){"console"in se&&xo.forEach(function(n){n in se.console&&bp(se.console,n,function(e){return ns[n]=e,function(...t){$c("console",{args:t,level:n});const i=ns[n];i&&i.apply(se.console,t)}})})}function Iv(n){return n==="warn"?"warning":["fatal","error","warning","log","info","debug"].includes(n)?n:"log"}const Pv=/^(\S+:\\|\/?)([\s\S]*?)((?:\.{1,2}|[^/\\]+?|)(\.[^./\\]*|))(?:[/\\]*)$/;function ih(n){const e=n.length>1024?`<truncated>${n.slice(-1024)}`:n,t=Pv.exec(e);return t?t.slice(1):[]}function Cv(n){const e=ih(n),t=e[0]||"";let r=e[1];return!t&&!r?".":(r&&(r=r.slice(0,r.length-1)),t+r)}function Nv(n,e){let t=ih(n)[2]||"";return e&&t.slice(e.length*-1)===e&&(t=t.slice(0,t.length-e.length)),t}const sh="c",ah="g",eu="s",oh="d",Ta=1e4,Lv=1e4;function ch(n,e){const t=Yr("globalMetricsAggregators",()=>new WeakMap),r=t.get(n);if(r)return r;const i=new e(n);return n.on("flush",()=>i.flush()),n.on("close",()=>i.close()),t.set(n,i),i}function Fs(n,e,t,r,i={}){const s=i.client||Q();if(!s)return;const a=Ms(),o=a?et(a):void 0,c=o&&Pe(o).description,{unit:u,tags:l,timestamp:d}=i,{release:f,environment:p}=s.getOptions(),h={};f&&(h.release=f),p&&(h.environment=p),c&&(h.transaction=c),j&&w.log(`Adding value of ${r} to ${e} metric ${t}`),ch(s,n).add(e,t,r,u,{...h,...l},d)}function xv(n,e,t=1,r){Fs(n,sh,e,tu(t),r)}function Ho(n,e,t,r){Fs(n,oh,e,tu(t),r)}function $v(n,e,t,r="second",i){if(typeof t=="function"){const s=Dt();return Ky({op:"metrics.timing",name:e,startTime:s,onlyIfParent:!0},a=>ks(()=>t(),()=>{},()=>{const o=Dt(),c=o-s;Ho(n,e,c,{...i,unit:"second"}),a.end(o)}))}Ho(n,e,t,{...i,unit:r})}function Mv(n,e,t,r){Fs(n,eu,e,t,r)}function kv(n,e,t,r){Fs(n,ah,e,tu(t),r)}const hr={increment:xv,distribution:Ho,set:Mv,gauge:kv,timing:$v,getMetricsAggregatorForClient:ch};function tu(n){return typeof n=="string"?parseInt(n):n}function Dv(n,e,t,r){const i=Object.entries(ae(r)).sort((s,a)=>s[0].localeCompare(a[0]));return`${n}${e}${t}${i}`}function Fv(n){let e=0;for(let t=0;t<n.length;t++){const r=n.charCodeAt(t);e=(e<<5)-e+r,e&=e}return e>>>0}function jv(n){let e="";for(const t of n){const r=Object.entries(t.tags),i=r.length>0?`|#${r.map(([s,a])=>`${s}:${a}`).join(",")}`:"";e+=`${t.name}@${t.unit}:${t.metric}|${t.metricType}${i}|T${t.timestamp}
`}return e}function Uv(n){return n.replace(/[^\w]+/gi,"_")}function Bv(n){return n.replace(/[^\w\-.]+/gi,"_")}function Gv(n){return n.replace(/[^\w\-./]+/gi,"")}const Hv=[[`
`,"\\n"],["\r","\\r"],["	","\\t"],["\\","\\\\"],["|","\\u{7c}"],[",","\\u{2c}"]];function Wv(n){for(const[e,t]of Hv)if(n===e)return t;return n}function Vv(n){return[...n].reduce((e,t)=>e+Wv(t),"")}function zv(n){const e={};for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const r=Gv(t);e[r]=Vv(String(n[t]))}return e}function qv(n,e){w.log(`Flushing aggregated metrics, number of metrics: ${e.length}`);const t=n.getDsn(),r=n.getSdkMetadata(),i=n.getOptions().tunnel,s=Zv(e,t,r,i);n.sendEnvelope(s)}function Zv(n,e,t,r){const i={sent_at:new Date().toISOString()};t&&t.sdk&&(i.sdk={name:t.sdk.name,version:t.sdk.version}),r&&e&&(i.dsn=pr(e));const s=Xv(n);return rn(i,[s])}function Xv(n){const e=jv(n);return[{type:"statsd",length:e.length},e]}class Yv{constructor(e){this._value=e}get weight(){return 1}add(e){this._value+=e}toString(){return`${this._value}`}}class Kv{constructor(e){this._last=e,this._min=e,this._max=e,this._sum=e,this._count=1}get weight(){return 5}add(e){this._last=e,e<this._min&&(this._min=e),e>this._max&&(this._max=e),this._sum+=e,this._count++}toString(){return`${this._last}:${this._min}:${this._max}:${this._sum}:${this._count}`}}class Jv{constructor(e){this._value=[e]}get weight(){return this._value.length}add(e){this._value.push(e)}toString(){return this._value.join(":")}}class Qv{constructor(e){this.first=e,this._value=new Set([e])}get weight(){return this._value.size}add(e){this._value.add(e)}toString(){return Array.from(this._value).map(e=>typeof e=="string"?Fv(e):e).join(":")}}const eE={[sh]:Yv,[ah]:Kv,[oh]:Jv,[eu]:Qv};class mr{constructor(e){this._client=e,this._buckets=new Map,this._bucketsTotalWeight=0,this._interval=setInterval(()=>this._flush(),Ta),this._interval.unref&&this._interval.unref(),this._flushShift=Math.floor(Math.random()*Ta/1e3),this._forceFlush=!1}add(e,t,r,i="none",s={},a=Dt()){const o=Math.floor(a),c=Bv(t),u=zv(s),l=Uv(i),d=Dv(e,c,l,u);let f=this._buckets.get(d);const p=f&&e===eu?f.metric.weight:0;f?(f.metric.add(r),f.timestamp<o&&(f.timestamp=o)):(f={metric:new eE[e](r),timestamp:o,metricType:e,name:c,unit:l,tags:u},this._buckets.set(d,f));const h=typeof r=="string"?f.metric.weight-p:r;Oy(e,c,h,l,s,d),this._bucketsTotalWeight+=f.metric.weight,this._bucketsTotalWeight>=Lv&&this.flush()}flush(){this._forceFlush=!0,this._flush()}close(){this._forceFlush=!0,clearInterval(this._interval),this._flush()}_flush(){if(this._forceFlush){this._forceFlush=!1,this._bucketsTotalWeight=0,this._captureMetrics(this._buckets),this._buckets.clear();return}const e=Math.floor(Dt())-Ta/1e3-this._flushShift,t=new Map;for(const[r,i]of this._buckets)i.timestamp<=e&&(t.set(r,i),this._bucketsTotalWeight-=i.metric.weight);for(const[r]of t)this._buckets.delete(r);this._captureMetrics(t)}_captureMetrics(e){if(e.size>0){const t=Array.from(e).map(([,r])=>r);qv(this._client,t)}}}function tE(n,e=1,t){hr.increment(mr,n,e,t)}function nE(n,e,t){hr.distribution(mr,n,e,t)}function rE(n,e,t){hr.set(mr,n,e,t)}function iE(n,e,t){hr.gauge(mr,n,e,t)}function sE(n,e,t="second",r){return hr.timing(mr,n,e,t,r)}function aE(n){return hr.getMetricsAggregatorForClient(n,mr)}const oE={increment:tE,distribution:nE,set:rE,gauge:iE,timing:sE,getMetricsAggregatorForClient:aE};function uh(n){if(n!==void 0)return n>=400&&n<500?"warning":n>=500?"error":void 0}function lh(n,e=!1){return!(e||n&&!n.startsWith("/")&&!n.match(/^[A-Z]:/)&&!n.startsWith(".")&&!n.match(/^[a-zA-Z]([a-zA-Z0-9.\-+])*:\/\//))&&n!==void 0&&!n.includes("node_modules/")}function cE(n){const e=/^\s*[-]{4,}$/,t=/at (?:async )?(?:(.+?)\s+\()?(?:(.+):(\d+):(\d+)?|([^)]+))\)?/;return r=>{const i=r.match(t);if(i){let s,a,o,c,u;if(i[1]){o=i[1];let f=o.lastIndexOf(".");if(o[f-1]==="."&&f--,f>0){s=o.slice(0,f),a=o.slice(f+1);const p=s.indexOf(".Module");p>0&&(o=o.slice(p+1),s=s.slice(0,p))}c=void 0}a&&(c=s,u=a),a==="<anonymous>"&&(u=void 0,o=void 0),o===void 0&&(u=u||Nc,o=c?`${c}.${u}`:u);let l=i[2]&&i[2].startsWith("file://")?i[2].slice(7):i[2];const d=i[5]==="native";return l&&l.match(/\/[A-Z]:/)&&(l=l.slice(1)),!l&&i[5]&&!d&&(l=i[5]),{filename:l?decodeURI(l):void 0,module:n?n(l):void 0,function:o,lineno:jl(i[3]),colno:jl(i[4]),in_app:lh(l||"",d)}}if(r.match(e))return{filename:r}}}function uE(n){return[90,cE(n)]}function jl(n){return parseInt(n||"",10)||void 0}function lE(n,e,t,r){const i=n();let s=!1,a=!0;return setInterval(()=>{const o=i.getTimeMs();s===!1&&o>e+t&&(s=!0,a&&r()),o<e+t&&(s=!1)},20),{poll:()=>{i.reset()},enabled:o=>{a=o}}}function dE(n,e,t){const r=e?e.replace(/^file:\/\//,""):void 0,i=n.location.columnNumber?n.location.columnNumber+1:void 0,s=n.location.lineNumber?n.location.lineNumber+1:void 0;return ae({filename:r,module:t(r),function:n.functionName||Nc,colno:i,lineno:s,in_app:r?lh(r):void 0})}class en{constructor(e){this._maxSize=e,this._cache=new Map}get size(){return this._cache.size}get(e){const t=this._cache.get(e);if(t!==void 0)return this._cache.delete(e),this._cache.set(e,t),t}set(e,t){this._cache.size>=this._maxSize&&this._cache.delete(this._cache.keys().next().value),this._cache.set(e,t)}remove(e){const t=this._cache.get(e);return t&&this._cache.delete(e),t}clear(){this._cache.clear()}keys(){return Array.from(this._cache.keys())}values(){const e=[];return this._cache.forEach(t=>e.push(t)),e}}function fE(n,e){return n??e()}function U(n){let e,t=n[0],r=1;for(;r<n.length;){const i=n[r],s=n[r+1];if(r+=2,(i==="optionalAccess"||i==="optionalCall")&&t==null)return;i==="access"||i==="optionalAccess"?(e=t,t=s(t)):(i==="call"||i==="optionalCall")&&(t=s((...a)=>t.call(e,...a)),e=void 0)}return t}var pE=typeof globalThis=="object"?globalThis:global,pn="1.9.0",Ul=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function hE(n){var e=new Set([n]),t=new Set,r=n.match(Ul);if(!r)return function(){return!1};var i={major:+r[1],minor:+r[2],patch:+r[3],prerelease:r[4]};if(i.prerelease!=null)return function(c){return c===n};function s(o){return t.add(o),!1}function a(o){return e.add(o),!0}return function(c){if(e.has(c))return!0;if(t.has(c))return!1;var u=c.match(Ul);if(!u)return s(c);var l={major:+u[1],minor:+u[2],patch:+u[3],prerelease:u[4]};return l.prerelease!=null||i.major!==l.major?s(c):i.major===0?i.minor===l.minor&&i.patch<=l.patch?a(c):s(c):i.minor<=l.minor?a(c):s(c)}}var mE=hE(pn),gE=pn.split(".")[0],Ur=Symbol.for("opentelemetry.js.api."+gE),Br=pE;function ii(n,e,t,r){var i;r===void 0&&(r=!1);var s=Br[Ur]=(i=Br[Ur])!==null&&i!==void 0?i:{version:pn};if(!r&&s[n]){var a=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+n);return t.error(a.stack||a.message),!1}if(s.version!==pn){var a=new Error("@opentelemetry/api: Registration of version v"+s.version+" for "+n+" does not match previously registered API v"+pn);return t.error(a.stack||a.message),!1}return s[n]=e,t.debug("@opentelemetry/api: Registered a global for "+n+" v"+pn+"."),!0}function Tn(n){var e,t,r=(e=Br[Ur])===null||e===void 0?void 0:e.version;if(!(!r||!mE(r)))return(t=Br[Ur])===null||t===void 0?void 0:t[n]}function si(n,e){e.debug("@opentelemetry/api: Unregistering a global for "+n+" v"+pn+".");var t=Br[Ur];t&&delete t[n]}var _E=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return s},yE=globalThis&&globalThis.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},bE=function(){function n(e){this._namespace=e.namespace||"DiagComponentLogger"}return n.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return br("debug",this._namespace,e)},n.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return br("error",this._namespace,e)},n.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return br("info",this._namespace,e)},n.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return br("warn",this._namespace,e)},n.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return br("verbose",this._namespace,e)},n}();function br(n,e,t){var r=Tn("diag");if(r)return t.unshift(e),r[n].apply(r,yE([],_E(t),!1))}var de;(function(n){n[n.NONE=0]="NONE",n[n.ERROR=30]="ERROR",n[n.WARN=50]="WARN",n[n.INFO=60]="INFO",n[n.DEBUG=70]="DEBUG",n[n.VERBOSE=80]="VERBOSE",n[n.ALL=9999]="ALL"})(de||(de={}));function vE(n,e){n<de.NONE?n=de.NONE:n>de.ALL&&(n=de.ALL),e=e||{};function t(r,i){var s=e[r];return typeof s=="function"&&n>=i?s.bind(e):function(){}}return{error:t("error",de.ERROR),warn:t("warn",de.WARN),info:t("info",de.INFO),debug:t("debug",de.DEBUG),verbose:t("verbose",de.VERBOSE)}}var EE=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return s},wE=globalThis&&globalThis.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},SE="diag",Tt=function(){function n(){function e(i){return function(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];var o=Tn("diag");if(o)return o[i].apply(o,wE([],EE(s),!1))}}var t=this,r=function(i,s){var a,o,c;if(s===void 0&&(s={logLevel:de.INFO}),i===t){var u=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error((a=u.stack)!==null&&a!==void 0?a:u.message),!1}typeof s=="number"&&(s={logLevel:s});var l=Tn("diag"),d=vE((o=s.logLevel)!==null&&o!==void 0?o:de.INFO,i);if(l&&!s.suppressOverrideMessage){var f=(c=new Error().stack)!==null&&c!==void 0?c:"<failed to generate stacktrace>";l.warn("Current logger will be overwritten from "+f),d.warn("Current logger will overwrite one already registered from "+f)}return ii("diag",d,t,!0)};t.setLogger=r,t.disable=function(){si(SE,t)},t.createComponentLogger=function(i){return new bE(i)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return n.instance=function(){return this._instance||(this._instance=new n),this._instance},n}(),TE=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return s},AE=globalThis&&globalThis.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},OE=function(){function n(e){this._entries=e?new Map(e):new Map}return n.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},n.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map(function(e){var t=TE(e,2),r=t[0],i=t[1];return[r,i]})},n.prototype.setEntry=function(e,t){var r=new n(this._entries);return r._entries.set(e,t),r},n.prototype.removeEntry=function(e){var t=new n(this._entries);return t._entries.delete(e),t},n.prototype.removeEntries=function(){for(var e,t,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];var s=new n(this._entries);try{for(var a=AE(r),o=a.next();!o.done;o=a.next()){var c=o.value;s._entries.delete(c)}}catch(u){e={error:u}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}return s},n.prototype.clear=function(){return new n},n}(),RE=Symbol("BaggageEntryMetadata"),IE=Tt.instance();function PE(n){return n===void 0&&(n={}),new OE(new Map(Object.entries(n)))}function dh(n){return typeof n!="string"&&(IE.error("Cannot create baggage metadata from unknown type: "+typeof n),n=""),{__TYPE__:RE,toString:function(){return n}}}function Ht(n){return Symbol.for(n)}var CE=function(){function n(e){var t=this;t._currentContext=e?new Map(e):new Map,t.getValue=function(r){return t._currentContext.get(r)},t.setValue=function(r,i){var s=new n(t._currentContext);return s._currentContext.set(r,i),s},t.deleteValue=function(r){var i=new n(t._currentContext);return i._currentContext.delete(r),i}}return n}(),nu=new CE,Aa=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}],NE=function(){function n(){function e(r){return function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];if(console){var a=console[r];if(typeof a!="function"&&(a=console.log),typeof a=="function")return a.apply(console,i)}}}for(var t=0;t<Aa.length;t++)this[Aa[t].n]=e(Aa[t].c)}return n}(),Rn=globalThis&&globalThis.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),LE=function(){function n(){}return n.prototype.createGauge=function(e,t){return BE},n.prototype.createHistogram=function(e,t){return GE},n.prototype.createCounter=function(e,t){return UE},n.prototype.createUpDownCounter=function(e,t){return HE},n.prototype.createObservableGauge=function(e,t){return VE},n.prototype.createObservableCounter=function(e,t){return WE},n.prototype.createObservableUpDownCounter=function(e,t){return zE},n.prototype.addBatchObservableCallback=function(e,t){},n.prototype.removeBatchObservableCallback=function(e){},n}(),js=function(){function n(){}return n}(),xE=function(n){Rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.add=function(t,r){},e}(js),$E=function(n){Rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.add=function(t,r){},e}(js),ME=function(n){Rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.record=function(t,r){},e}(js),kE=function(n){Rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.record=function(t,r){},e}(js),ru=function(){function n(){}return n.prototype.addCallback=function(e){},n.prototype.removeCallback=function(e){},n}(),DE=function(n){Rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(ru),FE=function(n){Rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(ru),jE=function(n){Rn(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e}(ru),fh=new LE,UE=new xE,BE=new ME,GE=new kE,HE=new $E,WE=new DE,VE=new FE,zE=new jE;function qE(){return fh}var Wo;(function(n){n[n.INT=0]="INT",n[n.DOUBLE=1]="DOUBLE"})(Wo||(Wo={}));var ph={get:function(n,e){if(n!=null)return n[e]},keys:function(n){return n==null?[]:Object.keys(n)}},hh={set:function(n,e,t){n!=null&&(n[e]=t)}},ZE=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return s},XE=globalThis&&globalThis.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},YE=function(){function n(){}return n.prototype.active=function(){return nu},n.prototype.with=function(e,t,r){for(var i=[],s=3;s<arguments.length;s++)i[s-3]=arguments[s];return t.call.apply(t,XE([r],ZE(i),!1))},n.prototype.bind=function(e,t){return t},n.prototype.enable=function(){return this},n.prototype.disable=function(){return this},n}(),KE=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return s},JE=globalThis&&globalThis.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},Oa="context",QE=new YE,Us=function(){function n(){}return n.getInstance=function(){return this._instance||(this._instance=new n),this._instance},n.prototype.setGlobalContextManager=function(e){return ii(Oa,e,Tt.instance())},n.prototype.active=function(){return this._getContextManager().active()},n.prototype.with=function(e,t,r){for(var i,s=[],a=3;a<arguments.length;a++)s[a-3]=arguments[a];return(i=this._getContextManager()).with.apply(i,JE([e,t,r],KE(s),!1))},n.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},n.prototype._getContextManager=function(){return Tn(Oa)||QE},n.prototype.disable=function(){this._getContextManager().disable(),si(Oa,Tt.instance())},n}(),Ae;(function(n){n[n.NONE=0]="NONE",n[n.SAMPLED=1]="SAMPLED"})(Ae||(Ae={}));var iu="0000000000000000",Bs="00000000000000000000000000000000",su={traceId:Bs,spanId:iu,traceFlags:Ae.NONE},Cr=function(){function n(e){e===void 0&&(e=su),this._spanContext=e}return n.prototype.spanContext=function(){return this._spanContext},n.prototype.setAttribute=function(e,t){return this},n.prototype.setAttributes=function(e){return this},n.prototype.addEvent=function(e,t){return this},n.prototype.addLink=function(e){return this},n.prototype.addLinks=function(e){return this},n.prototype.setStatus=function(e){return this},n.prototype.updateName=function(e){return this},n.prototype.end=function(e){},n.prototype.isRecording=function(){return!1},n.prototype.recordException=function(e,t){},n}(),au=Ht("OpenTelemetry Context Key SPAN");function ou(n){return n.getValue(au)||void 0}function ew(){return ou(Us.getInstance().active())}function cu(n,e){return n.setValue(au,e)}function tw(n){return n.deleteValue(au)}function nw(n,e){return cu(n,new Cr(e))}function mh(n){var e;return(e=ou(n))===null||e===void 0?void 0:e.spanContext()}var rw=/^([0-9a-f]{32})$/i,iw=/^[0-9a-f]{16}$/i;function Gs(n){return rw.test(n)&&n!==Bs}function gh(n){return iw.test(n)&&n!==iu}function sn(n){return Gs(n.traceId)&&gh(n.spanId)}function sw(n){return new Cr(n)}var Ra=Us.getInstance(),_h=function(){function n(){}return n.prototype.startSpan=function(e,t,r){r===void 0&&(r=Ra.active());var i=!!(t!=null&&t.root);if(i)return new Cr;var s=r&&mh(r);return aw(s)&&sn(s)?new Cr(s):new Cr},n.prototype.startActiveSpan=function(e,t,r,i){var s,a,o;if(!(arguments.length<2)){arguments.length===2?o=t:arguments.length===3?(s=t,o=r):(s=t,a=r,o=i);var c=a??Ra.active(),u=this.startSpan(e,s,c),l=cu(c,u);return Ra.with(l,o,void 0,u)}},n}();function aw(n){return typeof n=="object"&&typeof n.spanId=="string"&&typeof n.traceId=="string"&&typeof n.traceFlags=="number"}var ow=new _h,yh=function(){function n(e,t,r,i){this._provider=e,this.name=t,this.version=r,this.options=i}return n.prototype.startSpan=function(e,t,r){return this._getTracer().startSpan(e,t,r)},n.prototype.startActiveSpan=function(e,t,r,i){var s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)},n.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):ow},n}(),cw=function(){function n(){}return n.prototype.getTracer=function(e,t,r){return new _h},n}(),uw=new cw,Vo=function(){function n(){}return n.prototype.getTracer=function(e,t,r){var i;return(i=this.getDelegateTracer(e,t,r))!==null&&i!==void 0?i:new yh(this,e,t,r)},n.prototype.getDelegate=function(){var e;return(e=this._delegate)!==null&&e!==void 0?e:uw},n.prototype.setDelegate=function(e){this._delegate=e},n.prototype.getDelegateTracer=function(e,t,r){var i;return(i=this._delegate)===null||i===void 0?void 0:i.getTracer(e,t,r)},n}(),Bt;(function(n){n[n.NOT_RECORD=0]="NOT_RECORD",n[n.RECORD=1]="RECORD",n[n.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(Bt||(Bt={}));var He;(function(n){n[n.INTERNAL=0]="INTERNAL",n[n.SERVER=1]="SERVER",n[n.CLIENT=2]="CLIENT",n[n.PRODUCER=3]="PRODUCER",n[n.CONSUMER=4]="CONSUMER"})(He||(He={}));var Lt;(function(n){n[n.UNSET=0]="UNSET",n[n.OK=1]="OK",n[n.ERROR=2]="ERROR"})(Lt||(Lt={}));var zo="[_0-9a-z-*/]",lw="[a-z]"+zo+"{0,255}",dw="[a-z0-9]"+zo+"{0,240}@[a-z]"+zo+"{0,13}",fw=new RegExp("^(?:"+lw+"|"+dw+")$"),pw=/^[ -~]{0,255}[!-~]$/,hw=/,|=/;function mw(n){return fw.test(n)}function gw(n){return pw.test(n)&&!hw.test(n)}var Bl=32,_w=512,Gl=",",Hl="=",yw=function(){function n(e){this._internalState=new Map,e&&this._parse(e)}return n.prototype.set=function(e,t){var r=this._clone();return r._internalState.has(e)&&r._internalState.delete(e),r._internalState.set(e,t),r},n.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},n.prototype.get=function(e){return this._internalState.get(e)},n.prototype.serialize=function(){var e=this;return this._keys().reduce(function(t,r){return t.push(r+Hl+e.get(r)),t},[]).join(Gl)},n.prototype._parse=function(e){e.length>_w||(this._internalState=e.split(Gl).reverse().reduce(function(t,r){var i=r.trim(),s=i.indexOf(Hl);if(s!==-1){var a=i.slice(0,s),o=i.slice(s+1,r.length);mw(a)&&gw(o)&&t.set(a,o)}return t},new Map),this._internalState.size>Bl&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,Bl))))},n.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},n.prototype._clone=function(){var e=new n;return e._internalState=new Map(this._internalState),e},n}();function bw(n){return new yw(n)}var te=Us.getInstance(),G=Tt.instance(),vw=function(){function n(){}return n.prototype.getMeter=function(e,t,r){return fh},n}(),Ew=new vw,Ia="metrics",ww=function(){function n(){}return n.getInstance=function(){return this._instance||(this._instance=new n),this._instance},n.prototype.setGlobalMeterProvider=function(e){return ii(Ia,e,Tt.instance())},n.prototype.getMeterProvider=function(){return Tn(Ia)||Ew},n.prototype.getMeter=function(e,t,r){return this.getMeterProvider().getMeter(e,t,r)},n.prototype.disable=function(){si(Ia,Tt.instance())},n}(),Hs=ww.getInstance(),Sw=function(){function n(){}return n.prototype.inject=function(e,t){},n.prototype.extract=function(e,t){return e},n.prototype.fields=function(){return[]},n}(),uu=Ht("OpenTelemetry Baggage Key");function bh(n){return n.getValue(uu)||void 0}function Tw(){return bh(Us.getInstance().active())}function Aw(n,e){return n.setValue(uu,e)}function Ow(n){return n.deleteValue(uu)}var Pa="propagation",Rw=new Sw,Iw=function(){function n(){this.createBaggage=PE,this.getBaggage=bh,this.getActiveBaggage=Tw,this.setBaggage=Aw,this.deleteBaggage=Ow}return n.getInstance=function(){return this._instance||(this._instance=new n),this._instance},n.prototype.setGlobalPropagator=function(e){return ii(Pa,e,Tt.instance())},n.prototype.inject=function(e,t,r){return r===void 0&&(r=hh),this._getGlobalPropagator().inject(e,t,r)},n.prototype.extract=function(e,t,r){return r===void 0&&(r=ph),this._getGlobalPropagator().extract(e,t,r)},n.prototype.fields=function(){return this._getGlobalPropagator().fields()},n.prototype.disable=function(){si(Pa,Tt.instance())},n.prototype._getGlobalPropagator=function(){return Tn(Pa)||Rw},n}(),xt=Iw.getInstance(),Ca="trace",Pw=function(){function n(){this._proxyTracerProvider=new Vo,this.wrapSpanContext=sw,this.isSpanContextValid=sn,this.deleteSpan=tw,this.getSpan=ou,this.getActiveSpan=ew,this.getSpanContext=mh,this.setSpan=cu,this.setSpanContext=nw}return n.getInstance=function(){return this._instance||(this._instance=new n),this._instance},n.prototype.setGlobalTracerProvider=function(e){var t=ii(Ca,this._proxyTracerProvider,Tt.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},n.prototype.getTracerProvider=function(){return Tn(Ca)||this._proxyTracerProvider},n.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},n.prototype.disable=function(){si(Ca,Tt.instance()),this._proxyTracerProvider=new Vo},n}(),K=Pw.getInstance();const Cw={context:te,diag:G,metrics:Hs,propagation:xt,trace:K},Nw=Object.freeze(Object.defineProperty({__proto__:null,DiagConsoleLogger:NE,get DiagLogLevel(){return de},INVALID_SPANID:iu,INVALID_SPAN_CONTEXT:su,INVALID_TRACEID:Bs,ProxyTracer:yh,ProxyTracerProvider:Vo,ROOT_CONTEXT:nu,get SamplingDecision(){return Bt},get SpanKind(){return He},get SpanStatusCode(){return Lt},get TraceFlags(){return Ae},get ValueType(){return Wo},baggageEntryMetadataFromString:dh,context:te,createContextKey:Ht,createNoopMeter:qE,createTraceState:bw,default:Cw,defaultTextMapGetter:ph,defaultTextMapSetter:hh,diag:G,isSpanContextValid:sn,isValidSpanId:gh,isValidTraceId:Gs,metrics:Hs,propagation:xt,trace:K},Symbol.toStringTag,{value:"Module"}));var Ai=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Ws(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function lu(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}const du=lu(Nw);var qo={exports:{}};const Lw="2.0.0",vh=256,xw=Number.MAX_SAFE_INTEGER||9007199254740991,$w=16,Mw=vh-6,kw=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var Vs={MAX_LENGTH:vh,MAX_SAFE_COMPONENT_LENGTH:$w,MAX_SAFE_BUILD_LENGTH:Mw,MAX_SAFE_INTEGER:xw,RELEASE_TYPES:kw,SEMVER_SPEC_VERSION:Lw,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};const Dw=typeof process=="object"&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...n)=>console.error("SEMVER",...n):()=>{};var zs=Dw;(function(n,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:i}=Vs,s=zs;e=n.exports={};const a=e.re=[],o=e.safeRe=[],c=e.src=[],u=e.safeSrc=[],l=e.t={};let d=0;const f="[a-zA-Z0-9-]",p=[["\\s",1],["\\d",i],[f,r]],h=g=>{for(const[y,E]of p)g=g.split(`${y}*`).join(`${y}{0,${E}}`).split(`${y}+`).join(`${y}{1,${E}}`);return g},m=(g,y,E)=>{const b=h(y),S=d++;s(g,S,y),l[g]=S,c[S]=y,u[S]=b,a[S]=new RegExp(y,E?"g":void 0),o[S]=new RegExp(b,E?"g":void 0)};m("NUMERICIDENTIFIER","0|[1-9]\\d*"),m("NUMERICIDENTIFIERLOOSE","\\d+"),m("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${f}*`),m("MAINVERSION",`(${c[l.NUMERICIDENTIFIER]})\\.(${c[l.NUMERICIDENTIFIER]})\\.(${c[l.NUMERICIDENTIFIER]})`),m("MAINVERSIONLOOSE",`(${c[l.NUMERICIDENTIFIERLOOSE]})\\.(${c[l.NUMERICIDENTIFIERLOOSE]})\\.(${c[l.NUMERICIDENTIFIERLOOSE]})`),m("PRERELEASEIDENTIFIER",`(?:${c[l.NUMERICIDENTIFIER]}|${c[l.NONNUMERICIDENTIFIER]})`),m("PRERELEASEIDENTIFIERLOOSE",`(?:${c[l.NUMERICIDENTIFIERLOOSE]}|${c[l.NONNUMERICIDENTIFIER]})`),m("PRERELEASE",`(?:-(${c[l.PRERELEASEIDENTIFIER]}(?:\\.${c[l.PRERELEASEIDENTIFIER]})*))`),m("PRERELEASELOOSE",`(?:-?(${c[l.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${c[l.PRERELEASEIDENTIFIERLOOSE]})*))`),m("BUILDIDENTIFIER",`${f}+`),m("BUILD",`(?:\\+(${c[l.BUILDIDENTIFIER]}(?:\\.${c[l.BUILDIDENTIFIER]})*))`),m("FULLPLAIN",`v?${c[l.MAINVERSION]}${c[l.PRERELEASE]}?${c[l.BUILD]}?`),m("FULL",`^${c[l.FULLPLAIN]}$`),m("LOOSEPLAIN",`[v=\\s]*${c[l.MAINVERSIONLOOSE]}${c[l.PRERELEASELOOSE]}?${c[l.BUILD]}?`),m("LOOSE",`^${c[l.LOOSEPLAIN]}$`),m("GTLT","((?:<|>)?=?)"),m("XRANGEIDENTIFIERLOOSE",`${c[l.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),m("XRANGEIDENTIFIER",`${c[l.NUMERICIDENTIFIER]}|x|X|\\*`),m("XRANGEPLAIN",`[v=\\s]*(${c[l.XRANGEIDENTIFIER]})(?:\\.(${c[l.XRANGEIDENTIFIER]})(?:\\.(${c[l.XRANGEIDENTIFIER]})(?:${c[l.PRERELEASE]})?${c[l.BUILD]}?)?)?`),m("XRANGEPLAINLOOSE",`[v=\\s]*(${c[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[l.XRANGEIDENTIFIERLOOSE]})(?:\\.(${c[l.XRANGEIDENTIFIERLOOSE]})(?:${c[l.PRERELEASELOOSE]})?${c[l.BUILD]}?)?)?`),m("XRANGE",`^${c[l.GTLT]}\\s*${c[l.XRANGEPLAIN]}$`),m("XRANGELOOSE",`^${c[l.GTLT]}\\s*${c[l.XRANGEPLAINLOOSE]}$`),m("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),m("COERCE",`${c[l.COERCEPLAIN]}(?:$|[^\\d])`),m("COERCEFULL",c[l.COERCEPLAIN]+`(?:${c[l.PRERELEASE]})?(?:${c[l.BUILD]})?(?:$|[^\\d])`),m("COERCERTL",c[l.COERCE],!0),m("COERCERTLFULL",c[l.COERCEFULL],!0),m("LONETILDE","(?:~>?)"),m("TILDETRIM",`(\\s*)${c[l.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",m("TILDE",`^${c[l.LONETILDE]}${c[l.XRANGEPLAIN]}$`),m("TILDELOOSE",`^${c[l.LONETILDE]}${c[l.XRANGEPLAINLOOSE]}$`),m("LONECARET","(?:\\^)"),m("CARETTRIM",`(\\s*)${c[l.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",m("CARET",`^${c[l.LONECARET]}${c[l.XRANGEPLAIN]}$`),m("CARETLOOSE",`^${c[l.LONECARET]}${c[l.XRANGEPLAINLOOSE]}$`),m("COMPARATORLOOSE",`^${c[l.GTLT]}\\s*(${c[l.LOOSEPLAIN]})$|^$`),m("COMPARATOR",`^${c[l.GTLT]}\\s*(${c[l.FULLPLAIN]})$|^$`),m("COMPARATORTRIM",`(\\s*)${c[l.GTLT]}\\s*(${c[l.LOOSEPLAIN]}|${c[l.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",m("HYPHENRANGE",`^\\s*(${c[l.XRANGEPLAIN]})\\s+-\\s+(${c[l.XRANGEPLAIN]})\\s*$`),m("HYPHENRANGELOOSE",`^\\s*(${c[l.XRANGEPLAINLOOSE]})\\s+-\\s+(${c[l.XRANGEPLAINLOOSE]})\\s*$`),m("STAR","(<|>)?=?\\s*\\*"),m("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),m("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(qo,qo.exports);var ai=qo.exports;const Fw=Object.freeze({loose:!0}),jw=Object.freeze({}),Uw=n=>n?typeof n!="object"?Fw:n:jw;var fu=Uw;const Wl=/^[0-9]+$/,Eh=(n,e)=>{const t=Wl.test(n),r=Wl.test(e);return t&&r&&(n=+n,e=+e),n===e?0:t&&!r?-1:r&&!t?1:n<e?-1:1},Bw=(n,e)=>Eh(e,n);var wh={compareIdentifiers:Eh,rcompareIdentifiers:Bw};const Oi=zs,{MAX_LENGTH:Vl,MAX_SAFE_INTEGER:Ri}=Vs,{safeRe:zl,safeSrc:ql,t:Ii}=ai,Gw=fu,{compareIdentifiers:Nn}=wh;let Hw=class mt{constructor(e,t){if(t=Gw(t),e instanceof mt){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if(typeof e!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof e}".`);if(e.length>Vl)throw new TypeError(`version is longer than ${Vl} characters`);Oi("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?zl[Ii.LOOSE]:zl[Ii.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>Ri||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Ri||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Ri||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map(i=>{if(/^[0-9]+$/.test(i)){const s=+i;if(s>=0&&s<Ri)return s}return i}):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Oi("SemVer.compare",this.version,this.options,e),!(e instanceof mt)){if(typeof e=="string"&&e===this.version)return 0;e=new mt(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof mt||(e=new mt(e,this.options)),Nn(this.major,e.major)||Nn(this.minor,e.minor)||Nn(this.patch,e.patch)}comparePre(e){if(e instanceof mt||(e=new mt(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const r=this.prerelease[t],i=e.prerelease[t];if(Oi("prerelease compare",t,r,i),r===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(r===void 0)return-1;if(r===i)continue;return Nn(r,i)}while(++t)}compareBuild(e){e instanceof mt||(e=new mt(e,this.options));let t=0;do{const r=this.build[t],i=e.build[t];if(Oi("build compare",t,r,i),r===void 0&&i===void 0)return 0;if(i===void 0)return 1;if(r===void 0)return-1;if(r===i)continue;return Nn(r,i)}while(++t)}inc(e,t,r){if(e.startsWith("pre")){if(!t&&r===!1)throw new Error("invalid increment argument: identifier is empty");if(t){const i=new RegExp(`^${this.options.loose?ql[Ii.PRERELEASELOOSE]:ql[Ii.PRERELEASE]}$`),s=`-${t}`.match(i);if(!s||s[1]!==t)throw new Error(`invalid identifier: ${t}`)}}switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t,r);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t,r);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t,r),this.inc("pre",t,r);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",t,r),this.inc("pre",t,r);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const i=Number(r)?1:0;if(this.prerelease.length===0)this.prerelease=[i];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(t===this.prerelease.join(".")&&r===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(i)}}if(t){let s=[t,i];r===!1&&(s=[t]),Nn(this.prerelease[0],t)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error(`invalid increment argument: ${e}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}};var ke=Hw;const Zl=ke,Ww=(n,e,t=!1)=>{if(n instanceof Zl)return n;try{return new Zl(n,e)}catch(r){if(!t)return null;throw r}};var gr=Ww;const Vw=gr,zw=(n,e)=>{const t=Vw(n,e);return t?t.version:null};var qw=zw;const Zw=gr,Xw=(n,e)=>{const t=Zw(n.trim().replace(/^[=v]+/,""),e);return t?t.version:null};var Yw=Xw;const Xl=ke,Kw=(n,e,t,r,i)=>{typeof t=="string"&&(i=r,r=t,t=void 0);try{return new Xl(n instanceof Xl?n.version:n,t).inc(e,r,i).version}catch{return null}};var Jw=Kw;const Yl=gr,Qw=(n,e)=>{const t=Yl(n,null,!0),r=Yl(e,null,!0),i=t.compare(r);if(i===0)return null;const s=i>0,a=s?t:r,o=s?r:t,c=!!a.prerelease.length;if(!!o.prerelease.length&&!c){if(!o.patch&&!o.minor)return"major";if(o.compareMain(a)===0)return o.minor&&!o.patch?"minor":"patch"}const l=c?"pre":"";return t.major!==r.major?l+"major":t.minor!==r.minor?l+"minor":t.patch!==r.patch?l+"patch":"prerelease"};var eS=Qw;const tS=ke,nS=(n,e)=>new tS(n,e).major;var rS=nS;const iS=ke,sS=(n,e)=>new iS(n,e).minor;var aS=sS;const oS=ke,cS=(n,e)=>new oS(n,e).patch;var uS=cS;const lS=gr,dS=(n,e)=>{const t=lS(n,e);return t&&t.prerelease.length?t.prerelease:null};var fS=dS;const Kl=ke,pS=(n,e,t)=>new Kl(n,t).compare(new Kl(e,t));var dt=pS;const hS=dt,mS=(n,e,t)=>hS(e,n,t);var gS=mS;const _S=dt,yS=(n,e)=>_S(n,e,!0);var bS=yS;const Jl=ke,vS=(n,e,t)=>{const r=new Jl(n,t),i=new Jl(e,t);return r.compare(i)||r.compareBuild(i)};var pu=vS;const ES=pu,wS=(n,e)=>n.sort((t,r)=>ES(t,r,e));var SS=wS;const TS=pu,AS=(n,e)=>n.sort((t,r)=>TS(r,t,e));var OS=AS;const RS=dt,IS=(n,e,t)=>RS(n,e,t)>0;var qs=IS;const PS=dt,CS=(n,e,t)=>PS(n,e,t)<0;var hu=CS;const NS=dt,LS=(n,e,t)=>NS(n,e,t)===0;var Sh=LS;const xS=dt,$S=(n,e,t)=>xS(n,e,t)!==0;var Th=$S;const MS=dt,kS=(n,e,t)=>MS(n,e,t)>=0;var mu=kS;const DS=dt,FS=(n,e,t)=>DS(n,e,t)<=0;var gu=FS;const jS=Sh,US=Th,BS=qs,GS=mu,HS=hu,WS=gu,VS=(n,e,t,r)=>{switch(e){case"===":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n===t;case"!==":return typeof n=="object"&&(n=n.version),typeof t=="object"&&(t=t.version),n!==t;case"":case"=":case"==":return jS(n,t,r);case"!=":return US(n,t,r);case">":return BS(n,t,r);case">=":return GS(n,t,r);case"<":return HS(n,t,r);case"<=":return WS(n,t,r);default:throw new TypeError(`Invalid operator: ${e}`)}};var Ah=VS;const zS=ke,qS=gr,{safeRe:Pi,t:Ci}=ai,ZS=(n,e)=>{if(n instanceof zS)return n;if(typeof n=="number"&&(n=String(n)),typeof n!="string")return null;e=e||{};let t=null;if(!e.rtl)t=n.match(e.includePrerelease?Pi[Ci.COERCEFULL]:Pi[Ci.COERCE]);else{const c=e.includePrerelease?Pi[Ci.COERCERTLFULL]:Pi[Ci.COERCERTL];let u;for(;(u=c.exec(n))&&(!t||t.index+t[0].length!==n.length);)(!t||u.index+u[0].length!==t.index+t[0].length)&&(t=u),c.lastIndex=u.index+u[1].length+u[2].length;c.lastIndex=-1}if(t===null)return null;const r=t[2],i=t[3]||"0",s=t[4]||"0",a=e.includePrerelease&&t[5]?`-${t[5]}`:"",o=e.includePrerelease&&t[6]?`+${t[6]}`:"";return qS(`${r}.${i}.${s}${a}${o}`,e)};var XS=ZS;class YS{constructor(){this.max=1e3,this.map=new Map}get(e){const t=this.map.get(e);if(t!==void 0)return this.map.delete(e),this.map.set(e,t),t}delete(e){return this.map.delete(e)}set(e,t){if(!this.delete(e)&&t!==void 0){if(this.map.size>=this.max){const i=this.map.keys().next().value;this.delete(i)}this.map.set(e,t)}return this}}var KS=YS,Na,Ql;function ft(){if(Ql)return Na;Ql=1;const n=/\s+/g;class e{constructor(A,P){if(P=i(P),A instanceof e)return A.loose===!!P.loose&&A.includePrerelease===!!P.includePrerelease?A:new e(A.raw,P);if(A instanceof s)return this.raw=A.value,this.set=[[A]],this.formatted=void 0,this;if(this.options=P,this.loose=!!P.loose,this.includePrerelease=!!P.includePrerelease,this.raw=A.trim().replace(n," "),this.set=this.raw.split("||").map(I=>this.parseRange(I.trim())).filter(I=>I.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const I=this.set[0];if(this.set=this.set.filter(L=>!m(L[0])),this.set.length===0)this.set=[I];else if(this.set.length>1){for(const L of this.set)if(L.length===1&&g(L[0])){this.set=[L];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let A=0;A<this.set.length;A++){A>0&&(this.formatted+="||");const P=this.set[A];for(let I=0;I<P.length;I++)I>0&&(this.formatted+=" "),this.formatted+=P[I].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(A){const I=((this.options.includePrerelease&&p)|(this.options.loose&&h))+":"+A,L=r.get(I);if(L)return L;const R=this.options.loose,F=R?c[u.HYPHENRANGELOOSE]:c[u.HYPHENRANGE];A=A.replace(F,qe(this.options.includePrerelease)),a("hyphen replace",A),A=A.replace(c[u.COMPARATORTRIM],l),a("comparator trim",A),A=A.replace(c[u.TILDETRIM],d),a("tilde trim",A),A=A.replace(c[u.CARETTRIM],f),a("caret trim",A);let Z=A.split(" ").map(M=>E(M,this.options)).join(" ").split(/\s+/).map(M=>le(M,this.options));R&&(Z=Z.filter(M=>(a("loose invalid filter",M,this.options),!!M.match(c[u.COMPARATORLOOSE])))),a("range list",Z);const k=new Map,C=Z.map(M=>new s(M,this.options));for(const M of C){if(m(M))return[M];k.set(M.value,M)}k.size>1&&k.has("")&&k.delete("");const Y=[...k.values()];return r.set(I,Y),Y}intersects(A,P){if(!(A instanceof e))throw new TypeError("a Range is required");return this.set.some(I=>y(I,P)&&A.set.some(L=>y(L,P)&&I.every(R=>L.every(F=>R.intersects(F,P)))))}test(A){if(!A)return!1;if(typeof A=="string")try{A=new o(A,this.options)}catch{return!1}for(let P=0;P<this.set.length;P++)if(pt(this.set[P],A,this.options))return!0;return!1}}Na=e;const t=KS,r=new t,i=fu,s=Zs(),a=zs,o=ke,{safeRe:c,t:u,comparatorTrimReplace:l,tildeTrimReplace:d,caretTrimReplace:f}=ai,{FLAG_INCLUDE_PRERELEASE:p,FLAG_LOOSE:h}=Vs,m=O=>O.value==="<0.0.0-0",g=O=>O.value==="",y=(O,A)=>{let P=!0;const I=O.slice();let L=I.pop();for(;P&&I.length;)P=I.every(R=>L.intersects(R,A)),L=I.pop();return P},E=(O,A)=>(a("comp",O,A),O=D(O,A),a("caret",O),O=S(O,A),a("tildes",O),O=Te(O,A),a("xrange",O),O=ce(O,A),a("stars",O),O),b=O=>!O||O.toLowerCase()==="x"||O==="*",S=(O,A)=>O.trim().split(/\s+/).map(P=>v(P,A)).join(" "),v=(O,A)=>{const P=A.loose?c[u.TILDELOOSE]:c[u.TILDE];return O.replace(P,(I,L,R,F,Z)=>{a("tilde",O,I,L,R,F,Z);let k;return b(L)?k="":b(R)?k=`>=${L}.0.0 <${+L+1}.0.0-0`:b(F)?k=`>=${L}.${R}.0 <${L}.${+R+1}.0-0`:Z?(a("replaceTilde pr",Z),k=`>=${L}.${R}.${F}-${Z} <${L}.${+R+1}.0-0`):k=`>=${L}.${R}.${F} <${L}.${+R+1}.0-0`,a("tilde return",k),k})},D=(O,A)=>O.trim().split(/\s+/).map(P=>H(P,A)).join(" "),H=(O,A)=>{a("caret",O,A);const P=A.loose?c[u.CARETLOOSE]:c[u.CARET],I=A.includePrerelease?"-0":"";return O.replace(P,(L,R,F,Z,k)=>{a("caret",O,L,R,F,Z,k);let C;return b(R)?C="":b(F)?C=`>=${R}.0.0${I} <${+R+1}.0.0-0`:b(Z)?R==="0"?C=`>=${R}.${F}.0${I} <${R}.${+F+1}.0-0`:C=`>=${R}.${F}.0${I} <${+R+1}.0.0-0`:k?(a("replaceCaret pr",k),R==="0"?F==="0"?C=`>=${R}.${F}.${Z}-${k} <${R}.${F}.${+Z+1}-0`:C=`>=${R}.${F}.${Z}-${k} <${R}.${+F+1}.0-0`:C=`>=${R}.${F}.${Z}-${k} <${+R+1}.0.0-0`):(a("no pr"),R==="0"?F==="0"?C=`>=${R}.${F}.${Z}${I} <${R}.${F}.${+Z+1}-0`:C=`>=${R}.${F}.${Z}${I} <${R}.${+F+1}.0-0`:C=`>=${R}.${F}.${Z} <${+R+1}.0.0-0`),a("caret return",C),C})},Te=(O,A)=>(a("replaceXRanges",O,A),O.split(/\s+/).map(P=>be(P,A)).join(" ")),be=(O,A)=>{O=O.trim();const P=A.loose?c[u.XRANGELOOSE]:c[u.XRANGE];return O.replace(P,(I,L,R,F,Z,k)=>{a("xRange",O,I,L,R,F,Z,k);const C=b(R),Y=C||b(F),M=Y||b(Z),Oe=M;return L==="="&&Oe&&(L=""),k=A.includePrerelease?"-0":"",C?L===">"||L==="<"?I="<0.0.0-0":I="*":L&&Oe?(Y&&(F=0),Z=0,L===">"?(L=">=",Y?(R=+R+1,F=0,Z=0):(F=+F+1,Z=0)):L==="<="&&(L="<",Y?R=+R+1:F=+F+1),L==="<"&&(k="-0"),I=`${L+R}.${F}.${Z}${k}`):Y?I=`>=${R}.0.0${k} <${+R+1}.0.0-0`:M&&(I=`>=${R}.${F}.0${k} <${R}.${+F+1}.0-0`),a("xRange return",I),I})},ce=(O,A)=>(a("replaceStars",O,A),O.trim().replace(c[u.STAR],"")),le=(O,A)=>(a("replaceGTE0",O,A),O.trim().replace(c[A.includePrerelease?u.GTE0PRE:u.GTE0],"")),qe=O=>(A,P,I,L,R,F,Z,k,C,Y,M,Oe)=>(b(I)?P="":b(L)?P=`>=${I}.0.0${O?"-0":""}`:b(R)?P=`>=${I}.${L}.0${O?"-0":""}`:F?P=`>=${P}`:P=`>=${P}${O?"-0":""}`,b(C)?k="":b(Y)?k=`<${+C+1}.0.0-0`:b(M)?k=`<${C}.${+Y+1}.0-0`:Oe?k=`<=${C}.${Y}.${M}-${Oe}`:O?k=`<${C}.${Y}.${+M+1}-0`:k=`<=${k}`,`${P} ${k}`.trim()),pt=(O,A,P)=>{for(let I=0;I<O.length;I++)if(!O[I].test(A))return!1;if(A.prerelease.length&&!P.includePrerelease){for(let I=0;I<O.length;I++)if(a(O[I].semver),O[I].semver!==s.ANY&&O[I].semver.prerelease.length>0){const L=O[I].semver;if(L.major===A.major&&L.minor===A.minor&&L.patch===A.patch)return!0}return!1}return!0};return Na}var La,ed;function Zs(){if(ed)return La;ed=1;const n=Symbol("SemVer ANY");class e{static get ANY(){return n}constructor(l,d){if(d=t(d),l instanceof e){if(l.loose===!!d.loose)return l;l=l.value}l=l.trim().split(/\s+/).join(" "),a("comparator",l,d),this.options=d,this.loose=!!d.loose,this.parse(l),this.semver===n?this.value="":this.value=this.operator+this.semver.version,a("comp",this)}parse(l){const d=this.options.loose?r[i.COMPARATORLOOSE]:r[i.COMPARATOR],f=l.match(d);if(!f)throw new TypeError(`Invalid comparator: ${l}`);this.operator=f[1]!==void 0?f[1]:"",this.operator==="="&&(this.operator=""),f[2]?this.semver=new o(f[2],this.options.loose):this.semver=n}toString(){return this.value}test(l){if(a("Comparator.test",l,this.options.loose),this.semver===n||l===n)return!0;if(typeof l=="string")try{l=new o(l,this.options)}catch{return!1}return s(l,this.operator,this.semver,this.options)}intersects(l,d){if(!(l instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new c(l.value,d).test(this.value):l.operator===""?l.value===""?!0:new c(this.value,d).test(l.semver):(d=t(d),d.includePrerelease&&(this.value==="<0.0.0-0"||l.value==="<0.0.0-0")||!d.includePrerelease&&(this.value.startsWith("<0.0.0")||l.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&l.operator.startsWith(">")||this.operator.startsWith("<")&&l.operator.startsWith("<")||this.semver.version===l.semver.version&&this.operator.includes("=")&&l.operator.includes("=")||s(this.semver,"<",l.semver,d)&&this.operator.startsWith(">")&&l.operator.startsWith("<")||s(this.semver,">",l.semver,d)&&this.operator.startsWith("<")&&l.operator.startsWith(">")))}}La=e;const t=fu,{safeRe:r,t:i}=ai,s=Ah,a=zs,o=ke,c=ft();return La}const JS=ft(),QS=(n,e,t)=>{try{e=new JS(e,t)}catch{return!1}return e.test(n)};var Xs=QS;const eT=ft(),tT=(n,e)=>new eT(n,e).set.map(t=>t.map(r=>r.value).join(" ").trim().split(" "));var nT=tT;const rT=ke,iT=ft(),sT=(n,e,t)=>{let r=null,i=null,s=null;try{s=new iT(e,t)}catch{return null}return n.forEach(a=>{s.test(a)&&(!r||i.compare(a)===-1)&&(r=a,i=new rT(r,t))}),r};var aT=sT;const oT=ke,cT=ft(),uT=(n,e,t)=>{let r=null,i=null,s=null;try{s=new cT(e,t)}catch{return null}return n.forEach(a=>{s.test(a)&&(!r||i.compare(a)===1)&&(r=a,i=new oT(r,t))}),r};var lT=uT;const xa=ke,dT=ft(),td=qs,fT=(n,e)=>{n=new dT(n,e);let t=new xa("0.0.0");if(n.test(t)||(t=new xa("0.0.0-0"),n.test(t)))return t;t=null;for(let r=0;r<n.set.length;++r){const i=n.set[r];let s=null;i.forEach(a=>{const o=new xa(a.semver.version);switch(a.operator){case">":o.prerelease.length===0?o.patch++:o.prerelease.push(0),o.raw=o.format();case"":case">=":(!s||td(o,s))&&(s=o);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${a.operator}`)}}),s&&(!t||td(t,s))&&(t=s)}return t&&n.test(t)?t:null};var pT=fT;const hT=ft(),mT=(n,e)=>{try{return new hT(n,e).range||"*"}catch{return null}};var gT=mT;const _T=ke,Oh=Zs(),{ANY:yT}=Oh,bT=ft(),vT=Xs,nd=qs,rd=hu,ET=gu,wT=mu,ST=(n,e,t,r)=>{n=new _T(n,r),e=new bT(e,r);let i,s,a,o,c;switch(t){case">":i=nd,s=ET,a=rd,o=">",c=">=";break;case"<":i=rd,s=wT,a=nd,o="<",c="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(vT(n,e,r))return!1;for(let u=0;u<e.set.length;++u){const l=e.set[u];let d=null,f=null;if(l.forEach(p=>{p.semver===yT&&(p=new Oh(">=0.0.0")),d=d||p,f=f||p,i(p.semver,d.semver,r)?d=p:a(p.semver,f.semver,r)&&(f=p)}),d.operator===o||d.operator===c||(!f.operator||f.operator===o)&&s(n,f.semver))return!1;if(f.operator===c&&a(n,f.semver))return!1}return!0};var _u=ST;const TT=_u,AT=(n,e,t)=>TT(n,e,">",t);var OT=AT;const RT=_u,IT=(n,e,t)=>RT(n,e,"<",t);var PT=IT;const id=ft(),CT=(n,e,t)=>(n=new id(n,t),e=new id(e,t),n.intersects(e,t));var NT=CT;const LT=Xs,xT=dt;var $T=(n,e,t)=>{const r=[];let i=null,s=null;const a=n.sort((l,d)=>xT(l,d,t));for(const l of a)LT(l,e,t)?(s=l,i||(i=l)):(s&&r.push([i,s]),s=null,i=null);i&&r.push([i,null]);const o=[];for(const[l,d]of r)l===d?o.push(l):!d&&l===a[0]?o.push("*"):d?l===a[0]?o.push(`<=${d}`):o.push(`${l} - ${d}`):o.push(`>=${l}`);const c=o.join(" || "),u=typeof e.raw=="string"?e.raw:String(e);return c.length<u.length?c:e};const sd=ft(),yu=Zs(),{ANY:$a}=yu,vr=Xs,bu=dt,MT=(n,e,t={})=>{if(n===e)return!0;n=new sd(n,t),e=new sd(e,t);let r=!1;e:for(const i of n.set){for(const s of e.set){const a=DT(i,s,t);if(r=r||a!==null,a)continue e}if(r)return!1}return!0},kT=[new yu(">=0.0.0-0")],ad=[new yu(">=0.0.0")],DT=(n,e,t)=>{if(n===e)return!0;if(n.length===1&&n[0].semver===$a){if(e.length===1&&e[0].semver===$a)return!0;t.includePrerelease?n=kT:n=ad}if(e.length===1&&e[0].semver===$a){if(t.includePrerelease)return!0;e=ad}const r=new Set;let i,s;for(const p of n)p.operator===">"||p.operator===">="?i=od(i,p,t):p.operator==="<"||p.operator==="<="?s=cd(s,p,t):r.add(p.semver);if(r.size>1)return null;let a;if(i&&s){if(a=bu(i.semver,s.semver,t),a>0)return null;if(a===0&&(i.operator!==">="||s.operator!=="<="))return null}for(const p of r){if(i&&!vr(p,String(i),t)||s&&!vr(p,String(s),t))return null;for(const h of e)if(!vr(p,String(h),t))return!1;return!0}let o,c,u,l,d=s&&!t.includePrerelease&&s.semver.prerelease.length?s.semver:!1,f=i&&!t.includePrerelease&&i.semver.prerelease.length?i.semver:!1;d&&d.prerelease.length===1&&s.operator==="<"&&d.prerelease[0]===0&&(d=!1);for(const p of e){if(l=l||p.operator===">"||p.operator===">=",u=u||p.operator==="<"||p.operator==="<=",i){if(f&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===f.major&&p.semver.minor===f.minor&&p.semver.patch===f.patch&&(f=!1),p.operator===">"||p.operator===">="){if(o=od(i,p,t),o===p&&o!==i)return!1}else if(i.operator===">="&&!vr(i.semver,String(p),t))return!1}if(s){if(d&&p.semver.prerelease&&p.semver.prerelease.length&&p.semver.major===d.major&&p.semver.minor===d.minor&&p.semver.patch===d.patch&&(d=!1),p.operator==="<"||p.operator==="<="){if(c=cd(s,p,t),c===p&&c!==s)return!1}else if(s.operator==="<="&&!vr(s.semver,String(p),t))return!1}if(!p.operator&&(s||i)&&a!==0)return!1}return!(i&&u&&!s&&a!==0||s&&l&&!i&&a!==0||f||d)},od=(n,e,t)=>{if(!n)return e;const r=bu(n.semver,e.semver,t);return r>0?n:r<0||e.operator===">"&&n.operator===">="?e:n},cd=(n,e,t)=>{if(!n)return e;const r=bu(n.semver,e.semver,t);return r<0?n:r>0||e.operator==="<"&&n.operator==="<="?e:n};var FT=MT;const Ma=ai,ud=Vs,jT=ke,ld=wh,UT=gr,BT=qw,GT=Yw,HT=Jw,WT=eS,VT=rS,zT=aS,qT=uS,ZT=fS,XT=dt,YT=gS,KT=bS,JT=pu,QT=SS,e0=OS,t0=qs,n0=hu,r0=Sh,i0=Th,s0=mu,a0=gu,o0=Ah,c0=XS,u0=Zs(),l0=ft(),d0=Xs,f0=nT,p0=aT,h0=lT,m0=pT,g0=gT,_0=_u,y0=OT,b0=PT,v0=NT,E0=$T,w0=FT;var Zo={parse:UT,valid:BT,clean:GT,inc:HT,diff:WT,major:VT,minor:zT,patch:qT,prerelease:ZT,compare:XT,rcompare:YT,compareLoose:KT,compareBuild:JT,sort:QT,rsort:e0,gt:t0,lt:n0,eq:r0,neq:i0,gte:s0,lte:a0,cmp:o0,coerce:c0,Comparator:u0,Range:l0,satisfies:d0,toComparators:f0,maxSatisfying:p0,minSatisfying:h0,minVersion:m0,validRange:g0,outside:_0,gtr:y0,ltr:b0,intersects:v0,simplifyRange:E0,subset:w0,SemVer:jT,re:Ma.re,src:Ma.src,tokens:Ma.t,SEMVER_SPEC_VERSION:ud.SEMVER_SPEC_VERSION,RELEASE_TYPES:ud.RELEASE_TYPES,compareIdentifiers:ld.compareIdentifiers,rcompareIdentifiers:ld.rcompareIdentifiers},Rh=function(){function n(){}return n.prototype.emit=function(e){},n}(),S0=new Rh,T0=function(){function n(){}return n.prototype.getLogger=function(e,t,r){return new Rh},n}(),Ih=new T0,A0=function(){function n(e,t,r,i){this._provider=e,this.name=t,this.version=r,this.options=i}return n.prototype.emit=function(e){this._getLogger().emit(e)},n.prototype._getLogger=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateLogger(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):S0},n}(),dd=function(){function n(){}return n.prototype.getLogger=function(e,t,r){var i;return(i=this.getDelegateLogger(e,t,r))!==null&&i!==void 0?i:new A0(this,e,t,r)},n.prototype.getDelegate=function(){var e;return(e=this._delegate)!==null&&e!==void 0?e:Ih},n.prototype.setDelegate=function(e){this._delegate=e},n.prototype.getDelegateLogger=function(e,t,r){var i;return(i=this._delegate)===null||i===void 0?void 0:i.getLogger(e,t,r)},n}(),O0=typeof globalThis=="object"?globalThis:global,Ni=Symbol.for("io.opentelemetry.js.api.logs"),Er=O0;function R0(n,e,t){return function(r){return r===n?e:t}}var fd=1,I0=function(){function n(){this._proxyLoggerProvider=new dd}return n.getInstance=function(){return this._instance||(this._instance=new n),this._instance},n.prototype.setGlobalLoggerProvider=function(e){return Er[Ni]?this.getLoggerProvider():(Er[Ni]=R0(fd,e,Ih),this._proxyLoggerProvider.setDelegate(e),e)},n.prototype.getLoggerProvider=function(){var e,t;return(t=(e=Er[Ni])===null||e===void 0?void 0:e.call(Er,fd))!==null&&t!==void 0?t:this._proxyLoggerProvider},n.prototype.getLogger=function(e,t,r){return this.getLoggerProvider().getLogger(e,t,r)},n.prototype.disable=function(){delete Er[Ni],this._proxyLoggerProvider=new dd},n}(),Ph=I0.getInstance();function P0(n,e,t,r){for(var i=0,s=n.length;i<s;i++){var a=n[i];e&&a.setTracerProvider(e),t&&a.setMeterProvider(t),r&&a.setLoggerProvider&&a.setLoggerProvider(r),a.getConfig().enabled||a.enable()}}function C0(n){n.forEach(function(e){return e.disable()})}function vu(n){var e,t,r=n.tracerProvider||K.getTracerProvider(),i=n.meterProvider||Hs.getMeterProvider(),s=n.loggerProvider||Ph.getLoggerProvider(),a=(t=(e=n.instrumentations)===null||e===void 0?void 0:e.flat())!==null&&t!==void 0?t:[];return P0(a,r,i,s),function(){C0(a)}}function Xo(n){return typeof n=="function"}var xe=console.error.bind(console);function wr(n,e,t){var r=!!n[e]&&n.propertyIsEnumerable(e);Object.defineProperty(n,e,{configurable:!0,enumerable:r,writable:!0,value:t})}function oi(n){n&&n.logger&&(Xo(n.logger)?xe=n.logger:xe("new logger isn't a function, not replacing"))}function Ch(n,e,t){if(!n||!n[e]){xe("no original function "+e+" to wrap");return}if(!t){xe("no wrapper function"),xe(new Error().stack);return}if(!Xo(n[e])||!Xo(t)){xe("original object and wrapper must be functions");return}var r=n[e],i=t(r,e);return wr(i,"__original",r),wr(i,"__unwrap",function(){n[e]===i&&wr(n,e,r)}),wr(i,"__wrapped",!0),wr(n,e,i),i}function N0(n,e,t){if(n)Array.isArray(n)||(n=[n]);else{xe("must provide one or more modules to patch"),xe(new Error().stack);return}if(!(e&&Array.isArray(e))){xe("must provide one or more functions to wrap on modules");return}n.forEach(function(r){e.forEach(function(i){Ch(r,i,t)})})}function Nh(n,e){if(!n||!n[e]){xe("no function to unwrap."),xe(new Error().stack);return}if(!n[e].__unwrap)xe("no original to unwrap to -- has "+e+" already been unwrapped?");else return n[e].__unwrap()}function L0(n,e){if(n)Array.isArray(n)||(n=[n]);else{xe("must provide one or more modules to patch"),xe(new Error().stack);return}if(!(e&&Array.isArray(e))){xe("must provide one or more functions to unwrap on modules");return}n.forEach(function(t){e.forEach(function(r){Nh(t,r)})})}oi.wrap=Ch;oi.massWrap=N0;oi.unwrap=Nh;oi.massUnwrap=L0;var hn=oi,Yo=globalThis&&globalThis.__assign||function(){return Yo=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Yo.apply(this,arguments)},x0=function(){function n(e,t,r){this.instrumentationName=e,this.instrumentationVersion=t,this._config={},this._wrap=hn.wrap,this._unwrap=hn.unwrap,this._massWrap=hn.massWrap,this._massUnwrap=hn.massUnwrap,this.setConfig(r),this._diag=G.createComponentLogger({namespace:e}),this._tracer=K.getTracer(e,t),this._meter=Hs.getMeter(e,t),this._logger=Ph.getLogger(e,t),this._updateMetricInstruments()}return Object.defineProperty(n.prototype,"meter",{get:function(){return this._meter},enumerable:!1,configurable:!0}),n.prototype.setMeterProvider=function(e){this._meter=e.getMeter(this.instrumentationName,this.instrumentationVersion),this._updateMetricInstruments()},Object.defineProperty(n.prototype,"logger",{get:function(){return this._logger},enumerable:!1,configurable:!0}),n.prototype.setLoggerProvider=function(e){this._logger=e.getLogger(this.instrumentationName,this.instrumentationVersion)},n.prototype.getModuleDefinitions=function(){var e,t=(e=this.init())!==null&&e!==void 0?e:[];return Array.isArray(t)?t:[t]},n.prototype._updateMetricInstruments=function(){},n.prototype.getConfig=function(){return this._config},n.prototype.setConfig=function(e){this._config=Yo({enabled:!0},e)},n.prototype.setTracerProvider=function(e){this._tracer=e.getTracer(this.instrumentationName,this.instrumentationVersion)},Object.defineProperty(n.prototype,"tracer",{get:function(){return this._tracer},enumerable:!1,configurable:!0}),n.prototype._runSpanCustomizationHook=function(e,t,r,i){if(e)try{e(r,i)}catch(s){this._diag.error("Error running span customization hook due to exception in handler",{triggerName:t},s)}},n}(),Lh={exports:{}},Ko={exports:{}},Li={exports:{}},ka,pd;function $0(){if(pd)return ka;pd=1;var n=1e3,e=n*60,t=e*60,r=t*24,i=r*7,s=r*365.25;ka=function(l,d){d=d||{};var f=typeof l;if(f==="string"&&l.length>0)return a(l);if(f==="number"&&isFinite(l))return d.long?c(l):o(l);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(l))};function a(l){if(l=String(l),!(l.length>100)){var d=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(l);if(d){var f=parseFloat(d[1]),p=(d[2]||"ms").toLowerCase();switch(p){case"years":case"year":case"yrs":case"yr":case"y":return f*s;case"weeks":case"week":case"w":return f*i;case"days":case"day":case"d":return f*r;case"hours":case"hour":case"hrs":case"hr":case"h":return f*t;case"minutes":case"minute":case"mins":case"min":case"m":return f*e;case"seconds":case"second":case"secs":case"sec":case"s":return f*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:return}}}}function o(l){var d=Math.abs(l);return d>=r?Math.round(l/r)+"d":d>=t?Math.round(l/t)+"h":d>=e?Math.round(l/e)+"m":d>=n?Math.round(l/n)+"s":l+"ms"}function c(l){var d=Math.abs(l);return d>=r?u(l,d,r,"day"):d>=t?u(l,d,t,"hour"):d>=e?u(l,d,e,"minute"):d>=n?u(l,d,n,"second"):l+" ms"}function u(l,d,f,p){var h=d>=f*1.5;return Math.round(l/f)+" "+p+(h?"s":"")}return ka}var Da,hd;function xh(){if(hd)return Da;hd=1;function n(e){r.debug=r,r.default=r,r.coerce=u,r.disable=o,r.enable=s,r.enabled=c,r.humanize=$0(),r.destroy=l,Object.keys(e).forEach(d=>{r[d]=e[d]}),r.names=[],r.skips=[],r.formatters={};function t(d){let f=0;for(let p=0;p<d.length;p++)f=(f<<5)-f+d.charCodeAt(p),f|=0;return r.colors[Math.abs(f)%r.colors.length]}r.selectColor=t;function r(d){let f,p=null,h,m;function g(...y){if(!g.enabled)return;const E=g,b=Number(new Date),S=b-(f||b);E.diff=S,E.prev=f,E.curr=b,f=b,y[0]=r.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let v=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,(H,Te)=>{if(H==="%%")return"%";v++;const be=r.formatters[Te];if(typeof be=="function"){const ce=y[v];H=be.call(E,ce),y.splice(v,1),v--}return H}),r.formatArgs.call(E,y),(E.log||r.log).apply(E,y)}return g.namespace=d,g.useColors=r.useColors(),g.color=r.selectColor(d),g.extend=i,g.destroy=r.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>p!==null?p:(h!==r.namespaces&&(h=r.namespaces,m=r.enabled(d)),m),set:y=>{p=y}}),typeof r.init=="function"&&r.init(g),g}function i(d,f){const p=r(this.namespace+(typeof f>"u"?":":f)+d);return p.log=this.log,p}function s(d){r.save(d),r.namespaces=d,r.names=[],r.skips=[];const f=(typeof d=="string"?d:"").trim().replace(" ",",").split(",").filter(Boolean);for(const p of f)p[0]==="-"?r.skips.push(p.slice(1)):r.names.push(p)}function a(d,f){let p=0,h=0,m=-1,g=0;for(;p<d.length;)if(h<f.length&&(f[h]===d[p]||f[h]==="*"))f[h]==="*"?(m=h,g=p,h++):(p++,h++);else if(m!==-1)h=m+1,g++,p=g;else return!1;for(;h<f.length&&f[h]==="*";)h++;return h===f.length}function o(){const d=[...r.names,...r.skips.map(f=>"-"+f)].join(",");return r.enable(""),d}function c(d){for(const f of r.skips)if(a(d,f))return!1;for(const f of r.names)if(a(d,f))return!0;return!1}function u(d){return d instanceof Error?d.stack||d.message:d}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}return Da=n,Da}var md;function M0(){return md||(md=1,function(n,e){e.formatArgs=r,e.save=i,e.load=s,e.useColors=t,e.storage=a(),e.destroy=(()=>{let c=!1;return()=>{c||(c=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let c;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(c=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(c[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function r(c){if(c[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+c[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;c.splice(1,0,u,"color: inherit");let l=0,d=0;c[0].replace(/%[a-zA-Z%]/g,f=>{f!=="%%"&&(l++,f==="%c"&&(d=l))}),c.splice(d,0,u)}e.log=console.debug||console.log||(()=>{});function i(c){try{c?e.storage.setItem("debug",c):e.storage.removeItem("debug")}catch{}}function s(){let c;try{c=e.storage.getItem("debug")}catch{}return!c&&typeof process<"u"&&"env"in process&&(c=process.env.DEBUG),c}function a(){try{return localStorage}catch{}}n.exports=xh()(e);const{formatters:o}=n.exports;o.j=function(c){try{return JSON.stringify(c)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}}(Li,Li.exports)),Li.exports}var xi={exports:{}},Fa,gd;function k0(){return gd||(gd=1,Fa=(n,e=process.argv)=>{const t=n.startsWith("-")?"":n.length===1?"-":"--",r=e.indexOf(t+n),i=e.indexOf("--");return r!==-1&&(i===-1||r<i)}),Fa}var ja,_d;function D0(){if(_d)return ja;_d=1;const n=Pc,e=dp,t=k0(),{env:r}=process;let i;t("no-color")||t("no-colors")||t("color=false")||t("color=never")?i=0:(t("color")||t("colors")||t("color=true")||t("color=always"))&&(i=1),"FORCE_COLOR"in r&&(r.FORCE_COLOR==="true"?i=1:r.FORCE_COLOR==="false"?i=0:i=r.FORCE_COLOR.length===0?1:Math.min(parseInt(r.FORCE_COLOR,10),3));function s(c){return c===0?!1:{level:c,hasBasic:!0,has256:c>=2,has16m:c>=3}}function a(c,u){if(i===0)return 0;if(t("color=16m")||t("color=full")||t("color=truecolor"))return 3;if(t("color=256"))return 2;if(c&&!u&&i===void 0)return 0;const l=i||0;if(r.TERM==="dumb")return l;if(process.platform==="win32"){const d=n.release().split(".");return Number(d[0])>=10&&Number(d[2])>=10586?Number(d[2])>=14931?3:2:1}if("CI"in r)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some(d=>d in r)||r.CI_NAME==="codeship"?1:l;if("TEAMCITY_VERSION"in r)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(r.TEAMCITY_VERSION)?1:0;if(r.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in r){const d=parseInt((r.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(r.TERM_PROGRAM){case"iTerm.app":return d>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(r.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(r.TERM)||"COLORTERM"in r?1:l}function o(c){const u=a(c,c&&c.isTTY);return s(u)}return ja={supportsColor:o,stdout:s(a(!0,e.isatty(1))),stderr:s(a(!0,e.isatty(2)))},ja}var yd;function F0(){return yd||(yd=1,function(n,e){const t=dp,r=No;e.init=l,e.log=o,e.formatArgs=s,e.save=c,e.load=u,e.useColors=i,e.destroy=r.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."),e.colors=[6,2,3,4,5,1];try{const f=D0();f&&(f.stderr||f).level>=2&&(e.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}e.inspectOpts=Object.keys(process.env).filter(f=>/^debug_/i.test(f)).reduce((f,p)=>{const h=p.substring(6).toLowerCase().replace(/_([a-z])/g,(g,y)=>y.toUpperCase());let m=process.env[p];return/^(yes|on|true|enabled)$/i.test(m)?m=!0:/^(no|off|false|disabled)$/i.test(m)?m=!1:m==="null"?m=null:m=Number(m),f[h]=m,f},{});function i(){return"colors"in e.inspectOpts?!!e.inspectOpts.colors:t.isatty(process.stderr.fd)}function s(f){const{namespace:p,useColors:h}=this;if(h){const m=this.color,g="\x1B[3"+(m<8?m:"8;5;"+m),y=`  ${g};1m${p} \x1B[0m`;f[0]=y+f[0].split(`
`).join(`
`+y),f.push(g+"m+"+n.exports.humanize(this.diff)+"\x1B[0m")}else f[0]=a()+p+" "+f[0]}function a(){return e.inspectOpts.hideDate?"":new Date().toISOString()+" "}function o(...f){return process.stderr.write(r.formatWithOptions(e.inspectOpts,...f)+`
`)}function c(f){f?process.env.DEBUG=f:delete process.env.DEBUG}function u(){return process.env.DEBUG}function l(f){f.inspectOpts={};const p=Object.keys(e.inspectOpts);for(let h=0;h<p.length;h++)f.inspectOpts[p[h]]=e.inspectOpts[p[h]]}n.exports=xh()(e);const{formatters:d}=n.exports;d.o=function(f){return this.inspectOpts.colors=this.useColors,r.inspect(f,this.inspectOpts).split(`
`).map(p=>p.trim()).join(" ")},d.O=function(f){return this.inspectOpts.colors=this.useColors,r.inspect(f,this.inspectOpts)}}(xi,xi.exports)),xi.exports}typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?Ko.exports=M0():Ko.exports=F0();var j0=Ko.exports,Ua=X,$h=function(n){var e=n.split(Ua.sep),t=e.lastIndexOf("node_modules");if(t!==-1&&e[t+1]){var r=e[t+1][0]==="@",i=r?e[t+1]+"/"+e[t+2]:e[t+1],s=r?3:2;return{name:i,basedir:e.slice(0,t+s).join(Ua.sep),path:e.slice(t+s).join(Ua.sep)}}},Ba,bd;function Mh(){if(bd)return Ba;bd=1;var n=Pc;return Ba=n.homedir||function(){var t=process.env.HOME,r=process.env.LOGNAME||process.env.USER||process.env.LNAME||process.env.USERNAME;return process.platform==="win32"?process.env.USERPROFILE||process.env.HOMEDRIVE+process.env.HOMEPATH||t||null:process.platform==="darwin"?t||(r?"/Users/"+r:null):process.platform==="linux"?t||(process.getuid()===0?"/root":r?"/home/"+r:null):t||null},Ba}var Ga,vd;function kh(){return vd||(vd=1,Ga=function(){var n=Error.prepareStackTrace;Error.prepareStackTrace=function(t,r){return r};var e=new Error().stack;return Error.prepareStackTrace=n,e[2].getFileName()}),Ga}var Ln={exports:{}},Ed;function U0(){if(Ed)return Ln.exports;Ed=1;var n=process.platform==="win32",e=/^(((?:[a-zA-Z]:|[\\\/]{2}[^\\\/]+[\\\/]+[^\\\/]+)?[\\\/]?)(?:[^\\\/]*[\\\/])*)((\.{1,2}|[^\\\/]+?|)(\.[^.\/\\]*|))[\\\/]*$/,t={};function r(o){return e.exec(o).slice(1)}t.parse=function(o){if(typeof o!="string")throw new TypeError("Parameter 'pathString' must be a string, not "+typeof o);var c=r(o);if(!c||c.length!==5)throw new TypeError("Invalid path '"+o+"'");return{root:c[1],dir:c[0]===c[1]?c[0]:c[0].slice(0,-1),base:c[2],ext:c[4],name:c[3]}};var i=/^((\/?)(?:[^\/]*\/)*)((\.{1,2}|[^\/]+?|)(\.[^.\/]*|))[\/]*$/,s={};function a(o){return i.exec(o).slice(1)}return s.parse=function(o){if(typeof o!="string")throw new TypeError("Parameter 'pathString' must be a string, not "+typeof o);var c=a(o);if(!c||c.length!==5)throw new TypeError("Invalid path '"+o+"'");return{root:c[1],dir:c[0].slice(0,-1),base:c[2],ext:c[4],name:c[3]}},n?Ln.exports=t.parse:Ln.exports=s.parse,Ln.exports.posix=s.parse,Ln.exports.win32=t.parse,Ln.exports}var Ha,wd;function Dh(){if(wd)return Ha;wd=1;var n=X,e=n.parse||U0(),t=function(i,s){var a="/";/^([A-Za-z]:)/.test(i)?a="":/^\\\\/.test(i)&&(a="\\\\");for(var o=[i],c=e(i);c.dir!==o[o.length-1];)o.push(c.dir),c=e(c.dir);return o.reduce(function(u,l){return u.concat(s.map(function(d){return n.resolve(a,l,d)}))},[])};return Ha=function(i,s,a){var o=s&&s.moduleDirectory?[].concat(s.moduleDirectory):["node_modules"];if(s&&typeof s.paths=="function")return s.paths(a,i,function(){return t(i,o)},s);var c=t(i,o);return s&&s.paths?c.concat(s.paths):c},Ha}var Wa,Sd;function Fh(){return Sd||(Sd=1,Wa=function(n,e){return e||{}}),Wa}var Va,Td;function B0(){if(Td)return Va;Td=1;var n="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,r="[object Function]",i=function(c,u){for(var l=[],d=0;d<c.length;d+=1)l[d]=c[d];for(var f=0;f<u.length;f+=1)l[f+c.length]=u[f];return l},s=function(c,u){for(var l=[],d=u||0,f=0;d<c.length;d+=1,f+=1)l[f]=c[d];return l},a=function(o,c){for(var u="",l=0;l<o.length;l+=1)u+=o[l],l+1<o.length&&(u+=c);return u};return Va=function(c){var u=this;if(typeof u!="function"||e.apply(u)!==r)throw new TypeError(n+u);for(var l=s(arguments,1),d,f=function(){if(this instanceof d){var y=u.apply(this,i(l,arguments));return Object(y)===y?y:this}return u.apply(c,i(l,arguments))},p=t(0,u.length-l.length),h=[],m=0;m<p;m++)h[m]="$"+m;if(d=Function("binder","return function ("+a(h,",")+"){ return binder.apply(this,arguments); }")(f),u.prototype){var g=function(){};g.prototype=u.prototype,d.prototype=new g,g.prototype=null}return d},Va}var za,Ad;function G0(){if(Ad)return za;Ad=1;var n=B0();return za=Function.prototype.bind||n,za}var qa,Od;function H0(){if(Od)return qa;Od=1;var n=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=G0();return qa=t.call(n,e),qa}const W0=!0,V0=">= 8",z0=">= 0.5 && < 0.9.7",q0=!0,Z0=!0,X0=">= 0.5",Y0=!0,K0=!0,J0=!0,Q0=">= 1 && < 8",eA="< 8",tA=!0,nA=[">= 14.17 && < 15",">= 15.1"],rA=!0,iA=">= 0.7.12",sA=!0,aA="< 6",oA=!0,cA=">= 0.11.1",uA=">= 0.11.1",lA=">= 0.11.1",dA=">= 0.11.1",fA=">= 0.11.1",pA=">= 0.11.1",hA=!0,mA=">= 8.8",gA=!0,_A=">= 8",yA="< 8",bA=!0,vA=!0,EA=!0,wA=!0,SA=">= 8.5",TA=">= 1",AA=">= 0.5",OA=!0,RA=!0,IA=!0,PA=">= 0.11.5 && < 3",CA=">= 0.9.4",NA=">= 0.9.4",LA=">= 1.4.1",xA=">= 0.9.4",$A=">= 0.9.4",MA=">= 0.9.4",kA=!0,DA=!0,FA=[">= 0.4 && < 0.7",">= 0.8"],jA=!0,UA=">= 0.11.13",BA=">= 0.11.3 && < 10",GA=">= 0.11.3",HA=!0,WA=">= 10",VA=!0,zA=!0,qA=!0,ZA=">= 1",XA=!0,YA=[">= 13.4 && < 13.5",">= 18.17 && < 19",">= 20"],KA=">= 11.7",JA=">= 0.5",QA={assert:W0,"node:assert":[">= 14.18 && < 15",">= 16"],"assert/strict":">= 15","node:assert/strict":">= 16",async_hooks:V0,"node:async_hooks":[">= 14.18 && < 15",">= 16"],buffer_ieee754:z0,buffer:q0,"node:buffer":[">= 14.18 && < 15",">= 16"],child_process:Z0,"node:child_process":[">= 14.18 && < 15",">= 16"],cluster:X0,"node:cluster":[">= 14.18 && < 15",">= 16"],console:Y0,"node:console":[">= 14.18 && < 15",">= 16"],constants:K0,"node:constants":[">= 14.18 && < 15",">= 16"],crypto:J0,"node:crypto":[">= 14.18 && < 15",">= 16"],_debug_agent:Q0,_debugger:eA,dgram:tA,"node:dgram":[">= 14.18 && < 15",">= 16"],diagnostics_channel:nA,"node:diagnostics_channel":[">= 14.18 && < 15",">= 16"],dns:rA,"node:dns":[">= 14.18 && < 15",">= 16"],"dns/promises":">= 15","node:dns/promises":">= 16",domain:iA,"node:domain":[">= 14.18 && < 15",">= 16"],events:sA,"node:events":[">= 14.18 && < 15",">= 16"],freelist:aA,fs:oA,"node:fs":[">= 14.18 && < 15",">= 16"],"fs/promises":[">= 10 && < 10.1",">= 14"],"node:fs/promises":[">= 14.18 && < 15",">= 16"],_http_agent:cA,"node:_http_agent":[">= 14.18 && < 15",">= 16"],_http_client:uA,"node:_http_client":[">= 14.18 && < 15",">= 16"],_http_common:lA,"node:_http_common":[">= 14.18 && < 15",">= 16"],_http_incoming:dA,"node:_http_incoming":[">= 14.18 && < 15",">= 16"],_http_outgoing:fA,"node:_http_outgoing":[">= 14.18 && < 15",">= 16"],_http_server:pA,"node:_http_server":[">= 14.18 && < 15",">= 16"],http:hA,"node:http":[">= 14.18 && < 15",">= 16"],http2:mA,"node:http2":[">= 14.18 && < 15",">= 16"],https:gA,"node:https":[">= 14.18 && < 15",">= 16"],inspector:_A,"node:inspector":[">= 14.18 && < 15",">= 16"],"inspector/promises":[">= 19"],"node:inspector/promises":[">= 19"],_linklist:yA,module:bA,"node:module":[">= 14.18 && < 15",">= 16"],net:vA,"node:net":[">= 14.18 && < 15",">= 16"],"node-inspect/lib/_inspect":">= 7.6 && < 12","node-inspect/lib/internal/inspect_client":">= 7.6 && < 12","node-inspect/lib/internal/inspect_repl":">= 7.6 && < 12",os:EA,"node:os":[">= 14.18 && < 15",">= 16"],path:wA,"node:path":[">= 14.18 && < 15",">= 16"],"path/posix":">= 15.3","node:path/posix":">= 16","path/win32":">= 15.3","node:path/win32":">= 16",perf_hooks:SA,"node:perf_hooks":[">= 14.18 && < 15",">= 16"],process:TA,"node:process":[">= 14.18 && < 15",">= 16"],punycode:AA,"node:punycode":[">= 14.18 && < 15",">= 16"],querystring:OA,"node:querystring":[">= 14.18 && < 15",">= 16"],readline:RA,"node:readline":[">= 14.18 && < 15",">= 16"],"readline/promises":">= 17","node:readline/promises":">= 17",repl:IA,"node:repl":[">= 14.18 && < 15",">= 16"],"node:sea":[">= 20.12 && < 21",">= 21.7"],smalloc:PA,"node:sqlite":[">= 22.13 && < 23",">= 23.4"],_stream_duplex:CA,"node:_stream_duplex":[">= 14.18 && < 15",">= 16"],_stream_transform:NA,"node:_stream_transform":[">= 14.18 && < 15",">= 16"],_stream_wrap:LA,"node:_stream_wrap":[">= 14.18 && < 15",">= 16"],_stream_passthrough:xA,"node:_stream_passthrough":[">= 14.18 && < 15",">= 16"],_stream_readable:$A,"node:_stream_readable":[">= 14.18 && < 15",">= 16"],_stream_writable:MA,"node:_stream_writable":[">= 14.18 && < 15",">= 16"],stream:kA,"node:stream":[">= 14.18 && < 15",">= 16"],"stream/consumers":">= 16.7","node:stream/consumers":">= 16.7","stream/promises":">= 15","node:stream/promises":">= 16","stream/web":">= 16.5","node:stream/web":">= 16.5",string_decoder:DA,"node:string_decoder":[">= 14.18 && < 15",">= 16"],sys:FA,"node:sys":[">= 14.18 && < 15",">= 16"],"test/reporters":">= 19.9 && < 20.2","node:test/reporters":[">= 18.17 && < 19",">= 19.9",">= 20"],"test/mock_loader":">= 22.3 && < 22.7","node:test/mock_loader":">= 22.3 && < 22.7","node:test":[">= 16.17 && < 17",">= 18"],timers:jA,"node:timers":[">= 14.18 && < 15",">= 16"],"timers/promises":">= 15","node:timers/promises":">= 16",_tls_common:UA,"node:_tls_common":[">= 14.18 && < 15",">= 16"],_tls_legacy:BA,_tls_wrap:GA,"node:_tls_wrap":[">= 14.18 && < 15",">= 16"],tls:HA,"node:tls":[">= 14.18 && < 15",">= 16"],trace_events:WA,"node:trace_events":[">= 14.18 && < 15",">= 16"],tty:VA,"node:tty":[">= 14.18 && < 15",">= 16"],url:zA,"node:url":[">= 14.18 && < 15",">= 16"],util:qA,"node:util":[">= 14.18 && < 15",">= 16"],"util/types":">= 15.3","node:util/types":">= 16","v8/tools/arguments":">= 10 && < 12","v8/tools/codemap":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/consarray":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/csvparser":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/logreader":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/profile_view":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/splaytree":[">= 4.4 && < 5",">= 5.2 && < 12"],v8:ZA,"node:v8":[">= 14.18 && < 15",">= 16"],vm:XA,"node:vm":[">= 14.18 && < 15",">= 16"],wasi:YA,"node:wasi":[">= 18.17 && < 19",">= 20"],worker_threads:KA,"node:worker_threads":[">= 14.18 && < 15",">= 16"],zlib:JA,"node:zlib":[">= 14.18 && < 15",">= 16"]};var Za,Rd;function Ys(){if(Rd)return Za;Rd=1;var n=H0();function e(s,a){for(var o=s.split("."),c=a.split(" "),u=c.length>1?c[0]:"=",l=(c.length>1?c[1]:c[0]).split("."),d=0;d<3;++d){var f=parseInt(o[d]||0,10),p=parseInt(l[d]||0,10);if(f!==p)return u==="<"?f<p:u===">="?f>=p:!1}return u===">="}function t(s,a){var o=a.split(/ ?&& ?/);if(o.length===0)return!1;for(var c=0;c<o.length;++c)if(!e(s,o[c]))return!1;return!0}function r(s,a){if(typeof a=="boolean")return a;var o=typeof s>"u"?process.versions&&process.versions.node:s;if(typeof o!="string")throw new TypeError(typeof s>"u"?"Unable to determine current node version":"If provided, a valid node version is required");if(a&&typeof a=="object"){for(var c=0;c<a.length;++c)if(t(o,a[c]))return!0;return!1}return t(o,a)}var i=QA;return Za=function(a,o){return n(i,a)&&r(o,i[a])},Za}var Xa,Id;function eO(){if(Id)return Xa;Id=1;var n=oe,e=Mh(),t=X,r=kh(),i=Dh(),s=Fh(),a=Ys(),o=process.platform!=="win32"&&n.realpath&&typeof n.realpath.native=="function"?n.realpath.native:n.realpath,c=e(),u=function(){return[t.join(c,".node_modules"),t.join(c,".node_libraries")]},l=function(y,E){n.stat(y,function(b,S){return b?b.code==="ENOENT"||b.code==="ENOTDIR"?E(null,!1):E(b):E(null,S.isFile()||S.isFIFO())})},d=function(y,E){n.stat(y,function(b,S){return b?b.code==="ENOENT"||b.code==="ENOTDIR"?E(null,!1):E(b):E(null,S.isDirectory())})},f=function(y,E){o(y,function(b,S){b&&b.code!=="ENOENT"?E(b):E(null,b?y:S)})},p=function(y,E,b,S){b&&b.preserveSymlinks===!1?y(E,S):S(null,E)},h=function(y,E,b){y(E,function(S,v){if(S)b(S);else try{var D=JSON.parse(v);b(null,D)}catch{b(null)}})},m=function(y,E,b){for(var S=i(E,b,y),v=0;v<S.length;v++)S[v]=t.join(S[v],y);return S};return Xa=function(y,E,b){var S=b,v=E;if(typeof E=="function"&&(S=v,v={}),typeof y!="string"){var D=new TypeError("Path must be a string.");return process.nextTick(function(){S(D)})}v=s(y,v);var H=v.isFile||l,Te=v.isDirectory||d,be=v.readFile||n.readFile,ce=v.realpath||f,le=v.readPackage||h;if(v.readFile&&v.readPackage){var qe=new TypeError("`readFile` and `readPackage` are mutually exclusive.");return process.nextTick(function(){S(qe)})}var pt=v.packageIterator,O=v.extensions||[".js"],A=v.includeCoreModules!==!1,P=v.basedir||t.dirname(r()),I=v.filename||P;v.paths=v.paths||u();var L=t.resolve(P);p(ce,L,v,function(x,V){x?S(x):F(V)});var R;function F(x){if(/^(?:\.\.?(?:\/|$)|\/|([A-Za-z]:)?[/\\])/.test(y))R=t.resolve(x,y),(y==="."||y===".."||y.slice(-1)==="/")&&(R+="/"),/\/$/.test(y)&&R===x?Y(R,v.package,Z):k(R,v.package,Z);else{if(A&&a(y))return S(null,y);Oe(y,x,function(V,he,J){if(V)S(V);else{if(he)return p(ce,he,v,function(Ze,me){Ze?S(Ze):S(null,me,J)});var fe=new Error("Cannot find module '"+y+"' from '"+I+"'");fe.code="MODULE_NOT_FOUND",S(fe)}})}}function Z(x,V,he){x?S(x):V?S(null,V,he):Y(R,function(J,fe,Ze){if(J)S(J);else if(fe)p(ce,fe,v,function(pe,De){pe?S(pe):S(null,De,Ze)});else{var me=new Error("Cannot find module '"+y+"' from '"+I+"'");me.code="MODULE_NOT_FOUND",S(me)}})}function k(x,V,he){var J=V,fe=he;typeof J=="function"&&(fe=J,J=void 0);var Ze=[""].concat(O);me(Ze,x,J);function me(pe,De,At){if(pe.length===0)return fe(null,void 0,At);var on=De+pe[0],ht=At;ht?Re(null,ht):C(t.dirname(on),Re);function Re(Wt,Cn,Ot){if(ht=Cn,Wt)return fe(Wt);if(Ot&&ht&&v.pathFilter){var yi=t.relative(Ot,on),bi=yi.slice(0,yi.length-pe[0].length),yr=v.pathFilter(ht,De,bi);if(yr)return me([""].concat(O.slice()),t.resolve(Ot,yr),ht)}H(on,_i)}function _i(Wt,Cn){if(Wt)return fe(Wt);if(Cn)return fe(null,on,ht);me(pe.slice(1),De,ht)}}}function C(x,V){if(x===""||x==="/"||process.platform==="win32"&&/^\w:[/\\]*$/.test(x)||/[/\\]node_modules[/\\]*$/.test(x))return V(null);p(ce,x,v,function(he,J){if(he)return C(t.dirname(x),V);var fe=t.join(J,"package.json");H(fe,function(Ze,me){if(!me)return C(t.dirname(x),V);le(be,fe,function(pe,De){pe&&V(pe);var At=De;At&&v.packageFilter&&(At=v.packageFilter(At,fe)),V(null,At,x)})})})}function Y(x,V,he){var J=he,fe=V;typeof fe=="function"&&(J=fe,fe=v.package),p(ce,x,v,function(Ze,me){if(Ze)return J(Ze);var pe=t.join(me,"package.json");H(pe,function(De,At){if(De)return J(De);if(!At)return k(t.join(x,"index"),fe,J);le(be,pe,function(on,ht){if(on)return J(on);var Re=ht;if(Re&&v.packageFilter&&(Re=v.packageFilter(Re,pe)),Re&&Re.main){if(typeof Re.main!="string"){var _i=new TypeError("package “"+Re.name+"” `main` must be a string");return _i.code="INVALID_PACKAGE_MAIN",J(_i)}(Re.main==="."||Re.main==="./")&&(Re.main="index"),k(t.resolve(x,Re.main),Re,function(Wt,Cn,Ot){if(Wt)return J(Wt);if(Cn)return J(null,Cn,Ot);if(!Ot)return k(t.join(x,"index"),Ot,J);var yi=t.resolve(x,Ot.main);Y(yi,Ot,function(bi,yr,al){if(bi)return J(bi);if(yr)return J(null,yr,al);k(t.join(x,"index"),al,J)})});return}k(t.join(x,"/index"),Re,J)})})})}function M(x,V){if(V.length===0)return x(null,void 0);var he=V[0];Te(t.dirname(he),J);function J(me,pe){if(me)return x(me);if(!pe)return M(x,V.slice(1));k(he,v.package,fe)}function fe(me,pe,De){if(me)return x(me);if(pe)return x(null,pe,De);Y(he,v.package,Ze)}function Ze(me,pe,De){if(me)return x(me);if(pe)return x(null,pe,De);M(x,V.slice(1))}}function Oe(x,V,he){var J=function(){return m(x,V,v)};M(he,pt?pt(x,V,J,v):J())}},Xa}const tO=!0,nO=">= 8",rO=">= 0.5 && < 0.9.7",iO=!0,sO=!0,aO=">= 0.5",oO=!0,cO=!0,uO=!0,lO=">= 1 && < 8",dO="< 8",fO=!0,pO=[">= 14.17 && < 15",">= 15.1"],hO=!0,mO=">= 0.7.12",gO=!0,_O="< 6",yO=!0,bO=">= 0.11.1",vO=">= 0.11.1",EO=">= 0.11.1",wO=">= 0.11.1",SO=">= 0.11.1",TO=">= 0.11.1",AO=!0,OO=">= 8.8",RO=!0,IO=">= 8",PO="< 8",CO=!0,NO=!0,LO=!0,xO=!0,$O=">= 8.5",MO=">= 1",kO=">= 0.5",DO=!0,FO=!0,jO=!0,UO=">= 0.11.5 && < 3",BO=">= 0.9.4",GO=">= 0.9.4",HO=">= 1.4.1",WO=">= 0.9.4",VO=">= 0.9.4",zO=">= 0.9.4",qO=!0,ZO=!0,XO=[">= 0.4 && < 0.7",">= 0.8"],YO=!0,KO=">= 0.11.13",JO=">= 0.11.3 && < 10",QO=">= 0.11.3",eR=!0,tR=">= 10",nR=!0,rR=!0,iR=!0,sR=">= 1",aR=!0,oR=[">= 13.4 && < 13.5",">= 18.17 && < 19",">= 20"],cR=">= 11.7",uR=">= 0.5",lR={assert:tO,"node:assert":[">= 14.18 && < 15",">= 16"],"assert/strict":">= 15","node:assert/strict":">= 16",async_hooks:nO,"node:async_hooks":[">= 14.18 && < 15",">= 16"],buffer_ieee754:rO,buffer:iO,"node:buffer":[">= 14.18 && < 15",">= 16"],child_process:sO,"node:child_process":[">= 14.18 && < 15",">= 16"],cluster:aO,"node:cluster":[">= 14.18 && < 15",">= 16"],console:oO,"node:console":[">= 14.18 && < 15",">= 16"],constants:cO,"node:constants":[">= 14.18 && < 15",">= 16"],crypto:uO,"node:crypto":[">= 14.18 && < 15",">= 16"],_debug_agent:lO,_debugger:dO,dgram:fO,"node:dgram":[">= 14.18 && < 15",">= 16"],diagnostics_channel:pO,"node:diagnostics_channel":[">= 14.18 && < 15",">= 16"],dns:hO,"node:dns":[">= 14.18 && < 15",">= 16"],"dns/promises":">= 15","node:dns/promises":">= 16",domain:mO,"node:domain":[">= 14.18 && < 15",">= 16"],events:gO,"node:events":[">= 14.18 && < 15",">= 16"],freelist:_O,fs:yO,"node:fs":[">= 14.18 && < 15",">= 16"],"fs/promises":[">= 10 && < 10.1",">= 14"],"node:fs/promises":[">= 14.18 && < 15",">= 16"],_http_agent:bO,"node:_http_agent":[">= 14.18 && < 15",">= 16"],_http_client:vO,"node:_http_client":[">= 14.18 && < 15",">= 16"],_http_common:EO,"node:_http_common":[">= 14.18 && < 15",">= 16"],_http_incoming:wO,"node:_http_incoming":[">= 14.18 && < 15",">= 16"],_http_outgoing:SO,"node:_http_outgoing":[">= 14.18 && < 15",">= 16"],_http_server:TO,"node:_http_server":[">= 14.18 && < 15",">= 16"],http:AO,"node:http":[">= 14.18 && < 15",">= 16"],http2:OO,"node:http2":[">= 14.18 && < 15",">= 16"],https:RO,"node:https":[">= 14.18 && < 15",">= 16"],inspector:IO,"node:inspector":[">= 14.18 && < 15",">= 16"],"inspector/promises":[">= 19"],"node:inspector/promises":[">= 19"],_linklist:PO,module:CO,"node:module":[">= 14.18 && < 15",">= 16"],net:NO,"node:net":[">= 14.18 && < 15",">= 16"],"node-inspect/lib/_inspect":">= 7.6 && < 12","node-inspect/lib/internal/inspect_client":">= 7.6 && < 12","node-inspect/lib/internal/inspect_repl":">= 7.6 && < 12",os:LO,"node:os":[">= 14.18 && < 15",">= 16"],path:xO,"node:path":[">= 14.18 && < 15",">= 16"],"path/posix":">= 15.3","node:path/posix":">= 16","path/win32":">= 15.3","node:path/win32":">= 16",perf_hooks:$O,"node:perf_hooks":[">= 14.18 && < 15",">= 16"],process:MO,"node:process":[">= 14.18 && < 15",">= 16"],punycode:kO,"node:punycode":[">= 14.18 && < 15",">= 16"],querystring:DO,"node:querystring":[">= 14.18 && < 15",">= 16"],readline:FO,"node:readline":[">= 14.18 && < 15",">= 16"],"readline/promises":">= 17","node:readline/promises":">= 17",repl:jO,"node:repl":[">= 14.18 && < 15",">= 16"],"node:sea":[">= 20.12 && < 21",">= 21.7"],smalloc:UO,"node:sqlite":">= 23.4",_stream_duplex:BO,"node:_stream_duplex":[">= 14.18 && < 15",">= 16"],_stream_transform:GO,"node:_stream_transform":[">= 14.18 && < 15",">= 16"],_stream_wrap:HO,"node:_stream_wrap":[">= 14.18 && < 15",">= 16"],_stream_passthrough:WO,"node:_stream_passthrough":[">= 14.18 && < 15",">= 16"],_stream_readable:VO,"node:_stream_readable":[">= 14.18 && < 15",">= 16"],_stream_writable:zO,"node:_stream_writable":[">= 14.18 && < 15",">= 16"],stream:qO,"node:stream":[">= 14.18 && < 15",">= 16"],"stream/consumers":">= 16.7","node:stream/consumers":">= 16.7","stream/promises":">= 15","node:stream/promises":">= 16","stream/web":">= 16.5","node:stream/web":">= 16.5",string_decoder:ZO,"node:string_decoder":[">= 14.18 && < 15",">= 16"],sys:XO,"node:sys":[">= 14.18 && < 15",">= 16"],"test/reporters":">= 19.9 && < 20.2","node:test/reporters":[">= 18.17 && < 19",">= 19.9",">= 20"],"test/mock_loader":">= 22.3 && < 22.7","node:test/mock_loader":">= 22.3 && < 22.7","node:test":[">= 16.17 && < 17",">= 18"],timers:YO,"node:timers":[">= 14.18 && < 15",">= 16"],"timers/promises":">= 15","node:timers/promises":">= 16",_tls_common:KO,"node:_tls_common":[">= 14.18 && < 15",">= 16"],_tls_legacy:JO,_tls_wrap:QO,"node:_tls_wrap":[">= 14.18 && < 15",">= 16"],tls:eR,"node:tls":[">= 14.18 && < 15",">= 16"],trace_events:tR,"node:trace_events":[">= 14.18 && < 15",">= 16"],tty:nR,"node:tty":[">= 14.18 && < 15",">= 16"],url:rR,"node:url":[">= 14.18 && < 15",">= 16"],util:iR,"node:util":[">= 14.18 && < 15",">= 16"],"util/types":">= 15.3","node:util/types":">= 16","v8/tools/arguments":">= 10 && < 12","v8/tools/codemap":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/consarray":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/csvparser":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/logreader":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/profile_view":[">= 4.4 && < 5",">= 5.2 && < 12"],"v8/tools/splaytree":[">= 4.4 && < 5",">= 5.2 && < 12"],v8:sR,"node:v8":[">= 14.18 && < 15",">= 16"],vm:aR,"node:vm":[">= 14.18 && < 15",">= 16"],wasi:oR,"node:wasi":[">= 18.17 && < 19",">= 20"],worker_threads:cR,"node:worker_threads":[">= 14.18 && < 15",">= 16"],zlib:uR,"node:zlib":[">= 14.18 && < 15",">= 16"]};var Ya,Pd;function dR(){if(Pd)return Ya;Pd=1;var n=Ys(),e=lR,t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=n(r));return Ya=t,Ya}var Ka,Cd;function fR(){if(Cd)return Ka;Cd=1;var n=Ys();return Ka=function(t){return n(t)},Ka}var Ja,Nd;function pR(){if(Nd)return Ja;Nd=1;var n=Ys(),e=oe,t=X,r=Mh(),i=kh(),s=Dh(),a=Fh(),o=process.platform!=="win32"&&e.realpathSync&&typeof e.realpathSync.native=="function"?e.realpathSync.native:e.realpathSync,c=r(),u=function(){return[t.join(c,".node_modules"),t.join(c,".node_libraries")]},l=function(y){try{var E=e.statSync(y,{throwIfNoEntry:!1})}catch(b){if(b&&(b.code==="ENOENT"||b.code==="ENOTDIR"))return!1;throw b}return!!E&&(E.isFile()||E.isFIFO())},d=function(y){try{var E=e.statSync(y,{throwIfNoEntry:!1})}catch(b){if(b&&(b.code==="ENOENT"||b.code==="ENOTDIR"))return!1;throw b}return!!E&&E.isDirectory()},f=function(y){try{return o(y)}catch(E){if(E.code!=="ENOENT")throw E}return y},p=function(y,E,b){return b&&b.preserveSymlinks===!1?y(E):E},h=function(y,E){var b=y(E);try{var S=JSON.parse(b);return S}catch{}},m=function(y,E,b){for(var S=s(E,b,y),v=0;v<S.length;v++)S[v]=t.join(S[v],y);return S};return Ja=function(y,E){if(typeof y!="string")throw new TypeError("Path must be a string.");var b=a(y,E),S=b.isFile||l,v=b.readFileSync||e.readFileSync,D=b.isDirectory||d,H=b.realpathSync||f,Te=b.readPackageSync||h;if(b.readFileSync&&b.readPackageSync)throw new TypeError("`readFileSync` and `readPackageSync` are mutually exclusive.");var be=b.packageIterator,ce=b.extensions||[".js"],le=b.includeCoreModules!==!1,qe=b.basedir||t.dirname(i()),pt=b.filename||qe;b.paths=b.paths||u();var O=p(H,t.resolve(qe),b);if(/^(?:\.\.?(?:\/|$)|\/|([A-Za-z]:)?[/\\])/.test(y)){var A=t.resolve(O,y);(y==="."||y===".."||y.slice(-1)==="/")&&(A+="/");var P=R(A)||Z(A);if(P)return p(H,P,b)}else{if(le&&n(y))return y;var I=k(y,O);if(I)return p(H,I,b)}var L=new Error("Cannot find module '"+y+"' from '"+pt+"'");throw L.code="MODULE_NOT_FOUND",L;function R(C){var Y=F(t.dirname(C));if(Y&&Y.dir&&Y.pkg&&b.pathFilter){var M=t.relative(Y.dir,C),Oe=b.pathFilter(Y.pkg,C,M);Oe&&(C=t.resolve(Y.dir,Oe))}if(S(C))return C;for(var x=0;x<ce.length;x++){var V=C+ce[x];if(S(V))return V}}function F(C){if(!(C===""||C==="/")&&!(process.platform==="win32"&&/^\w:[/\\]*$/.test(C))&&!/[/\\]node_modules[/\\]*$/.test(C)){var Y=t.join(p(H,C,b),"package.json");if(!S(Y))return F(t.dirname(C));var M=Te(v,Y);return M&&b.packageFilter&&(M=b.packageFilter(M,C)),{pkg:M,dir:C}}}function Z(C){var Y=t.join(p(H,C,b),"/package.json");if(S(Y)){try{var M=Te(v,Y)}catch{}if(M&&b.packageFilter&&(M=b.packageFilter(M,C)),M&&M.main){if(typeof M.main!="string"){var Oe=new TypeError("package “"+M.name+"” `main` must be a string");throw Oe.code="INVALID_PACKAGE_MAIN",Oe}(M.main==="."||M.main==="./")&&(M.main="index");try{var x=R(t.resolve(C,M.main));if(x)return x;var V=Z(t.resolve(C,M.main));if(V)return V}catch{}}}return R(t.join(C,"/index"))}function k(C,Y){for(var M=function(){return m(C,Y,b)},Oe=be?be(C,Y,M,b):M(),x=0;x<Oe.length;x++){var V=Oe[x];if(D(t.dirname(V))){var he=R(V);if(he)return he;var J=Z(V);if(J)return J}}}},Ja}var Qa,Ld;function jh(){if(Ld)return Qa;Ld=1;var n=eO();return n.core=dR(),n.isCore=fR(),n.sync=pR(),Qa=n,Qa}const hR="require-in-the-middle",mR="7.5.2",gR="Module to hook into the Node.js require function",_R="index.js",yR="types/index.d.ts",bR={debug:"^4.3.5","module-details-from-path":"^1.0.3",resolve:"^1.22.8"},vR={"@babel/core":"^7.9.0","@babel/preset-env":"^7.9.5","@babel/preset-typescript":"^7.9.0","@babel/register":"^7.9.0","ipp-printer":"^1.0.0",patterns:"^1.0.3",roundround:"^0.2.0",semver:"^6.3.0",standard:"^14.3.1",tape:"^4.11.0"},ER={test:"npm run test:lint && npm run test:tape && npm run test:babel","test:lint":"standard","test:tape":"tape test/*.js","test:babel":"node test/babel/babel-register.js"},wR={type:"git",url:"git+https://github.com/nodejs/require-in-the-middle.git"},SR=["require","hook","shim","shimmer","shimming","patch","monkey","monkeypatch","module","load"],TR=["types"],AR="Thomas Watson Steen <w@tson.dk> (https://twitter.com/wa7son)",OR="MIT",RR={url:"https://github.com/nodejs/require-in-the-middle/issues"},IR="https://github.com/nodejs/require-in-the-middle#readme",PR={node:">=8.6.0"},CR={name:hR,version:mR,description:gR,main:_R,types:yR,dependencies:bR,devDependencies:vR,scripts:ER,repository:wR,keywords:SR,files:TR,author:AR,license:OR,bugs:RR,homepage:IR,engines:PR},Vn=X,st=p_,ge=j0("require-in-the-middle"),NR=$h;Lh.exports=Gr;var Uh=Lh.exports.Hook=Gr;let eo,jn;if(st.isBuiltin)jn=st.isBuiltin;else if(st.builtinModules)jn=n=>n.startsWith("node:")?!0:(eo===void 0&&(eo=new Set(st.builtinModules)),eo.has(n));else{const n=jh(),[e,t]=process.versions.node.split(".").map(Number);e===8&&t<8?jn=r=>r==="http2"?!0:!!n.core[r]:jn=r=>!!n.core[r]}let $i;function LR(n,e){if(!$i)if(require.resolve&&require.resolve.paths)$i=function(t,r){return require.resolve(t,{paths:[r]})};else{const t=jh();$i=function(r,i){return t.sync(r,{basedir:i})}}return $i(n,e)}const xR=/([/\\]index)?(\.js)?$/;class $R{constructor(){this._localCache=new Map,this._kRitmExports=Symbol("RitmExports")}has(e,t){if(this._localCache.has(e))return!0;if(t)return!1;{const r=require.cache[e];return!!(r&&this._kRitmExports in r)}}get(e,t){const r=this._localCache.get(e);if(r!==void 0)return r;if(!t){const i=require.cache[e];return i&&i[this._kRitmExports]}}set(e,t,r){r?this._localCache.set(e,t):e in require.cache?require.cache[e][this._kRitmExports]=t:(ge('non-core module is unexpectedly not in require.cache: "%s"',e),this._localCache.set(e,t))}}function Gr(n,e,t){if(!(this instanceof Gr))return new Gr(n,e,t);if(typeof n=="function"?(t=n,n=null,e=null):typeof e=="function"&&(t=e,e=null),typeof st._resolveFilename!="function"){console.error("Error: Expected Module._resolveFilename to be a function (was: %s) - aborting!",typeof st._resolveFilename),console.error("Please report this error as an issue related to Node.js %s at %s",process.version,CR.bugs.url);return}this._cache=new $R,this._unhooked=!1,this._origRequire=st.prototype.require;const r=this,i=new Set,s=e?e.internals===!0:!1,a=Array.isArray(n);ge("registering require hook"),this._require=st.prototype.require=function(c){return r._unhooked===!0?(ge("ignoring require call - module is soft-unhooked"),r._origRequire.apply(this,arguments)):o.call(this,arguments,!1)},typeof process.getBuiltinModule=="function"&&(this._origGetBuiltinModule=process.getBuiltinModule,this._getBuiltinModule=process.getBuiltinModule=function(c){return r._unhooked===!0?(ge("ignoring process.getBuiltinModule call - module is soft-unhooked"),r._origGetBuiltinModule.apply(this,arguments)):o.call(this,arguments,!0)});function o(c,u){const l=c[0],d=jn(l);let f;if(d){if(f=l,l.startsWith("node:")){const E=l.slice(5);jn(E)&&(f=E)}}else{if(u)return ge("call to process.getBuiltinModule with unknown built-in id"),r._origGetBuiltinModule.apply(this,c);try{f=st._resolveFilename(l,this)}catch(E){return ge('Module._resolveFilename("%s") threw %j, calling original Module.require',l,E.message),r._origRequire.apply(this,c)}}let p,h;if(ge("processing %s module require('%s'): %s",d===!0?"core":"non-core",l,f),r._cache.has(f,d)===!0)return ge("returning already patched cached module: %s",f),r._cache.get(f,d);const m=i.has(f);m===!1&&i.add(f);const g=u?r._origGetBuiltinModule.apply(this,c):r._origRequire.apply(this,c);if(m===!0)return ge("module is in the process of being patched already - ignoring: %s",f),g;if(i.delete(f),d===!0){if(a===!0&&n.includes(f)===!1)return ge("ignoring core module not on whitelist: %s",f),g;p=f}else if(a===!0&&n.includes(f)){const E=Vn.parse(f);p=E.name,h=E.dir}else{const E=NR(f);if(E===void 0)return ge("could not parse filename: %s",f),g;p=E.name,h=E.basedir;const b=MR(E);ge("resolved filename to module: %s (id: %s, resolved: %s, basedir: %s)",p,l,b,h);let S=!1;if(a){if(!l.startsWith(".")&&n.includes(l)&&(p=l,S=!0),!n.includes(p)&&!n.includes(b))return g;n.includes(b)&&b!==p&&(p=b,S=!0)}if(!S){let v;try{v=LR(p,h)}catch{return ge("could not resolve module: %s",p),r._cache.set(f,g,d),g}if(v!==f)if(s===!0)p=p+Vn.sep+Vn.relative(h,f),ge("preparing to process require of internal file: %s",p);else return ge("ignoring require of non-main module file: %s",v),r._cache.set(f,g,d),g}}r._cache.set(f,g,d),ge("calling require hook: %s",p);const y=t(g,p,h);return r._cache.set(f,y,d),ge("returning module: %s",p),y}}Gr.prototype.unhook=function(){this._unhooked=!0,this._require===st.prototype.require?(st.prototype.require=this._origRequire,ge("require unhook successful")):ge("require unhook unsuccessful"),process.getBuiltinModule!==void 0&&(this._getBuiltinModule===process.getBuiltinModule?(process.getBuiltinModule=this._origGetBuiltinModule,ge("process.getBuiltinModule unhook successful")):ge("process.getBuiltinModule unhook unsuccessful"))};function MR(n){const e=Vn.sep!=="/"?n.path.split(Vn.sep).join("/"):n.path;return Vn.posix.join(n.name,e).replace(xR,"")}var xd=globalThis&&globalThis.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},$d=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return s},Md=globalThis&&globalThis.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},ds="/",kd=function(){function n(){this.hooks=[],this.children=new Map}return n}(),kR=function(){function n(){this._trie=new kd,this._counter=0}return n.prototype.insert=function(e){var t,r,i=this._trie;try{for(var s=xd(e.moduleName.split(ds)),a=s.next();!a.done;a=s.next()){var o=a.value,c=i.children.get(o);c||(c=new kd,i.children.set(o,c)),i=c}}catch(u){t={error:u}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(t)throw t.error}}i.hooks.push({hook:e,insertedId:this._counter++})},n.prototype.search=function(e,t){var r,i,s=t===void 0?{}:t,a=s.maintainInsertionOrder,o=s.fullOnly,c=this._trie,u=[],l=!0;try{for(var d=xd(e.split(ds)),f=d.next();!f.done;f=d.next()){var p=f.value,h=c.children.get(p);if(!h){l=!1;break}o||u.push.apply(u,Md([],$d(h.hooks),!1)),c=h}}catch(m){r={error:m}}finally{try{f&&!f.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}return o&&l&&u.push.apply(u,Md([],$d(c.hooks),!1)),u.length===0?[]:u.length===1?[u[0].hook]:(a&&u.sort(function(m,g){return m.insertedId-g.insertedId}),u.map(function(m){var g=m.hook;return g}))},n}(),DR=globalThis&&globalThis.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},FR=["afterEach","after","beforeEach","before","describe","it"].every(function(n){return typeof global[n]=="function"}),jR=function(){function n(){this._moduleNameTrie=new kR,this._initialize()}return n.prototype._initialize=function(){var e=this;new Uh(null,{internals:!0},function(t,r,i){var s,a,o=UR(r),c=e._moduleNameTrie.search(o,{maintainInsertionOrder:!0,fullOnly:i===void 0});try{for(var u=DR(c),l=u.next();!l.done;l=u.next()){var d=l.value.onRequire;t=d(t,r,i)}}catch(f){s={error:f}}finally{try{l&&!l.done&&(a=u.return)&&a.call(u)}finally{if(s)throw s.error}}return t})},n.prototype.register=function(e,t){var r={moduleName:e,onRequire:t};return this._moduleNameTrie.insert(r),r},n.getInstance=function(){var e;return FR?new n:this._instance=(e=this._instance)!==null&&e!==void 0?e:new n},n}();function UR(n){return B.sep!==ds?n.split(B.sep).join(ds):n}var ci={exports:{}},ui={};const Bh=[],Jo=new WeakMap,Gh=new WeakMap,Hh=new Map,Wh=[],BR={set(n,e,t){return Jo.get(n)[e](t)},get(n,e){if(e===Symbol.toStringTag)return"Module";const t=Gh.get(n)[e];if(typeof t=="function")return t()},defineProperty(n,e,t){if(!("value"in t))throw new Error("Getters/setters are not supported for exports property descriptors.");return Jo.get(n)[e](t.value)}};function GR(n,e,t,r,i){Hh.set(n,i),Jo.set(e,t),Gh.set(e,r);const s=new Proxy(e,BR);Bh.forEach(a=>a(n,s)),Wh.push([n,s])}ui.register=GR;ui.importHooks=Bh;ui.specifiers=Hh;ui.toHook=Wh;const Dd=X,HR=$h,{fileURLToPath:Fd}=Xr,{MessageChannel:WR}=Co,{importHooks:Qo,specifiers:VR,toHook:zR}=ui;function Vh(n){Qo.push(n),zR.forEach(([e,t])=>n(e,t))}function zh(n){const e=Qo.indexOf(n);e>-1&&Qo.splice(e,1)}function jd(n,e,t,r){const i=n(e,t,r);i&&i!==e&&(e.default=i)}let ec;function qR(){const{port1:n,port2:e}=new WR;let t=0,r;ec=o=>{t++,n.postMessage(o)},n.on("message",()=>{t--,r&&t<=0&&r()}).unref();function i(){const o=setInterval(()=>{},1e3),c=new Promise(u=>{r=u}).then(()=>{clearInterval(o)});return t===0&&r(),c}const s=e;return{registerOptions:{data:{addHookMessagePort:s,include:[]},transferList:[s]},addHookMessagePort:s,waitForAllMessagesAcknowledged:i}}function Hr(n,e,t){if(!(this instanceof Hr))return new Hr(n,e,t);typeof n=="function"?(t=n,n=null,e=null):typeof e=="function"&&(t=e,e=null);const r=e?e.internals===!0:!1;ec&&Array.isArray(n)&&ec(n),this._iitmHook=(i,s)=>{const a=i,o=i.startsWith("node:");let c;if(o)i=i.replace(/^node:/,"");else{if(i.startsWith("file://"))try{i=Fd(i)}catch{}const u=HR(i);u&&(i=u.name,c=u.basedir)}if(n){for(const u of n)if(u===i){if(c){if(r)i=i+Dd.sep+Dd.relative(c,Fd(a));else if(!c.endsWith(VR.get(a)))continue}jd(t,s,i,c)}}else jd(t,s,i,c)},Vh(this._iitmHook)}Hr.prototype.unhook=function(){zh(this._iitmHook)};ci.exports=Hr;var ZR=ci.exports.Hook=Hr;ci.exports.addHook=Vh;ci.exports.removeHook=zh;ci.exports.createAddHookMessageChannel=qR;var XR=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function o(l){try{u(r.next(l))}catch(d){a(d)}}function c(l){try{u(r.throw(l))}catch(d){a(d)}}function u(l){l.done?s(l.value):i(l.value).then(o,c)}u((r=r.apply(n,e||[])).next())})},YR=globalThis&&globalThis.__generator||function(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(u){return function(l){return c([u,l])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(n,t)}catch(l){u=[6,l],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};function KR(n,e,t){var r,i;try{i=n()}catch(s){r=s}finally{if(e(r,i),r&&!t)throw r;return i}}function JR(n,e,t){return XR(this,void 0,void 0,function(){var r,i,s;return YR(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,3,4]),[4,n()];case 1:return i=a.sent(),[3,4];case 2:return s=a.sent(),r=s,[3,4];case 3:if(e(r,i),r&&!t)throw r;return[2,i];case 4:return[2]}})})}function qh(n){return typeof n=="function"&&typeof n.__original=="function"&&typeof n.__unwrap=="function"&&n.__wrapped===!0}var QR=globalThis&&globalThis.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Sr=globalThis&&globalThis.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},eI=function(n){QR(e,n);function e(t,r,i){var s=n.call(this,t,r,i)||this;s._hooks=[],s._requireInTheMiddleSingleton=jR.getInstance(),s._enabled=!1,s._wrap=function(o,c,u){if(qh(o[c])&&s._unwrap(o,c),No.types.isProxy(o)){var l=hn.wrap(Object.assign({},o),c,u);return Object.defineProperty(o,c,{value:l}),l}else return hn.wrap(o,c,u)},s._unwrap=function(o,c){return No.types.isProxy(o)?Object.defineProperty(o,c,{value:o[c]}):hn.unwrap(o,c)},s._massWrap=function(o,c,u){if(o)Array.isArray(o)||(o=[o]);else{G.error("must provide one or more modules to patch");return}if(!(c&&Array.isArray(c))){G.error("must provide one or more functions to wrap on modules");return}o.forEach(function(l){c.forEach(function(d){s._wrap(l,d,u)})})},s._massUnwrap=function(o,c){if(o)Array.isArray(o)||(o=[o]);else{G.error("must provide one or more modules to patch");return}if(!(c&&Array.isArray(c))){G.error("must provide one or more functions to wrap on modules");return}o.forEach(function(u){c.forEach(function(l){s._unwrap(u,l)})})};var a=s.init();return a&&!Array.isArray(a)&&(a=[a]),s._modules=a||[],s._config.enabled&&s.enable(),s}return e.prototype._warnOnPreloadedModules=function(){var t=this;this._modules.forEach(function(r){var i=r.name;try{var s=require.resolve(i);require.cache[s]&&t._diag.warn("Module "+i+" has been loaded before "+t.instrumentationName+" so it might not work, please initialize it before requiring "+i)}catch{}})},e.prototype._extractPackageVersion=function(t){try{var r=oe.readFileSync(B.join(t,"package.json"),{encoding:"utf8"}),i=JSON.parse(r).version;return typeof i=="string"?i:void 0}catch{G.warn("Failed extracting version",t)}},e.prototype._onRequire=function(t,r,i,s){var a=this,o;if(!s)return typeof t.patch=="function"&&(t.moduleExports=r,this._enabled)?(this._diag.debug("Applying instrumentation patch for nodejs core module on require hook",{module:t.name}),t.patch(r)):r;var c=this._extractPackageVersion(s);if(t.moduleVersion=c,t.name===i)return Ud(t.supportedVersions,c,t.includePrerelease)&&typeof t.patch=="function"&&(t.moduleExports=r,this._enabled)?(this._diag.debug("Applying instrumentation patch for module on require hook",{module:t.name,version:t.moduleVersion,baseDir:s}),t.patch(r,t.moduleVersion)):r;var u=(o=t.files)!==null&&o!==void 0?o:[],l=B.normalize(i),d=u.filter(function(f){return f.name===l}).filter(function(f){return Ud(f.supportedVersions,c,t.includePrerelease)});return d.reduce(function(f,p){return p.moduleExports=f,a._enabled?(a._diag.debug("Applying instrumentation patch for nodejs module file on require hook",{module:t.name,version:t.moduleVersion,fileName:p.name,baseDir:s}),p.patch(f,t.moduleVersion)):f},r)},e.prototype.enable=function(){var t,r,i,s,a,o,c=this;if(!this._enabled){if(this._enabled=!0,this._hooks.length>0){try{for(var u=Sr(this._modules),l=u.next();!l.done;l=u.next()){var d=l.value;typeof d.patch=="function"&&d.moduleExports&&(this._diag.debug("Applying instrumentation patch for nodejs module on instrumentation enabled",{module:d.name,version:d.moduleVersion}),d.patch(d.moduleExports,d.moduleVersion));try{for(var f=(i=void 0,Sr(d.files)),p=f.next();!p.done;p=f.next()){var h=p.value;h.moduleExports&&(this._diag.debug("Applying instrumentation patch for nodejs module file on instrumentation enabled",{module:d.name,version:d.moduleVersion,fileName:h.name}),h.patch(h.moduleExports,d.moduleVersion))}}catch(S){i={error:S}}finally{try{p&&!p.done&&(s=f.return)&&s.call(f)}finally{if(i)throw i.error}}}}catch(S){t={error:S}}finally{try{l&&!l.done&&(r=u.return)&&r.call(u)}finally{if(t)throw t.error}}return}this._warnOnPreloadedModules();var m=function(S){var v=function(be,ce,le){if(!le&&B.isAbsolute(ce)){var qe=B.parse(ce);ce=qe.name,le=qe.dir}return c._onRequire(S,be,ce,le)},D=function(be,ce,le){return c._onRequire(S,be,ce,le)},H=B.isAbsolute(S.name)?new Uh([S.name],{internals:!0},D):g._requireInTheMiddleSingleton.register(S.name,D);g._hooks.push(H);var Te=new ZR([S.name],{internals:!1},v);g._hooks.push(Te)},g=this;try{for(var y=Sr(this._modules),E=y.next();!E.done;E=y.next()){var b=E.value;m(b)}}catch(S){a={error:S}}finally{try{E&&!E.done&&(o=y.return)&&o.call(y)}finally{if(a)throw a.error}}}},e.prototype.disable=function(){var t,r,i,s;if(this._enabled){this._enabled=!1;try{for(var a=Sr(this._modules),o=a.next();!o.done;o=a.next()){var c=o.value;typeof c.unpatch=="function"&&c.moduleExports&&(this._diag.debug("Removing instrumentation patch for nodejs module on instrumentation disabled",{module:c.name,version:c.moduleVersion}),c.unpatch(c.moduleExports,c.moduleVersion));try{for(var u=(i=void 0,Sr(c.files)),l=u.next();!l.done;l=u.next()){var d=l.value;d.moduleExports&&(this._diag.debug("Removing instrumentation patch for nodejs module file on instrumentation disabled",{module:c.name,version:c.moduleVersion,fileName:d.name}),d.unpatch(d.moduleExports,c.moduleVersion))}}catch(f){i={error:f}}finally{try{l&&!l.done&&(s=u.return)&&s.call(u)}finally{if(i)throw i.error}}}}catch(f){t={error:f}}finally{try{o&&!o.done&&(r=a.return)&&r.call(a)}finally{if(t)throw t.error}}}},e.prototype.isEnabled=function(){return this._enabled},e}(x0);function Ud(n,e,t){return typeof e>"u"?n.includes("*"):n.some(function(r){return Zo.satisfies(e,r,{includePrerelease:t})})}var tI=function(){function n(e,t,r,i,s){this.name=e,this.supportedVersions=t,this.patch=r,this.unpatch=i,this.files=s||[]}return n}(),nI=function(){function n(e,t,r,i){this.supportedVersions=t,this.patch=r,this.unpatch=i,this.name=X.normalize(e)}return n}();const rI=Object.freeze(Object.defineProperty({__proto__:null,InstrumentationBase:eI,InstrumentationNodeModuleDefinition:tI,InstrumentationNodeModuleFile:nI,isWrapped:qh,registerInstrumentations:vu,safeExecuteInTheMiddle:KR,safeExecuteInTheMiddleAsync:JR},Symbol.toStringTag,{value:"Module"})),iI=lu(rI);var sI="db.system",aI="db.statement",oI="faas.trigger",cI="http.method",uI="http.url",lI="http.target",dI="http.status_code",fI="messaging.system",pI="rpc.service",hI="rpc.grpc.status_code",mI=sI,gI=aI,_I=oI,Eu=cI,Ks=uI,yI=lI,Zh=dI,bI=fI,vI=pI,EI=hI,wI="service.namespace",SI=wI,wu="http.request.method",Su="http.response.status_code",TI="http.route",AI="service.name",OI="service.version",Js="url.full",Tu=Ht("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function In(n){return n.setValue(Tu,!0)}function RI(n){return n.deleteValue(Tu)}function li(n){return n.getValue(Tu)===!0}var II="=",tc=";",fs=",",to="baggage",PI=180,CI=4096,NI=8192,LI=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return s};function Xh(n){return n.reduce(function(e,t){var r=""+e+(e!==""?fs:"")+t;return r.length>NI?e:r},"")}function Yh(n){return n.getAllEntries().map(function(e){var t=LI(e,2),r=t[0],i=t[1],s=encodeURIComponent(r)+"="+encodeURIComponent(i.value);return i.metadata!==void 0&&(s+=tc+i.metadata.toString()),s})}function Au(n){var e=n.split(tc);if(!(e.length<=0)){var t=e.shift();if(t){var r=t.indexOf(II);if(!(r<=0)){var i=decodeURIComponent(t.substring(0,r).trim()),s=decodeURIComponent(t.substring(r+1).trim()),a;return e.length>0&&(a=dh(e.join(tc))),{key:i,value:s,metadata:a}}}}}function xI(n){return typeof n!="string"||n.length===0?{}:n.split(fs).map(function(e){return Au(e)}).filter(function(e){return e!==void 0&&e.value.length>0}).reduce(function(e,t){return e[t.key]=t.value,e},{})}var Ou=function(){function n(){}return n.prototype.inject=function(e,t,r){var i=xt.getBaggage(e);if(!(!i||li(e))){var s=Yh(i).filter(function(o){return o.length<=CI}).slice(0,PI),a=Xh(s);a.length>0&&r.set(t,to,a)}},n.prototype.extract=function(e,t,r){var i=r.get(t,to),s=Array.isArray(i)?i.join(fs):i;if(!s)return e;var a={};if(s.length===0)return e;var o=s.split(fs);return o.forEach(function(c){var u=Au(c);if(u){var l={value:u.value};u.metadata&&(l.metadata=u.metadata),a[u.key]=l}}),Object.entries(a).length===0?e:xt.setBaggage(e,xt.createBaggage(a))},n.prototype.fields=function(){return[to]},n}(),$I=function(){function n(e,t){this._monotonicClock=t,this._epochMillis=e.now(),this._performanceMillis=t.now()}return n.prototype.now=function(){var e=this._monotonicClock.now()-this._performanceMillis;return this._epochMillis+e},n}(),Kh=globalThis&&globalThis.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},MI=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return s};function Nr(n){var e,t,r={};if(typeof n!="object"||n==null)return r;try{for(var i=Kh(Object.entries(n)),s=i.next();!s.done;s=i.next()){var a=MI(s.value,2),o=a[0],c=a[1];if(!Jh(o)){G.warn("Invalid attribute key: "+o);continue}if(!Ru(c)){G.warn("Invalid attribute value set for key: "+o);continue}Array.isArray(c)?r[o]=c.slice():r[o]=c}}catch(u){e={error:u}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return r}function Jh(n){return typeof n=="string"&&n.length>0}function Ru(n){return n==null?!0:Array.isArray(n)?kI(n):Qh(n)}function kI(n){var e,t,r;try{for(var i=Kh(n),s=i.next();!s.done;s=i.next()){var a=s.value;if(a!=null){if(!r){if(Qh(a)){r=typeof a;continue}return!1}if(typeof a!==r)return!1}}}catch(o){e={error:o}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return!0}function Qh(n){switch(typeof n){case"number":case"boolean":case"string":return!0}return!1}function em(){return function(n){G.error(DI(n))}}function DI(n){return typeof n=="string"?n:JSON.stringify(FI(n))}function FI(n){for(var e={},t=n;t!==null;)Object.getOwnPropertyNames(t).forEach(function(r){if(!e[r]){var i=t[r];i&&(e[r]=String(i))}}),t=Object.getPrototypeOf(t);return e}var tm=em();function jI(n){tm=n}function nr(n){try{tm(n)}catch{}}var it;(function(n){n.AlwaysOff="always_off",n.AlwaysOn="always_on",n.ParentBasedAlwaysOff="parentbased_always_off",n.ParentBasedAlwaysOn="parentbased_always_on",n.ParentBasedTraceIdRatio="parentbased_traceidratio",n.TraceIdRatio="traceidratio"})(it||(it={}));var UI=",",BI=["OTEL_SDK_DISABLED"];function GI(n){return BI.indexOf(n)>-1}var HI=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_BLRP_EXPORT_TIMEOUT","OTEL_BLRP_MAX_EXPORT_BATCH_SIZE","OTEL_BLRP_MAX_QUEUE_SIZE","OTEL_BLRP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_OTLP_LOGS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function WI(n){return HI.indexOf(n)>-1}var VI=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS","OTEL_SEMCONV_STABILITY_OPT_IN"];function zI(n){return VI.indexOf(n)>-1}var Lr=1/0,xr=128,nm=128,rm=128,Iu={OTEL_SDK_DISABLED:!1,CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_BLRP_EXPORT_TIMEOUT:3e4,OTEL_BLRP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BLRP_MAX_QUEUE_SIZE:2048,OTEL_BLRP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_LOGS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_LOGS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_LOGS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:de.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:Lr,OTEL_ATTRIBUTE_COUNT_LIMIT:xr,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:Lr,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:xr,OTEL_LOGRECORD_ATTRIBUTE_VALUE_LENGTH_LIMIT:Lr,OTEL_LOGRECORD_ATTRIBUTE_COUNT_LIMIT:xr,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:nm,OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:rm,OTEL_TRACES_EXPORTER:"",OTEL_TRACES_SAMPLER:it.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_LOGS_EXPORTER:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_LOGS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_LOGS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_LOGS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_TRACES_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_LOGS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"cumulative",OTEL_SEMCONV_STABILITY_OPT_IN:[]};function qI(n,e,t){if(!(typeof t[n]>"u")){var r=String(t[n]);e[n]=r.toLowerCase()==="true"}}function ZI(n,e,t,r,i){if(r===void 0&&(r=-1/0),i===void 0&&(i=1/0),typeof t[n]<"u"){var s=Number(t[n]);isNaN(s)||(s<r?e[n]=r:s>i?e[n]=i:e[n]=s)}}function XI(n,e,t,r){r===void 0&&(r=UI);var i=t[n];typeof i=="string"&&(e[n]=i.split(r).map(function(s){return s.trim()}))}var YI={ALL:de.ALL,VERBOSE:de.VERBOSE,DEBUG:de.DEBUG,INFO:de.INFO,WARN:de.WARN,ERROR:de.ERROR,NONE:de.NONE};function KI(n,e,t){var r=t[n];if(typeof r=="string"){var i=YI[r.toUpperCase()];i!=null&&(e[n]=i)}}function Pu(n){var e={};for(var t in Iu){var r=t;switch(r){case"OTEL_LOG_LEVEL":KI(r,e,n);break;default:if(GI(r))qI(r,e,n);else if(WI(r))ZI(r,e,n);else if(zI(r))XI(r,e,n);else{var i=n[r];typeof i<"u"&&i!==null&&(e[r]=String(i))}}}return e}function rr(){var n=Pu(process.env);return Object.assign({},Iu,n)}function im(){return Pu(process.env)}var JI=typeof globalThis=="object"?globalThis:global;function Bd(n){return n>=48&&n<=57?n-48:n>=97&&n<=102?n-87:n-55}function sm(n){for(var e=new Uint8Array(n.length/2),t=0,r=0;r<n.length;r+=2){var i=Bd(n.charCodeAt(r)),s=Bd(n.charCodeAt(r+1));e[t++]=i<<4|s}return e}function QI(n){return Buffer.from(sm(n)).toString("base64")}var eP=8,am=16,tP=function(){function n(){this.generateTraceId=Gd(am),this.generateSpanId=Gd(eP)}return n}(),Mi=Buffer.allocUnsafe(am);function Gd(n){return function(){for(var t=0;t<n/4;t++)Mi.writeUInt32BE(Math.random()*Math.pow(2,32)>>>0,t*4);for(var t=0;t<n&&!(Mi[t]>0);t++)t===n-1&&(Mi[n-1]=1);return Mi.toString("hex",0,n)}}var bn=m_.performance,om="1.30.1",nP="process.runtime.name",rP="telemetry.sdk.name",iP="telemetry.sdk.language",sP="telemetry.sdk.version",aP=nP,oP=rP,cP=iP,uP=sP,lP="nodejs",dP=lP,xn,Zi=(xn={},xn[oP]="opentelemetry",xn[aP]="node",xn[cP]=dP,xn[uP]=om,xn);function cm(n){n.unref()}var um=9,fP=6,pP=Math.pow(10,fP),ps=Math.pow(10,um);function Nt(n){var e=n/1e3,t=Math.trunc(e),r=Math.round(n%1e3*pP);return[t,r]}function Qs(){var n=bn.timeOrigin;if(typeof n!="number"){var e=bn;n=e.timing&&e.timing.fetchStart}return n}function Cu(n){var e=Nt(Qs()),t=Nt(typeof n=="number"?n:bn.now());return Nu(e,t)}function hP(n){if(ea(n))return n;if(typeof n=="number")return n<Qs()?Cu(n):Nt(n);if(n instanceof Date)return Nt(n.getTime());throw TypeError("Invalid input type")}function lm(n,e){var t=e[0]-n[0],r=e[1]-n[1];return r<0&&(t-=1,r+=ps),[t,r]}function mP(n){var e=um,t=""+"0".repeat(e)+n[1]+"Z",r=t.substring(t.length-e-1),i=new Date(n[0]*1e3).toISOString();return i.replace("000Z",r)}function gP(n){return n[0]*ps+n[1]}function _P(n){return n[0]*1e3+n[1]/1e6}function yP(n){return n[0]*1e6+n[1]/1e3}function ea(n){return Array.isArray(n)&&n.length===2&&typeof n[0]=="number"&&typeof n[1]=="number"}function nc(n){return ea(n)||typeof n=="number"||n instanceof Date}function Nu(n,e){var t=[n[0]+e[0],n[1]+e[1]];return t[1]>=ps&&(t[1]-=ps,t[0]+=1),t}var hs;(function(n){n[n.SUCCESS=0]="SUCCESS",n[n.FAILED=1]="FAILED"})(hs||(hs={}));var bP=globalThis&&globalThis.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},dm=function(){function n(e){e===void 0&&(e={});var t;this._propagators=(t=e.propagators)!==null&&t!==void 0?t:[],this._fields=Array.from(new Set(this._propagators.map(function(r){return typeof r.fields=="function"?r.fields():[]}).reduce(function(r,i){return r.concat(i)},[])))}return n.prototype.inject=function(e,t,r){var i,s;try{for(var a=bP(this._propagators),o=a.next();!o.done;o=a.next()){var c=o.value;try{c.inject(e,t,r)}catch(u){G.warn("Failed to inject with "+c.constructor.name+". Err: "+u.message)}}}catch(u){i={error:u}}finally{try{o&&!o.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}},n.prototype.extract=function(e,t,r){return this._propagators.reduce(function(i,s){try{return s.extract(i,t,r)}catch(a){G.warn("Failed to extract with "+s.constructor.name+". Err: "+a.message)}return i},e)},n.prototype.fields=function(){return this._fields.slice()},n}(),rc="[_0-9a-z-*/]",vP="[a-z]"+rc+"{0,255}",EP="[a-z0-9]"+rc+"{0,240}@[a-z]"+rc+"{0,13}",wP=new RegExp("^(?:"+vP+"|"+EP+")$"),SP=/^[ -~]{0,255}[!-~]$/,TP=/,|=/;function AP(n){return wP.test(n)}function OP(n){return SP.test(n)&&!TP.test(n)}var Hd=32,RP=512,Wd=",",Vd="=",ta=function(){function n(e){this._internalState=new Map,e&&this._parse(e)}return n.prototype.set=function(e,t){var r=this._clone();return r._internalState.has(e)&&r._internalState.delete(e),r._internalState.set(e,t),r},n.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},n.prototype.get=function(e){return this._internalState.get(e)},n.prototype.serialize=function(){var e=this;return this._keys().reduce(function(t,r){return t.push(r+Vd+e.get(r)),t},[]).join(Wd)},n.prototype._parse=function(e){e.length>RP||(this._internalState=e.split(Wd).reverse().reduce(function(t,r){var i=r.trim(),s=i.indexOf(Vd);if(s!==-1){var a=i.slice(0,s),o=i.slice(s+1,r.length);AP(a)&&OP(o)&&t.set(a,o)}return t},new Map),this._internalState.size>Hd&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,Hd))))},n.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},n.prototype._clone=function(){var e=new n;return e._internalState=new Map(this._internalState),e},n}(),Xi="traceparent",Yi="tracestate",IP="00",PP="(?!ff)[\\da-f]{2}",CP="(?![0]{32})[\\da-f]{32}",NP="(?![0]{16})[\\da-f]{16}",LP="[\\da-f]{2}",xP=new RegExp("^\\s?("+PP+")-("+CP+")-("+NP+")-("+LP+")(-.*)?\\s?$");function fm(n){var e=xP.exec(n);return!e||e[1]==="00"&&e[5]?null:{traceId:e[2],spanId:e[3],traceFlags:parseInt(e[4],16)}}var pm=function(){function n(){}return n.prototype.inject=function(e,t,r){var i=K.getSpanContext(e);if(!(!i||li(e)||!sn(i))){var s=IP+"-"+i.traceId+"-"+i.spanId+"-0"+Number(i.traceFlags||Ae.NONE).toString(16);r.set(t,Xi,s),i.traceState&&r.set(t,Yi,i.traceState.serialize())}},n.prototype.extract=function(e,t,r){var i=r.get(t,Xi);if(!i)return e;var s=Array.isArray(i)?i[0]:i;if(typeof s!="string")return e;var a=fm(s);if(!a)return e;a.isRemote=!0;var o=r.get(t,Yi);if(o){var c=Array.isArray(o)?o.join(","):o;a.traceState=new ta(typeof c=="string"?c:void 0)}return K.setSpanContext(e,a)},n.prototype.fields=function(){return[Xi,Yi]},n}(),Lu=Ht("OpenTelemetry SDK Context Key RPC_METADATA"),ic;(function(n){n.HTTP="http"})(ic||(ic={}));function $P(n,e){return n.setValue(Lu,e)}function MP(n){return n.deleteValue(Lu)}function kP(n){return n.getValue(Lu)}var sc=function(){function n(){}return n.prototype.shouldSample=function(){return{decision:Bt.NOT_RECORD}},n.prototype.toString=function(){return"AlwaysOffSampler"},n}(),Ki=function(){function n(){}return n.prototype.shouldSample=function(){return{decision:Bt.RECORD_AND_SAMPLED}},n.prototype.toString=function(){return"AlwaysOnSampler"},n}(),DP=function(){function n(e){var t,r,i,s;this._root=e.root,this._root||(nr(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new Ki),this._remoteParentSampled=(t=e.remoteParentSampled)!==null&&t!==void 0?t:new Ki,this._remoteParentNotSampled=(r=e.remoteParentNotSampled)!==null&&r!==void 0?r:new sc,this._localParentSampled=(i=e.localParentSampled)!==null&&i!==void 0?i:new Ki,this._localParentNotSampled=(s=e.localParentNotSampled)!==null&&s!==void 0?s:new sc}return n.prototype.shouldSample=function(e,t,r,i,s,a){var o=K.getSpanContext(e);return!o||!sn(o)?this._root.shouldSample(e,t,r,i,s,a):o.isRemote?o.traceFlags&Ae.SAMPLED?this._remoteParentSampled.shouldSample(e,t,r,i,s,a):this._remoteParentNotSampled.shouldSample(e,t,r,i,s,a):o.traceFlags&Ae.SAMPLED?this._localParentSampled.shouldSample(e,t,r,i,s,a):this._localParentNotSampled.shouldSample(e,t,r,i,s,a)},n.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"},n}(),FP=function(){function n(e){e===void 0&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(this._ratio*4294967295)}return n.prototype.shouldSample=function(e,t){return{decision:Gs(t)&&this._accumulate(t)<this._upperBound?Bt.RECORD_AND_SAMPLED:Bt.NOT_RECORD}},n.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},n.prototype._normalize=function(e){return typeof e!="number"||isNaN(e)?0:e>=1?1:e<=0?0:e},n.prototype._accumulate=function(e){for(var t=0,r=0;r<e.length/8;r++){var i=r*8,s=parseInt(e.slice(i,i+8),16);t=(t^s)>>>0}return t},n}(),jP="[object Object]",UP="[object Null]",BP="[object Undefined]",GP=Function.prototype,hm=GP.toString,HP=hm.call(Object),WP=VP(Object.getPrototypeOf,Object),mm=Object.prototype,gm=mm.hasOwnProperty,ln=Symbol?Symbol.toStringTag:void 0,_m=mm.toString;function VP(n,e){return function(t){return n(e(t))}}function zd(n){if(!zP(n)||qP(n)!==jP)return!1;var e=WP(n);if(e===null)return!0;var t=gm.call(e,"constructor")&&e.constructor;return typeof t=="function"&&t instanceof t&&hm.call(t)===HP}function zP(n){return n!=null&&typeof n=="object"}function qP(n){return n==null?n===void 0?BP:UP:ln&&ln in Object(n)?ZP(n):XP(n)}function ZP(n){var e=gm.call(n,ln),t=n[ln],r=!1;try{n[ln]=void 0,r=!0}catch{}var i=_m.call(n);return r&&(e?n[ln]=t:delete n[ln]),i}function XP(n){return _m.call(n)}var YP=20;function ym(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];for(var t=n.shift(),r=new WeakMap;n.length>0;)t=bm(t,n.shift(),0,r);return t}function no(n){return ms(n)?n.slice():n}function bm(n,e,t,r){t===void 0&&(t=0);var i;if(!(t>YP)){if(t++,Ji(n)||Ji(e)||vm(e))i=no(e);else if(ms(n)){if(i=n.slice(),ms(e))for(var s=0,a=e.length;s<a;s++)i.push(no(e[s]));else if(Tr(e))for(var o=Object.keys(e),s=0,a=o.length;s<a;s++){var c=o[s];i[c]=no(e[c])}}else if(Tr(n))if(Tr(e)){if(!KP(n,e))return e;i=Object.assign({},n);for(var o=Object.keys(e),s=0,a=o.length;s<a;s++){var c=o[s],u=e[c];if(Ji(u))typeof u>"u"?delete i[c]:i[c]=u;else{var l=i[c],d=u;if(qd(n,c,r)||qd(e,c,r))delete i[c];else{if(Tr(l)&&Tr(d)){var f=r.get(l)||[],p=r.get(d)||[];f.push({obj:n,key:c}),p.push({obj:e,key:c}),r.set(l,f),r.set(d,p)}i[c]=bm(i[c],u,t,r)}}}}else i=e;return i}}function qd(n,e,t){for(var r=t.get(n[e])||[],i=0,s=r.length;i<s;i++){var a=r[i];if(a.key===e&&a.obj===n)return!0}return!1}function ms(n){return Array.isArray(n)}function vm(n){return typeof n=="function"}function Tr(n){return!Ji(n)&&!ms(n)&&!vm(n)&&typeof n=="object"}function Ji(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n>"u"||n instanceof Date||n instanceof RegExp||n===null}function KP(n,e){return!(!zd(n)||!zd(e))}var JP=globalThis&&globalThis.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Em=function(n){JP(e,n);function e(t){var r=n.call(this,t)||this;return Object.setPrototypeOf(r,e.prototype),r}return e}(Error);function QP(n,e){var t,r=new Promise(function(s,a){t=setTimeout(function(){a(new Em("Operation timed out."))},e)});return Promise.race([n,r]).then(function(i){return clearTimeout(t),i},function(i){throw clearTimeout(t),i})}var eC=globalThis&&globalThis.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};function wm(n,e){return typeof e=="string"?n===e:!!n.match(e)}function tC(n,e){var t,r;if(!e)return!1;try{for(var i=eC(e),s=i.next();!s.done;s=i.next()){var a=s.value;if(wm(n,a))return!0}}catch(o){t={error:o}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return!1}function nC(n){return typeof n=="function"&&typeof n.__original=="function"&&typeof n.__unwrap=="function"&&n.__wrapped===!0}var rC=function(){function n(){var e=this;this._promise=new Promise(function(t,r){e._resolve=t,e._reject=r})}return Object.defineProperty(n.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),n.prototype.resolve=function(e){this._resolve(e)},n.prototype.reject=function(e){this._reject(e)},n}(),iC=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return s},sC=globalThis&&globalThis.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},Sm=function(){function n(e,t){this._callback=e,this._that=t,this._isCalled=!1,this._deferred=new rC}return Object.defineProperty(n.prototype,"isCalled",{get:function(){return this._isCalled},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!1,configurable:!0}),n.prototype.call=function(){for(var e,t=this,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];if(!this._isCalled){this._isCalled=!0;try{Promise.resolve((e=this._callback).call.apply(e,sC([this._that],iC(r),!1))).then(function(s){return t._deferred.resolve(s)},function(s){return t._deferred.reject(s)})}catch(s){this._deferred.reject(s)}}return this._deferred.promise},n}();function aC(n,e){return new Promise(function(t){te.with(In(te.active()),function(){n.export(e,function(r){t(r)})})})}var oC={getKeyPairs:Yh,serializeKeyPairs:Xh,parseKeyPairsIntoRecord:xI,parsePairKeyValue:Au},cC={_export:aC};const uC=Object.freeze(Object.defineProperty({__proto__:null,AlwaysOffSampler:sc,AlwaysOnSampler:Ki,AnchoredClock:$I,BindOnceFuture:Sm,CompositePropagator:dm,DEFAULT_ATTRIBUTE_COUNT_LIMIT:xr,DEFAULT_ATTRIBUTE_VALUE_LENGTH_LIMIT:Lr,DEFAULT_ENVIRONMENT:Iu,DEFAULT_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT:nm,DEFAULT_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT:rm,get ExportResultCode(){return hs},ParentBasedSampler:DP,get RPCType(){return ic},RandomIdGenerator:tP,SDK_INFO:Zi,TRACE_PARENT_HEADER:Xi,TRACE_STATE_HEADER:Yi,TimeoutError:Em,TraceIdRatioBasedSampler:FP,TraceState:ta,get TracesSamplerValues(){return it},VERSION:om,W3CBaggagePropagator:Ou,W3CTraceContextPropagator:pm,_globalThis:JI,addHrTimes:Nu,baggageUtils:oC,callWithTimeout:QP,deleteRPCMetadata:MP,getEnv:rr,getEnvWithoutDefaults:im,getRPCMetadata:kP,getTimeOrigin:Qs,globalErrorHandler:nr,hexToBase64:QI,hexToBinary:sm,hrTime:Cu,hrTimeDuration:lm,hrTimeToMicroseconds:yP,hrTimeToMilliseconds:_P,hrTimeToNanoseconds:gP,hrTimeToTimeStamp:mP,internal:cC,isAttributeKey:Jh,isAttributeValue:Ru,isTimeInput:nc,isTimeInputHrTime:ea,isTracingSuppressed:li,isUrlIgnored:tC,isWrapped:nC,loggingErrorHandler:em,merge:ym,millisToHrTime:Nt,otperformance:bn,parseEnvironment:Pu,parseTraceParent:fm,sanitizeAttributes:Nr,setGlobalErrorHandler:jI,setRPCMetadata:$P,suppressTracing:In,timeInputToHrTime:hP,unrefTimer:cm,unsuppressTracing:RI,urlMatches:wm},Symbol.toStringTag,{value:"Module"}));var lC="exception.type",dC="exception.message",fC="exception.stacktrace",ro=lC,io=dC,pC=fC,hC="exception",ac=globalThis&&globalThis.__assign||function(){return ac=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},ac.apply(this,arguments)},mC=globalThis&&globalThis.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Zd=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return s},gC=globalThis&&globalThis.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},_C=function(){function n(e,t,r,i,s,a,o,c,u,l){o===void 0&&(o=[]),this.attributes={},this.links=[],this.events=[],this._droppedAttributesCount=0,this._droppedEventsCount=0,this._droppedLinksCount=0,this.status={code:Lt.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this.name=r,this._spanContext=i,this.parentSpanId=a,this.kind=s,this.links=o;var d=Date.now();this._performanceStartTime=bn.now(),this._performanceOffset=d-(this._performanceStartTime+Qs()),this._startTimeProvided=c!=null,this.startTime=this._getTime(c??d),this.resource=e.resource,this.instrumentationLibrary=e.instrumentationLibrary,this._spanLimits=e.getSpanLimits(),this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0,l!=null&&this.setAttributes(l),this._spanProcessor=e.getActiveSpanProcessor(),this._spanProcessor.onStart(this,t)}return n.prototype.spanContext=function(){return this._spanContext},n.prototype.setAttribute=function(e,t){return t==null||this._isSpanEnded()?this:e.length===0?(G.warn("Invalid attribute key: "+e),this):Ru(t)?Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,e)?(this._droppedAttributesCount++,this):(this.attributes[e]=this._truncateToSize(t),this):(G.warn("Invalid attribute value set for key: "+e),this)},n.prototype.setAttributes=function(e){var t,r;try{for(var i=mC(Object.entries(e)),s=i.next();!s.done;s=i.next()){var a=Zd(s.value,2),o=a[0],c=a[1];this.setAttribute(o,c)}}catch(u){t={error:u}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}return this},n.prototype.addEvent=function(e,t,r){if(this._isSpanEnded())return this;if(this._spanLimits.eventCountLimit===0)return G.warn("No events allowed."),this._droppedEventsCount++,this;this.events.length>=this._spanLimits.eventCountLimit&&(this._droppedEventsCount===0&&G.debug("Dropping extra events."),this.events.shift(),this._droppedEventsCount++),nc(t)&&(nc(r)||(r=t),t=void 0);var i=Nr(t);return this.events.push({name:e,attributes:i,time:this._getTime(r),droppedAttributesCount:0}),this},n.prototype.addLink=function(e){return this.links.push(e),this},n.prototype.addLinks=function(e){var t;return(t=this.links).push.apply(t,gC([],Zd(e),!1)),this},n.prototype.setStatus=function(e){return this._isSpanEnded()?this:(this.status=ac({},e),this.status.message!=null&&typeof e.message!="string"&&(G.warn("Dropping invalid status.message of type '"+typeof e.message+"', expected 'string'"),delete this.status.message),this)},n.prototype.updateName=function(e){return this._isSpanEnded()?this:(this.name=e,this)},n.prototype.end=function(e){if(this._isSpanEnded()){G.error(this.name+" "+this._spanContext.traceId+"-"+this._spanContext.spanId+" - You can only call end() on a span once.");return}this._ended=!0,this.endTime=this._getTime(e),this._duration=lm(this.startTime,this.endTime),this._duration[0]<0&&(G.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._droppedEventsCount>0&&G.warn("Dropped "+this._droppedEventsCount+" events because eventCountLimit reached"),this._spanProcessor.onEnd(this)},n.prototype._getTime=function(e){if(typeof e=="number"&&e<=bn.now())return Cu(e+this._performanceOffset);if(typeof e=="number")return Nt(e);if(e instanceof Date)return Nt(e.getTime());if(ea(e))return e;if(this._startTimeProvided)return Nt(Date.now());var t=bn.now()-this._performanceStartTime;return Nu(this.startTime,Nt(t))},n.prototype.isRecording=function(){return this._ended===!1},n.prototype.recordException=function(e,t){var r={};typeof e=="string"?r[io]=e:e&&(e.code?r[ro]=e.code.toString():e.name&&(r[ro]=e.name),e.message&&(r[io]=e.message),e.stack&&(r[pC]=e.stack)),r[ro]||r[io]?this.addEvent(hC,r,t):G.warn("Failed to record an exception "+e)},Object.defineProperty(n.prototype,"duration",{get:function(){return this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"ended",{get:function(){return this._ended},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"droppedAttributesCount",{get:function(){return this._droppedAttributesCount},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"droppedEventsCount",{get:function(){return this._droppedEventsCount},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"droppedLinksCount",{get:function(){return this._droppedLinksCount},enumerable:!1,configurable:!0}),n.prototype._isSpanEnded=function(){return this._ended&&G.warn("Can not execute the operation on ended Span {traceId: "+this._spanContext.traceId+", spanId: "+this._spanContext.spanId+"}"),this._ended},n.prototype._truncateToLimitUtil=function(e,t){return e.length<=t?e:e.substring(0,t)},n.prototype._truncateToSize=function(e){var t=this,r=this._attributeValueLengthLimit;return r<=0?(G.warn("Attribute value limit must be positive, got "+r),e):typeof e=="string"?this._truncateToLimitUtil(e,r):Array.isArray(e)?e.map(function(i){return typeof i=="string"?t._truncateToLimitUtil(i,r):i}):e},n}(),at;(function(n){n[n.NOT_RECORD=0]="NOT_RECORD",n[n.RECORD=1]="RECORD",n[n.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"})(at||(at={}));var gs=function(){function n(){}return n.prototype.shouldSample=function(){return{decision:at.NOT_RECORD}},n.prototype.toString=function(){return"AlwaysOffSampler"},n}(),zn=function(){function n(){}return n.prototype.shouldSample=function(){return{decision:at.RECORD_AND_SAMPLED}},n.prototype.toString=function(){return"AlwaysOnSampler"},n}(),so=function(){function n(e){var t,r,i,s;this._root=e.root,this._root||(nr(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new zn),this._remoteParentSampled=(t=e.remoteParentSampled)!==null&&t!==void 0?t:new zn,this._remoteParentNotSampled=(r=e.remoteParentNotSampled)!==null&&r!==void 0?r:new gs,this._localParentSampled=(i=e.localParentSampled)!==null&&i!==void 0?i:new zn,this._localParentNotSampled=(s=e.localParentNotSampled)!==null&&s!==void 0?s:new gs}return n.prototype.shouldSample=function(e,t,r,i,s,a){var o=K.getSpanContext(e);return!o||!sn(o)?this._root.shouldSample(e,t,r,i,s,a):o.isRemote?o.traceFlags&Ae.SAMPLED?this._remoteParentSampled.shouldSample(e,t,r,i,s,a):this._remoteParentNotSampled.shouldSample(e,t,r,i,s,a):o.traceFlags&Ae.SAMPLED?this._localParentSampled.shouldSample(e,t,r,i,s,a):this._localParentNotSampled.shouldSample(e,t,r,i,s,a)},n.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"},n}(),Xd=function(){function n(e){e===void 0&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(this._ratio*4294967295)}return n.prototype.shouldSample=function(e,t){return{decision:Gs(t)&&this._accumulate(t)<this._upperBound?at.RECORD_AND_SAMPLED:at.NOT_RECORD}},n.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},n.prototype._normalize=function(e){return typeof e!="number"||isNaN(e)?0:e>=1?1:e<=0?0:e},n.prototype._accumulate=function(e){for(var t=0,r=0;r<e.length/8;r++){var i=r*8,s=parseInt(e.slice(i,i+8),16);t=(t^s)>>>0}return t},n}(),yC=it.AlwaysOn,$n=1;function Tm(){var n=rr();return{sampler:Am(n),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:n.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:n.OTEL_ATTRIBUTE_COUNT_LIMIT},spanLimits:{attributeValueLengthLimit:n.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:n.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:n.OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:n.OTEL_SPAN_EVENT_COUNT_LIMIT,attributePerEventCountLimit:n.OTEL_SPAN_ATTRIBUTE_PER_EVENT_COUNT_LIMIT,attributePerLinkCountLimit:n.OTEL_SPAN_ATTRIBUTE_PER_LINK_COUNT_LIMIT},mergeResourceWithDefaults:!0}}function Am(n){switch(n===void 0&&(n=rr()),n.OTEL_TRACES_SAMPLER){case it.AlwaysOn:return new zn;case it.AlwaysOff:return new gs;case it.ParentBasedAlwaysOn:return new so({root:new zn});case it.ParentBasedAlwaysOff:return new so({root:new gs});case it.TraceIdRatio:return new Xd(Yd(n));case it.ParentBasedTraceIdRatio:return new so({root:new Xd(Yd(n))});default:return G.error('OTEL_TRACES_SAMPLER value "'+n.OTEL_TRACES_SAMPLER+" invalid, defaulting to "+yC+'".'),new zn}}function Yd(n){if(n.OTEL_TRACES_SAMPLER_ARG===void 0||n.OTEL_TRACES_SAMPLER_ARG==="")return G.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to "+$n+"."),$n;var e=Number(n.OTEL_TRACES_SAMPLER_ARG);return isNaN(e)?(G.error("OTEL_TRACES_SAMPLER_ARG="+n.OTEL_TRACES_SAMPLER_ARG+" was given, but it is invalid, defaulting to "+$n+"."),$n):e<0||e>1?(G.error("OTEL_TRACES_SAMPLER_ARG="+n.OTEL_TRACES_SAMPLER_ARG+" was given, but it is out of range ([0..1]), defaulting to "+$n+"."),$n):e}function bC(n){var e={sampler:Am()},t=Tm(),r=Object.assign({},t,e,n);return r.generalLimits=Object.assign({},t.generalLimits,n.generalLimits||{}),r.spanLimits=Object.assign({},t.spanLimits,n.spanLimits||{}),r}function vC(n){var e,t,r,i,s,a,o,c,u,l,d,f,p=Object.assign({},n.spanLimits),h=im();return p.attributeCountLimit=(a=(s=(i=(t=(e=n.spanLimits)===null||e===void 0?void 0:e.attributeCountLimit)!==null&&t!==void 0?t:(r=n.generalLimits)===null||r===void 0?void 0:r.attributeCountLimit)!==null&&i!==void 0?i:h.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT)!==null&&s!==void 0?s:h.OTEL_ATTRIBUTE_COUNT_LIMIT)!==null&&a!==void 0?a:xr,p.attributeValueLengthLimit=(f=(d=(l=(c=(o=n.spanLimits)===null||o===void 0?void 0:o.attributeValueLengthLimit)!==null&&c!==void 0?c:(u=n.generalLimits)===null||u===void 0?void 0:u.attributeValueLengthLimit)!==null&&l!==void 0?l:h.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT)!==null&&d!==void 0?d:h.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)!==null&&f!==void 0?f:Lr,Object.assign({},n,{spanLimits:p})}var EC=function(){function n(e,t){this._exporter=e,this._isExporting=!1,this._finishedSpans=[],this._droppedSpansCount=0;var r=rr();this._maxExportBatchSize=typeof(t==null?void 0:t.maxExportBatchSize)=="number"?t.maxExportBatchSize:r.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize=typeof(t==null?void 0:t.maxQueueSize)=="number"?t.maxQueueSize:r.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis=typeof(t==null?void 0:t.scheduledDelayMillis)=="number"?t.scheduledDelayMillis:r.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis=typeof(t==null?void 0:t.exportTimeoutMillis)=="number"?t.exportTimeoutMillis:r.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new Sm(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(G.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}return n.prototype.forceFlush=function(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()},n.prototype.onStart=function(e,t){},n.prototype.onEnd=function(e){this._shutdownOnce.isCalled||e.spanContext().traceFlags&Ae.SAMPLED&&this._addToBuffer(e)},n.prototype.shutdown=function(){return this._shutdownOnce.call()},n.prototype._shutdown=function(){var e=this;return Promise.resolve().then(function(){return e.onShutdown()}).then(function(){return e._flushAll()}).then(function(){return e._exporter.shutdown()})},n.prototype._addToBuffer=function(e){if(this._finishedSpans.length>=this._maxQueueSize){this._droppedSpansCount===0&&G.debug("maxQueueSize reached, dropping spans"),this._droppedSpansCount++;return}this._droppedSpansCount>0&&(G.warn("Dropped "+this._droppedSpansCount+" spans because maxQueueSize reached"),this._droppedSpansCount=0),this._finishedSpans.push(e),this._maybeStartTimer()},n.prototype._flushAll=function(){var e=this;return new Promise(function(t,r){for(var i=[],s=Math.ceil(e._finishedSpans.length/e._maxExportBatchSize),a=0,o=s;a<o;a++)i.push(e._flushOneBatch());Promise.all(i).then(function(){t()}).catch(r)})},n.prototype._flushOneBatch=function(){var e=this;return this._clearTimer(),this._finishedSpans.length===0?Promise.resolve():new Promise(function(t,r){var i=setTimeout(function(){r(new Error("Timeout"))},e._exportTimeoutMillis);te.with(In(te.active()),function(){var s;e._finishedSpans.length<=e._maxExportBatchSize?(s=e._finishedSpans,e._finishedSpans=[]):s=e._finishedSpans.splice(0,e._maxExportBatchSize);for(var a=function(){return e._exporter.export(s,function(d){var f;clearTimeout(i),d.code===hs.SUCCESS?t():r((f=d.error)!==null&&f!==void 0?f:new Error("BatchSpanProcessor: span export failed"))})},o=null,c=0,u=s.length;c<u;c++){var l=s[c];l.resource.asyncAttributesPending&&l.resource.waitForAsyncAttributes&&(o??(o=[]),o.push(l.resource.waitForAsyncAttributes()))}o===null?a():Promise.all(o).then(a,function(d){nr(d),r(d)})})})},n.prototype._maybeStartTimer=function(){var e=this;if(!this._isExporting){var t=function(){e._isExporting=!0,e._flushOneBatch().finally(function(){e._isExporting=!1,e._finishedSpans.length>0&&(e._clearTimer(),e._maybeStartTimer())}).catch(function(r){e._isExporting=!1,nr(r)})};if(this._finishedSpans.length>=this._maxExportBatchSize)return t();this._timer===void 0&&(this._timer=setTimeout(function(){return t()},this._scheduledDelayMillis),cm(this._timer))}},n.prototype._clearTimer=function(){this._timer!==void 0&&(clearTimeout(this._timer),this._timer=void 0)},n}(),wC=globalThis&&globalThis.__extends||function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(r[s]=i[s])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),SC=function(n){wC(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.onShutdown=function(){},e}(EC),TC=8,Om=16,AC=function(){function n(){this.generateTraceId=Kd(Om),this.generateSpanId=Kd(TC)}return n}(),ki=Buffer.allocUnsafe(Om);function Kd(n){return function(){for(var t=0;t<n/4;t++)ki.writeUInt32BE(Math.random()*Math.pow(2,32)>>>0,t*4);for(var t=0;t<n&&!(ki[t]>0);t++)t===n-1&&(ki[n-1]=1);return ki.toString("hex",0,n)}}var OC=function(){function n(e,t,r){this._tracerProvider=r;var i=bC(t);this._sampler=i.sampler,this._generalLimits=i.generalLimits,this._spanLimits=i.spanLimits,this._idGenerator=t.idGenerator||new AC,this.resource=r.resource,this.instrumentationLibrary=e}return n.prototype.startSpan=function(e,t,r){var i,s,a;t===void 0&&(t={}),r===void 0&&(r=te.active()),t.root&&(r=K.deleteSpan(r));var o=K.getSpan(r);if(li(r)){G.debug("Instrumentation suppressed, returning Noop Span");var c=K.wrapSpanContext(su);return c}var u=o==null?void 0:o.spanContext(),l=this._idGenerator.generateSpanId(),d,f,p;!u||!K.isSpanContextValid(u)?d=this._idGenerator.generateTraceId():(d=u.traceId,f=u.traceState,p=u.spanId);var h=(i=t.kind)!==null&&i!==void 0?i:He.INTERNAL,m=((s=t.links)!==null&&s!==void 0?s:[]).map(function(D){return{context:D.context,attributes:Nr(D.attributes)}}),g=Nr(t.attributes),y=this._sampler.shouldSample(r,d,e,h,g,m);f=(a=y.traceState)!==null&&a!==void 0?a:f;var E=y.decision===Bt.RECORD_AND_SAMPLED?Ae.SAMPLED:Ae.NONE,b={traceId:d,spanId:l,traceFlags:E,traceState:f};if(y.decision===Bt.NOT_RECORD){G.debug("Recording is off, propagating context in a non-recording span");var c=K.wrapSpanContext(b);return c}var S=Nr(Object.assign(g,y.attributes)),v=new _C(this,r,e,b,h,p,m,t.startTime,void 0,S);return v},n.prototype.startActiveSpan=function(e,t,r,i){var s,a,o;if(!(arguments.length<2)){arguments.length===2?o=t:arguments.length===3?(s=t,o=r):(s=t,a=r,o=i);var c=a??te.active(),u=this.startSpan(e,s,c),l=K.setSpan(c,u);return te.with(l,o,void 0,u)}},n.prototype.getGeneralLimits=function(){return this._generalLimits},n.prototype.getSpanLimits=function(){return this._spanLimits},n.prototype.getActiveSpanProcessor=function(){return this._tracerProvider.getActiveSpanProcessor()},n}(),RC="service.name",IC="telemetry.sdk.name",PC="telemetry.sdk.language",CC="telemetry.sdk.version",NC=RC,Jd=IC,Qd=PC,ef=CC;function LC(){return"unknown_service:"+process.argv0}var Zt=globalThis&&globalThis.__assign||function(){return Zt=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++){e=arguments[t];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i])}return n},Zt.apply(this,arguments)},xC=globalThis&&globalThis.__awaiter||function(n,e,t,r){function i(s){return s instanceof t?s:new t(function(a){a(s)})}return new(t||(t=Promise))(function(s,a){function o(l){try{u(r.next(l))}catch(d){a(d)}}function c(l){try{u(r.throw(l))}catch(d){a(d)}}function u(l){l.done?s(l.value):i(l.value).then(o,c)}u((r=r.apply(n,e||[])).next())})},$C=globalThis&&globalThis.__generator||function(n,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},r,i,s,a;return a={next:o(0),throw:o(1),return:o(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function o(u){return function(l){return c([u,l])}}function c(u){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(s=u[0]&2?i.return:u[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,u[1])).done)return s;switch(i=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,i=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(n,t)}catch(l){u=[6,l],i=0}finally{r=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},MC=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return s},oc=function(){function n(e,t){var r=this,i;this._attributes=e,this.asyncAttributesPending=t!=null,this._syncAttributes=(i=this._attributes)!==null&&i!==void 0?i:{},this._asyncAttributesPromise=t==null?void 0:t.then(function(s){return r._attributes=Object.assign({},r._attributes,s),r.asyncAttributesPending=!1,s},function(s){return G.debug("a resource's async attributes promise rejected: %s",s),r.asyncAttributesPending=!1,{}})}return n.empty=function(){return n.EMPTY},n.default=function(){var e;return new n((e={},e[NC]=LC(),e[Qd]=Zi[Qd],e[Jd]=Zi[Jd],e[ef]=Zi[ef],e))},Object.defineProperty(n.prototype,"attributes",{get:function(){var e;return this.asyncAttributesPending&&G.error("Accessing resource attributes before async attributes settled"),(e=this._attributes)!==null&&e!==void 0?e:{}},enumerable:!1,configurable:!0}),n.prototype.waitForAsyncAttributes=function(){return xC(this,void 0,void 0,function(){return $C(this,function(e){switch(e.label){case 0:return this.asyncAttributesPending?[4,this._asyncAttributesPromise]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})},n.prototype.merge=function(e){var t=this,r;if(!e)return this;var i=Zt(Zt({},this._syncAttributes),(r=e._syncAttributes)!==null&&r!==void 0?r:e.attributes);if(!this._asyncAttributesPromise&&!e._asyncAttributesPromise)return new n(i);var s=Promise.all([this._asyncAttributesPromise,e._asyncAttributesPromise]).then(function(a){var o,c=MC(a,2),u=c[0],l=c[1];return Zt(Zt(Zt(Zt({},t._syncAttributes),u),(o=e._syncAttributes)!==null&&o!==void 0?o:e.attributes),l)});return new n(i,s)},n.EMPTY=new n({}),n}(),Di=globalThis&&globalThis.__values||function(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},tf=function(){function n(e){this._spanProcessors=e}return n.prototype.forceFlush=function(){var e,t,r=[];try{for(var i=Di(this._spanProcessors),s=i.next();!s.done;s=i.next()){var a=s.value;r.push(a.forceFlush())}}catch(o){e={error:o}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return new Promise(function(o){Promise.all(r).then(function(){o()}).catch(function(c){nr(c||new Error("MultiSpanProcessor: forceFlush failed")),o()})})},n.prototype.onStart=function(e,t){var r,i;try{for(var s=Di(this._spanProcessors),a=s.next();!a.done;a=s.next()){var o=a.value;o.onStart(e,t)}}catch(c){r={error:c}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}},n.prototype.onEnd=function(e){var t,r;try{for(var i=Di(this._spanProcessors),s=i.next();!s.done;s=i.next()){var a=s.value;a.onEnd(e)}}catch(o){t={error:o}}finally{try{s&&!s.done&&(r=i.return)&&r.call(i)}finally{if(t)throw t.error}}},n.prototype.shutdown=function(){var e,t,r=[];try{for(var i=Di(this._spanProcessors),s=i.next();!s.done;s=i.next()){var a=s.value;r.push(a.shutdown())}}catch(o){e={error:o}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return new Promise(function(o,c){Promise.all(r).then(function(){o()},c)})},n}(),kC=function(){function n(){}return n.prototype.onStart=function(e,t){},n.prototype.onEnd=function(e){},n.prototype.shutdown=function(){return Promise.resolve()},n.prototype.forceFlush=function(){return Promise.resolve()},n}(),DC=globalThis&&globalThis.__read||function(n,e){var t=typeof Symbol=="function"&&n[Symbol.iterator];if(!t)return n;var r=t.call(n),i,s=[],a;try{for(;(e===void 0||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(o){a={error:o}}finally{try{i&&!i.done&&(t=r.return)&&t.call(r)}finally{if(a)throw a.error}}return s},FC=globalThis&&globalThis.__spreadArray||function(n,e,t){if(t||arguments.length===2)for(var r=0,i=e.length,s;r<i;r++)(s||!(r in e))&&(s||(s=Array.prototype.slice.call(e,0,r)),s[r]=e[r]);return n.concat(s||Array.prototype.slice.call(e))},dn;(function(n){n[n.resolved=0]="resolved",n[n.timeout=1]="timeout",n[n.error=2]="error",n[n.unresolved=3]="unresolved"})(dn||(dn={}));var jC=function(){function n(e){e===void 0&&(e={});var t,r;this._registeredSpanProcessors=[],this._tracers=new Map;var i=ym({},Tm(),vC(e));if(this.resource=(t=i.resource)!==null&&t!==void 0?t:oc.empty(),i.mergeResourceWithDefaults&&(this.resource=oc.default().merge(this.resource)),this._config=Object.assign({},i,{resource:this.resource}),!((r=e.spanProcessors)===null||r===void 0)&&r.length)this._registeredSpanProcessors=FC([],DC(e.spanProcessors),!1),this.activeSpanProcessor=new tf(this._registeredSpanProcessors);else{var s=this._buildExporterFromEnv();if(s!==void 0){var a=new SC(s);this.activeSpanProcessor=a}else this.activeSpanProcessor=new kC}}return n.prototype.getTracer=function(e,t,r){var i=e+"@"+(t||"")+":"+((r==null?void 0:r.schemaUrl)||"");return this._tracers.has(i)||this._tracers.set(i,new OC({name:e,version:t,schemaUrl:r==null?void 0:r.schemaUrl},this._config,this)),this._tracers.get(i)},n.prototype.addSpanProcessor=function(e){this._registeredSpanProcessors.length===0&&this.activeSpanProcessor.shutdown().catch(function(t){return G.error("Error while trying to shutdown current span processor",t)}),this._registeredSpanProcessors.push(e),this.activeSpanProcessor=new tf(this._registeredSpanProcessors)},n.prototype.getActiveSpanProcessor=function(){return this.activeSpanProcessor},n.prototype.register=function(e){e===void 0&&(e={}),K.setGlobalTracerProvider(this),e.propagator===void 0&&(e.propagator=this._buildPropagatorFromEnv()),e.contextManager&&te.setGlobalContextManager(e.contextManager),e.propagator&&xt.setGlobalPropagator(e.propagator)},n.prototype.forceFlush=function(){var e=this._config.forceFlushTimeoutMillis,t=this._registeredSpanProcessors.map(function(r){return new Promise(function(i){var s,a=setTimeout(function(){i(new Error("Span processor did not completed within timeout period of "+e+" ms")),s=dn.timeout},e);r.forceFlush().then(function(){clearTimeout(a),s!==dn.timeout&&(s=dn.resolved,i(s))}).catch(function(o){clearTimeout(a),s=dn.error,i(o)})})});return new Promise(function(r,i){Promise.all(t).then(function(s){var a=s.filter(function(o){return o!==dn.resolved});a.length>0?i(a):r()}).catch(function(s){return i([s])})})},n.prototype.shutdown=function(){return this.activeSpanProcessor.shutdown()},n.prototype._getPropagator=function(e){var t;return(t=this.constructor._registeredPropagators.get(e))===null||t===void 0?void 0:t()},n.prototype._getSpanExporter=function(e){var t;return(t=this.constructor._registeredExporters.get(e))===null||t===void 0?void 0:t()},n.prototype._buildPropagatorFromEnv=function(){var e=this,t=Array.from(new Set(rr().OTEL_PROPAGATORS)),r=t.map(function(s){var a=e._getPropagator(s);return a||G.warn('Propagator "'+s+'" requested through environment variable is unavailable.'),a}),i=r.reduce(function(s,a){return a&&s.push(a),s},[]);if(i.length!==0)return t.length===1?i[0]:new dm({propagators:i})},n.prototype._buildExporterFromEnv=function(){var e=rr().OTEL_TRACES_EXPORTER;if(!(e==="none"||e==="")){var t=this._getSpanExporter(e);return t||G.error('Exporter "'+e+'" requested through environment variable is unavailable.'),t}},n._registeredPropagators=new Map([["tracecontext",function(){return new pm}],["baggage",function(){return new Ou}]]),n._registeredExporters=new Map,n}();const xu="sentry.parentIsRemote",UC="sentry.graphql.operation";function $u(n){const e=n;return!!e.attributes&&typeof e.attributes=="object"}function BC(n){return typeof n.kind=="number"}function GC(n){return!!n.status}function HC(n){return!!n.name}function WC(n){return!!n.parentSpanId}function VC(n){if(!$u(n))return{};const e=n.attributes[Js]||n.attributes[Ks],t={url:e,"http.method":n.attributes[wu]||n.attributes[Eu]};!t["http.method"]&&t.url&&(t["http.method"]="GET");try{if(typeof e=="string"){const r=Jc(e);t.url=Qc(r),r.search&&(t["http.query"]=r.search),r.hash&&(t["http.fragment"]=r.hash)}}catch{}return t}function zC(n){return BC(n)?n.kind:He.INTERNAL}const ao="sentry-trace",cc="baggage",Mu="sentry.dsc",ku="sentry.sampled_not_recording",Rm="sentry.url",Im=Ht("sentry_scopes"),uc=Ht("sentry_fork_isolation_scope"),lc=Ht("sentry_fork_set_scope"),dc=Ht("sentry_fork_set_isolation_scope"),Pm="_scopeContext";function di(n){return n.getValue(Im)}function Cm(n,e){return n.setValue(Im,e)}function qC(n,e){kt(n,Pm,e)}function Du(n){return n[Pm]}function nf(n){let e,t=n[0],r=1;for(;r<n.length;){const i=n[r],s=n[r+1];if(r+=2,(i==="optionalAccess"||i==="optionalCall")&&t==null)return;i==="access"||i==="optionalAccess"?(e=t,t=s(t)):(i==="call"||i==="optionalCall")&&(t=s((...a)=>t.call(e,...a)),e=void 0)}return t}function Wr(n){const{traceFlags:e,traceState:t}=n,r=t?t.get(ku)==="1":!1;if(e===Ae.SAMPLED)return!0;if(r)return!1;const i=t?t.get(Mu):void 0,s=i?Ls(i):void 0;if(nf([s,"optionalAccess",a=>a.sampled])==="true")return!0;if(nf([s,"optionalAccess",a=>a.sampled])==="false")return!1}function Nm(n,e,t){const r=e[wu]||e[Eu];if(r)return YC({attributes:e,name:n,kind:t},r);const i=e[mI],s=typeof e[St]=="string"&&e[St].startsWith("cache.");if(i&&!s)return XC({attributes:e,name:n});const a=e[ut]==="custom"?"custom":"route";if(e[vI])return{...$r(n,e,"route"),op:"rpc"};if(e[bI])return{...$r(n,e,a),op:"message"};const u=e[_I];return u?{...$r(n,e,a),op:u.toString()}:{op:void 0,description:n,source:"custom"}}function ZC(n){const e=$u(n)?n.attributes:{},t=HC(n)?n.name:"<unknown>",r=zC(n);return Nm(t,e,r)}function XC({attributes:n,name:e}){const t=n[Qn];if(typeof t=="string")return{op:"db",description:t,source:n[ut]||"custom"};if(n[ut]==="custom")return{op:"db",description:e,source:"custom"};const r=n[gI];return{op:"db",description:r?r.toString():e,source:"task"}}function YC({name:n,kind:e,attributes:t},r){const i=["http"];switch(e){case He.CLIENT:i.push("client");break;case He.SERVER:i.push("server");break}t["sentry.http.prefetch"]&&i.push("prefetch");const{urlPath:s,url:a,query:o,fragment:c,hasRoute:u}=JC(t,e);if(!s)return{...$r(n,t),op:i.join(".")};const l=t[UC],d=`${r} ${s}`,f=l?`${d} (${KC(l)})`:d,p=u||s==="/"?"route":"url",h={};a&&(h.url=a),o&&(h["http.query"]=o),c&&(h["http.fragment"]=c);const m=e===He.CLIENT||e===He.SERVER,y=!`${t[Ut]||"manual"}`.startsWith("auto"),E=t[ut]==="custom",b=t[Qn],S=!E&&b==null&&(m||!y),{description:v,source:D}=S?{description:f,source:p}:$r(n,t);return{op:i.join("."),description:v,source:D,data:h}}function KC(n){if(Array.isArray(n)){const e=n.slice().sort();return e.length<=5?e.join(", "):`${e.slice(0,5).join(", ")}, +${e.length-5}`}return`${n}`}function JC(n,e){const t=n[yI],r=n[Ks]||n[Js],i=n[TI],s=typeof r=="string"?Jc(r):void 0,a=s?Qc(s):void 0,o=s&&s.search?s.search:void 0,c=s&&s.hash?s.hash:void 0;return typeof i=="string"?{urlPath:i,url:a,query:o,fragment:c,hasRoute:!0}:e===He.SERVER&&typeof t=="string"?{urlPath:Fl(t),url:a,query:o,fragment:c,hasRoute:!1}:s?{urlPath:a,url:a,query:o,fragment:c,hasRoute:!1}:typeof t=="string"?{urlPath:Fl(t),url:a,query:o,fragment:c,hasRoute:!1}:{urlPath:void 0,url:a,query:o,fragment:c,hasRoute:!1}}function $r(n,e,t="custom"){const r=e[ut]||t,i=e[Qn];return i&&typeof i=="string"?{description:i,source:r}:{description:n,source:r}}function Lm({dsc:n,sampled:e}){const t=n?xs(n):void 0,r=new ta,i=t?r.set(Mu,t):r;return e===!1?i.set(ku,"1"):i}function QC(){return K.getActiveSpan()}const Gt=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,e1=new Set;function na(n){e1.add(n)}function vn(n){let e,t=n[0],r=1;for(;r<n.length;){const i=n[r],s=n[r+1];if(r+=2,(i==="optionalAccess"||i==="optionalCall")&&t==null)return;i==="access"||i==="optionalAccess"?(e=t,t=s(t)):(i==="call"||i==="optionalCall")&&(t=s((...a)=>t.call(e,...a)),e=void 0)}return t}function t1(n){const e=n.spanContext(),{traceId:t,spanId:r,traceState:i}=e,s=i?i.get(Mu):void 0,a=s?Ls(s):void 0,o=WC(n)?n.parentSpanId:void 0,c=Wr(e),u=a||Ve(et(n));return{traceId:t,spanId:r,sampled:c,parentSpanId:o,dsc:u}}class n1 extends Ou{constructor(){super(),na("SentryPropagator"),this._urlMatchesTargetsMap=new en(100)}inject(e,t,r){if(li(e)){Gt&&w.log("[Tracing] Not injecting trace data for url because tracing is suppressed.");return}const i=K.getSpan(e),s=i&&s1(i),a=vn([Q,"call",p=>p(),"optionalAccess",p=>p.getOptions,"call",p=>p(),"optionalAccess",p=>p.tracePropagationTargets]);if(!xm(s,a,this._urlMatchesTargetsMap)){Gt&&w.log("[Tracing] Not injecting trace data for url because it does not match tracePropagationTargets:",s);return}const o=i1(t);let c=xt.getBaggage(e)||xt.createBaggage({});const{dynamicSamplingContext:u,traceId:l,spanId:d,sampled:f}=$m(e);if(o){const p=Op(o);p&&Object.entries(p).forEach(([h,m])=>{c=c.setEntry(h,{value:m})})}u&&(c=Object.entries(u).reduce((p,[h,m])=>m?p.setEntry(`${Hc}${h}`,{value:m}):p,c)),l&&l!==Bs&&r.set(t,ao,Qr(l,d,f)),super.inject(xt.setBaggage(e,c),t,r)}extract(e,t,r){const i=r.get(t,ao),s=r.get(t,cc),a=i?Array.isArray(i)?i[0]:i:void 0;return km(Mm(e,{sentryTrace:a,baggage:s}))}fields(){return[ao,cc]}}const rf="[Tracing] Not injecting trace data for url because it does not match tracePropagationTargets:";function xm(n,e,t){if(typeof n!="string"||!e)return!0;const r=vn([t,"optionalAccess",s=>s.get,"call",s=>s(n)]);if(r!==void 0)return Gt&&!r&&w.log(rf,n),r;const i=lr(n,e);return vn([t,"optionalAccess",s=>s.set,"call",s=>s(n,i)]),Gt&&!i&&w.log(rf,n),i}function $m(n){const e=K.getSpan(n);if(e&&e.spanContext().isRemote){const a=e.spanContext();return{dynamicSamplingContext:Ve(e),traceId:a.traceId,spanId:Ft(),sampled:Wr(a)}}if(e){const a=e.spanContext();return{dynamicSamplingContext:Ve(e),traceId:a.traceId,spanId:a.spanId,sampled:Wr(a)}}const t=vn([di,"call",a=>a(n),"optionalAccess",a=>a.scope])||re(),r=Q(),i=t.getPropagationContext();return{dynamicSamplingContext:r?ni(r,t):void 0,traceId:i.traceId,spanId:i.spanId,sampled:i.sampled}}function Mm(n,{sentryTrace:e,baggage:t}){const r=Ey(e,t),{traceId:i,parentSpanId:s,sampled:a,dsc:o}=r;if(!s)return n;const c=a1({traceId:i,spanId:s,sampled:a,dsc:o});return K.setSpanContext(n,c)}function r1(n,e,t){const r=km(Mm(n,e));return te.with(r,t)}function km(n){const e=di(n),t={scope:e?e.scope:re().clone(),isolationScope:e?e.isolationScope:Me()};return Cm(n,t)}function i1(n){try{const e=n[cc];return Array.isArray(e)?e.join(","):e}catch{return}}function s1(n){const e=Pe(n).data,t=vn([e,"optionalAccess",i=>i[Ks]])||vn([e,"optionalAccess",i=>i[Js]]);if(t)return t;const r=vn([n,"access",i=>i.spanContext,"call",i=>i(),"access",i=>i.traceState,"optionalAccess",i=>i.get,"call",i=>i(Rm)]);if(r)return r}function a1({spanId:n,traceId:e,sampled:t,dsc:r}){const i=Lm({dsc:r,sampled:t});return{traceId:e,spanId:n,isRemote:!0,traceFlags:t?Ae.SAMPLED:Ae.NONE,traceState:i}}function o1(n,e){const t=Fu(),{name:r,parentSpan:i}=n;return Bu(i)(()=>{const a=Uu(n.scope,n.forceTransaction),c=n.onlyIfParent&&!K.getSpan(a)?In(a):a,u=ju(n);return t.startActiveSpan(r,u,c,l=>ks(()=>e(l),()=>{Pe(l).status===void 0&&l.setStatus({code:Lt.ERROR})},()=>l.end()))})}function c1(n,e){const t=Fu(),{name:r,parentSpan:i}=n;return Bu(i)(()=>{const a=Uu(n.scope,n.forceTransaction),c=n.onlyIfParent&&!K.getSpan(a)?In(a):a,u=ju(n);return t.startActiveSpan(r,u,c,l=>ks(()=>e(l,()=>l.end()),()=>{Pe(l).status===void 0&&l.setStatus({code:Lt.ERROR})}))})}function u1(n){const e=Fu(),{name:t,parentSpan:r}=n;return Bu(r)(()=>{const s=Uu(n.scope,n.forceTransaction),o=n.onlyIfParent&&!K.getSpan(s)?In(s):s,c=ju(n);return e.startSpan(t,c,o)})}function Dm(n,e){const t=n?K.setSpan(te.active(),n):K.deleteSpan(te.active());return te.with(t,()=>e(re()))}function Fu(){const n=Q();return n&&n.tracer||K.getTracer("@sentry/opentelemetry",vt)}function ju(n){const{startTime:e,attributes:t,kind:r,op:i}=n,s=typeof e=="number"?l1(e):e;return{attributes:i?{[St]:i,...t}:t,kind:r,startTime:s}}function l1(n){return n<9999999999?n*1e3:n}function Uu(n,e){const t=d1(n),r=K.getSpan(t);if(!r||!e)return t;const i=K.deleteSpan(t),{spanId:s,traceId:a}=r.spanContext(),o=Wr(r.spanContext()),c=et(r),u=Ve(c),l=Lm({dsc:u,sampled:o}),d={traceId:a,spanId:s,isRemote:!0,traceFlags:o?Ae.SAMPLED:Ae.NONE,traceState:l};return K.setSpanContext(i,d)}function d1(n){if(n){const e=Du(n);if(e)return e}return te.active()}function f1(n,e){return r1(te.active(),n,e)}function p1(n,e){const t=Du(e),r=t&&K.getSpan(t),i=r?Wc(r):Gc(e);return[r?Ve(r):ni(n,e),i]}function Bu(n){return n!==void 0?e=>Dm(n,e):e=>e()}function h1(n){const e=In(te.active());return te.with(e,n)}function m1({span:n}={}){let e=te.active();if(n){const{scope:a}=as(n);e=a&&Du(a)||K.setSpan(te.active(),n)}const{traceId:t,spanId:r,sampled:i,dynamicSamplingContext:s}=$m(e);return{"sentry-trace":Qr(t,r,i),baggage:xs(s)}}function g1(){function n(){const o=te.active(),c=di(o);return c||{scope:Fc(),isolationScope:jc()}}function e(o){const c=te.active();return te.with(c,()=>o(s()))}function t(o,c){const u=te.active();return te.with(u.setValue(lc,o),()=>c(o))}function r(o){const c=te.active();return te.with(c.setValue(uc,!0),()=>o(a()))}function i(o,c){const u=te.active();return te.with(u.setValue(dc,o),()=>c(a()))}function s(){return n().scope}function a(){return n().isolationScope}ly({withScope:e,withSetScope:t,withSetIsolationScope:i,withIsolationScope:r,getCurrentScope:s,getIsolationScope:a,startSpan:o1,startSpanManual:c1,startInactiveSpan:u1,getActiveSpan:QC,suppressTracing:h1,getTraceData:m1,continueTrace:f1,withActiveSpan:Dm})}function sf(n){let e,t=n[0],r=1;for(;r<n.length;){const i=n[r],s=n[r+1];if(r+=2,(i==="optionalAccess"||i==="optionalCall")&&t==null)return;i==="access"||i==="optionalAccess"?(e=t,t=s(t)):(i==="call"||i==="optionalCall")&&(t=s((...a)=>t.call(e,...a)),e=void 0)}return t}function _1(n){class e extends n{constructor(...r){super(...r),na("SentryContextManager")}with(r,i,s,...a){const o=di(r),c=sf([o,"optionalAccess",E=>E.scope])||re(),u=sf([o,"optionalAccess",E=>E.isolationScope])||Me(),l=r.getValue(uc)===!0,d=r.getValue(lc),f=r.getValue(dc),p=d||c.clone(),h=f||(l?u.clone():u),y=Cm(r,{scope:p,isolationScope:h}).deleteValue(uc).deleteValue(lc).deleteValue(dc);return qC(p,y),super.with(y,i,s,...a)}}return e}function y1(n){const e=new Map;for(const t of n)b1(e,t);return Array.from(e,function([t,r]){return r})}function Fm(n){return n.attributes[xu]===!0?void 0:n.parentSpanId}function b1(n,e){const t=e.spanContext().spanId,r=Fm(e);if(!r){fc(n,{id:t,span:e,children:[]});return}const i=v1(n,r),s=fc(n,{id:t,span:e,parentNode:i,children:[]});i.children.push(s)}function v1(n,e){const t=n.get(e);return t||fc(n,{id:e,children:[]})}function fc(n,e){const t=n.get(e.id);return t&&t.span?t:t&&!t.span?(t.span=e.span,t.parentNode=e.parentNode,t):(n.set(e.id,e),e)}const jm={1:"cancelled",2:"unknown_error",3:"invalid_argument",4:"deadline_exceeded",5:"not_found",6:"already_exists",7:"permission_denied",8:"resource_exhausted",9:"failed_precondition",10:"aborted",11:"out_of_range",12:"unimplemented",13:"internal_error",14:"unavailable",15:"data_loss",16:"unauthenticated"},E1=n=>Object.values(jm).includes(n);function Um(n){const e=$u(n)?n.attributes:{},t=GC(n)?n.status:void 0;if(t){if(t.code===Lt.OK)return{code:ss};if(t.code===Lt.ERROR){if(typeof t.message>"u"){const i=af(e);if(i)return i}return t.message&&E1(t.message)?{code:Ee,message:t.message}:{code:Ee,message:"unknown_error"}}}const r=af(e);return r||(t&&t.code===Lt.UNSET?{code:ss}:{code:Ee,message:"unknown_error"})}function af(n){const e=n[Su]||n[Zh],t=n[EI],r=typeof e=="number"?e:typeof e=="string"?parseInt(e):void 0;if(typeof r=="number")return Ap(r);if(typeof t=="string")return{code:Ee,message:jm[t]||"unknown_error"}}function w1(n){let e,t=n[0],r=1;for(;r<n.length;){const i=n[r],s=n[r+1];if(r+=2,(i==="optionalAccess"||i==="optionalCall")&&t==null)return;i==="access"||i==="optionalAccess"?(e=t,t=s(t)):(i==="call"||i==="optionalCall")&&(t=s((...a)=>t.call(e,...a)),e=void 0)}return t}const of=1e3,S1=300;class T1{constructor(e){this._finishedSpanBucketSize=w1([e,"optionalAccess",t=>t.timeout])||S1,this._finishedSpanBuckets=new Array(this._finishedSpanBucketSize).fill(void 0),this._lastCleanupTimestampInS=Math.floor(Date.now()/1e3),this._spansToBucketEntry=new WeakMap}export(e){const t=Math.floor(Date.now()/1e3);if(this._lastCleanupTimestampInS!==t){let s=0;this._finishedSpanBuckets.forEach((a,o)=>{a&&a.timestampInS<=t-this._finishedSpanBucketSize&&(s+=a.spans.size,this._finishedSpanBuckets[o]=void 0)}),s>0&&Gt&&w.log(`SpanExporter dropped ${s} spans because they were pending for more than ${this._finishedSpanBucketSize} seconds.`),this._lastCleanupTimestampInS=t}const r=t%this._finishedSpanBucketSize,i=this._finishedSpanBuckets[r]||{timestampInS:t,spans:new Set};this._finishedSpanBuckets[r]=i,i.spans.add(e),this._spansToBucketEntry.set(e,i),Fm(e)||(this._clearTimeout(),this._flushTimeout=setTimeout(()=>{this.flush()},1))}flush(){this._clearTimeout();const e=[];this._finishedSpanBuckets.forEach(s=>{s&&e.push(...s.spans)});const t=A1(e),r=t.size,i=e.length-r;Gt&&w.log(`SpanExporter exported ${r} spans, ${i} spans are waiting for their parent spans to finish`),t.forEach(s=>{const a=this._spansToBucketEntry.get(s);a&&a.spans.delete(s)})}clear(){this._finishedSpanBuckets=this._finishedSpanBuckets.fill(void 0),this._clearTimeout()}_clearTimeout(){this._flushTimeout&&(clearTimeout(this._flushTimeout),this._flushTimeout=void 0)}}function A1(n){const e=y1(n),t=new Set;return R1(e).forEach(i=>{const s=i.span;t.add(s);const a=P1(s),o=a.spans||[];i.children.forEach(u=>{pc(u,o,t)}),a.spans=o.length>of?o.sort((u,l)=>u.start_timestamp-l.start_timestamp).slice(0,of):o;const c=cs(s.events);c&&(a.measurements=c),ri(a)}),t}function O1(n){return!!n.span&&!n.parentNode}function R1(n){return n.filter(O1)}function I1(n){const e=n.attributes,t=e[Ut],r=e[St],i=e[ut];return{origin:t,op:r,source:i}}function P1(n){const{op:e,description:t,data:r,origin:i="manual",source:s}=Bm(n),a=as(n),o=n.attributes[Jn],c=ae({[ut]:s,[Jn]:o,[St]:e,[Ut]:i,...r,...Gm(n.attributes)}),{traceId:u,spanId:l}=n.spanContext(),d=n.parentSpanId,f=Um(n),p=ae({parent_span_id:d,span_id:l,trace_id:u,data:c,origin:i,op:e,status:$s(f)}),h=c[Su],m=typeof h=="number"?{response:{status_code:h}}:void 0;return ae({contexts:{trace:p,otel:{resource:n.resource.attributes},...m},spans:[],start_timestamp:Et(n.startTime),timestamp:Et(n.endTime),transaction:t,type:"transaction",sdkProcessingMetadata:{...ae({capturedSpanScope:a.scope,capturedSpanIsolationScope:a.isolationScope,sampleRate:o,dynamicSamplingContext:Ve(n)})},...s&&{transaction_info:{source:s}},_metrics_summary:jr(n)})}function pc(n,e,t){const r=n.span;if(r&&t.add(r),!r){n.children.forEach(E=>{pc(E,e,t)});return}const s=r.spanContext().spanId,a=r.spanContext().traceId,{attributes:o,startTime:c,endTime:u,parentSpanId:l}=r,{op:d,description:f,data:p,origin:h="manual"}=Bm(r),m=ae({[Ut]:h,[St]:d,...Gm(o),...p}),g=Um(r),y=ae({span_id:s,trace_id:a,data:m,description:f,parent_span_id:l,start_timestamp:Et(c),timestamp:Et(u)||void 0,status:$s(g),op:d,origin:h,_metrics_summary:jr(r),measurements:cs(r.events)});e.push(y),n.children.forEach(E=>{pc(E,e,t)})}function Bm(n){const{op:e,source:t,origin:r}=I1(n),{op:i,description:s,source:a,data:o}=ZC(n),c=e||i,u=t||a,l={...o,...C1(n)};return{op:c,description:s,source:u,origin:r,data:l}}function Gm(n){const e={...n};return delete e[Jn],delete e[xu],delete e[Qn],e}function C1(n){const e=n.attributes,t={};n.kind!==He.INTERNAL&&(t["otel.kind"]=He[n.kind]);const r=e[Zh];r&&(t[Su]=r);const i=VC(n);return i.url&&(t.url=i.url),i["http.query"]&&(t["http.query"]=i["http.query"].slice(1)),i["http.fragment"]&&(t["http.fragment"]=i["http.fragment"].slice(1)),t}function Hm(n){let e,t=n[0],r=1;for(;r<n.length;){const i=n[r],s=n[r+1];if(r+=2,(i==="optionalAccess"||i==="optionalCall")&&t==null)return;i==="access"||i==="optionalAccess"?(e=t,t=s(t)):(i==="call"||i==="optionalCall")&&(t=s((...a)=>t.call(e,...a)),e=void 0)}return t}function N1(n,e){const t=K.getSpan(e);let r=di(e);t&&!t.spanContext().isRemote&&Vc(t,n),t&&t.spanContext().isRemote&&n.setAttribute(xu,!0),e===nu&&(r={scope:Fc(),isolationScope:jc()}),r&&$p(n,r.scope,r.isolationScope),kp(n);const i=Q();Hm([i,"optionalAccess",s=>s.emit,"call",s=>s("spanStart",n)])}function L1(n){Dp(n);const e=Q();Hm([e,"optionalAccess",t=>t.emit,"call",t=>t("spanEnd",n)])}class x1{constructor(e){na("SentrySpanProcessor"),this._exporter=new T1(e)}async forceFlush(){this._exporter.flush()}async shutdown(){this._exporter.clear()}onStart(e,t){N1(e,t)}onEnd(e){L1(e),this._exporter.export(e)}}class $1{constructor(e){this._client=e,na("SentrySampler")}shouldSample(e,t,r,i,s,a){const o=this._client.getOptions(),c=F1(e),u=U([c,"optionalAccess",v=>v.spanContext,"call",v=>v()]);if(!ei(o))return Mn({decision:void 0,context:e,spanAttributes:s});const l=s[Eu]||s[wu];if(i===He.CLIENT&&l&&(!c||U([u,"optionalAccess",v=>v.isRemote])))return Mn({decision:void 0,context:e,spanAttributes:s});const d=c?k1(c,t,r):void 0,{description:f,data:p,op:h}=Nm(r,s,i),m={...p,...s};h&&(m[St]=h);const g={decision:!0};if(this._client.emit("beforeSampling",{spanAttributes:m,spanName:f,parentSampled:d,parentContext:u},g),!g.decision)return Mn({decision:void 0,context:e,spanAttributes:s});const[y,E]=jp(o,{name:f,attributes:m,transactionContext:{name:f,parentSampled:d},parentSampled:d}),b={[Jn]:E},S=`${l}`.toUpperCase();return S==="OPTIONS"||S==="HEAD"?(Gt&&w.log(`[Tracing] Not sampling span because HTTP method is '${S}' for ${r}`),{...Mn({decision:at.NOT_RECORD,context:e,spanAttributes:s}),attributes:b}):y?{...Mn({decision:at.RECORD_AND_SAMPLED,context:e,spanAttributes:s}),attributes:b}:{...Mn({decision:at.NOT_RECORD,context:e,spanAttributes:s}),attributes:b}}toString(){return"SentrySampler"}}function M1(n){const e=n.spanContext().traceId,t=t1(n);return t&&e===t.traceId?t.sampled:void 0}function k1(n,e,t){const r=n.spanContext();if(sn(r)&&r.traceId===e){if(r.isRemote){const s=M1(n);return Gt&&w.log(`[Tracing] Inheriting remote parent's sampled decision for ${t}: ${s}`),s}const i=Wr(r);return Gt&&w.log(`[Tracing] Inheriting parent's sampled decision for ${t}: ${i}`),i}}function Mn({decision:n,context:e,spanAttributes:t}){const r=D1(e,t);return n==null?{decision:at.NOT_RECORD,traceState:r}:n===at.NOT_RECORD?{decision:n,traceState:r.set(ku,"1")}:{decision:n,traceState:r}}function D1(n,e){const t=K.getSpan(n),r=U([t,"optionalAccess",a=>a.spanContext,"call",a=>a()]);let i=U([r,"optionalAccess",a=>a.traceState])||new ta;const s=e[Ks]||e[Js];return s&&typeof s=="string"&&(i=i.set(Rm,s)),i}function F1(n){const e=K.getSpan(n);return e&&sn(e.spanContext())?e:void 0}const ot=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;var Wm={},ra={},ir={};Object.defineProperty(ir,"__esModule",{value:!0});ir.PACKAGE_NAME=ir.PACKAGE_VERSION=void 0;ir.PACKAGE_VERSION="0.9.0";ir.PACKAGE_NAME="@opentelemetry/instrumentation-undici";var ia={};Object.defineProperty(ia,"__esModule",{value:!0});ia.SemanticAttributes=void 0;ia.SemanticAttributes={HTTP_CONNECTION_STATE:"http.connection.state",ERROR_TYPE:"error.type",HTTP_REQUEST_BODY_SIZE:"http.request.body.size",HTTP_REQUEST_METHOD:"http.request.method",HTTP_REQUEST_METHOD_ORIGINAL:"http.request.method_original",HTTP_REQUEST_RESEND_COUNT:"http.request.resend_count",HTTP_RESPONSE_BODY_SIZE:"http.response.body.size",HTTP_RESPONSE_STATUS_CODE:"http.response.status_code",HTTP_ROUTE:"http.route",NETWORK_PEER_ADDRESS:"network.peer.address",NETWORK_PEER_PORT:"network.peer.port",NETWORK_PROTOCOL_NAME:"network.protocol.name",NETWORK_PROTOCOL_VERSION:"network.protocol.version",SERVER_ADDRESS:"server.address",SERVER_PORT:"server.port",URL_FULL:"url.full",URL_PATH:"url.path",URL_QUERY:"url.query",URL_SCHEME:"url.scheme",USER_AGENT_ORIGINAL:"user_agent.original"};const j1=lu(uC);Object.defineProperty(ra,"__esModule",{value:!0});ra.UndiciInstrumentation=void 0;const Ar=g_,U1=Xr,Or=iI,Ue=du,cf=ir,ve=ia,Fi=j1;class B1 extends Or.InstrumentationBase{constructor(e={}){super(cf.PACKAGE_NAME,cf.PACKAGE_VERSION,e),this._recordFromReq=new WeakMap}init(){}disable(){super.disable(),this._channelSubs.forEach(e=>e.unsubscribe()),this._channelSubs.length=0}enable(){super.enable(),this._channelSubs=this._channelSubs||[],!(this._channelSubs.length>0)&&(this.subscribeToChannel("undici:request:create",this.onRequestCreated.bind(this)),this.subscribeToChannel("undici:client:sendHeaders",this.onRequestHeaders.bind(this)),this.subscribeToChannel("undici:request:headers",this.onResponseHeaders.bind(this)),this.subscribeToChannel("undici:request:trailers",this.onDone.bind(this)),this.subscribeToChannel("undici:request:error",this.onError.bind(this)))}_updateMetricInstruments(){this._httpClientDurationHistogram=this.meter.createHistogram("http.client.request.duration",{description:"Measures the duration of outbound HTTP requests.",unit:"s",valueType:Ue.ValueType.DOUBLE,advice:{explicitBucketBoundaries:[.005,.01,.025,.05,.075,.1,.25,.5,.75,1,2.5,5,7.5,10]}})}subscribeToChannel(e,t){var r;const[i,s]=process.version.replace("v","").split(".").map(c=>Number(c)),a=i>18||i===18&&s>=19;let o;if(a)(r=Ar.subscribe)===null||r===void 0||r.call(Ar,e,t),o=()=>{var c;return(c=Ar.unsubscribe)===null||c===void 0?void 0:c.call(Ar,e,t)};else{const c=Ar.channel(e);c.subscribe(t),o=()=>c.unsubscribe(t)}this._channelSubs.push({name:e,unsubscribe:o})}onRequestCreated({request:e}){const t=this.getConfig(),r=t.enabled!==!1;if((0,Or.safeExecuteInTheMiddle)(()=>{var v;return!r||e.method==="CONNECT"||((v=t.ignoreRequestHook)===null||v===void 0?void 0:v.call(t,e))},v=>v&&this._diag.error("caught ignoreRequestHook error: ",v),!0))return;const s=(0,Fi.hrTime)();let a;try{a=new U1.URL(e.path,e.origin)}catch(v){this._diag.warn("could not determine url.full:",v);return}const o=a.protocol.replace(":",""),c=this.getRequestMethod(e.method),u={[ve.SemanticAttributes.HTTP_REQUEST_METHOD]:c,[ve.SemanticAttributes.HTTP_REQUEST_METHOD_ORIGINAL]:e.method,[ve.SemanticAttributes.URL_FULL]:a.toString(),[ve.SemanticAttributes.URL_PATH]:a.pathname,[ve.SemanticAttributes.URL_QUERY]:a.search,[ve.SemanticAttributes.URL_SCHEME]:o},l={https:"443",http:"80"},d=a.hostname,f=a.port||l[o];u[ve.SemanticAttributes.SERVER_ADDRESS]=d,f&&!isNaN(Number(f))&&(u[ve.SemanticAttributes.SERVER_PORT]=Number(f));let p;if(Array.isArray(e.headers)){const v=e.headers.findIndex(D=>D.toLowerCase()==="user-agent");v>=0&&(p=e.headers[v+1])}else if(typeof e.headers=="string"){const D=e.headers.split(`\r
`).find(H=>H.toLowerCase().startsWith("user-agent"));p=D&&D.substring(D.indexOf(":")+1).trim()}p&&(u[ve.SemanticAttributes.USER_AGENT_ORIGINAL]=p);const h=(0,Or.safeExecuteInTheMiddle)(()=>{var v;return(v=t.startSpanHook)===null||v===void 0?void 0:v.call(t,e)},v=>v&&this._diag.error("caught startSpanHook error: ",v),!0);h&&Object.entries(h).forEach(([v,D])=>{u[v]=D});const m=Ue.context.active(),g=Ue.trace.getSpan(m);let y;t.requireParentforSpans&&(!g||!Ue.trace.isSpanContextValid(g.spanContext()))?y=Ue.trace.wrapSpanContext(Ue.INVALID_SPAN_CONTEXT):y=this.tracer.startSpan(c==="_OTHER"?"HTTP":c,{kind:Ue.SpanKind.CLIENT,attributes:u},m),(0,Or.safeExecuteInTheMiddle)(()=>{var v;return(v=t.requestHook)===null||v===void 0?void 0:v.call(t,y,e)},v=>v&&this._diag.error("caught requestHook error: ",v),!0);const E=Ue.trace.setSpan(Ue.context.active(),y),b={};Ue.propagation.inject(E,b);const S=Object.entries(b);for(let v=0;v<S.length;v++){const[D,H]=S[v];typeof e.addHeader=="function"?e.addHeader(D,H):typeof e.headers=="string"?e.headers+=`${D}: ${H}\r
`:Array.isArray(e.headers)&&e.headers.push(D,H)}this._recordFromReq.set(e,{span:y,attributes:u,startTime:s})}onRequestHeaders({request:e,socket:t}){var r;const i=this._recordFromReq.get(e);if(!i)return;const s=this.getConfig(),{span:a}=i,{remoteAddress:o,remotePort:c}=t,u={[ve.SemanticAttributes.NETWORK_PEER_ADDRESS]:o,[ve.SemanticAttributes.NETWORK_PEER_PORT]:c};if(!((r=s.headersToSpanAttributes)===null||r===void 0)&&r.requestHeaders){const l=new Set(s.headersToSpanAttributes.requestHeaders.map(f=>f.toLowerCase())),d=Array.isArray(e.headers)?e.headers:e.headers.split(`\r
`);d.forEach((f,p)=>{const h=f.indexOf(":"),m=h!==-1,g=(m?f.substring(0,h):f).toLowerCase(),y=m?f.substring(h+1):d[p+1];l.has(g)&&(u[`http.request.header.${g}`]=y.trim())})}a.setAttributes(u)}onResponseHeaders({request:e,response:t}){var r,i;const s=this._recordFromReq.get(e);if(!s)return;const{span:a,attributes:o}=s,c={[ve.SemanticAttributes.HTTP_RESPONSE_STATUS_CODE]:t.statusCode},u=this.getConfig();(0,Or.safeExecuteInTheMiddle)(()=>{var d;return(d=u.responseHook)===null||d===void 0?void 0:d.call(u,a,{request:e,response:t})},d=>d&&this._diag.error("caught responseHook error: ",d),!0);const l=new Set;!((r=u.headersToSpanAttributes)===null||r===void 0)&&r.responseHeaders&&((i=u.headersToSpanAttributes)===null||i===void 0||i.responseHeaders.forEach(d=>l.add(d.toLowerCase())));for(let d=0;d<t.headers.length;d=d+2){const f=t.headers[d].toString().toLowerCase(),p=t.headers[d+1];if(l.has(f)&&(c[`http.response.header.${f}`]=p.toString()),f==="content-length"){const h=Number(p.toString());isNaN(h)||(c["http.response.header.content-length"]=h)}}a.setAttributes(c),a.setStatus({code:t.statusCode>=400?Ue.SpanStatusCode.ERROR:Ue.SpanStatusCode.UNSET}),s.attributes=Object.assign(o,c)}onDone({request:e}){const t=this._recordFromReq.get(e);if(!t)return;const{span:r,attributes:i,startTime:s}=t;r.end(),this._recordFromReq.delete(e),this.recordRequestDuration(i,s)}onError({request:e,error:t}){const r=this._recordFromReq.get(e);if(!r)return;const{span:i,attributes:s,startTime:a}=r;i.recordException(t),i.setStatus({code:Ue.SpanStatusCode.ERROR,message:t.message}),i.end(),this._recordFromReq.delete(e),s[ve.SemanticAttributes.ERROR_TYPE]=t.message,this.recordRequestDuration(s,a)}recordRequestDuration(e,t){const r={};[ve.SemanticAttributes.HTTP_RESPONSE_STATUS_CODE,ve.SemanticAttributes.HTTP_REQUEST_METHOD,ve.SemanticAttributes.SERVER_ADDRESS,ve.SemanticAttributes.SERVER_PORT,ve.SemanticAttributes.URL_SCHEME,ve.SemanticAttributes.ERROR_TYPE].forEach(a=>{a in e&&(r[a]=e[a])});const s=(0,Fi.hrTimeToMilliseconds)((0,Fi.hrTimeDuration)(t,(0,Fi.hrTime)()))/1e3;this._httpClientDurationHistogram.record(s,r)}getRequestMethod(e){const t={CONNECT:!0,OPTIONS:!0,HEAD:!0,GET:!0,POST:!0,PUT:!0,PATCH:!0,DELETE:!0,TRACE:!0};return e.toUpperCase()in t?e.toUpperCase():"_OTHER"}}ra.UndiciInstrumentation=B1;var Vm={};Object.defineProperty(Vm,"__esModule",{value:!0});(function(n){var e=Ai&&Ai.__createBinding||(Object.create?function(r,i,s,a){a===void 0&&(a=s),Object.defineProperty(r,a,{enumerable:!0,get:function(){return i[s]}})}:function(r,i,s,a){a===void 0&&(a=s),r[a]=i[s]}),t=Ai&&Ai.__exportStar||function(r,i){for(var s in r)s!=="default"&&!Object.prototype.hasOwnProperty.call(i,s)&&e(i,r,s)};Object.defineProperty(n,"__esModule",{value:!0}),t(ra,n),t(Vm,n)})(Wm);const G1=(n={})=>{const e=typeof n.breadcrumbs>"u"?!0:n.breadcrumbs,t=n.ignoreOutgoingRequests;return{name:"NodeFetch",setupOnce(){const r=new en(100),i=new Wm.UndiciInstrumentation({requireParentforSpans:!1,ignoreRequestHook:s=>{const a=z1(s.origin,s.path);if(t&&a&&t(a))return!0;if(!ei()){const c=U([Q,"call",d=>d(),"optionalAccess",d=>d.getOptions,"call",d=>d(),"access",d=>d.tracePropagationTargets]),u=xm(a,c,r)?Qb():{},l=s.headers;return Array.isArray(l)?Object.entries(u).forEach(d=>l.push(...d)):s.headers+=Object.entries(u).map(([d,f])=>`${d}: ${f}\r
`).join(""),!0}return!1},startSpanHook:()=>({[Ut]:"auto.http.otel.node_fetch"}),responseHook:(s,{request:a,response:o})=>{e&&W1(a,o)}});vu({instrumentations:[i]})}}},H1=G1;function W1(n,e){const t=V1(n),r=e.statusCode,i=uh(r);tr({category:"http",data:{status_code:r,...t},type:"http",level:i},{event:"response",request:n,response:e})}function V1(n){try{const e=new URL(n.path,n.origin),t=Jc(e.toString()),r={url:Qc(t),"http.method":n.method||"GET"};return t.search&&(r["http.query"]=t.search),t.hash&&(r["http.fragment"]=t.hash),r}catch{return{}}}function z1(n,e="/"){const t=`${n}`;return t.endsWith("/")&&e.startsWith("/")?`${t}${e.slice(1)}`:!t.endsWith("/")&&!e.startsWith("/")?`${t}/${e.slice(1)}`:`${t}${e}`}const q1="Console",Z1=()=>({name:q1,setup(n){Ov(({args:e,level:t})=>{Q()===n&&tr({category:"console",level:Iv(t),message:yn(T_.format.apply(void 0,e),2048)},{input:[...e],level:t})})}}),X1=Ic.promisify(Cc.readFile),Y1=Ic.promisify(Cc.readdir),K1="Context",J1=(n={})=>{let e;const t={app:!0,os:!0,device:!0,culture:!0,cloudResource:!0,...n};async function r(s){e===void 0&&(e=i());const a=eN(await e);return s.contexts={...s.contexts,app:{...a.app,...U([s,"access",o=>o.contexts,"optionalAccess",o=>o.app])},os:{...a.os,...U([s,"access",o=>o.contexts,"optionalAccess",o=>o.os])},device:{...a.device,...U([s,"access",o=>o.contexts,"optionalAccess",o=>o.device])},culture:{...a.culture,...U([s,"access",o=>o.contexts,"optionalAccess",o=>o.culture])},cloud_resource:{...a.cloud_resource,...U([s,"access",o=>o.contexts,"optionalAccess",o=>o.cloud_resource])}},s}async function i(){const s={};if(t.os&&(s.os=await tN()),t.app&&(s.app=rN()),t.device&&(s.device=iN(t.device)),t.culture){const a=nN();a&&(s.culture=a)}return t.cloudResource&&(s.cloud_resource=lN()),s}return{name:K1,processEvent(s){return r(s)}}},Q1=J1;function eN(n){if(U([n,"optionalAccess",e=>e.app,"optionalAccess",e=>e.app_memory])&&(n.app.app_memory=process.memoryUsage().rss),U([n,"optionalAccess",e=>e.app,"optionalAccess",e=>e.free_memory])&&typeof process.availableMemory=="function"){const e=U([process,"access",t=>t.availableMemory,"optionalCall",t=>t()]);e!=null&&(n.app.free_memory=e)}return U([n,"optionalAccess",e=>e.device,"optionalAccess",e=>e.free_memory])&&(n.device.free_memory=Ge.freemem()),n}async function tN(){const n=Ge.platform();switch(n){case"darwin":return cN();case"linux":return uN();default:return{name:sN[n]||n,version:Ge.release()}}}function nN(){try{if(typeof process.versions.icu!="string")return;const n=new Date(9e8);if(new Intl.DateTimeFormat("es",{month:"long"}).format(n)==="enero"){const t=Intl.DateTimeFormat().resolvedOptions();return{locale:t.locale,timezone:t.timeZone}}}catch{}}function rN(){const n=process.memoryUsage().rss,t={app_start_time:new Date(Date.now()-process.uptime()*1e3).toISOString(),app_memory:n};if(typeof process.availableMemory=="function"){const r=U([process,"access",i=>i.availableMemory,"optionalCall",i=>i()]);r!=null&&(t.free_memory=r)}return t}function iN(n){const e={};let t;try{t=Ge.uptime&&Ge.uptime()}catch{}if(typeof t=="number"&&(e.boot_time=new Date(Date.now()-t*1e3).toISOString()),e.arch=Ge.arch(),(n===!0||n.memory)&&(e.memory_size=Ge.totalmem(),e.free_memory=Ge.freemem()),n===!0||n.cpu){const r=Ge.cpus(),i=r&&r[0];i&&(e.processor_count=r.length,e.cpu_description=i.model,e.processor_frequency=i.speed)}return e}const sN={aix:"IBM AIX",freebsd:"FreeBSD",openbsd:"OpenBSD",sunos:"SunOS",win32:"Windows"},aN=[{name:"fedora-release",distros:["Fedora"]},{name:"redhat-release",distros:["Red Hat Linux","Centos"]},{name:"redhat_version",distros:["Red Hat Linux"]},{name:"SuSE-release",distros:["SUSE Linux"]},{name:"lsb-release",distros:["Ubuntu Linux","Arch Linux"]},{name:"debian_version",distros:["Debian"]},{name:"debian_release",distros:["Debian"]},{name:"arch-release",distros:["Arch Linux"]},{name:"gentoo-release",distros:["Gentoo Linux"]},{name:"novell-release",distros:["SUSE Linux"]},{name:"alpine-release",distros:["Alpine Linux"]}],oN={alpine:n=>n,arch:n=>gt(/distrib_release=(.*)/,n),centos:n=>gt(/release ([^ ]+)/,n),debian:n=>n,fedora:n=>gt(/release (..)/,n),mint:n=>gt(/distrib_release=(.*)/,n),red:n=>gt(/release ([^ ]+)/,n),suse:n=>gt(/VERSION = (.*)\n/,n),ubuntu:n=>gt(/distrib_release=(.*)/,n)};function gt(n,e){const t=n.exec(e);return t?t[1]:void 0}async function cN(){const n={kernel_version:Ge.release(),name:"Mac OS X",version:`10.${Number(Ge.release().split(".")[0])-4}`};try{const e=await new Promise((t,r)=>{b_.execFile("/usr/bin/sw_vers",(i,s)=>{if(i){r(i);return}t(s)})});n.name=gt(/^ProductName:\s+(.*)$/m,e),n.version=gt(/^ProductVersion:\s+(.*)$/m,e),n.build=gt(/^BuildVersion:\s+(.*)$/m,e)}catch{}return n}function uf(n){return n.split(" ")[0].toLowerCase()}async function uN(){const n={kernel_version:Ge.release(),name:"Linux"};try{const e=await Y1("/etc"),t=aN.find(o=>e.includes(o.name));if(!t)return n;const r=Kt.join("/etc",t.name),i=(await X1(r,{encoding:"utf-8"})).toLowerCase(),{distros:s}=t;n.name=s.find(o=>i.indexOf(uf(o))>=0)||s[0];const a=uf(n.name);n.version=U([oN,"access",o=>o[a],"optionalCall",o=>o(i)])}catch{}return n}function lN(){return process.env.VERCEL?{"cloud.provider":"vercel","cloud.region":process.env.VERCEL_REGION}:process.env.AWS_REGION?{"cloud.provider":"aws","cloud.region":process.env.AWS_REGION,"cloud.platform":process.env.AWS_EXECUTION_ENV}:process.env.GCP_PROJECT?{"cloud.provider":"gcp"}:process.env.ALIYUN_REGION_ID?{"cloud.provider":"alibaba_cloud","cloud.region":process.env.ALIYUN_REGION_ID}:process.env.WEBSITE_SITE_NAME&&process.env.REGION_NAME?{"cloud.provider":"azure","cloud.region":process.env.REGION_NAME}:process.env.IBM_CLOUD_REGION?{"cloud.provider":"ibm_cloud","cloud.region":process.env.IBM_CLOUD_REGION}:process.env.TENCENTCLOUD_REGION?{"cloud.provider":"tencent_cloud","cloud.region":process.env.TENCENTCLOUD_REGION,"cloud.account.id":process.env.TENCENTCLOUD_APPID,"cloud.availability_zone":process.env.TENCENTCLOUD_ZONE}:process.env.NETLIFY?{"cloud.provider":"netlify"}:process.env.FLY_REGION?{"cloud.provider":"fly.io","cloud.region":process.env.FLY_REGION}:process.env.DYNO?{"cloud.provider":"heroku"}:void 0}const hc=new en(10),zm=new en(20),dN=7,fN="ContextLines",pN=1e3,hN=1e4;function mN(n,e,t){const r=n.get(e);return r===void 0?(n.set(e,t),t):r}function gN(n){return!!(n.startsWith("node:")||n.endsWith(".min.js")||n.endsWith(".min.cjs")||n.endsWith(".min.mjs")||n.startsWith("data:"))}function _N(n){return n.lineno!==void 0&&n.lineno>hN||n.colno!==void 0&&n.colno>pN}function yN(n,e){const t=hc.get(n);if(t===void 0)return!1;for(let r=e[0];r<=e[1];r++)if(t[r]===void 0)return!1;return!0}function bN(n,e){if(!n.length)return[];let t=0;const r=n[0];if(typeof r!="number")return[];let i=df(r,e);const s=[];for(;;){if(t===n.length-1){s.push(i);break}const a=n[t+1];if(typeof a!="number")break;a<=i[1]?i[1]=a+e:(s.push(i),i=df(a,e)),t++}return s}function vN(n,e,t){return new Promise((r,i)=>{const s=Cc.createReadStream(n),a=__.createInterface({input:s});function o(){s.destroy(),r()}let c=0,u=0;const l=e[u];if(l===void 0){o();return}let d=l[0],f=l[1];function p(h){zm.set(n,1),ot&&w.error(`Failed to read file: ${n}. Error: ${h}`),a.close(),a.removeAllListeners(),o()}s.on("error",p),a.on("error",p),a.on("close",o),a.on("line",h=>{if(c++,!(c<d)&&(t[c]=q_(h,0),c>=f)){if(u===e.length-1){a.close(),a.removeAllListeners();return}u++;const m=e[u];if(m===void 0){a.close(),a.removeAllListeners();return}d=m[0],f=m[1]}})})}async function EN(n,e){const t={};if(e>0&&U([n,"access",s=>s.exception,"optionalAccess",s=>s.values])){for(const s of n.exception.values)if(U([s,"access",a=>a.stacktrace,"optionalAccess",a=>a.frames,"optionalAccess",a=>a.length]))for(let a=s.stacktrace.frames.length-1;a>=0;a--){const o=s.stacktrace.frames[a],c=U([o,"optionalAccess",l=>l.filename]);if(!o||typeof c!="string"||typeof o.lineno!="number"||gN(c)||_N(o))continue;t[c]||(t[c]=[]),t[c].push(o.lineno)}}const r=Object.keys(t);if(r.length==0)return n;const i=[];for(const s of r){if(zm.get(s))continue;const a=t[s];if(!a)continue;a.sort((u,l)=>u-l);const o=bN(a,e);if(o.every(u=>yN(s,u)))continue;const c=mN(hc,s,{});i.push(vN(s,o,c))}if(await Promise.all(i).catch(()=>{ot&&w.log("Failed to read one or more source files and resolve context lines")}),e>0&&U([n,"access",s=>s.exception,"optionalAccess",s=>s.values]))for(const s of n.exception.values)s.stacktrace&&s.stacktrace.frames&&s.stacktrace.frames.length>0&&wN(s.stacktrace.frames,e,hc);return n}function wN(n,e,t){for(const r of n)if(r.filename&&r.context_line===void 0&&typeof r.lineno=="number"){const i=t.get(r.filename);if(i===void 0)continue;SN(r.lineno,r,e,i)}}function lf(n){delete n.pre_context,delete n.context_line,delete n.post_context}function SN(n,e,t,r){if(e.lineno===void 0||r===void 0){ot&&w.error("Cannot resolve context for frame with no lineno or file contents");return}e.pre_context=[];for(let s=qm(n,t);s<n;s++){const a=r[s];if(a===void 0){lf(e),ot&&w.error(`Could not find line ${s} in file ${e.filename}`);return}e.pre_context.push(a)}if(r[n]===void 0){lf(e),ot&&w.error(`Could not find line ${n} in file ${e.filename}`);return}e.context_line=r[n];const i=Zm(n,t);e.post_context=[];for(let s=n+1;s<=i;s++){const a=r[s];if(a===void 0)break;e.post_context.push(a)}}function qm(n,e){return Math.max(1,n-e)}function Zm(n,e){return n+e}function df(n,e){return[qm(n,e),Zm(n,e)]}const TN=(n={})=>{const e=n.frameContextLines!==void 0?n.frameContextLines:dN;return{name:fN,processEvent(t){return EN(t,e)}}},AN=TN,Xm=Sp(process.versions.node),ON=Xm.major;let ji;async function Ym(){if(ji===void 0)try{ji=!!(await import("node:inspector")).url()}catch{ji=!1}return ji}const Ui="__SENTRY_ERROR_LOCAL_VARIABLES__";function RN(n,e,t){let r=0,i=5,s=0;return setInterval(()=>{s===0?r>n&&(i*=2,t(i),i>86400&&(i=86400),s=i):(s-=1,s===0&&e()),r=0},1e3).unref(),()=>{r+=1}}function ff(n){return n!==void 0&&(n.length===0||n==="?"||n==="<anonymous>")}function Km(n,e){return n===e||ff(n)&&ff(e)}const IN="LyohIEBzZW50cnkvbm9kZSA4LjUxLjAgKDNhMGUxNjApIHwgaHR0cHM6Ly9naXRodWIuY29tL2dldHNlbnRyeS9zZW50cnktamF2YXNjcmlwdCAqLwppbXBvcnR7U2Vzc2lvbiBhcyBlfWZyb20ibm9kZTppbnNwZWN0b3IvcHJvbWlzZXMiO2ltcG9ydHt3b3JrZXJEYXRhIGFzIHR9ZnJvbSJub2RlOndvcmtlcl90aHJlYWRzIjtjb25zdCBuPSI4LjUxLjAiLG89Z2xvYmFsVGhpcztjb25zdCBpPSJ1bmRlZmluZWQiPT10eXBlb2YgX19TRU5UUllfREVCVUdfX3x8X19TRU5UUllfREVCVUdfXyxhPVsiZGVidWciLCJpbmZvIiwid2FybiIsImVycm9yIiwibG9nIiwiYXNzZXJ0IiwidHJhY2UiXSxzPXt9O2Z1bmN0aW9uIGMoZSl7aWYoISgiY29uc29sZSJpbiBvKSlyZXR1cm4gZSgpO2NvbnN0IHQ9by5jb25zb2xlLG49e30saT1PYmplY3Qua2V5cyhzKTtpLmZvckVhY2goKGU9Pntjb25zdCBvPXNbZV07bltlXT10W2VdLHRbZV09b30pKTt0cnl7cmV0dXJuIGUoKX1maW5hbGx5e2kuZm9yRWFjaCgoZT0+e3RbZV09bltlXX0pKX19IWZ1bmN0aW9uKGUsdCxpKXtjb25zdCBhPW8scz1hLl9fU0VOVFJZX189YS5fX1NFTlRSWV9ffHx7fSxjPXNbbl09c1tuXXx8e307Y1tlXXx8KGNbZV09dCgpKX0oImxvZ2dlciIsKGZ1bmN0aW9uKCl7bGV0IGU9ITE7Y29uc3QgdD17ZW5hYmxlOigpPT57ZT0hMH0sZGlzYWJsZTooKT0+e2U9ITF9LGlzRW5hYmxlZDooKT0+ZX07cmV0dXJuIGk/YS5mb3JFYWNoKChuPT57dFtuXT0oLi4udCk9PntlJiZjKCgoKT0+e28uY29uc29sZVtuXShgU2VudHJ5IExvZ2dlciBbJHtufV06YCwuLi50KX0pKX19KSk6YS5mb3JFYWNoKChlPT57dFtlXT0oKT0+e319KSksdH0pKTtjb25zdCByPSJfX1NFTlRSWV9FUlJPUl9MT0NBTF9WQVJJQUJMRVNfXyI7Y29uc3QgdT10O2Z1bmN0aW9uIGwoLi4uZSl7dS5kZWJ1ZyYmYygoKCk9PmNvbnNvbGUubG9nKCJbTG9jYWxWYXJpYWJsZXMgV29ya2VyXSIsLi4uZSkpKX1hc3luYyBmdW5jdGlvbiBmKGUsdCxuLG8pe2NvbnN0IGk9YXdhaXQgZS5wb3N0KCJSdW50aW1lLmdldFByb3BlcnRpZXMiLHtvYmplY3RJZDp0LG93blByb3BlcnRpZXM6ITB9KTtvW25dPWkucmVzdWx0LmZpbHRlcigoZT0+Imxlbmd0aCIhPT1lLm5hbWUmJiFpc05hTihwYXJzZUludChlLm5hbWUsMTApKSkpLnNvcnQoKChlLHQpPT5wYXJzZUludChlLm5hbWUsMTApLXBhcnNlSW50KHQubmFtZSwxMCkpKS5tYXAoKGU9PmUudmFsdWU/LnZhbHVlKSl9YXN5bmMgZnVuY3Rpb24gZyhlLHQsbixvKXtjb25zdCBpPWF3YWl0IGUucG9zdCgiUnVudGltZS5nZXRQcm9wZXJ0aWVzIix7b2JqZWN0SWQ6dCxvd25Qcm9wZXJ0aWVzOiEwfSk7b1tuXT1pLnJlc3VsdC5tYXAoKGU9PltlLm5hbWUsZS52YWx1ZT8udmFsdWVdKSkucmVkdWNlKCgoZSxbdCxuXSk9PihlW3RdPW4sZSkpLHt9KX1mdW5jdGlvbiBkKGUsdCl7ZS52YWx1ZSYmKCJ2YWx1ZSJpbiBlLnZhbHVlP3ZvaWQgMD09PWUudmFsdWUudmFsdWV8fG51bGw9PT1lLnZhbHVlLnZhbHVlP3RbZS5uYW1lXT1gPCR7ZS52YWx1ZS52YWx1ZX0+YDp0W2UubmFtZV09ZS52YWx1ZS52YWx1ZToiZGVzY3JpcHRpb24iaW4gZS52YWx1ZSYmImZ1bmN0aW9uIiE9PWUudmFsdWUudHlwZT90W2UubmFtZV09YDwke2UudmFsdWUuZGVzY3JpcHRpb259PmA6InVuZGVmaW5lZCI9PT1lLnZhbHVlLnR5cGUmJih0W2UubmFtZV09Ijx1bmRlZmluZWQ+IikpfWFzeW5jIGZ1bmN0aW9uIGIoZSx0KXtjb25zdCBuPWF3YWl0IGUucG9zdCgiUnVudGltZS5nZXRQcm9wZXJ0aWVzIix7b2JqZWN0SWQ6dCxvd25Qcm9wZXJ0aWVzOiEwfSksbz17fTtmb3IoY29uc3QgdCBvZiBuLnJlc3VsdClpZih0Py52YWx1ZT8ub2JqZWN0SWQmJiJBcnJheSI9PT10Py52YWx1ZS5jbGFzc05hbWUpe2NvbnN0IG49dC52YWx1ZS5vYmplY3RJZDthd2FpdCBmKGUsbix0Lm5hbWUsbyl9ZWxzZSBpZih0Py52YWx1ZT8ub2JqZWN0SWQmJiJPYmplY3QiPT09dD8udmFsdWU/LmNsYXNzTmFtZSl7Y29uc3Qgbj10LnZhbHVlLm9iamVjdElkO2F3YWl0IGcoZSxuLHQubmFtZSxvKX1lbHNlIHQ/LnZhbHVlJiZkKHQsbyk7cmV0dXJuIG99bGV0IHA7KGFzeW5jIGZ1bmN0aW9uKCl7Y29uc3QgdD1uZXcgZTt0LmNvbm5lY3RUb01haW5UaHJlYWQoKSxsKCJDb25uZWN0ZWQgdG8gbWFpbiB0aHJlYWQiKTtsZXQgbj0hMTt0Lm9uKCJEZWJ1Z2dlci5yZXN1bWVkIiwoKCk9PntuPSExfSkpLHQub24oIkRlYnVnZ2VyLnBhdXNlZCIsKGU9PntuPSEwLGFzeW5jIGZ1bmN0aW9uKGUse3JlYXNvbjp0LGRhdGE6e29iamVjdElkOm59LGNhbGxGcmFtZXM6b30pe2lmKCJleGNlcHRpb24iIT09dCYmInByb21pc2VSZWplY3Rpb24iIT09dClyZXR1cm47aWYocD8uKCksbnVsbD09bilyZXR1cm47Y29uc3QgaT1bXTtmb3IobGV0IHQ9MDt0PG8ubGVuZ3RoO3QrKyl7Y29uc3R7c2NvcGVDaGFpbjpuLGZ1bmN0aW9uTmFtZTphLHRoaXM6c309b1t0XSxjPW4uZmluZCgoZT0+ImxvY2FsIj09PWUudHlwZSkpLHI9Imdsb2JhbCIhPT1zLmNsYXNzTmFtZSYmcy5jbGFzc05hbWU/YCR7cy5jbGFzc05hbWV9LiR7YX1gOmE7aWYodm9pZCAwPT09Yz8ub2JqZWN0Lm9iamVjdElkKWlbdF09e2Z1bmN0aW9uOnJ9O2Vsc2V7Y29uc3Qgbj1hd2FpdCBiKGUsYy5vYmplY3Qub2JqZWN0SWQpO2lbdF09e2Z1bmN0aW9uOnIsdmFyczpufX19YXdhaXQgZS5wb3N0KCJSdW50aW1lLmNhbGxGdW5jdGlvbk9uIix7ZnVuY3Rpb25EZWNsYXJhdGlvbjpgZnVuY3Rpb24oKSB7IHRoaXMuJHtyfSA9IHRoaXMuJHtyfSB8fCAke0pTT04uc3RyaW5naWZ5KGkpfTsgfWAsc2lsZW50OiEwLG9iamVjdElkOm59KSxhd2FpdCBlLnBvc3QoIlJ1bnRpbWUucmVsZWFzZU9iamVjdCIse29iamVjdElkOm59KX0odCxlLnBhcmFtcykudGhlbigoYXN5bmMoKT0+e24mJmF3YWl0IHQucG9zdCgiRGVidWdnZXIucmVzdW1lIil9KSwoYXN5bmMgZT0+e24mJmF3YWl0IHQucG9zdCgiRGVidWdnZXIucmVzdW1lIil9KSl9KSksYXdhaXQgdC5wb3N0KCJEZWJ1Z2dlci5lbmFibGUiKTtjb25zdCBvPSExIT09dS5jYXB0dXJlQWxsRXhjZXB0aW9ucztpZihhd2FpdCB0LnBvc3QoIkRlYnVnZ2VyLnNldFBhdXNlT25FeGNlcHRpb25zIix7c3RhdGU6bz8iYWxsIjoidW5jYXVnaHQifSksbyl7Y29uc3QgZT11Lm1heEV4Y2VwdGlvbnNQZXJTZWNvbmR8fDUwO3A9ZnVuY3Rpb24oZSx0LG4pe2xldCBvPTAsaT01LGE9MDtyZXR1cm4gc2V0SW50ZXJ2YWwoKCgpPT57MD09PWE/bz5lJiYoaSo9MixuKGkpLGk+ODY0MDAmJihpPTg2NDAwKSxhPWkpOihhLT0xLDA9PT1hJiZ0KCkpLG89MH0pLDFlMykudW5yZWYoKSwoKT0+e28rPTF9fShlLChhc3luYygpPT57bCgiUmF0ZS1saW1pdCBsaWZ0ZWQuIiksYXdhaXQgdC5wb3N0KCJEZWJ1Z2dlci5zZXRQYXVzZU9uRXhjZXB0aW9ucyIse3N0YXRlOiJhbGwifSl9KSwoYXN5bmMgZT0+e2woYFJhdGUtbGltaXQgZXhjZWVkZWQuIERpc2FibGluZyBjYXB0dXJpbmcgb2YgY2F1Z2h0IGV4Y2VwdGlvbnMgZm9yICR7ZX0gc2Vjb25kcy5gKSxhd2FpdCB0LnBvc3QoIkRlYnVnZ2VyLnNldFBhdXNlT25FeGNlcHRpb25zIix7c3RhdGU6InVuY2F1Z2h0In0pfSkpfX0pKCkuY2F0Y2goKGU9PntsKCJGYWlsZWQgdG8gc3RhcnQgZGVidWdnZXIiLGUpfSkpLHNldEludGVydmFsKCgoKT0+e30pLDFlNCk7";function pf(...n){w.log("[LocalVariables]",...n)}const PN=(n={})=>{function e(s,a){const o=(U([s,"access",c=>c.stacktrace,"optionalAccess",c=>c.frames])||[]).filter(c=>c.function!=="new Promise");for(let c=0;c<o.length;c++){const u=o.length-c-1,l=a[c],d=o[u];if(!d||!l)break;l.vars===void 0||d.in_app===!1||!Km(d.function,l.function)||(d.vars=l.vars)}}function t(s,a){if(a.originalException&&typeof a.originalException=="object"&&Ui in a.originalException&&Array.isArray(a.originalException[Ui])){for(const o of U([s,"access",c=>c.exception,"optionalAccess",c=>c.values])||[])e(o,a.originalException[Ui]);a.originalException[Ui]=void 0}return s}async function r(){const s=await import("node:inspector");s.url()||s.open(0)}function i(s){const a=new y_.Worker(new URL(`data:application/javascript;base64,${IN}`),{workerData:s,execArgv:[],env:{...process.env,NODE_OPTIONS:void 0}});process.on("exit",()=>{a.terminate()}),a.once("error",o=>{pf("Worker error",o)}),a.once("exit",o=>{pf("Worker exit",o)}),a.unref()}return{name:"LocalVariablesAsync",async setup(s){if(!s.getOptions().includeLocalVariables)return;if(await Ym()){w.warn("Local variables capture has been disabled because the debugger was already enabled");return}const o={...n,debug:w.isEnabled()};r().then(()=>{try{i(o)}catch(c){w.error("Failed to start worker",c)}},c=>{w.error("Failed to start inspector",c)})},processEvent(s,a){return t(s,a)}}};function Jm(n){if(n!==void 0)return n.slice(-10).reduce((e,t)=>`${e},${t.function},${t.lineno},${t.colno}`,"")}function CN(n,e){if(e!==void 0)return Jm(n(e,1))}function Qm(n){let e=[],t=!1;function r(a){e=[],!t&&(t=!0,n(a))}e.push(r);function i(a){e.push(a)}function s(a){const o=e.pop()||r;try{o(a)}catch{r(a)}}return{add:i,next:s}}class Gu{constructor(e){this._session=e}static async create(e){if(e)return e;const t=await import("node:inspector");return new Gu(new t.Session)}configureAndConnect(e,t){this._session.connect(),this._session.on("Debugger.paused",r=>{e(r,()=>{this._session.post("Debugger.resume")})}),this._session.post("Debugger.enable"),this._session.post("Debugger.setPauseOnExceptions",{state:t?"all":"uncaught"})}setPauseOnExceptions(e){this._session.post("Debugger.setPauseOnExceptions",{state:e?"all":"uncaught"})}getLocalVariables(e,t){this._getProperties(e,r=>{const{add:i,next:s}=Qm(t);for(const a of r)if(U([a,"optionalAccess",o=>o.value,"optionalAccess",o=>o.objectId])&&U([a,"optionalAccess",o=>o.value,"access",o=>o.className])==="Array"){const o=a.value.objectId;i(c=>this._unrollArray(o,a.name,c,s))}else if(U([a,"optionalAccess",o=>o.value,"optionalAccess",o=>o.objectId])&&U([a,"optionalAccess",o=>o.value,"optionalAccess",o=>o.className])==="Object"){const o=a.value.objectId;i(c=>this._unrollObject(o,a.name,c,s))}else U([a,"optionalAccess",o=>o.value])&&i(o=>this._unrollOther(a,o,s));s({})})}_getProperties(e,t){this._session.post("Runtime.getProperties",{objectId:e,ownProperties:!0},(r,i)=>{t(r?[]:i.result)})}_unrollArray(e,t,r,i){this._getProperties(e,s=>{r[t]=s.filter(a=>a.name!=="length"&&!isNaN(parseInt(a.name,10))).sort((a,o)=>parseInt(a.name,10)-parseInt(o.name,10)).map(a=>U([a,"optionalAccess",o=>o.value,"optionalAccess",o=>o.value])),i(r)})}_unrollObject(e,t,r,i){this._getProperties(e,s=>{r[t]=s.map(a=>[a.name,U([a,"optionalAccess",o=>o.value,"optionalAccess",o=>o.value])]).reduce((a,[o,c])=>(a[o]=c,a),{}),i(r)})}_unrollOther(e,t,r){e.value&&("value"in e.value?e.value.value===void 0||e.value.value===null?t[e.name]=`<${e.value.value}>`:t[e.name]=e.value.value:"description"in e.value&&e.value.type!=="function"?t[e.name]=`<${e.value.description}>`:e.value.type==="undefined"&&(t[e.name]="<undefined>")),r(t)}}const NN="LocalVariables",LN=(n={},e)=>{const t=new en(20);let r,i=!1;function s(o){const c=Jm(U([o,"optionalAccess",d=>d.stacktrace,"optionalAccess",d=>d.frames]));if(c===void 0)return;const u=t.remove(c);if(u===void 0)return;const l=(U([o,"access",d=>d.stacktrace,"optionalAccess",d=>d.frames])||[]).filter(d=>d.function!=="new Promise");for(let d=0;d<l.length;d++){const f=l.length-d-1,p=u[d],h=l[f];if(!h||!p)break;p.vars===void 0||h.in_app===!1||!Km(h.function,p.function)||(h.vars=p.vars)}}function a(o){for(const c of U([o,"optionalAccess",u=>u.exception,"optionalAccess",u=>u.values])||[])s(c);return o}return{name:NN,async setupOnce(){const o=Q(),c=U([o,"optionalAccess",l=>l.getOptions,"call",l=>l()]);if(!U([c,"optionalAccess",l=>l.includeLocalVariables]))return;if(ON<18){w.log("The `LocalVariables` integration is only supported on Node >= v18.");return}if(await Ym()){w.warn("Local variables capture has been disabled because the debugger was already enabled");return}Gu.create(e).then(l=>{function d(p,{params:{reason:h,data:m,callFrames:g}},y){if(h!=="exception"&&h!=="promiseRejection"){y();return}U([r,"optionalCall",v=>v()]);const E=CN(p,U([m,"optionalAccess",v=>v.description]));if(E==null){y();return}const{add:b,next:S}=Qm(v=>{t.set(E,v),y()});for(let v=0;v<Math.min(g.length,5);v++){const{scopeChain:D,functionName:H,this:Te}=g[v],be=D.find(le=>le.type==="local"),ce=Te.className==="global"||!Te.className?H:`${Te.className}.${H}`;if(U([be,"optionalAccess",le=>le.object,"access",le=>le.objectId])===void 0)b(le=>{le[v]={function:ce},S(le)});else{const le=be.object.objectId;b(qe=>U([l,"optionalAccess",pt=>pt.getLocalVariables,"call",pt=>pt(le,O=>{qe[v]={function:ce,vars:O},S(qe)})]))}}S([])}const f=n.captureAllExceptions!==!1;if(l.configureAndConnect((p,h)=>d(c.stackParser,p,h),f),f){const p=n.maxExceptionsPerSecond||50;r=RN(p,()=>{w.log("Local variables rate-limit lifted."),U([l,"optionalAccess",h=>h.setPauseOnExceptions,"call",h=>h(!0)])},h=>{w.log(`Local variables rate-limit exceeded. Disabling capturing of caught exceptions for ${h} seconds.`),U([l,"optionalAccess",m=>m.setPauseOnExceptions,"call",m=>m(!1)])})}i=!0},l=>{w.log("The `LocalVariables` integration failed to start.",l)})},processEvent(o){return i?a(o):o},_getCachedFramesCount(){return t.size},_getFirstCachedFrame(){return t.values()[0]}}},xN=LN,$N=(n={})=>Xm.major<19?xN(n):PN(n),MN=2e3;function kN(n){Jt(()=>{console.error(n)});const e=Q();if(e===void 0){ot&&w.warn("No NodeClient was defined, we are exiting the process now."),global.process.exit(1);return}const t=e.getOptions(),r=t&&t.shutdownTimeout&&t.shutdownTimeout>0&&t.shutdownTimeout||MN;e.close(r).then(i=>{i||ot&&w.warn("We reached the timeout for emptying the request buffer, still exiting now!"),global.process.exit(1)},i=>{ot&&w.error(i)})}const DN="OnUnhandledRejection",FN=(n={})=>{const e=n.mode||"warn";return{name:DN,setup(t){global.process.on("unhandledRejection",UN(t,{mode:e}))}}},jN=FN;function UN(n,e){return function(r,i){Q()===n&&(Ds(r,{originalException:i,captureContext:{extra:{unhandledPromiseRejection:!0}},mechanism:{handled:!1,type:"onunhandledrejection"}}),BN(r,e))}}function BN(n,e){const t="This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). The promise rejected with the reason:";e.mode==="warn"?Jt(()=>{console.warn(t),console.error(n&&typeof n=="object"&&"stack"in n?n.stack:n)}):e.mode==="strict"&&(Jt(()=>{console.warn(t)}),kN(n))}var eg={},sa={},fi={};Object.defineProperty(fi,"__esModule",{value:!0});fi.AbstractAsyncHooksContextManager=void 0;const GN=h_,HN=["addListener","on","once","prependListener","prependOnceListener"];class WN{constructor(){this._kOtListeners=Symbol("OtListeners"),this._wrapped=!1}bind(e,t){return t instanceof GN.EventEmitter?this._bindEventEmitter(e,t):typeof t=="function"?this._bindFunction(e,t):t}_bindFunction(e,t){const r=this,i=function(...s){return r.with(e,()=>t.apply(this,s))};return Object.defineProperty(i,"length",{enumerable:!1,configurable:!0,writable:!1,value:t.length}),i}_bindEventEmitter(e,t){return this._getPatchMap(t)!==void 0||(this._createPatchMap(t),HN.forEach(i=>{t[i]!==void 0&&(t[i]=this._patchAddListener(t,t[i],e))}),typeof t.removeListener=="function"&&(t.removeListener=this._patchRemoveListener(t,t.removeListener)),typeof t.off=="function"&&(t.off=this._patchRemoveListener(t,t.off)),typeof t.removeAllListeners=="function"&&(t.removeAllListeners=this._patchRemoveAllListeners(t,t.removeAllListeners))),t}_patchRemoveListener(e,t){const r=this;return function(i,s){var a;const o=(a=r._getPatchMap(e))===null||a===void 0?void 0:a[i];if(o===void 0)return t.call(this,i,s);const c=o.get(s);return t.call(this,i,c||s)}}_patchRemoveAllListeners(e,t){const r=this;return function(i){const s=r._getPatchMap(e);return s!==void 0&&(arguments.length===0?r._createPatchMap(e):s[i]!==void 0&&delete s[i]),t.apply(this,arguments)}}_patchAddListener(e,t,r){const i=this;return function(s,a){if(i._wrapped)return t.call(this,s,a);let o=i._getPatchMap(e);o===void 0&&(o=i._createPatchMap(e));let c=o[s];c===void 0&&(c=new WeakMap,o[s]=c);const u=i.bind(r,a);c.set(a,u),i._wrapped=!0;try{return t.call(this,s,u)}finally{i._wrapped=!1}}}_createPatchMap(e){const t=Object.create(null);return e[this._kOtListeners]=t,t}_getPatchMap(e){return e[this._kOtListeners]}}fi.AbstractAsyncHooksContextManager=WN;Object.defineProperty(sa,"__esModule",{value:!0});sa.AsyncHooksContextManager=void 0;const VN=du,zN=lp,qN=fi;class ZN extends qN.AbstractAsyncHooksContextManager{constructor(){super(),this._contexts=new Map,this._stack=[],this._asyncHook=zN.createHook({init:this._init.bind(this),before:this._before.bind(this),after:this._after.bind(this),destroy:this._destroy.bind(this),promiseResolve:this._destroy.bind(this)})}active(){var e;return(e=this._stack[this._stack.length-1])!==null&&e!==void 0?e:VN.ROOT_CONTEXT}with(e,t,r,...i){this._enterContext(e);try{return t.call(r,...i)}finally{this._exitContext()}}enable(){return this._asyncHook.enable(),this}disable(){return this._asyncHook.disable(),this._contexts.clear(),this._stack=[],this}_init(e,t){if(t==="TIMERWRAP")return;const r=this._stack[this._stack.length-1];r!==void 0&&this._contexts.set(e,r)}_destroy(e){this._contexts.delete(e)}_before(e){const t=this._contexts.get(e);t!==void 0&&this._enterContext(t)}_after(){this._exitContext()}_enterContext(e){this._stack.push(e)}_exitContext(){this._stack.pop()}}sa.AsyncHooksContextManager=ZN;var aa={};Object.defineProperty(aa,"__esModule",{value:!0});aa.AsyncLocalStorageContextManager=void 0;const XN=du,YN=lp,KN=fi;class JN extends KN.AbstractAsyncHooksContextManager{constructor(){super(),this._asyncLocalStorage=new YN.AsyncLocalStorage}active(){var e;return(e=this._asyncLocalStorage.getStore())!==null&&e!==void 0?e:XN.ROOT_CONTEXT}with(e,t,r,...i){const s=r==null?t:t.bind(r);return this._asyncLocalStorage.run(e,s,...i)}enable(){return this}disable(){return this._asyncLocalStorage.disable(),this}}aa.AsyncLocalStorageContextManager=JN;(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.AsyncLocalStorageContextManager=n.AsyncHooksContextManager=void 0;var e=sa;Object.defineProperty(n,"AsyncHooksContextManager",{enumerable:!0,get:function(){return e.AsyncHooksContextManager}});var t=aa;Object.defineProperty(n,"AsyncLocalStorageContextManager",{enumerable:!0,get:function(){return t.AsyncLocalStorageContextManager}})})(eg);const QN=_1(eg.AsyncLocalStorageContextManager);function hf(n){return n.replace(/^[A-Z]:/,"").replace(/\\/g,"/")}function tg(n=process.argv[1]?Cv(process.argv[1]):process.cwd(),e=Kt.sep==="\\"){const t=e?hf(n):n;return r=>{if(!r)return;const i=e?hf(r):r;let{dir:s,base:a,ext:o}=Kt.posix.parse(i);(o===".js"||o===".mjs"||o===".cjs")&&(a=a.slice(0,o.length*-1));const c=decodeURIComponent(a);s||(s=".");const u=s.lastIndexOf("/node_modules");if(u>-1)return`${s.slice(u+14).replace(/\//g,".")}:${c}`;if(s.startsWith(t)){const l=s.slice(t.length+1).replace(/\//g,".");return l?`${l}:${c}`:c}return c}}const eL=6e4;class tL extends Gb{constructor(e){const t={...e,platform:"node",runtime:{name:"node",version:global.process.version},serverName:e.serverName||global.process.env.SENTRY_NAME||Ge.hostname()};e.openTelemetryInstrumentations&&vu({instrumentations:e.openTelemetryInstrumentations}),Jb(t,"node"),w.log(`Initializing Sentry: process: ${process.pid}, thread: ${Co.isMainThread?"main":`worker-${Co.threadId}`}.`),super(t)}get tracer(){if(this._tracer)return this._tracer;const e="@sentry/node",t=vt,r=K.getTracer(e,t);return this._tracer=r,r}async flush(e){const t=this.traceProvider,r=U([t,"optionalAccess",i=>i.activeSpanProcessor]);return r&&await r.forceFlush(),this.getOptions().sendClientReports&&this._flushOutcomes(),super.flush(e)}close(e){return this._clientReportInterval&&clearInterval(this._clientReportInterval),this._clientReportOnExitFlushListener&&process.off("beforeExit",this._clientReportOnExitFlushListener),super.close(e)}startClientReportTracking(){const e=this.getOptions();e.sendClientReports&&(this._clientReportOnExitFlushListener=()=>{this._flushOutcomes()},this._clientReportInterval=setInterval(()=>{ot&&w.log("Flushing client reports based on interval."),this._flushOutcomes()},fE(e.clientReportFlushInterval,()=>eL)).unref(),process.on("beforeExit",this._clientReportOnExitFlushListener))}_getTraceInfoFromScope(e){return e?p1(this,e):[void 0,void 0]}}const oo=1e6;function nL(n,e={}){n.getOptions().debug&&sL();const t=rL(n,e);n.traceProvider=t}function rL(n,e={}){const t=new jC({sampler:new $1(n),resource:new oc({[AI]:"node",[SI]:"sentry",[OI]:vt}),forceFlushTimeoutMillis:500,spanProcessors:[new x1({timeout:iL(n.getOptions().maxSpanWaitDuration)}),...e.spanProcessors||[]]});return t.register({propagator:new n1,contextManager:new QN}),t}function iL(n){if(n!=null){if(n>oo)return ot&&w.warn(`\`maxSpanWaitDuration\` is too high, using the maximum value of ${oo}`),oo;if(n<=0||Number.isNaN(n)){ot&&w.warn("`maxSpanWaitDuration` must be a positive number, using default value instead.");return}return n}}function sL(){const n=new Proxy(w,{get(e,t,r){return Reflect.get(e,t==="verbose"?"debug":t,r)}});G.disable(),G.setLogger(n,de.DEBUG)}let Mr;function ng(){if(Mr)return;const n=Mr=new Map;function e(r,i){const s=n.get(r)||{id:r};s.url=yt(i,_.app.getAppPath()),n.set(r,s)}function t(r,i){const s=n.get(r)||{id:r};s.title=i,n.set(r,s)}_.app.on("web-contents-created",(r,i)=>{const s=i.id;i.on("did-navigate",(a,o)=>e(s,o)),i.on("did-navigate-in-page",(a,o)=>e(s,o)),i.on("page-title-updated",(a,o)=>t(s,o)),i.on("destroyed",()=>{setTimeout(()=>{n.delete(s)},5e3)})})}function rg(n){return Mr==null?void 0:Mr.get(n)}const aL={app:n=>!n.startsWith("remote-"),autoUpdater:()=>!0,webContents:n=>["dom-ready","context-menu","load-url","destroyed"].includes(n),browserWindow:n=>["closed","close","unresponsive","responsive","show","blur","focus","hide","maximize","minimize","restore","enter-full-screen","leave-full-screen"].includes(n),screen:()=>!0,powerMonitor:()=>!0,captureWindowTitles:!1};function oL(n){return Object.keys(n).reduce((e,t)=>{if(t==="captureWindowTitles")e[t]=!!n[t];else{const r=n[t];Array.isArray(r)?e[t]=i=>r.includes(i):(typeof r=="function"||r===!1)&&(e[t]=r)}return e},{})}const cL=(n={})=>{const e={...aL,...oL(n)};function t(r,i,s,a){const o=r.emit.bind(r);r.emit=(c,...u)=>{var l,d;if(s&&s(c)){const f={category:"electron",message:`${i}.${c}`,timestamp:new Date().getTime()/1e3,type:"ui"};a&&(f.data={...rg(a)},!e.captureWindowTitles&&((l=f.data)!=null&&l.title)&&((d=f.data)==null||delete d.title)),tr(f)}return o(c,...u)}}return{name:"ElectronBreadcrumbs",setup(r){const i=r.getOptions();ng(),_.app.whenReady().then(()=>{e.screen&&t(_.screen,"screen",e.screen),e.powerMonitor&&t(_.powerMonitor,"powerMonitor",e.powerMonitor)},()=>{}),e.app&&t(_.app,"app",e.app),e.autoUpdater&&t(_.autoUpdater,"autoUpdater",e.autoUpdater),e.browserWindow&&_.app.on("browser-window-created",(s,a)=>{var u;const o=a.webContents.id,c=((u=i==null?void 0:i.getRendererName)==null?void 0:u.call(i,a.webContents))||"window";t(a,c,e.browserWindow,o)}),e.webContents&&_.app.on("web-contents-created",(s,a)=>{var u;const o=a.id,c=((u=i==null?void 0:i.getRendererName)==null?void 0:u.call(i,a))||"renderer";t(a,c,e.webContents,o)})}}},uL=()=>({name:"OnUncaughtException",setup(n){const e=n.getOptions();global.process.on("uncaughtException",t=>{Ds(t,{originalException:t,captureContext:{level:"fatal"},data:{mechanism:{handled:!1,type:"generic"}}}),n.flush(e.shutdownTimeout||2e3).then(()=>{if(e!=null&&e.onFatalError)e.onFatalError(t);else if(global.process.listenerCount("uncaughtException")<=2){console.error("Uncaught Exception:"),console.error(t);const r=t.stack,s=`Uncaught Exception:
${r!==void 0?r:`${t.name}: ${t.message}`}`;_.dialog.showErrorBox("A JavaScript error occurred in the main process",s)}},()=>{})})}});function Qi(){const n=Uc().getScopeData(),e=Me().getScopeData(),t=re().getScopeData();return us(n,e),us(n,t),n.eventProcessors=[],n}function lL(n){Me().addScopeListener(e=>{const t=Qi();n(t,e)}),re().addScopeListener(e=>{const t=Qi();n(t,e)}),Uc().addScopeListener(e=>{const t=Qi();n(t,e)})}const mf="5.11.0",dL="sentry.javascript.electron";function fL(){return{name:dL,packages:[{name:"npm:@sentry/electron",version:mf}],version:mf}}function Hu(){return`${(_.app.name||_.app.getName()).replace(/\W/g,"-")}@${_.app.getVersion()}`}function Wu(){return _.app.isPackaged?"production":"development"}async function pL(n){let e={message:"test"};const t={};for(const r of n.getEventProcessors()){if(e===null)break;e=await r(e,t)}return e==null||delete e.message,e||{}}var sr;(function(n){n[n.Classic=1]="Classic",n[n.Protocol=2]="Protocol",n[n.Both=3]="Both"})(sr||(sr={}));const qt="sentry-ipc";var je;(function(n){n.RENDERER_START="sentry-electron.renderer-start",n.EVENT="sentry-electron.event",n.SCOPE="sentry-electron.scope",n.ENVELOPE="sentry-electron.envelope",n.STATUS="sentry-electron.status",n.ADD_METRIC="sentry-electron.add-metric"})(je||(je={}));const gf="sentry-electron-renderer-id",ig="__sentry_message_port_message__";function _f(n){return!!(n&&typeof n=="object"&&ig in n)}function hL(){return{[ig]:!0}}const co=Sp(process.versions.electron),sg={major:co.major||0,minor:co.minor||0,patch:co.patch||0},mc=["clean-exit","abnormal-exit","killed","crashed","oom","launch-failed","integrity-failure"];function Vu(){return X.join(_.app.getPath("userData"),"sentry")}function mL(){return sg.major>=16?!0:_.app.commandLine.hasSwitch("enable-crashpad")}function gc(){return process.platform!=="linux"||mL()}function gL(){return sg.major>=25}function _L(n,e,t){gL()?n.handle(e,async r=>(t({windowId:r.headers.get(gf)||void 0,url:r.url,body:Buffer.from(await r.arrayBuffer())}),new Response(""))):n.registerStringProtocol(e,(r,i)=>{var s,a;t({windowId:r.headers[gf],url:r.url,body:(a=(s=r.uploadData)==null?void 0:s[0])==null?void 0:a.bytes}),i("")})}class ag{constructor(){this._entries=[],this._waiters=[],this._value=1}async runExclusive(e){const t=await this._acquire();try{return await e()}finally{t()}}_acquire(){return new Promise((e,t)=>{this._entries.push({resolve:e,reject:t}),this._dispatch()})}_release(){this._value+=1,this._dispatch()}_dispatch(){var e;for(let t=this._value;t>0;t--){const r=(e=this._entries)==null?void 0:e.shift();r&&(this._value-=t,t=this._value+1,r.resolve(this._newReleaser()))}this._drainUnlockWaiters()}_newReleaser(){let e=!1;return()=>{e||(e=!0,this._release())}}_drainUnlockWaiters(){for(let e=this._value;e>0;e--)this._waiters[e-1]&&(this._waiters.forEach(t=>t()),this._waiters=[])}}const yL=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}\.*\d{0,10}Z$/;function bL(n,e){return typeof e=="string"&&yL.test(e)?new Date(e):e}class zu{constructor(e,t,r){this._lock=new ag,this._path=X.join(e,`${t}.json`),this._initial=r}async set(e){await this._lock.runExclusive(async()=>{this._data=e;try{if(e===void 0)try{await oe.promises.unlink(this._path)}catch{}else await oe.promises.mkdir(X.dirname(this._path),{recursive:!0}),await oe.promises.writeFile(this._path,JSON.stringify(e))}catch(t){w.warn("Failed to write to store",t)}})}async get(){return this._lock.runExclusive(async()=>{if(this._data===void 0)try{this._data=JSON.parse(await oe.promises.readFile(this._path,"utf8"),bL)}catch{this._data=this._initial}return this._data})}async update(e){await this.set(e(await this.get()))}async clear(){await this.set(this._initial)}async getModifiedDate(){var e;try{return(e=await oe.promises.stat(this._path))==null?void 0:e.mtime}catch{return}}}class vL extends zu{constructor(e,t,r,i=500){super(e,t,r),this._throttleTime=i}async set(e){var t;this._data=e,this._pendingWrite={data:e,timeout:((t=this._pendingWrite)==null?void 0:t.timeout)||setTimeout(()=>this._writePending(),this._throttleTime)}}_writePending(){if(this._pendingWrite){const e=this._pendingWrite.data;this._pendingWrite=void 0,super.set(e).catch(()=>{})}}}const EL=6e4;let Bi,qn;function _c(){return Bi||(Bi=new zu(Vu(),"session",void 0),qn=Bi.get().then(n=>n&&Cs(n))),Bi}function yf(n){const e={...n};return delete e.toJSON,e}let Vr;function wL(n){const e=vb();n&&Kp(),_c().set(yf(e)).catch(()=>{}),Vr=setInterval(async()=>{const t=re().getSession();t&&t.status==="ok"&&await _c().set(yf(t))},EL)}async function SL(){Vr&&clearInterval(Vr);const n=re().getSession();n?n.status==="ok"?(w.log("Ending session"),Kc()):w.log("Session was already ended"):w.log("No session"),await _c().clear(),await yb(2e3)}async function TL(){const n=await qn,e=re(),t=e.getSession();return n&&(qn=void 0,n.status==="ok"&&e.setSession(Cs(n))),t}function AL(n){re().setSession(n)}async function OL(){var t,r;const n=Q(),e=await qn;if(e&&n){if(e.status!=="ok"){qn=void 0;return}w.log("Found previous abnormal session");const i=Cs(e);Qt(i,{status:"abnormal",errors:(i.errors||0)+1,release:(t=e.attrs)==null?void 0:t.release,environment:(r=e.attrs)==null?void 0:r.environment}),await n.sendSession(i),qn=void 0}}function RL(){Vr&&clearInterval(Vr);const n=re().getSession();n&&n.status==="ok"&&(w.log("Setting session as abnormal ANR"),Qt(n,{status:"abnormal",abnormal_mechanism:"anr_foreground"}),Kp())}function IL(){_.app.on("before-quit",()=>{_.app.removeListener("will-quit",bf),_.app.on("will-quit",bf)})}const bf=async n=>{if(!n.defaultPrevented){w.log("[Session] Exit Handler"),n.preventDefault();try{await SL()}catch(e){w.warn("[Session] Error ending session:",e)}_.app.exit()}},vf=30,PL=24*3600*1e3,Ef=1e3,CL=5e3,og=500,wf=CL/og,cg="MDMP";function NL(n){return new Promise(e=>setTimeout(e,n))}function ug(n,e=t=>t){const t=new ag;return async(r,i)=>{await t.runExclusive(async()=>{for(const s of await n())try{if(r)continue;w.log("Found minidump",s);let a=await oe.promises.stat(s);const o=new Date().getTime()-vf*PL;if(a.mtimeMs<o){w.log(`Ignoring minidump as it is over ${vf} days old`);continue}let c=0;for(;c<=wf;){const u=new Date().getTime()-Ef;if(a.mtimeMs<u){const l=await oe.promises.readFile(s),d=e(l);if(d.length<1e4||d.subarray(0,4).toString()!==cg){w.warn("Dropping minidump as it appears invalid.");break}const f=FL(d);w.log("Sending minidump"),await i(f,{attachmentType:"event.minidump",filename:Nv(s),data:d});break}w.log(`Waiting. Minidump has been modified in the last ${Ef} milliseconds.`),c+=1,await NL(og),a=await oe.promises.stat(s)}c>=wf&&w.warn("Timed out waiting for minidump to stop being modified")}catch(a){w.error("Failed to load minidump",a)}finally{try{await oe.promises.unlink(s)}catch{w.warn("Could not delete minidump",s)}}})}}async function lg(n,e=100){if(e>2e3)return;const t=X.join(n,"metadata");try{await oe.promises.unlink(t),w.log("Deleted Crashpad metadata file",t)}catch(r){r.code&&r.code=="EBUSY"&&setTimeout(async()=>{await lg(n,e*2)},e)}}async function LL(n){const e=[];for(const t of n)try{const r=await oe.promises.readdir(t);e.push(...r.map(i=>X.join(t,i)))}catch{}return e}function xL(){const n=_.app.getPath("crashDumps"),e=process.platform==="win32"?"reports":"completed",t=[X.join(n,e)];return process.platform==="darwin"&&t.push(X.join(n,"pending")),ug(async()=>(await lg(n).catch(i=>w.error(i)),(await LL(t)).filter(i=>i.endsWith(".dmp"))))}function $L(n){const e=n.lastIndexOf("Content-Type: application/octet-stream");if(e>0){const t=n.indexOf(cg,e),r=n.lastIndexOf("----------------------------");if(t>0&&r>0&&r>t)return n.subarray(t,r)}return n}function ML(n,e){Promise.all(e.filter(t=>t.endsWith(".txt")&&!t.endsWith("log.txt")).map(async t=>{const r=X.join(n,t);try{await oe.promises.unlink(r)}catch{w.warn("Could not delete",r)}})).catch(()=>{})}function kL(){const n=_.app.getPath("crashDumps");return ug(async()=>{const e=await oe.promises.readdir(n);return ML(n,e),e.filter(t=>t.endsWith(".dmp")).map(t=>X.join(n,t))},$L)}function DL(){return gc()?xL():kL()}function FL(n){const e=n.indexOf("process_type");if(e<0)return;let t=e+12;for(;(n[t]||0)<32;)if(t++,t-e>20)return;let r=t;for(;(n[r]||-1)>=32;)if(r++,r-t>20)return;const i=n.subarray(t,r).toString().replace("-process","");return i==="gpu"?"GPU":i}const jL=(n={})=>{let e=n.maxMinidumpsPerSession||10,t,r,i;function s(){w.log("Starting Electron crashReporter"),_.crashReporter.start({companyName:"",ignoreSystemCrashHandler:!0,productName:_.app.name||_.app.getName(),submitURL:"https://f.a.k/e",uploadToServer:!1,compress:!0})}function a(l){function d(f){setImmediate(async()=>t==null?void 0:t.set({scope:f,event:await pL(l)}))}lL(f=>{d(f)}),d(Qi())}async function o(l,d){e<=0&&w.log("Not sending minidumps because the limit has been reached");const f=l.getOptions().enabled===!1||e<=0;let p=!1;return await(i==null?void 0:i(f,async(h,m)=>{p=!0;const g=await d(h);e>0&&(e-=1,ri(g,{attachments:[m]}))})),p}async function c(l,d,f,p){const{getRendererName:h}=d;await o(l,m=>{var y;const g=(m==="renderer"&&h?h(f):m)||(gc()?"unknown":"renderer");return w.log(`'${g}' process '${p.reason}'`),{contexts:{electron:{crashed_url:((y=rg(f.id))==null?void 0:y.url)||"unknown",details:p}},level:"fatal",platform:"native",tags:{"event.environment":"native","event.process":g,"exit.reason":p.reason}}})}async function u(l,d){w.log(`${d.type} process has ${d.reason}`),await o(l,f=>({contexts:{electron:{details:d}},level:"fatal",platform:"native",tags:{"event.environment":"native","event.process":f||d.type,"exit.reason":d.reason,event_type:"native"}}))}return{name:"SentryMinidump",setup(l){if(process.mas)return;s(),t=new vL(Vu(),"scope_v3",{scope:new jt().getScopeData()}),r=t.get(),i=DL();const d=l.getOptions();if(a(l),!(d!=null&&d.dsn))throw new Qe("Attempted to enable Electron native crash reporter but no DSN was supplied");ng(),_.app.on("render-process-gone",async(p,h,m)=>{mc.includes(m.reason)&&await c(l,d,h,m)}),_.app.on("child-process-gone",async(p,h)=>{mc.includes(h.reason)&&await u(l,h)});let f;o(l,async p=>{var g,y,E;const h={level:"fatal",platform:"native",tags:{"event.environment":"native","event.process":p||(gc()?"unknown":"browser")}},m=await r;return m&&(m.scope&&Xp(h,m.scope),h.release=(g=m.event)==null?void 0:g.release,h.environment=(y=m.event)==null?void 0:y.environment,h.contexts=(E=m.event)==null?void 0:E.contexts),f=await TL(),h}).then(async p=>{p?f&&AL(f):await OL()}).catch(p=>w.error(p))}}};var UL=function(e){return BL(e)&&!GL(e)};function BL(n){return!!n&&typeof n=="object"}function GL(n){var e=Object.prototype.toString.call(n);return e==="[object RegExp]"||e==="[object Date]"||VL(n)}var HL=typeof Symbol=="function"&&Symbol.for,WL=HL?Symbol.for("react.element"):60103;function VL(n){return n.$$typeof===WL}function zL(n){return Array.isArray(n)?[]:{}}function zr(n,e){return e.clone!==!1&&e.isMergeableObject(n)?ar(zL(n),n,e):n}function qL(n,e,t){return n.concat(e).map(function(r){return zr(r,t)})}function ZL(n,e){if(!e.customMerge)return ar;var t=e.customMerge(n);return typeof t=="function"?t:ar}function XL(n){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(n).filter(function(e){return Object.propertyIsEnumerable.call(n,e)}):[]}function Sf(n){return Object.keys(n).concat(XL(n))}function dg(n,e){try{return e in n}catch{return!1}}function YL(n,e){return dg(n,e)&&!(Object.hasOwnProperty.call(n,e)&&Object.propertyIsEnumerable.call(n,e))}function KL(n,e,t){var r={};return t.isMergeableObject(n)&&Sf(n).forEach(function(i){r[i]=zr(n[i],t)}),Sf(e).forEach(function(i){YL(n,i)||(dg(n,i)&&t.isMergeableObject(e[i])?r[i]=ZL(i,t)(n[i],e[i],t):r[i]=zr(e[i],t))}),r}function ar(n,e,t){t=t||{},t.arrayMerge=t.arrayMerge||qL,t.isMergeableObject=t.isMergeableObject||UL,t.cloneUnlessOtherwiseSpecified=zr;var r=Array.isArray(e),i=Array.isArray(n),s=r===i;return s?r?t.arrayMerge(n,e,t):KL(n,e,t):zr(e,t)}ar.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(r,i){return ar(r,i,t)},{})};var JL=ar,QL=JL;const ex=Ws(QL);function tx(n){var e,t;(e=n.sdkProcessingMetadata)==null||delete e.capturedSpanScope,(t=n.sdkProcessingMetadata)==null||delete t.capturedSpanIsolationScope;for(const r of n.spans||[])delete r.spanRecorder}function oa(n,e){tx(e);const t=ex(n,e);return(e.spans||n.spans)&&(t.spans=e.spans||n.spans),{...t,sdk:{...n.sdk,...e.sdk}}}function nx(n,e){var r,i,s,a,o,c;for(const u of((r=n.exception)==null?void 0:r.values)||[])for(const l of((i=u.stacktrace)==null?void 0:i.frames)||[])l.filename&&(l.filename=yt(l.filename,e));for(const u of((s=n.debug_meta)==null?void 0:s.images)||[])u.type==="sourcemap"&&(u.code_file=yt(u.code_file,e));n.transaction&&(n.transaction=yt(n.transaction,e));const{request:t={}}=n;if(t.url&&(t.url=yt(t.url,e)),(o=(a=n.contexts)==null?void 0:a.feedback)!=null&&o.url&&typeof n.contexts.feedback.url=="string"&&(n.contexts.feedback.url=yt(n.contexts.feedback.url,e)),n.spans)for(const u of n.spans)(c=u.description)!=null&&c.startsWith("file://")&&(u.description=yt(u.description,e));return n}function rx(n,e){let t=rn(n[0]),r=!1;return er(n,(i,s)=>{var a;if(s==="replay_event"){r=!0;const[o,c]=i,u=re().getScopeData();c.breadcrumbs=u.breadcrumbs,c.tags=u.tags,c.user=u.user,Array.isArray(c.urls)&&(c.urls=c.urls.map(l=>yt(l,e))),(a=c==null?void 0:c.request)!=null&&a.url&&(c.request.url=yt(c.request.url,e)),t=Uo(t,[o,c])}else s==="replay_recording"&&(t=Uo(t,i))}),r?t:n}function ix(n,e){for(const t of n.profile.frames)t.abs_path&&(t.abs_path=yt(t.abs_path,e))}function sx(){try{return require.resolve("../../preload/index.js")}catch{try{const e=Xr.fileURLToPath(typeof document>"u"?require("url").pathToFileURL(__filename).href:ga&&ga.tagName.toUpperCase()==="SCRIPT"&&ga.src||new URL("index.js",document.baseURI).href);return X.resolve(e,"..","..","..","..","preload","index.js")}catch{}}}const ax=()=>({name:"PreloadInjection",setup(n){const e=n.getOptions();e.ipcMode&sr.Classic&&_.app.once("ready",()=>{const t=sx();if(t&&typeof t=="string"&&X.isAbsolute(t)&&oe.existsSync(t))for(const r of e.getSessions()){const i=r.getPreloads();r.setPreloads([t,...i])}else w.log("The preload script could not be injected automatically. This is most likely caused by bundling of the main process")})}}),ox=(n={})=>({name:"MainProcessSession",setup(){wL(!!n.sendOnCreate),IL()}}),cx={screen:!0},ux=(n={})=>{const e={},t={...cx,...n};function r(){const i=_.screen.getPrimaryDisplay(),s=Math.floor(i.size.width*i.scaleFactor),a=Math.floor(i.size.height*i.scaleFactor);e.screen_density=i.scaleFactor,e.screen_resolution=`${s}x${a}`}return{name:"AdditionalContext",setup(){_.app.whenReady().then(()=>{const{screen:i}=t;i&&(r(),_.screen.on("display-metrics-changed",()=>{r()}))},()=>{})},processEvent(i){return oa(i,{contexts:{device:e}})}}};function lx(n){const{method:e,options:t}=typeof n=="string"?{method:"GET",options:_a.parse(n)}:{method:(n.method||"GET").toUpperCase(),options:n};let r="url"in t?t.url:void 0;if(!r){const i={};i.protocol=t.protocol||"http:",t.host?i.host=t.host:(t.hostname?i.hostname=t.hostname:i.hostname="localhost",t.port&&(i.port=t.port));const s=_a.parse(t.path||"/");i.pathname=s.pathname,i.search=s.search,i.hash=s.hash,r=_a.format(i)}return{method:e,url:r}}function Tf(n,e,t,r){w.log(`[Tracing] Adding sentry-trace header ${t} to outgoing request to "${e}": `),n.setHeader("sentry-trace",t);const i=xs(r);i&&n.setHeader("baggage",i)}function dx(n,e){const t=new en(100),r=new en(100),i=(a,o)=>{if(n.tracing===void 0)return!0;if(n.tracing===!1)return!1;const c=`${a}:${o}`,u=t.get(c);if(u!==void 0)return u;const l=n.tracing===!0||n.tracing(a,o);return t.set(c,l),l},s=(a,o)=>{const c=`${a}:${o}`,u=r.get(c);if(u!==void 0)return u;if(e){const l=lr(o,e);return r.set(c,l),l}return!0};return function(o){return function(u){const{url:l,method:d}=lx(u),f=o.apply(this,[u]);if(l.match(/sentry_key/)||f.getHeader("x-sentry-auth"))return f;const p=i(d,l)?Jy({name:`${d} ${l}`,onlyIfParent:!0,attributes:{url:l,type:"net.request","http.method":d},op:"http.client"}):new ti;if(p.setAttribute(Ut,"auto.http.electron.net"),s(d,l)){const{traceId:h,spanId:m,sampled:g,dsc:y}={...Me().getPropagationContext(),...re().getPropagationContext()};if(p.isRecording()){const E=Cp(p),b=y||Ve(p);Tf(f,l,E,b)}else{const E=Qr(h,m,g),b=Q(),S=y||(b?qc(h,b):void 0);Tf(f,l,E,S)}}return f.once("response",function(h){n.breadcrumbs!==!1&&Af("response",d,l,this,h),h.statusCode&&gl(p,h.statusCode),p.end()}).once("error",function(h){n.breadcrumbs!==!1&&Af("error",d,l,this,void 0),gl(p,500),p.end()})}}}function Af(n,e,t,r,i){tr({type:"http",category:"electron.net",data:{url:t,method:e,status_code:i==null?void 0:i.statusCode},level:uh(i==null?void 0:i.statusCode)},{event:n,request:r,response:i})}const fx=(n={})=>({name:"ElectronNet",setup(){var t;const e=(t=Q())==null?void 0:t.getOptions();n.breadcrumbs===!1&&n.tracing===!1||bp(_.net,"request",dx(n,e==null?void 0:e.tracePropagationTargets))}}),Of={breadcrumbs:mc,events:["abnormal-exit","launch-failed","integrity-failure"]};function Gi(n,e){const t=`'${e}' process exited with '${n}'`;switch(n){case"abnormal-exit":case"killed":return{message:t,level:"warning"};case"crashed":case"oom":case"launch-failed":case"integrity-failure":return{message:t,level:"fatal"};default:return{message:t,level:"debug"}}}const px=(n={})=>{const{breadcrumbs:e,events:t}=n,r={breadcrumbs:Array.isArray(e)?e:e===!1?[]:Of.breadcrumbs,events:Array.isArray(t)?t:t===!1?[]:Of.events};return{name:"ChildProcess",setup(i){const{breadcrumbs:s,events:a}=r;if(Array.from(new Set([...s,...a])).length>0){const c=i.getOptions();_.app.on("child-process-gone",(u,l)=>{const{reason:d}=l;if(a.includes(d)){const{message:f,level:p}=Gi(l.reason,l.type);Pl(f,{level:p,tags:{"event.process":l.type}})}s.includes(d)&&tr({type:"process",category:"child-process",...Gi(l.reason,l.type),data:l})}),_.app.on("render-process-gone",(u,l,d)=>{var h;const{reason:f}=d,p=((h=c==null?void 0:c.getRendererName)==null?void 0:h.call(c,l))||"renderer";if(a.includes(f)){const{message:m,level:g}=Gi(d.reason,p);Pl(m,g)}s.includes(f)&&tr({type:"process",category:"child-process",...Gi(d.reason,p),data:d})})}}}},Rf=()=>({name:"Screenshots",async processEvent(n,e,t){if(!!!t.getOptions().attachScreenshot)return n;if(!n.transaction&&n.platform!=="native"){let i=1;for(const s of _.BrowserWindow.getAllWindows()){e.attachments||(e.attachments=[]);try{if(!s.isDestroyed()&&s.isVisible()){const a=i===1?"screenshot.png":`screenshot-${i}.png`,o=await s.capturePage();e.attachments.push({filename:a,data:o.toPNG(),contentType:"image/png"}),i+=1}}catch(a){w.error("Error capturing screenshot",a)}}}return n}}),Hi="Document-Policy",uo="js-profiling";let Un;function hx(n,e){if(!Un)return;const t=e.event_id;Un.set(t,e),n&&(n.contexts={...n.contexts,profile:{profile_id:t}})}function mx(n={}){if(n[Hi]){const e=n[Hi];Array.isArray(e)?e.push(uo):n[Hi]=[e,uo]}else n[Hi]=uo;return{responseHeaders:n}}const gx=()=>({name:"RendererProfiling",setup(n){var t;const e=n.getOptions();e.enableRendererProfiling&&(Un=new en(10),_.app.on("ready",()=>{for(const r of e.getSessions())r.webRequest.onHeadersReceived((i,s)=>{s(mx(i.responseHeaders))})}),(t=n.on)==null||t.call(n,"beforeEnvelope",r=>{let i;if(er(r,(a,o)=>{var c,u;if(o==="transaction")for(let l=1;l<a.length;l++){const d=a[l];(u=(c=d==null?void 0:d.contexts)==null?void 0:c.profile)!=null&&u.profile_id&&(i=d.contexts.profile.profile_id,delete d.contexts.profile)}}),!i)return;const s=Un==null?void 0:Un.remove(i);s&&(ix(s,_.app.getAppPath()),s.release=e.release||Hu(),s.environment=e.environment||Wu(),r[1].push([{type:"profile"},s]))}))}}),_x=()=>({name:"NormalizePaths",processEvent(n){return nx(n,_.app.getAppPath())}});function yx(){return _.app.getAppMetrics().reduce((n,e)=>n+e.memory.workingSetSize*1024,0)}const bx=()=>({name:"ElectronContext",processEvent(n,e,t){var a,o,c,u,l,d;delete n.server_name,(a=n.tags)==null||delete a.server_name,(o=n.contexts)==null||delete o.runtime,(u=(c=n.contexts)==null?void 0:c.app)==null||delete u.app_memory,(l=n.request)!=null&&l.headers&&delete n.request.headers["User-Agent"];const{release:r=Hu(),environment:i=Wu(),sendDefaultPii:s}=t.getOptions();return s===!0&&typeof((d=n.user)==null?void 0:d.ip_address)>"u"&&(n.user=n.user||{},n.user.ip_address=n.user.ip_address||"{{auto}}"),oa({contexts:{app:{app_name:_.app.name||_.app.getName(),app_version:_.app.getVersion(),build_type:process.mas?"app-store":process.windowsStore?"windows-store":void 0,app_memory:yx(),app_arch:process.arch},browser:{name:"Chrome"},chrome:{name:"Chrome",type:"runtime",version:process.versions.chrome},device:{family:"Desktop"},node:{name:"Node",type:"runtime",version:process.versions.node},runtime:{name:"Electron",version:process.versions.electron}},environment:i,release:r,tags:{"event.origin":"electron","event.environment":"javascript","event.process":"browser"}},n)}}),vx=1024*32;function Ex(n){return new d_.Readable({read(){this.push(n),this.push(null)}})}function wx(n){const{hostname:e,pathname:t,port:r,protocol:i,search:s}=new Xr.URL(n);return{method:"POST",hostname:e,path:`${t}${s}`,port:parseInt(r,10),protocol:i}}function Sx(n){return Xb(n,Tx(n.url,n.headers||{}))}function Tx(n,e){return e["Content-Type"]="application/x-sentry-envelope",function(r){return _.app.whenReady().then(()=>new Promise((i,s)=>{let a=Ex(r.body);const o={...e};r.body.length>vx&&(o["content-encoding"]="gzip",a=a.pipe(f_.createGzip()));const c=_.net.request(wx(n));for(const[u,l]of Object.entries(o))c.setHeader(u,l);c.on("response",u=>{u.on("error",s),u.on("data",()=>{}),u.on("end",()=>{});const l=u.headers["retry-after"]??null,d=u.headers["x-sentry-rate-limits"]??null;i({statusCode:u.statusCode,headers:ae({"retry-after":Array.isArray(l)?l[0]||null:l,"x-sentry-rate-limits":Array.isArray(d)?d[0]||null:d})})}),c.on("error",s),a.pipe(c)}))}}const Ax=864e5;function Ox(n,e){var r;const t=Date.now()-Ax*e;return(((r=n==null?void 0:n.date)==null?void 0:r.getTime())||0)<t}function Rx(n){const e=n[0];if(typeof e.sent_at=="string")return new Date(e.sent_at)}function Ix(n){function e(...c){w.log("[Offline Store]:",...c)}const t={maxAgeDays:n.maxAgeDays||30,maxQueueSize:n.maxQueueSize||30,queuePath:n.queuePath||X.join(Vu(),"queue")},r=new zu(t.queuePath,"queue-v2",[]);function i(c){oe.promises.unlink(X.join(t.queuePath,c)).catch(()=>{})}function s(c){for(;c[0]&&Ox(c[0],t.maxAgeDays);){const u=c.shift();e("Removing stale envelope",u),i(u.id)}}async function a(c,u,l){e(`${u}ing envelope into offline storage`);const d=We();try{const f=Gp(c);await oe.promises.mkdir(t.queuePath,{recursive:!0}),await oe.promises.writeFile(X.join(t.queuePath,d),f)}catch(f){e("Failed to save",f)}await r.update(f=>u==="push"&&(s(f),f.length>=t.maxQueueSize)?(i(d),f):(f[u]({id:d,date:l||Rx(c)||new Date}),f))}let o;return{push:async c=>{await a(c,"push")},unshift:async c=>{await a(c,"unshift",o)},shift:async()=>{e("Popping envelope from offline storage");let c;if(await r.update(u=>(s(u),c=u.shift(),u)),c)try{const u=await oe.promises.readFile(X.join(t.queuePath,c.id));return i(c.id),o=c.date,Zc(u)}catch(u){e("Failed to read",u)}}}}function Px(n){return e=>{const t=n(e);return{...t,send:async r=>{if(e.shouldSend===void 0||await e.shouldSend(r))return t.send(r);throw new Error("'shouldSend' callback returned false. Skipped sending.")}}}}function Cx(n=Sx){return e=>Kb(Px(n))({flushAtStartup:!0,createStore:Ix,...e})}function fg(n){let e;const t=[];let r;return er(n,(i,s)=>{if(s==="event"||s==="transaction"||s==="feedback")e=Array.isArray(i)?i[1]:void 0;else if(s==="attachment"){const[a,o]=i;t.push({filename:a.filename,attachmentType:a.attachment_type,contentType:a.content_type,data:o})}else s==="profile"&&(r=i[1])}),e?[e,t,r]:void 0}function Nx(n){var t,r;const e=(t=Q())==null?void 0:t.getOptions();return(r=e==null?void 0:e.getRendererName)==null?void 0:r.call(e,n)}function If(n,e,t){RL();const r=Nx(n)||"renderer",i={level:"error",exception:{values:[{type:"ApplicationNotResponding",value:`Application Not Responding for at least ${e} ms`,stacktrace:{frames:t},mechanism:{type:"ANR"}}]},tags:{"event.process":r}};ri(i)}function Lx(n,e){n.debugger.attach("1.3");const t=new Map,r=tg(_.app.getAppPath());return n.debugger.on("message",(i,s,a)=>{if(s==="Debugger.scriptParsed"){const o=a;t.set(o.scriptId,o.url)}else if(s==="Debugger.paused"){const o=a;if(o.reason!=="other")return;const c=[...o.callFrames];n.debugger.sendCommand("Debugger.resume").then(null,()=>{});const u=mp(c.map(l=>dE(l,t.get(l.location.scriptId),r)));e(u)}}),n.debugger.sendCommand("Debugger.enable").catch(()=>{}),()=>n.debugger.sendCommand("Debugger.pause")}let cn;function xx(){let n=process.hrtime();return{getTimeMs:()=>{const[e,t]=process.hrtime(n);return Math.floor(e*1e3+t/1e6)},reset:()=>{n=process.hrtime()}}}function pg(){function n(e,...t){w.log(`[Renderer ANR] ${e}`,...t)}return(e,t)=>{cn=cn||new Map;let r=cn.get(t);if(r===void 0){n("Renderer sent first status message",e.config);let i;e.config.captureStackTrace&&(n("Connecting to debugger"),i=Lx(t,s=>{n("Event captured with stack frames"),If(t,e.config.anrThreshold,s)})),r=lE(xx,100,e.config.anrThreshold,async()=>{n("Watchdog timeout"),i?(n("Pausing debugger to capture stack trace"),i()):(n("Capturing event"),If(t,e.config.anrThreshold))}),t.once("destroyed",()=>{cn==null||cn.delete(t)}),cn.set(t,r)}r.poll(),e.status!=="alive"&&(n("Renderer visibility changed",e.status),r.enabled(e.status==="visible"))}}let Le,_t;const Pf={scheme:qt,privileges:{bypassCSP:!0,corsEnabled:!0,supportFetchAPI:!0,secure:!0}};function $x(){Le=Le||new Set,_t=_t||new Map;for(const n of _.webContents.getAllWebContents()){const e=n.id;Le.has(e)||n.isDestroyed()||n.executeJavaScript("window.__SENTRY_RENDERER_ID__").then(t=>{t&&Le&&_t&&(Le.add(e),_t.set(t,e),n.once("destroyed",()=>{Le==null||Le.delete(e),_t==null||_t.delete(t)}))},w.error)}}function hg(n,e,t,r){var s,a,o,c;const i=r&&((s=n==null?void 0:n.getRendererName)==null?void 0:s.call(n,r))||"renderer";e.breadcrumbs=e.breadcrumbs||[],delete e.environment,(a=e.sdk)==null||delete a.name,(o=e.sdk)==null||delete o.version,(c=e.sdk)==null||delete c.packages,ri(oa(e,{tags:{"event.process":i}}),{attachments:t})}function mg(n,e,t){let r;try{r=JSON.parse(e)}catch{w.warn("sentry-electron received an invalid event message");return}hg(n,r,[],t)}function gg(n,e,t){var s,a;const r=Zc(e),i=fg(r);if(i){const[o,c,u]=i;u&&hx(o,u),hg(n,o,c,t)}else{const o=rx(r,_.app.getAppPath());(a=(s=Q())==null?void 0:s.getTransport())==null||a.send(o)}}function _g(n){const e=Q();if(!e)return;oE.getMetricsAggregatorForClient(e).add(n.metricType,n.name,n.value,n.unit,n.tags,n.timestamp)}function lo(n){return n!=null&&Object.keys(n).length>0}function yg(n,e){let t;try{t=JSON.parse(e)}catch{w.warn("sentry-electron received an invalid scope message");return}const r=re();lo(t.user)&&r.setUser(t.user),lo(t.tags)&&r.setTags(t.tags),lo(t.extra)&&r.setExtras(t.extra);for(const s of t.attachments||[])r.addAttachment(s);const i=t.breadcrumbs.pop();i&&r.addBreadcrumb(i,(n==null?void 0:n.maxBreadcrumbs)||100)}function Mx(n){if(_.app.isReady())throw new Qe("Sentry SDK should be initialized before the Electron app 'ready' event is fired");_.protocol.registerSchemesAsPrivileged([Pf]),_.protocol.registerSchemesAsPrivileged=new Proxy(_.protocol.registerSchemesAsPrivileged,{apply:(t,r,i)=>{t([...i[0],Pf])}});const e=pg();_.app.whenReady().then(()=>{for(const t of n.getSessions())_L(t.protocol,qt,r=>{const i=()=>{const a=r.windowId?_t==null?void 0:_t.get(r.windowId):void 0;return a?_.webContents.fromId(a):void 0},s=r.body;if(r.url.startsWith(`${qt}://${je.RENDERER_START}`))$x();else if(r.url.startsWith(`${qt}://${je.EVENT}`)&&s)mg(n,s.toString(),i());else if(r.url.startsWith(`${qt}://${je.SCOPE}`)&&s)yg(n,s.toString());else if(r.url.startsWith(`${qt}://${je.ENVELOPE}`)&&s)gg(n,s,i());else if(r.url.startsWith(`${qt}://${je.ADD_METRIC}`)&&s)_g(JSON.parse(s.toString()));else if(r.url.startsWith(`${qt}://${je.STATUS}`)&&s){const a=i();if(a){const o=JSON.parse(s.toString()).status;e(o,a)}}})}).catch(t=>w.error(t))}function kx(n){_.ipcMain.on(je.RENDERER_START,({sender:t})=>{const r=t.id;Le=Le||new Set,!Le.has(r)&&(t.isDestroyed()||(Le.add(r),t.once("destroyed",()=>{Le==null||Le.delete(r)})))}),_.ipcMain.on(je.EVENT,({sender:t},r)=>mg(n,r,t)),_.ipcMain.on(je.SCOPE,(t,r)=>yg(n,r)),_.ipcMain.on(je.ENVELOPE,({sender:t},r)=>gg(n,r,t));const e=pg();_.ipcMain.on(je.STATUS,({sender:t},r)=>e(r,t)),_.ipcMain.on(je.ADD_METRIC,(t,r)=>_g(r))}function Dx(n){(n.ipcMode&sr.Protocol)>0&&Mx(n),(n.ipcMode&sr.Classic)>0&&kx(n)}const Fx=hp(uE(tg(_.app.getAppPath())));function jx(n){w.log(`[Utility Process] ${n}`)}function Ux(){var n;(n=vi.utilityProcess)!=null&&n.fork&&(vi.utilityProcess.fork=new Proxy(vi.utilityProcess.fork,{apply:(e,t,r)=>{const i=e.apply(t,r);function s(){const[,,a]=r;return(a==null?void 0:a.serviceName)||`pid:${i.pid}`}return i.on("message",a=>{if(_f(a)){jx(`SDK started in utility process '${s()}'`);const{port1:o,port2:c}=new vi.MessageChannelMain;c.on("message",u=>{(u.data instanceof Uint8Array||typeof u.data=="string")&&Bx(u.data)}),c.start(),i.postMessage(hL(),[o])}}),i.on=new Proxy(i.on,{apply:(a,o,[c,u])=>c==="message"?a.apply(o,["message",l=>{if(!_f(l))return u(l)}]):a.apply(o,[c,u])}),i}}))}function Bx(n){var r,i;const e=Zc(n),t=fg(e);if(t){const[s,a]=t;Gx(s,a)}else(i=(r=Q())==null?void 0:r.getTransport())==null||i.send(e)}function Gx(n,e){var t,r,i;delete n.environment,delete n.release,(t=n.sdk)==null||delete t.name,(r=n.sdk)==null||delete r.version,(i=n.sdk)==null||delete i.packages,ri(oa(n,{tags:{"event.process":"utility"}}),{attachments:e})}function Hx(n){const e=[jL(),cL(),fx(),bx(),px(),uL(),ax(),ux(),Rf(),cv(),iv(),Av(),Z1(),H1(),jN(),AN(),$N(),Q1({cloudResource:!1}),_x()];return n.autoSessionTracking!==!1&&e.push(ox()),n.attachScreenshot&&e.push(Rf()),n.enableRendererProfiling&&e.push(gx()),e}function Wx(n){const e={_metadata:{sdk:fL()},ipcMode:sr.Both,release:Hu(),environment:Wu(),defaultIntegrations:Hx(n),transport:Cx(),transportOptions:{},getSessions:()=>[_.session.defaultSession],...n,stackParser:N_(n.stackParser||Fx)},t={...e,integrations:Ib(e)};t.debug&&w.enable(),zx(t),Dx(t),Ux(),g1();const r=re();r.update(t.initialScope);const i=new tL(t);r.setClient(i),i.init(),t.skipOpenTelemetrySetup||nL(i)}const Vx=[{userAdded:"ElectronMinidump",toRemove:"SentryMinidump"},{userAdded:"BrowserWindowSession",toRemove:"MainProcessSession"}];function zx(n){for(const{userAdded:e,toRemove:t}of Vx)n.integrations.some(r=>r.name===e)&&(n.integrations=n.integrations.filter(r=>r.name!==t))}function qu(n,e=0){if(n instanceof Error){let t=`${n.name}: ${n.message}`;return n.cause&&(t+=`
Caused by: ${qu(n.cause,e+1)}`),e===0&&(t+=`
Stack Trace:
${n.stack}`),t}return String(n)}var T=(n=>(n.hasUserOpenedAppBefore="hasUserOpenedAppBefore",n.Analytics="analytics",n.SchemaVersion="schemaVersion",n.DirectoryFromPreviousSession="user.directoryFromPreviousSession",n.LLMs="LLMs",n.LLMAPIs="LLMAPIs",n.EmbeddingModels="embeddingModels",n.DefaultLLM="defaultLLM",n.DefaultEmbeddingModelAlias="defaultEmbeddingModelAlias",n.MaxRAGExamples="RAG.maxRAGExamples",n.LLMGenerationParameters="llmGenerationParameters",n.Chats="chats",n.AgentConfigs="agentConfigs",n.ChunkSize="chunkSize",n.SpellCheck="spellCheck",n.EditorFlexCenter="editorFlexCenter",n.showDocumentStats="showDocumentStats",n.AutoContext="autoContext",n.TamaguiTheme="tamaguiTheme",n.SearchParams="searchParams",n))(T||{});function bg(n,e,t){const r=X.extname(n).toLowerCase();return e.includes(r)?n:`${n}${t}`}const qx=(n,e)=>{if(e)return e.slice(0,50);if(!n||n.length===0||!n[0].content)return"Empty Chat";const t=n[0];if(t.visibleContent)return t.visibleContent.slice(0,30);const r=t.content;return!r||r===""||typeof r!="string"?"Empty Chat":r.slice(0,30)},Cf=n=>n.children!==void 0,ca=[".md",".markdown",".mdown",".mkdn",".mkd"];function es(n){return n.startsWith(".")}function vg(n,e){try{const t=B.extname(n).toLowerCase();return e.includes(t)}catch{return!1}}function pi(n,e=""){const t=[];if(!W.existsSync(n))return t;try{const r=W.statSync(n);if(r.isFile())vg(n,ca)&&!es(B.basename(n))&&t.push({name:B.basename(n),path:n,relativePath:e,dateModified:r.mtime,dateCreated:r.birthtime});else{const s=W.readdirSync(n).filter(a=>!es(a)).map(a=>{const o=B.join(n,a);return pi(o,B.join(e,a))}).flat();if(e==="")return s;es(B.basename(n))||t.push({name:B.basename(n),path:n,relativePath:e,dateModified:r.mtime,dateCreated:r.birthtime,children:s})}}catch{}return t}function Zu(n){return n.reduce((e,t)=>(Cf(t)||e.push({name:t.name,path:t.path,relativePath:t.relativePath,dateModified:t.dateModified,dateCreated:t.dateCreated}),Cf(t)&&t.children&&e.push(...Zu(t.children)),e),[])}function Zx(n){const e=pi(n);return Zu(e)}function Xx(n){const e=n.map(s=>pi(s)).flat(),t=Zu(e),r=new Set;return t.filter(s=>r.has(s.path)?!1:(r.add(s.path),!0))}function Yx(n,e,t){const r=B.dirname(n);if(W.existsSync(r)||W.mkdirSync(r,{recursive:!0}),W.existsSync(n))return;const i=bg(n,ca,".md");W.writeFileSync(i,e,t)}function Xu(n,e){const t=pi(e);n&&n.webContents.send("files-list",t)}function Eg(n,e){try{const t=E_.watch(e,{ignoreInitial:!0}),r=(i,s)=>{(vg(s,ca)||i.includes("directory"))&&Xu(n,e)};return t.on("add",i=>r("added",i)).on("change",i=>r("changed",i)).on("unlink",i=>r("removed",i)).on("addDir",i=>r("directory added",i)).on("unlinkDir",i=>r("directory removed",i)),t}catch{return}}function wg(n){return W.readFileSync(n,"utf8")}function Kx(n){const e=B.normalize(n),t=e.endsWith(B.sep)?e:`${e}${B.sep}`;if(B.dirname(t.slice(0,-1))===t.slice(0,-1))return{localModelPath:"",repoName:B.basename(t.slice(0,-1))};const r=B.dirname(t.slice(0,-1)),i=B.basename(t.slice(0,-1));return{localModelPath:r,repoName:i}}const Sg=async(n,e)=>{const t=n instanceof URL?n.href:n.toString(),r=e||{};return new Promise((i,s)=>{const a={method:r.method||"GET",url:t},o=_.net.request(a);if(r.headers&&Object.entries(r.headers).forEach(([c,u])=>{o.setHeader(c,u)}),r.body){let c;if(r.body instanceof ArrayBuffer)c=Buffer.from(r.body);else if(typeof r.body=="string"||Buffer.isBuffer(r.body))c=r.body;else if(typeof r.body=="object")c=JSON.stringify(r.body),o.setHeader("Content-Type","application/json");else{s(new Error("Unsupported body type"));return}o.write(c)}o.on("response",c=>{const u=[];c.on("data",l=>u.push(l)),c.on("end",()=>{const l=Buffer.concat(u);i(new Response(l,{status:c.statusCode,statusText:c.statusMessage,headers:new Headers(c.headers)}))})}),o.on("error",c=>s(c)),o.end()})};async function Jx(n,e,t){const r=await fp.downloadFile({repo:n,path:e,fetch:Sg});if(!r)throw new Error(`Failed to download file from ${n}/${e}`);const i=await r.arrayBuffer(),s=Buffer.from(i),a=B.join(t,e),o=B.dirname(a);oe.existsSync(o)||oe.mkdirSync(o,{recursive:!0}),oe.writeFileSync(a,s)}const Qx=async(n,e,t=!0)=>{const r=await fp.listFiles({repo:n,recursive:!0,fetch:Sg}),i=[];for await(const a of r)if(a.type==="file")if(a.path.endsWith("onnx")){const o=a.path.includes("quantized");t===o&&i.push(a)}else i.push(a);const s=i.map(a=>Jx(n,a.path,B.join(e,n)));await Promise.all(s)},e$={"Xenova/UAE-Large-V1":{type:"repo",repoName:"Xenova/UAE-Large-V1",readableName:"UAE-Large-V1",description:"Recommended for English content"},"Xenova/bge-small-en-v1.5":{type:"repo",repoName:"Xenova/bge-small-en-v1.5",readableName:"bge-small-en-v1.5",description:"Recommended for low-power devices"},"Xenova/multilingual-e5-large":{type:"repo",repoName:"Xenova/multilingual-e5-large",readableName:"multilingual-e5-large",description:"Recommended for non-English content"},"Xenova/jina-embeddings-v2-base-zh":{type:"repo",repoName:"Xenova/jina-embeddings-v2-base-zh",readableName:"jina-embeddings-v2-base-zh",description:"Recommended for Chinese content"},"Xenova/jina-embeddings-v2-base-de":{type:"repo",repoName:"Xenova/jina-embeddings-v2-base-de",readableName:"jina-embeddings-v2-base-de",description:"Recommended for German content"}};function Tg(n){return e=>{if(!n)throw new Error("Tokenizer not initialized");return e.map(t=>n(t))}}async function Ag(n){return async e=>{if(e.length===0||e[0].length===0)return[];if(typeof e[0][0]=="number")return e;if(!n)throw new Error("Pipeline not initialized");return await Promise.all(e.map(async r=>{const i=await n(v_(r),{pooling:"mean",normalize:!0});return Array.from(i.data)}))}}async function t$(n,e){let t="",r="";const{pipeline:i,env:s}=await import("@xenova/transformers");s.cacheDir=X.join(_.app.getPath("userData"),"models","embeddings");const a=Kx(n.localPath);s.localModelPath=a.localModelPath,t=a.repoName,s.allowRemoteModels=!1,r=n.localPath;const o=await i("feature-extraction",t),c=Tg(o.tokenizer),u=await Ag(o);return{name:r,contextLength:o.model.config.hidden_size,sourceColumn:e,embed:u,tokenize:c}}async function n$(n,e){let t,r="",i="";const{pipeline:s,env:a}=await import("@xenova/transformers");a.cacheDir=X.join(_.app.getPath("userData"),"models","embeddings"),r=n.repoName,a.allowRemoteModels=!0,i=n.repoName;try{t=await s("feature-extraction",r)}catch{await Qx(r,a.cacheDir),t=await s("feature-extraction",r)}const o=Tg(t.tokenizer),c=await Ag(t);return{name:i,contextLength:t.model.config.hidden_size,sourceColumn:e,embed:c,tokenize:o}}async function r$(n,e){return n.type==="local"?t$(n,e):n$(n,e)}const i$=async(n,e)=>{const{env:t,AutoModelForSequenceClassification:r,AutoTokenizer:i}=await import("@xenova/transformers");t.cacheDir=X.join(_.app.getPath("userData"),"models","reranker");const s=await i.from_pretrained("Xenova/bge-reranker-base"),a=await r.from_pretrained("Xenova/bge-reranker-base"),o=Array(e.length).fill(n),c=s(o,{text_pair:e.map(d=>d.content),padding:!0,truncation:!0}),u=await a(c);return e.map((d,f)=>({...d,score:u.logits.data[f]})).sort((d,f)=>f.score-d.score).filter(d=>d.score>0)};var Yt=(n=>(n.NOTE_PATH="notepath",n.VECTOR="vector",n.CONTENT="content",n.SUB_NOTE_INDEX="subnoteindex",n.TIME_ADDED="timeadded",n.FILE_MODIFIED="filemodified",n.FILE_CREATED="filecreated",n.DISTANCE="_distance",n))(Yt||{});const s$=n=>{const e=[new _e.Field("notepath",new _e.Utf8,!1),new _e.Field("vector",new _e.FixedSizeList(n,new _e.Field("item",new _e.Float32)),!1),new _e.Field("content",new _e.Utf8,!1),new _e.Field("subnoteindex",new _e.Float64,!1),new _e.Field("timeadded",new _e.Date_(_e.DateUnit.MILLISECOND),!1),new _e.Field("filemodified",new _e.Date_(_e.DateUnit.MILLISECOND),!1),new _e.Field("filecreated",new _e.Date_(_e.DateUnit.MILLISECOND),!1)];return new _e.Schema(e)},Nf=n=>JSON.stringify(n.fields.map(e=>({name:e.name,type:e.type.toString(),nullable:e.nullable}))),a$=(n,e)=>{const t=Nf(n),r=Nf(e);return t===r},o$=(n,e)=>{const t=s=>s.replace(/[<>:"/\\|?*]/g,"_"),r=t(e);return`ragnote_table_${t(n)}_${r}`},c$=async(n,e,t)=>{const r=await n.tableNames(),i=s$(e.contextLength),s=o$(e.name,t);if(r.includes(s)){const o=await n.openTable(s,e),c=await o.schema;return a$(c,i)?o:(await n.dropTable(s),await n.createTable({name:s,schema:i,embeddingFunction:e}))}return await n.createTable({name:s,schema:i,embeddingFunction:e})};function u$(n){return n.replace(/''/g,"'")}function yc(n){const{vector:e,...t}=n,r=t;return r.notepath=u$(r.notepath),r}function Wi(n){return n.replace(/'/g,"''")}class l${constructor(){ue(this,"lanceTable");ue(this,"embedFun")}async initialize(e,t,r){this.embedFun=await r$(r,"content"),this.lanceTable=await c$(e,this.embedFun,t)}async add(e,t){const r=e.filter(c=>c.content!=="").map(c=>{const u=c;return u.notepath=Wi(u.notepath),u});await this.deleteDBItemsByFilePaths(r.map(c=>c.notepath));const i=r,s=process.platform==="darwin"?50:40,a=[];for(let c=0;c<i.length;c+=s)a.push(i.slice(c,c+s));if(a.length===0)return;const o=a.length;await a.reduce(async(c,u,l)=>{await c;const d=Lo.makeArrowTable(u);await this.lanceTable.add(d);const f=(l+1)/o;t&&t(f)},Promise.resolve())}async deleteDBItemsByFilePaths(e){const t=e.map(i=>Wi(i)).map(i=>`'${i}'`).join(", ");if(t==="")return;const r=`${Yt.NOTE_PATH} IN (${t})`;try{await this.lanceTable.delete(r)}catch{}}async updateDBItemsWithNewFilePath(e,t){const r=Wi(e);if(r==="")return;const i=`${Yt.NOTE_PATH} = '${r}'`;try{await this.lanceTable.update({where:i,values:{[Yt.NOTE_PATH]:Wi(t)}})}catch{}}async search(e,t,r){const i=await this.lanceTable.search(e).metricType(Lo.MetricType.Cosine).limit(t);return r&&(i.prefilter(!0),i.filter(r)),(await i.execute()).map(yc)}async filter(e,t=10){return(await this.lanceTable.filter(e).limit(t).execute()).map(yc)}}class d${constructor(){ue(this,"activeWindows",[]);ue(this,"errorStringsToSendWindow",[]);ue(this,"watcher")}async createWindow(e,t,r,i){const{x:s,y:a}=this.getNextWindowPosition(),{width:o,height:c}=this.getWindowSize(),u=new _.BrowserWindow({title:"Reor",x:s,y:a,webPreferences:{preload:t},frame:!1,titleBarStyle:"hidden",titleBarOverlay:{color:"#303030",symbolColor:"#fff",height:30},width:o,height:c});r?(u.loadURL(r),u.webContents.openDevTools()):u.loadFile(i),u.webContents.setWindowOpenHandler(({url:l})=>(l.startsWith("https:")&&_.shell.openExternal(l),{action:"deny"})),u.on("close",()=>{u.webContents.send("prepare-for-window-close"),this.prepareWindowForClose(e,u)}),u.webContents.on("did-finish-load",()=>{this.getAndClearErrorStrings().forEach(d=>{u.webContents.send("error-to-display-in-window",d)})})}getAndSetupDirectoryForWindowFromPreviousAppSession(e,t){const r=t.get(T.DirectoryFromPreviousSession);return r?this.activeWindows.some(s=>s.vaultDirectoryForWindow===r)?"":(this.setVaultDirectoryForContents(e,r,t),r):""}appendNewErrorToDisplayInWindow(e){let t=!1;_.BrowserWindow.getAllWindows().forEach(i=>{i.webContents.isLoading()||(i.webContents.send("error-to-display-in-window",e),t=!0)}),t||this.errorStringsToSendWindow.push(e)}getAndClearErrorStrings(){const e=this.errorStringsToSendWindow;return this.errorStringsToSendWindow=[],e}getBrowserWindowId(e){const t=_.BrowserWindow.fromWebContents(e);return t?t.id:null}getWindowInfoForContents(e){const t=this.getBrowserWindowId(e);return t===null?null:this.activeWindows.find(i=>i.windowID===t)||null}getVaultDirectoryForWinContents(e){const t=this.getBrowserWindowId(e);return t?this.getVaultDirectoryForWindowID(t):null}getVaultDirectoryForWindowID(e){const t=this.activeWindows.find(r=>r.windowID===e);return t?t.vaultDirectoryForWindow:null}setVaultDirectoryForContents(e,t,r){if(!e)throw new Error("Invalid webContents provided.");const i=this.getBrowserWindowId(e);if(!i)throw new Error("Unable to find the browser window ID.");if(!t||typeof t!="string")throw new Error("Invalid directory provided.");let s=this.activeWindows.find(a=>a.windowID===i);s?s.vaultDirectoryForWindow=t:(s={windowID:i,dbTableClient:new l$,vaultDirectoryForWindow:t},this.activeWindows.push(s)),r.set(T.DirectoryFromPreviousSession,t)}prepareWindowForClose(e,t){const r=this.getVaultDirectoryForWinContents(t.webContents);r&&(e.set(T.DirectoryFromPreviousSession,r),this.removeActiveWindowByDirectory(r))}removeActiveWindowByDirectory(e){this.activeWindows=this.activeWindows.filter(t=>t.vaultDirectoryForWindow!==e)}getNextWindowPosition(){const t=_.BrowserWindow.getFocusedWindow();if(t){const[r,i]=t.getPosition();return{x:r+30,y:i+30}}return{x:void 0,y:void 0}}getWindowSize(){const e=_.screen.getPrimaryDisplay(),{width:t,height:r}=e.workAreaSize,i=Math.min(1200,t*.8),s=Math.min(800,r*.8);return{width:i,height:s}}}const Ir="OpenAI",ts="Anthropic",f$=[{contextLength:128e3,modelName:"gpt-4o",apiName:Ir},{contextLength:128e3,modelName:"gpt-4o-mini",apiName:Ir},{contextLength:16385,modelName:"gpt-3.5-turbo",apiName:Ir},{contextLength:128e3,modelName:"gpt-4-turbo",apiName:Ir}],p$=[{contextLength:18e4,modelName:"claude-3-5-sonnet-latest",apiName:ts},{contextLength:18e4,modelName:"claude-3-opus-latest",apiName:ts},{contextLength:18e4,modelName:"claude-3-haiku-20240307",apiName:ts}],fo={SYSTEM:"system",PACKAGED:"packaged"},Dn={name:"Ollama",apiInterface:"ollama",apiURL:"http://localhost:11434/v1/"};class h${constructor(){ue(this,"client");ue(this,"host","http://127.0.0.1:11434");ue(this,"childProcess");ue(this,"init",async()=>{await this.serve();const e=await import("ollama");this.client=new e.Ollama});ue(this,"getAvailableModels",async()=>(await this.client.list()).models.map(r=>({modelName:r.name,contextLength:4096,apiName:Dn.name})));ue(this,"pullModel",async(e,t)=>{const r=await this.client.pull({model:e,stream:!0});for await(const i of r)t(i)});ue(this,"deleteModel",async e=>{await this.client.delete({model:e})});ue(this,"getTokenizer",e=>{let t;try{t=cl.encodingForModel(e)}catch{t=cl.encodingForModel("gpt-3.5-turbo-1106")}return i=>t.encode(i)})}async ping(){const e=await fetch(this.host,{method:"GET",cache:"no-store"});if(e.status!==200)throw new Error(`failed to ping ollama server: ${e.status}`);return!0}async serve(){try{return await this.ping(),fo.SYSTEM}catch{}try{return await this.execServe("ollama"),fo.SYSTEM}catch{}let e="",t="";switch(process.platform){case"win32":e="ollama.exe",t=_.app.isPackaged?B.join(process.resourcesPath,"binaries"):B.join(_.app.getAppPath(),"binaries","win32");break;case"darwin":e="ollama-darwin",t=_.app.isPackaged?B.join(process.resourcesPath,"binaries"):B.join(_.app.getAppPath(),"binaries","darwin");break;case"linux":e="ollama",t=_.app.isPackaged?B.join(process.resourcesPath,"binaries"):B.join(_.app.getAppPath(),"binaries","linux");break;default:throw new Error("Unsupported platform")}const r=B.join(t,e);return await this.execServe(r),fo.PACKAGED}async execServe(e){return new Promise((t,r)=>{const i={...process.env},s=`"${e}" serve`;this.childProcess=ol.exec(s,{env:i},(a,o,c)=>{if(a){r(`exec error: ${a}`);return}if(c){r(`ollama stderr: ${c}`);return}r(`ollama stdout: ${o}`)}),this.waitForPing().then(()=>{t(void 0)}).catch(a=>{this.childProcess&&!this.childProcess.killed&&this.childProcess.kill(),r(a)})})}async waitForPing(e=1e3,t=20){for(let r=0;r<t;r+=1)try{await this.ping();return}catch{await new Promise(s=>{setTimeout(s,e)})}throw new Error("Max retries reached. Ollama server didn't respond.")}stop(){this.childProcess&&(A_.platform()==="win32"?ol.exec(`taskkill /pid ${this.childProcess.pid} /f /t`):this.childProcess.kill(),this.childProcess=null)}abort(){throw new Error("Abort not yet implemented.")}}async function m$(n,e){const t=await n.get(T.LLMAPIs);if(t.find(i=>i.name===e.name)){const i=t.map(s=>s.name===e.name?e:s);n.set(T.LLMAPIs,i)}else{const i=[...t,e];n.set(T.LLMAPIs,i)}}async function bc(n,e){const t=n.get(T.LLMs)||[];if(t.find(i=>i.modelName===e.modelName)){const i=t.map(s=>s.modelName===e.modelName?e:s);n.set(T.LLMs,i)}else{const i=[...t,e];n.set(T.LLMs,i)}}async function Og(n,e){const t=n.get(T.LLMs)||[],r=await e.getAvailableModels();return[...t,...r]}async function g$(n,e,t){const r=await Og(n,e);if(r)return r.find(i=>i.modelName===t)}async function _$(n,e,t){const r=n.get(T.LLMs)||[];if(!await g$(n,e,t))return;const s=r.filter(a=>a.modelName!==t);n.set(T.LLMAPIs,s),e.deleteModel(t)}const Lf=2,y$=n=>{n.get(T.Analytics)===void 0&&n.set(T.Analytics,!0)},b$=n=>{n.get(T.SpellCheck)===void 0&&n.set(T.SpellCheck,"false")},v$=n=>{if(n.get(T.EmbeddingModels)||n.set(T.EmbeddingModels,e$),!n.get(T.DefaultEmbeddingModelAlias)){const r=n.get(T.EmbeddingModels)||{};if(Object.keys(r).length===0)throw new Error("No embedding models found");n.set(T.DefaultEmbeddingModelAlias,Object.keys(r)[0])}},E$=n=>{const e=n.get(T.LLMAPIs),t=e==null?void 0:e.find(s=>s.name===Dn.name);if(!t)n.set(T.LLMAPIs,[Dn]);else if(t.apiInterface!==Dn.name){const s=e.filter(a=>a.name!==Dn.name);n.set(T.LLMAPIs,[...s,Dn])}(e==null?void 0:e.find(s=>s.name===Ir))&&f$.forEach(s=>{bc(n,s)}),(e==null?void 0:e.find(s=>s.name===ts))&&p$.forEach(s=>{bc(n,s)})};function w$(n){n.get(T.MaxRAGExamples)||n.set(T.MaxRAGExamples,15),n.get(T.ChunkSize)||n.set(T.ChunkSize,1e3),y$(n),b$(n),v$(n),E$(n)}function S$(n){const e=n.get("chatHistories");e&&(n.set(T.Chats,e),n.delete("chatHistories"));const t=n.get(T.Chats);t&&(Object.keys(t).forEach(r=>{const i=t[r];i.map(s=>{const a=s;return s.displayableChatHistory&&(a.messages=s.displayableChatHistory,delete a.displayableChatHistory),a}),t[r]=i}),n.set(T.Chats,t))}function T$(n){const e=n.get(T.Chats);e&&(Object.keys(e).forEach(t=>{e[t].map(i=>{const s=i;return(!s.displayName||s.displayName===i.id)&&(s.displayName=qx(i.messages)),s.timeOfLastMessage||(s.timeOfLastMessage=Date.now()),s})}),n.set(T.Chats,e))}const A$=n=>{n.get(T.SchemaVersion)!==Lf&&(n.set(T.SchemaVersion,Lf),n.set(T.LLMAPIs,[]),n.set(T.DefaultLLM,"")),S$(n),T$(n),w$(n)},O$=(n,e)=>{A$(n),_.ipcMain.handle("set-vault-directory-for-window",async(t,r)=>{e.setVaultDirectoryForContents(t.sender,r,n)}),_.ipcMain.handle("get-vault-directory-for-window",t=>{let r=e.getVaultDirectoryForWinContents(t.sender);return r||(r=e.getAndSetupDirectoryForWindowFromPreviousAppSession(t.sender,n)),r}),_.ipcMain.handle("set-default-embedding-model",(t,r)=>{n.set(T.DefaultEmbeddingModelAlias,r)}),_.ipcMain.handle("add-new-local-embedding-model",(t,r)=>{const i=n.get(T.EmbeddingModels)||{},s=X.basename(r.localPath);n.set(T.EmbeddingModels,{...i,[s]:r}),n.set(T.DefaultEmbeddingModelAlias,s)}),_.ipcMain.handle("add-new-repo-embedding-model",(t,r)=>{const i=n.get(T.EmbeddingModels)||{};n.set(T.EmbeddingModels,{...i,[r.repoName]:r}),n.set(T.DefaultEmbeddingModelAlias,r.repoName)}),_.ipcMain.handle("get-embedding-models",()=>n.get(T.EmbeddingModels)),_.ipcMain.handle("update-embedding-model",(t,r,i)=>{const s=n.get(T.EmbeddingModels)||{};n.set(T.EmbeddingModels,{...s,[r]:i})}),_.ipcMain.handle("remove-embedding-model",(t,r)=>{const i=n.get(T.EmbeddingModels)||{},{[r]:s,...a}=i;n.set(T.EmbeddingModels,a)}),_.ipcMain.handle("set-no-of-rag-examples",(t,r)=>{n.set(T.MaxRAGExamples,r)}),_.ipcMain.handle("get-no-of-rag-examples",()=>n.get(T.MaxRAGExamples)),_.ipcMain.handle("set-chunk-size",(t,r)=>{n.set(T.ChunkSize,r)}),_.ipcMain.handle("get-chunk-size",()=>n.get(T.ChunkSize)),_.ipcMain.handle("get-default-embedding-model",()=>n.get(T.DefaultEmbeddingModelAlias)),_.ipcMain.handle("set-llm-generation-params",(t,r)=>{n.set(T.LLMGenerationParameters,r)}),_.ipcMain.handle("get-llm-generation-params",()=>n.get(T.LLMGenerationParameters)),_.ipcMain.handle("get-editor-flex-center",()=>n.get(T.EditorFlexCenter)),_.ipcMain.handle("set-editor-flex-center",(t,r)=>{n.set(T.EditorFlexCenter,r),t.sender.send("editor-flex-center-changed",r)}),_.ipcMain.handle("get-agent-configs",()=>n.get(T.AgentConfigs)),_.ipcMain.handle("set-agent-config",(t,r)=>{const i=n.get(T.AgentConfigs)||[],s=i.findIndex(a=>a.name===r.name);s!==-1?i[s]=r:i.push(r),n.set(T.AgentConfigs,i)}),_.ipcMain.handle("set-analytics-mode",(t,r)=>{n.set(T.Analytics,r)}),_.ipcMain.handle("get-analytics-mode",()=>n.get(T.Analytics)),_.ipcMain.handle("set-spellcheck-mode",(t,r)=>{n.set(T.SpellCheck,r)}),_.ipcMain.handle("get-spellcheck-mode",()=>n.get(T.SpellCheck)),_.ipcMain.handle("set-document-stats",(t,r)=>{n.set(T.showDocumentStats,r),t.sender.send("show-doc-stats-changed",r)}),_.ipcMain.handle("get-document-stats",()=>n.get(T.showDocumentStats,!1)),_.ipcMain.handle("has-user-opened-app-before",()=>n.get(T.hasUserOpenedAppBefore)),_.ipcMain.handle("set-user-has-opened-app-before",()=>{n.set(T.hasUserOpenedAppBefore,!0)}),_.ipcMain.handle("get-all-chats-metadata",t=>{const r=e.getVaultDirectoryForWinContents(t.sender);if(!r)return[];const i=n.get(T.Chats);return((i==null?void 0:i[r])??[]).map(({messages:a,...o})=>o)}),_.ipcMain.handle("save-chat",(t,r)=>{const i=e.getVaultDirectoryForWinContents(t.sender);if(!i)return;const s=n.get(T.Chats),a=(s==null?void 0:s[i])??[],o=a.findIndex(c=>c.id===r.id);o!==-1?a[o]=r:a.push(r),n.set(T.Chats,{...s,[i]:a})}),_.ipcMain.handle("get-chat",(t,r)=>{if(!r)return;const i=e.getVaultDirectoryForWinContents(t.sender);return i?(n.get(T.Chats)[i]||[]).find(o=>o.id===r):null}),_.ipcMain.handle("delete-chat",(t,r)=>{if(!r)return;const i=e.getVaultDirectoryForWinContents(t.sender);if(!i)return;const s=n.get(T.Chats),o=(s[i]||[]).filter(c=>c.id!==r);s[i]=o,n.set(T.Chats,s)}),_.ipcMain.handle("set-auto-context",(t,r)=>{n.set(T.AutoContext,r),t.sender.send("auto-context-changed",r)}),_.ipcMain.handle("get-auto-context",()=>n.get(T.AutoContext,!0)),_.ipcMain.handle("set-tamagui-theme",(t,r)=>{n.set(T.TamaguiTheme,r),t.sender.send("tamagui-theme-changed",r)}),_.ipcMain.handle("get-tamagui-theme",()=>n.get(T.TamaguiTheme,"dark")),_.ipcMain.handle("get-search-params",()=>n.get(T.SearchParams,{searchMode:"vector",vectorWeight:.7})),_.ipcMain.handle("set-search-params",(t,r)=>{n.set(T.SearchParams,r),t.sender.send("search-mode-changed",r)})};function R$(n){const e=n.get(T.DefaultEmbeddingModelAlias);if(!e)throw new Error("No default embedding model is specified");const r=(n.get(T.EmbeddingModels)||{})[e];if(!r)throw new Error(`No embedding model found for alias '${e}'`);return r}const I$=(n,e,t,r,i)=>{_.ipcMain.handle("open-external",(s,a)=>{_.shell.openExternal(a)}),_.ipcMain.handle("get-platform",async()=>process.platform),_.ipcMain.handle("open-new-window",()=>{e.createWindow(n,t,r,i)}),_.ipcMain.handle("get-reor-app-version",async()=>_.app.getVersion()),_.ipcMain.handle("get-user-data-path",()=>_.app.getPath("userData"))};class P${constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent!==void 0?e.pageContent.toString():"",this.metadata=e.metadata??{},this.id=e.id}}var ua={exports:{}},Rg={};function tt(n,e){typeof e=="boolean"&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(n)),this._timeouts=n,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var C$=tt;tt.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)};tt.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null};tt.prototype.retry=function(n){if(this._timeout&&clearTimeout(this._timeout),!n)return!1;var e=new Date().getTime();if(n&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(n),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(n);var t=this._timeouts.shift();if(t===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),t=this._cachedTimeouts.slice(-1);else return!1;var r=this;return this._timer=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)},t),this._options.unref&&this._timer.unref(),!0};tt.prototype.attempt=function(n,e){this._fn=n,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var t=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){t._operationTimeoutCb()},t._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)};tt.prototype.try=function(n){console.log("Using RetryOperation.try() is deprecated"),this.attempt(n)};tt.prototype.start=function(n){console.log("Using RetryOperation.start() is deprecated"),this.attempt(n)};tt.prototype.start=tt.prototype.try;tt.prototype.errors=function(){return this._errors};tt.prototype.attempts=function(){return this._attempts};tt.prototype.mainError=function(){if(this._errors.length===0)return null;for(var n={},e=null,t=0,r=0;r<this._errors.length;r++){var i=this._errors[r],s=i.message,a=(n[s]||0)+1;n[s]=a,a>=t&&(e=i,t=a)}return e};(function(n){var e=C$;n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in t)r[i]=t[i];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var s=[],a=0;a<r.retries;a++)s.push(this.createTimeout(a,r));return t&&t.forever&&!s.length&&s.push(this.createTimeout(a,r)),s.sort(function(o,c){return o-c}),s},n.createTimeout=function(t,r){var i=r.randomize?Math.random()+1:1,s=Math.round(i*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return s=Math.min(s,r.maxTimeout),s},n.wrap=function(t,r,i){if(r instanceof Array&&(i=r,r=null),!i){i=[];for(var s in t)typeof t[s]=="function"&&i.push(s)}for(var a=0;a<i.length;a++){var o=i[a],c=t[o];t[o]=(function(l){var d=n.operation(r),f=Array.prototype.slice.call(arguments,1),p=f.pop();f.push(function(h){d.retry(h)||(h&&(arguments[0]=d.mainError()),p.apply(this,arguments))}),d.attempt(function(){l.apply(t,f)})}).bind(t,c),t[o].options=r}}})(Rg);var N$=Rg;const L$=N$,x$=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class Ig extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const $$=(n,e,t)=>{const r=t.retries-(e-1);return n.attemptNumber=e,n.retriesLeft=r,n},M$=n=>x$.includes(n),Pg=(n,e)=>new Promise((t,r)=>{e={onFailedAttempt:()=>{},retries:10,...e};const i=L$.operation(e);i.attempt(async s=>{try{t(await n(s))}catch(a){if(!(a instanceof Error)){r(new TypeError(`Non-error was thrown: "${a}". You should only throw errors.`));return}if(a instanceof Ig)i.stop(),r(a.originalError);else if(a instanceof TypeError&&!M$(a.message))i.stop(),r(a);else{$$(a,s,e);try{await e.onFailedAttempt(a)}catch(o){r(o);return}i.retry(a)||r(i.mainError())}}})});ua.exports=Pg;ua.exports.default=Pg;ua.exports.AbortError=Ig;var k$=ua.exports;const _s=Ws(k$);var Cg={},Ng={exports:{}};(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(c,u,l){this.fn=c,this.context=u,this.once=l||!1}function s(c,u,l,d,f){if(typeof l!="function")throw new TypeError("The listener must be a function");var p=new i(l,d||c,f),h=t?t+u:u;return c._events[h]?c._events[h].fn?c._events[h]=[c._events[h],p]:c._events[h].push(p):(c._events[h]=p,c._eventsCount++),c}function a(c,u){--c._eventsCount===0?c._events=new r:delete c._events[u]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var u=[],l,d;if(this._eventsCount===0)return u;for(d in l=this._events)e.call(l,d)&&u.push(t?d.slice(1):d);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(l)):u},o.prototype.listeners=function(u){var l=t?t+u:u,d=this._events[l];if(!d)return[];if(d.fn)return[d.fn];for(var f=0,p=d.length,h=new Array(p);f<p;f++)h[f]=d[f].fn;return h},o.prototype.listenerCount=function(u){var l=t?t+u:u,d=this._events[l];return d?d.fn?1:d.length:0},o.prototype.emit=function(u,l,d,f,p,h){var m=t?t+u:u;if(!this._events[m])return!1;var g=this._events[m],y=arguments.length,E,b;if(g.fn){switch(g.once&&this.removeListener(u,g.fn,void 0,!0),y){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,l),!0;case 3:return g.fn.call(g.context,l,d),!0;case 4:return g.fn.call(g.context,l,d,f),!0;case 5:return g.fn.call(g.context,l,d,f,p),!0;case 6:return g.fn.call(g.context,l,d,f,p,h),!0}for(b=1,E=new Array(y-1);b<y;b++)E[b-1]=arguments[b];g.fn.apply(g.context,E)}else{var S=g.length,v;for(b=0;b<S;b++)switch(g[b].once&&this.removeListener(u,g[b].fn,void 0,!0),y){case 1:g[b].fn.call(g[b].context);break;case 2:g[b].fn.call(g[b].context,l);break;case 3:g[b].fn.call(g[b].context,l,d);break;case 4:g[b].fn.call(g[b].context,l,d,f);break;default:if(!E)for(v=1,E=new Array(y-1);v<y;v++)E[v-1]=arguments[v];g[b].fn.apply(g[b].context,E)}}return!0},o.prototype.on=function(u,l,d){return s(this,u,l,d,!1)},o.prototype.once=function(u,l,d){return s(this,u,l,d,!0)},o.prototype.removeListener=function(u,l,d,f){var p=t?t+u:u;if(!this._events[p])return this;if(!l)return a(this,p),this;var h=this._events[p];if(h.fn)h.fn===l&&(!f||h.once)&&(!d||h.context===d)&&a(this,p);else{for(var m=0,g=[],y=h.length;m<y;m++)(h[m].fn!==l||f&&!h[m].once||d&&h[m].context!==d)&&g.push(h[m]);g.length?this._events[p]=g.length===1?g[0]:g:a(this,p)}return this},o.prototype.removeAllListeners=function(u){var l;return u?(l=t?t+u:u,this._events[l]&&a(this,l)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o})(Ng);var D$=Ng.exports,la={exports:{}},F$=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})));const j$=F$;class Lg extends Error{constructor(e){super(e),this.name="TimeoutError"}}const xg=(n,e,t)=>new Promise((r,i)=>{if(typeof e!="number"||e<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(e===1/0){r(n);return}const s=setTimeout(()=>{if(typeof t=="function"){try{r(t())}catch(c){i(c)}return}const a=typeof t=="string"?t:`Promise timed out after ${e} milliseconds`,o=t instanceof Error?t:new Lg(a);typeof n.cancel=="function"&&n.cancel(),i(o)},e);j$(n.then(r,i),()=>{clearTimeout(s)})});la.exports=xg;la.exports.default=xg;la.exports.TimeoutError=Lg;var U$=la.exports,Yu={},Ku={};Object.defineProperty(Ku,"__esModule",{value:!0});function B$(n,e,t){let r=0,i=n.length;for(;i>0;){const s=i/2|0;let a=r+s;t(n[a],e)<=0?(r=++a,i-=s+1):i=s}return r}Ku.default=B$;Object.defineProperty(Yu,"__esModule",{value:!0});const G$=Ku;class H${constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);const r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}const i=G$.default(this._queue,r,(s,a)=>a.priority-s.priority);this._queue.splice(i,0,r)}dequeue(){const e=this._queue.shift();return e==null?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this._queue.length}}Yu.default=H$;Object.defineProperty(Cg,"__esModule",{value:!0});const W$=D$,$g=U$,V$=Yu,Vi=()=>{},z$=new $g.TimeoutError;class q$ extends W${constructor(e){var t,r,i,s;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=Vi,this._resolveIdle=Vi,e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:V$.default},e),!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(r=(t=e.intervalCap)===null||t===void 0?void 0:t.toString())!==null&&r!==void 0?r:""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(s=(i=e.interval)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||e.interval===0,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=e.throwOnTimeout===!0,this._isPaused=e.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=Vi,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=Vi,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const e=Date.now();if(this._intervalId===void 0){const t=this._intervalEnd-e;if(t<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const t=this._queue.dequeue();return t?(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,i)=>{const s=async()=>{this._pendingCount++,this._intervalCount++;try{const a=this._timeout===void 0&&t.timeout===void 0?e():$g.default(Promise.resolve(e()),t.timeout===void 0?this._timeout:t.timeout,()=>{(t.throwOnTimeout===void 0?this._throwOnTimeout:t.throwOnTimeout)&&i(z$)});r(await a)}catch(a){i(a)}this._next()};this._queue.enqueue(s,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async r=>this.add(r,t)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(e=>{const t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(e=>{const t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}}var $t=Cg.default=q$;const Z$=(...n)=>fetch(...n),X$=Symbol.for("ls:fetch_implementation"),N=()=>globalThis[X$]??Z$,Y$=[400,401,403,404,405,406,407,408],K$=[409];let xf=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,"default"in $t?this.queue=new $t.default({concurrency:this.maxConcurrency}):this.queue=new $t({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){const r=this.onFailedResponseHook;return this.queue.add(()=>_s(()=>e(...t).catch(i=>{throw i instanceof Error?i:new Error(i)}),{async onFailedAttempt(i){if(i.message.startsWith("Cancel")||i.message.startsWith("TimeoutError")||i.message.startsWith("AbortError")||(i==null?void 0:i.code)==="ECONNABORTED")throw i;const s=i==null?void 0:i.response,a=s==null?void 0:s.status;if(a){if(Y$.includes(+a))throw i;if(K$.includes(+a))return;r&&await r(s)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((i,s)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{s(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>N()(...e).then(t=>t.ok?t:Promise.reject(t)))}};function $f(n){return typeof(n==null?void 0:n._getType)=="function"}function Mf(n){const e={type:n._getType(),data:{content:n.content}};return n!=null&&n.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs={...n.additional_kwargs}),e}function q(n,e){if(!Wn.validate(n)){const t=e!==void 0?`Invalid UUID for ${e}: ${n}`:`Invalid UUID: ${n}`;throw new Error(t)}return n}const kf={};function Mg(n){kf[n]||(console.warn(n),kf[n]=!0)}function J$(n,e){const t=Zo.parse(n),r=Zo.parse(e);if(!t||!r)throw new Error("Invalid version format.");return t.compare(r)>=0}function Vt(n){if(!n||n.split("/").length>2||n.startsWith("/")||n.endsWith("/")||n.split(":").length>2)throw new Error(`Invalid identifier format: ${n}`);const[e,t]=n.split(":"),r=t||"latest";if(e.includes("/")){const[i,s]=e.split("/",2);if(!i||!s)throw new Error(`Invalid identifier format: ${n}`);return[i,s,r]}else{if(!e)throw new Error(`Invalid identifier format: ${n}`);return["-",e,r]}}class Q$ extends Error{constructor(e){super(e),this.name="LangSmithConflictError"}}async function z(n,e,t){let r;if(n.ok){t&&(r=await n.text());return}r=await n.text();const i=`Failed to ${e}. Received status [${n.status}]: ${n.statusText}. Server response: ${r}`;throw n.status===409?new Q$(i):new Error(i)}var Df="[...]",eM={result:"[Circular]"},ys=[],Bn=[];function tM(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function Fn(n,e,t,r){var a;try{return JSON.stringify(n,e,t)}catch(o){if(!((a=o.message)!=null&&a.includes("Converting circular structure to JSON")))return console.warn("[WARNING]: LangSmith received unserializable value."),"[Unserializable]";console.warn("[WARNING]: LangSmith received circular JSON. This will decrease tracer performance."),typeof r>"u"&&(r=tM()),vc(n,"",0,[],void 0,0,r);var i;try{Bn.length===0?i=JSON.stringify(n,e,t):i=JSON.stringify(n,nM(e),t)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;ys.length!==0;){var s=ys.pop();s.length===4?Object.defineProperty(s[0],s[1],s[3]):s[0][s[1]]=s[2]}}return i}}function po(n,e,t,r){var i=Object.getOwnPropertyDescriptor(r,t);i.get!==void 0?i.configurable?(Object.defineProperty(r,t,{value:n}),ys.push([r,t,e,i])):Bn.push([e,t,n]):(r[t]=n,ys.push([r,t,e]))}function vc(n,e,t,r,i,s,a){s+=1;var o;if(typeof n=="object"&&n!==null){for(o=0;o<r.length;o++)if(r[o]===n){po(eM,n,e,i);return}if(typeof a.depthLimit<"u"&&s>a.depthLimit){po(Df,n,e,i);return}if(typeof a.edgesLimit<"u"&&t+1>a.edgesLimit){po(Df,n,e,i);return}if(r.push(n),Array.isArray(n))for(o=0;o<n.length;o++)vc(n[o],o,o,r,n,s,a);else{var c=Object.keys(n);for(o=0;o<c.length;o++){var u=c[o];vc(n[u],u,o,r,n,s,a)}}r.pop()}}function nM(n){return n=typeof n<"u"?n:function(e,t){return t},function(e,t){if(Bn.length>0)for(var r=0;r<Bn.length;r++){var i=Bn[r];if(i[1]===e&&i[0]===t){t=i[2],Bn.splice(r,1);break}}return n.call(this,e,t)}}function Ff(n){const e=Fg(),t=mM(),r=n.extra??{},i=r.metadata;return n.extra={...r,runtime:{...e,...r==null?void 0:r.runtime},metadata:{...t,...t.revision_id||n.revision_id?{revision_id:n.revision_id??t.revision_id}:{},...i}},n}const rM=()=>{const n=fn("TRACING_SAMPLING_RATE");if(n===void 0)return;const e=parseFloat(n);if(e<0||e>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${e}`);return e},iM=n=>{const t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function sM(n){const e=[];for await(const t of n)e.push(t);return e}function ho(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const aM=async n=>{if((n==null?void 0:n.status)===429){const e=parseInt(n.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};class oM{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const r=new Promise(s=>{t=s}),i=Fn(e.item).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:r,size:i}),this.sizeBytes+=i,r}pop(e){var i;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const t=[];let r=0;for(;r+(((i=this.peek())==null?void 0:i.size)??0)<e&&this.items.length>0;){const s=this.items.shift();s&&(t.push(s),r+=s.size,this.sizeBytes-=s.size)}if(t.length===0&&this.items.length>0){const s=this.items.shift();t.push(s),r+=s.size,this.sizeBytes-=s.size}return[t.map(s=>({action:s.action,item:s.payload})),()=>t.forEach(s=>s.itemPromiseResolve())]}}const cM=20971520,uM=1e3;class qr{constructor(e={}){var r;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new oM}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const t=qr.getDefaultClientConfig();this.tracingSampleRate=rM(),this.apiUrl=ho(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=ho(e.apiKey??t.apiKey),this.webUrl=ho(e.webUrl??t.webUrl),(r=this.webUrl)!=null&&r.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??12e3,this.caller=new xf(e.callerOptions??{}),this.batchIngestCaller=new xf({...e.callerOptions??{},onFailedResponseHook:aM}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){const e=fn("API_KEY"),t=fn("ENDPOINT")??"https://api.smith.langchain.com",r=fn("HIDE_INPUTS")==="true",i=fn("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:i}}getHostUrl(){return this.webUrl?this.webUrl:iM(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${kg}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){const r=(t==null?void 0:t.toString())??"",i=`${this.apiUrl}${e}?${r}`,s=await this.caller.call(N(),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(s,`Failed to fetch ${e}`),s}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,r){let i=Number(t.get("offset"))||0;const s=Number(t.get("limit"))||100;for(;;){t.set("offset",String(i)),t.set("limit",String(s));const a=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(N(),a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(o,`Failed to fetch ${e}`);const c=r?r(await o.json()):await o.json();if(c.length===0||(yield c,c.length<s))break;i+=c.length}}async*_getCursorPaginatedList(e,t=null,r="POST",i="runs"){const s=t?{...t}:{};for(;;){const o=await(await this.caller.call(N(),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(s)})).json();if(!o||!o[i])break;yield o[i];const c=o.cursors;if(!c||!c.next)break;s.cursor=c.next}}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const r=[];for(const i of e)this.filteredPostUuids.has(i.id)?this.filteredPostUuids.delete(i.id):r.push(i);return r}else{const r=[];for(const i of e)i.id!==i.trace_id&&!this.filteredPostUuids.has(i.trace_id)||Math.random()<this.tracingSampleRate?r.push(i):this.filteredPostUuids.add(i.id);return r}}async _getBatchSizeLimitBytes(){var t;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit_bytes)??cM}async drainAutoBatchQueue(){var e;for(;this.autoBatchQueue.items.length>=0;){const[t,r]=this.autoBatchQueue.pop(await this._getBatchSizeLimitBytes());if(!t.length){r();return}try{const i={runCreates:t.filter(a=>a.action==="create").map(a=>a.item),runUpdates:t.filter(a=>a.action==="update").map(a=>a.item)},s=await this._ensureServerInfo();(e=s==null?void 0:s.batch_ingest_config)!=null&&e.use_multipart_endpoint?await this.multipartIngestRuns(i):await this.batchIngestRuns(i)}finally{r()}}}async processRunOperation(e,t){const r=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=Ff(e.item));const i=this.autoBatchQueue.push(e),s=await this._getBatchSizeLimitBytes();return(t||this.autoBatchQueue.sizeBytes>s)&&await this.drainAutoBatchQueue().catch(console.error),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)},r?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),i}async _getServerInfo(){const e=await N()(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(uM),...this.fetchOptions});return await z(e,"get server info"),e.json()}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch{console.warn("[WARNING]: LangSmith failed to fetch info on supported operations. Falling back to single calls and default limits.")}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;const i=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&i.trace_id!==void 0&&i.dotted_order!==void 0){this.processRunOperation({action:"create",item:i}).catch(console.error);return}const s=Ff(i),a=await this.caller.call(N(),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:Fn(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(a,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let r=(e==null?void 0:e.map(c=>this.prepareRunCreateOrUpdateInputs(c)))??[],i=(t==null?void 0:t.map(c=>this.prepareRunCreateOrUpdateInputs(c)))??[];if(r.length>0&&i.length>0){const c=r.reduce((l,d)=>(d.id&&(l[d.id]=d),l),{}),u=[];for(const l of i)l.id!==void 0&&c[l.id]?c[l.id]={...c[l.id],...l}:u.push(l);r=Object.values(c),i=u}const s={post:this._filterForSampling(r),patch:this._filterForSampling(i,!0)};if(!s.post.length&&!s.patch.length)return;if((await this._ensureServerInfo()).version===void 0){this.autoBatchTracing=!1;for(const c of s.post)await this.createRun(c);for(const c of s.patch)c.id!==void 0&&await this.updateRun(c.id,c);return}const o={post:[],patch:[]};for(const c of["post","patch"]){const u=c,l=s[u].reverse();let d=l.pop();for(;d!==void 0;)o[u].push(d),d=l.pop()}(o.post.length>0||o.patch.length>0)&&await this._postBatchIngestRuns(Fn(o))}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(N(),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(r,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;const r={};let i=[];for(const l of e??[]){const d=this.prepareRunCreateOrUpdateInputs(l);d.id!==void 0&&d.attachments!==void 0&&(r[d.id]=d.attachments),delete d.attachments,i.push(d)}let s=[];for(const l of t??[])s.push(this.prepareRunCreateOrUpdateInputs(l));if(i.find(l=>l.trace_id===void 0||l.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(s.find(l=>l.trace_id===void 0||l.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(i.length>0&&s.length>0){const l=i.reduce((f,p)=>(p.id&&(f[p.id]=p),f),{}),d=[];for(const f of s)f.id!==void 0&&l[f.id]?l[f.id]={...l[f.id],...f}:d.push(f);i=Object.values(l),s=d}if(i.length===0&&s.length===0)return;const c=[],u=[];for(const[l,d]of[["post",i],["patch",s]])for(const f of d){const{inputs:p,outputs:h,events:m,...g}=f,y={inputs:p,outputs:h,events:m},E=Fn(g);u.push({name:`${l}.${g.id}`,payload:new Blob([E],{type:`application/json; length=${E.length}`})});for(const[b,S]of Object.entries(y)){if(S===void 0)continue;const v=Fn(S);u.push({name:`${l}.${g.id}.${b}`,payload:new Blob([v],{type:`application/json; length=${v.length}`})})}if(g.id!==void 0){const b=r[g.id];if(b){delete r[g.id];for(const[S,[v,D]]of Object.entries(b))u.push({name:`attachment.${g.id}.${S}`,payload:new Blob([D],{type:`${v}; length=${D.length}`})})}}c.push(`trace=${g.trace_id},id=${g.id}`)}await this._sendMultipartRequest(u,c.join("; "))}async _sendMultipartRequest(e,t){try{const r=new FormData;for(const i of e)r.append(i.name,i.payload);await this.batchIngestCaller.call(N(),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers},body:r,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})}catch(r){let i="Failed to multipart ingest runs";r instanceof Error?i+=`: ${r.stack||r.message}`:i+=`: ${String(r)}`,console.warn(`${i.trim()}

Context: ${t}`)}}async updateRun(e,t){q(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));const r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(t.end_time!==void 0&&r.parent_run_id===void 0&&this.blockOnRootRunFinalization){await this.processRunOperation({action:"update",item:r},!0);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}const i={...this.headers,"Content-Type":"application/json"},s=await this.caller.call(N(),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:i,body:Fn(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(s,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){q(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(t!==void 0){let i;t.session_id?i=t.session_id:r!=null&&r.projectName?i=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?i=r==null?void 0:r.projectId:i=(await this.readProject({projectName:fn("PROJECT")||"default"})).id;const s=await this._getTenantId();return`${this.getHostUrl()}/o/${s}/projects/p/${i}/r/${t.id}?poll=true`}else if(e!==void 0){const i=await this.readRun(e);if(!i.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${i.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){const t=await sM(this.listRuns({id:e.child_run_ids})),r={},i={};t.sort((s,a)=>((s==null?void 0:s.dotted_order)??"").localeCompare((a==null?void 0:a.dotted_order)??""));for(const s of t){if(s.parent_run_id===null||s.parent_run_id===void 0)throw new Error(`Child run ${s.id} has no parent`);s.parent_run_id in r||(r[s.parent_run_id]=[]),r[s.parent_run_id].push(s),i[s.id]=s}e.child_runs=r[e.id]||[];for(const s in r)s!==e.id&&(i[s].child_runs=r[s]);return e}async*listRuns(e){const{projectId:t,projectName:r,parentRunId:i,traceId:s,referenceExampleId:a,startTime:o,executionOrder:c,isRoot:u,runType:l,error:d,id:f,query:p,filter:h,traceFilter:m,treeFilter:g,limit:y,select:E}=e;let b=[];if(t&&(b=Array.isArray(t)?t:[t]),r){const H=Array.isArray(r)?r:[r],Te=await Promise.all(H.map(be=>this.readProject({projectName:be}).then(ce=>ce.id)));b.push(...Te)}const S=["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],v={session:b.length?b:null,run_type:l,reference_example:a,query:p,filter:h,trace_filter:m,tree_filter:g,execution_order:c,parent_run:i,start_time:o?o.toISOString():null,error:d,id:f,limit:y,trace:s,select:E||S,is_root:u};let D=0;for await(const H of this._getCursorPaginatedList("/runs/query",v))if(y){if(D>=y)break;if(H.length+D>y){yield*H.slice(0,y-D);break}D+=H.length,yield*H}else yield*H}async getRunStats({id:e,trace:t,parentRun:r,runType:i,projectNames:s,projectIds:a,referenceExampleIds:o,startTime:c,endTime:u,error:l,query:d,filter:f,traceFilter:p,treeFilter:h,isRoot:m,dataSourceType:g}){let y=a||[];s&&(y=[...a||[],...await Promise.all(s.map(D=>this.readProject({projectName:D}).then(H=>H.id)))]);const b=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:i,session:y,reference_example:o,start_time:c,end_time:u,error:l,query:d,filter:f,trace_filter:p,tree_filter:h,is_root:m,data_source_type:g}).filter(([D,H])=>H!==void 0));return await(await this.caller.call(N(),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(b),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||Wn.v4()};q(e);const s=await(await this.caller.call(N(),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(s===null||!("share_token"in s))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${s.share_token}/r`}async unshareRun(e){q(e);const t=await this.caller.call(N(),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(t,"unshare run",!0)}async readRunSharedLink(e){q(e);const r=await(await this.caller.call(N(),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const r=new URLSearchParams({share_token:e});if(t!==void 0)for(const a of t)r.append("id",a);return q(e),await(await this.caller.call(N(),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),q(e);const i=await(await this.caller.call(N(),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const r={dataset_id:e};q(e);const s=await(await this.caller.call(N(),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return s.url=`${this.getHostUrl()}/public/${s.share_token}/d`,s}async unshareDataset(e){q(e);const t=await this.caller.call(N(),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(t,"unshare dataset",!0)}async readSharedDataset(e){return q(e),await(await this.caller.call(N(),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){const r={};t!=null&&t.exampleIds&&(r.id=t.exampleIds);const i=new URLSearchParams;Object.entries(r).forEach(([o,c])=>{Array.isArray(c)?c.forEach(u=>i.append(o,u)):i.append(o,c)});const s=await this.caller.call(N(),`${this.apiUrl}/public/${e}/examples?${i.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),a=await s.json();if(!s.ok)throw"detail"in a?new Error(`Failed to list shared examples.
Status: ${s.status}
Message: ${a.detail.join(`
`)}`):new Error(`Failed to list shared examples: ${s.status} ${s.statusText}`);return a.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:i=!1,projectExtra:s=null,referenceDatasetId:a=null}){const o=i?"?upsert=true":"",c=`${this.apiUrl}/sessions${o}`,u=s||{};r&&(u.metadata=r);const l={name:e,extra:u,description:t};a!==null&&(l.reference_dataset_id=a);const d=await this.caller.call(N(),c,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(d,"create project"),await d.json()}async updateProject(e,{name:t=null,description:r=null,metadata:i=null,projectExtra:s=null,endTime:a=null}){const o=`${this.apiUrl}/sessions/${e}`;let c=s;i&&(c={...c||{},metadata:i});const u={name:t,extra:c,description:r,end_time:a?new Date(a).toISOString():null},l=await this.caller.call(N(),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(l,"update project"),await l.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions";const i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)q(e),r+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");const s=await this.caller.call(N(),`${this.apiUrl}${r}?${i}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const a=await s.json();return s.ok?Array.isArray(a)?a.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let i="/sessions";const s=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)q(e),i+=`/${e}`;else if(t!==void 0)s.append("name",t);else throw new Error("Must provide projectName or projectId");r!==void 0&&s.append("include_stats",r.toString());const a=await this._get(i,s);let o;if(Array.isArray(a)){if(a.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=a[0]}else o=a;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:e,projectName:t}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:e,datasetName:t}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:i,referenceDatasetName:s,referenceFree:a,metadata:o}={}){const c=new URLSearchParams;if(e!==void 0)for(const u of e)c.append("id",u);if(t!==void 0&&c.append("name",t),r!==void 0&&c.append("name_contains",r),i!==void 0)c.append("reference_dataset",i);else if(s!==void 0){const u=await this.readDataset({datasetName:s});c.append("reference_dataset",u.id)}a!==void 0&&c.append("reference_free",a.toString()),o!==void 0&&c.append("metadata",JSON.stringify(o));for await(const u of this._getPaginated("/sessions",c))yield*u}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e,q(r);const i=await this.caller.call(N(),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(i,`delete session ${r} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:i,description:s,dataType:a,name:o}){const c=`${this.apiUrl}/datasets/upload`,u=new FormData;u.append("file",e,t),r.forEach(f=>{u.append("input_keys",f)}),i.forEach(f=>{u.append("output_keys",f)}),s&&u.append("description",s),a&&u.append("data_type",a),o&&u.append("name",o);const l=await this.caller.call(N(),c,{method:"POST",headers:this.headers,body:u,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(l,"upload CSV"),await l.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:i,outputsSchema:s,metadata:a}={}){const o={name:e,description:t,extra:a?{metadata:a}:void 0};r&&(o.data_type=r),i&&(o.inputs_schema_definition=i),s&&(o.outputs_schema_definition=s);const c=await this.caller.call(N(),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(c,"create dataset"),await c.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const i=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)q(e),r+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide datasetName or datasetId");const s=await this._get(r,i);let a;if(Array.isArray(s)){if(s.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);a=s[0]}else a=s;return a}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:i}){let s=e;if(s===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(s!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");s===void 0&&(s=(await this.readDataset({datasetName:t})).id);const a=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof i=="string"?i:i.toISOString()});return await this._get(`/datasets/${s}/versions/diff`,a)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const r="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:i,datasetNameContains:s,metadata:a}={}){const o="/datasets",c=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(const u of r)c.append("id",u);i!==void 0&&c.append("name",i),s!==void 0&&c.append("name_contains",s),a!==void 0&&c.append("metadata",JSON.stringify(a));for await(const u of this._getPaginated(o,c))yield*u}async updateDataset(e){const{datasetId:t,datasetName:r,...i}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const s=t??(await this.readDataset({datasetName:r})).id;q(s);const a=await this.caller.call(N(),`${this.apiUrl}/datasets/${s}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(a,"update dataset"),await a.json()}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",i=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(i=(await this.readDataset({datasetName:t})).id),i!==void 0)q(i),r+=`/${i}`;else throw new Error("Must provide datasetName or datasetId");const s=await this.caller.call(N(),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(s,`delete ${r}`),await s.json()}async indexDataset({datasetId:e,datasetName:t,tag:r}){let i=e;if(!i&&!t)throw new Error("Must provide either datasetName or datasetId");if(i&&t)throw new Error("Must provide either datasetName or datasetId, not both");i||(i=(await this.readDataset({datasetName:t})).id),q(i);const s={tag:r},a=await this.caller.call(N(),`${this.apiUrl}/datasets/${i}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(a,"index dataset"),await a.json()}async similarExamples(e,t,r,{filter:i}={}){const s={limit:r,inputs:e};i!==void 0&&(s.filter=i),q(t);const a=await this.caller.call(N(),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(a,"fetch similar examples"),(await a.json()).examples}async createExample(e,t,{datasetId:r,datasetName:i,createdAt:s,exampleId:a,metadata:o,split:c,sourceRunId:u}){let l=r;if(l===void 0&&i===void 0)throw new Error("Must provide either datasetName or datasetId");if(l!==void 0&&i!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");l===void 0&&(l=(await this.readDataset({datasetName:i})).id);const d=s||new Date,f={dataset_id:l,inputs:e,outputs:t,created_at:d==null?void 0:d.toISOString(),id:a,metadata:o,split:c,source_run_id:u},p=await this.caller.call(N(),`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(f),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(p,"create example"),await p.json()}async createExamples(e){const{inputs:t,outputs:r,metadata:i,sourceRunIds:s,exampleIds:a,datasetId:o,datasetName:c}=e;let u=o;if(u===void 0&&c===void 0)throw new Error("Must provide either datasetName or datasetId");if(u!==void 0&&c!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");u===void 0&&(u=(await this.readDataset({datasetName:c})).id);const l=t.map((p,h)=>({dataset_id:u,inputs:p,outputs:r?r[h]:void 0,metadata:i?i[h]:void 0,split:e.splits?e.splits[h]:void 0,id:a?a[h]:void 0,source_run_id:s?s[h]:void 0})),d=await this.caller.call(N(),`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(d,"create examples"),await d.json()}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const i=e.map(a=>$f(a)?Mf(a):a),s=$f(t)?Mf(t):t;return this.createExample({input:i},{output:s},r)}async readExample(e){q(e);const t=`/examples/${e}`;return await this._get(t)}async*listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:i,splits:s,inlineS3Urls:a,metadata:o,limit:c,offset:u,filter:l}={}){let d;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)d=e;else if(t!==void 0)d=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const f=new URLSearchParams({dataset:d}),p=i?typeof i=="string"?i:i==null?void 0:i.toISOString():void 0;p&&f.append("as_of",p);const h=a??!0;if(f.append("inline_s3_urls",h.toString()),r!==void 0)for(const g of r)f.append("id",g);if(s!==void 0)for(const g of s)f.append("splits",g);if(o!==void 0){const g=JSON.stringify(o);f.append("metadata",g)}c!==void 0&&f.append("limit",c.toString()),u!==void 0&&f.append("offset",u.toString()),l!==void 0&&f.append("filter",l);let m=0;for await(const g of this._getPaginated("/examples",f)){for(const y of g)yield y,m++;if(c!==void 0&&m>=c)break}}async deleteExample(e){q(e);const t=`/examples/${e}`,r=await this.caller.call(N(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(r,`delete ${t}`),await r.json()}async updateExample(e,t){q(e);const r=await this.caller.call(N(),`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(r,"update example"),await r.json()}async updateExamples(e){const t=await this.caller.call(N(),`${this.apiUrl}/examples/bulk`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(e),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(t,"update examples"),await t.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let i;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:t})).id:i=e,q(i);const s=new URLSearchParams,a=r?typeof r=="string"?r:r==null?void 0:r.toISOString():void 0;return a&&s.append("as_of",a),await this._get(`/datasets/${i}/splits`,s)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:i,remove:s=!1}){let a;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?a=(await this.readDataset({datasetName:t})).id:a=e,q(a);const o={split_name:r,examples:i.map(u=>(q(u),u)),remove:s},c=await this.caller.call(N(),`${this.apiUrl}/datasets/${a}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(c,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:i,referenceExample:s}={loadChildRuns:!1}){Mg("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let a;if(typeof e=="string")a=await this.readRun(e,{loadChildRuns:i});else if(typeof e=="object"&&"id"in e)a=e;else throw new Error(`Invalid run type: ${typeof e}`);a.reference_example_id!==null&&a.reference_example_id!==void 0&&(s=await this.readExample(a.reference_example_id));const o=await t.evaluateRun(a,s),[c,u]=await this._logEvaluationFeedback(o,a,r);return u[0]}async createFeedback(e,t,{score:r,value:i,correction:s,comment:a,sourceInfo:o,feedbackSourceType:c="api",sourceRunId:u,feedbackId:l,feedbackConfig:d,projectId:f,comparativeExperimentId:p}){var E;if(!e&&!f)throw new Error("One of runId or projectId must be provided");if(e&&f)throw new Error("Only one of runId or projectId can be provided");const h={type:c??"api",metadata:o??{}};u!==void 0&&(h==null?void 0:h.metadata)!==void 0&&!h.metadata.__run&&(h.metadata.__run={run_id:u}),(h==null?void 0:h.metadata)!==void 0&&((E=h.metadata.__run)==null?void 0:E.run_id)!==void 0&&q(h.metadata.__run.run_id);const m={id:l??Wn.v4(),run_id:e,key:t,score:r,value:i,correction:s,comment:a,feedback_source:h,comparative_experiment_id:p,feedbackConfig:d,session_id:f},g=`${this.apiUrl}/feedback`,y=await this.caller.call(N(),g,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(m),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(y,"create feedback",!0),m}async updateFeedback(e,{score:t,value:r,correction:i,comment:s}){const a={};t!=null&&(a.score=t),r!=null&&(a.value=r),i!=null&&(a.correction=i),s!=null&&(a.comment=s),q(e);const o=await this.caller.call(N(),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(o,"update feedback",!0)}async readFeedback(e){q(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){q(e);const t=`/feedback/${e}`,r=await this.caller.call(N(),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(r,`delete ${t}`),await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const i=new URLSearchParams;if(e&&i.append("run",e.join(",")),t)for(const s of t)i.append("key",s);if(r)for(const s of r)i.append("source",s);for await(const s of this._getPaginated("/feedback",i))yield*s}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:i}={}){const s={run_id:e,feedback_key:t,feedback_config:i};return r?typeof r=="string"?s.expires_at=r:(r!=null&&r.hours||r!=null&&r.minutes||r!=null&&r.days)&&(s.expires_in=r):s.expires_in={hours:3},await(await this.caller.call(N(),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:i,description:s,metadata:a,id:o}){var l;if(t.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");const c={id:o,name:e,experiment_ids:t,reference_dataset_id:r,description:s,created_at:(l=i??new Date)==null?void 0:l.toISOString(),extra:{}};return a&&(c.extra.metadata=a),await(await this.caller.call(N(),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){q(e);const t=new URLSearchParams({run_id:e});for await(const r of this._getPaginated("/feedback/tokens",t))yield*r}_selectEvalResults(e){let t;return"results"in e?t=e.results:t=[e],t}async _logEvaluationFeedback(e,t,r){const i=this._selectEvalResults(e),s=[];for(const a of i){let o=r||{};a.evaluatorInfo&&(o={...a.evaluatorInfo,...o});let c=null;a.targetRunId?c=a.targetRunId:t&&(c=t.id),s.push(await this.createFeedback(c,a.key,{score:a.score,value:a.value,comment:a.comment,correction:a.correction,sourceInfo:o,sourceRunId:a.sourceRunId,feedbackConfig:a.feedbackConfig,feedbackSourceType:"model"}))}return[i,s]}async logEvaluationFeedback(e,t,r){const[i]=await this._logEvaluationFeedback(e,t,r);return i}async*listAnnotationQueues(e={}){const{queueIds:t,name:r,nameContains:i,limit:s}=e,a=new URLSearchParams;t&&t.forEach((c,u)=>{q(c,`queueIds[${u}]`),a.append("ids",c)}),r&&a.append("name",r),i&&a.append("name_contains",i),a.append("limit",(s!==void 0?Math.min(s,100):100).toString());let o=0;for await(const c of this._getPaginated("/annotation-queues",a))if(yield*c,o++,s!==void 0&&o>=s)break}async createAnnotationQueue(e){const{name:t,description:r,queueId:i}=e,s={name:t,description:r,id:i||Wn.v4()},a=await this.caller.call(N(),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(s).filter(([c,u])=>u!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(a,"create annotation queue"),await a.json()}async readAnnotationQueue(e){const t=await this.listAnnotationQueues({queueIds:[e]}).next();if(t.done)throw new Error(`Annotation queue with ID ${e} not found`);return t.value}async updateAnnotationQueue(e,t){const{name:r,description:i}=t,s=await this.caller.call(N(),`${this.apiUrl}/annotation-queues/${q(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:i}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(s,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call(N(),`${this.apiUrl}/annotation-queues/${q(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const r=await this.caller.call(N(),`${this.apiUrl}/annotation-queues/${q(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((i,s)=>q(i,`runIds[${s}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const r=`/annotation-queues/${q(e,"queueId")}/run`,i=await this.caller.call(N(),`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(i,"get run from annotation queue"),await i.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){const r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call(N(),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(!t.ok){const i=typeof r.detail=="string"?r.detail:JSON.stringify(r.detail),s=new Error(`Error ${t.status}: ${t.statusText}
${i}`);throw s.statusCode=t.status,s}if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[r,i,s]=Vt(e),a=await this.caller.call(N(),`${this.apiUrl}/likes/${r}/${i}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(a,`${t?"like":"unlike"} prompt`),await a.json()}async _getPromptUrl(e){const[t,r,i]=Vt(e);if(await this._currentTenantIsOwner(t)){const s=await this._getSettings();return i!=="latest"?`${this.getHostUrl()}/prompts/${r}/${i.substring(0,8)}?organizationId=${s.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${s.id}`}else return i!=="latest"?`${this.getHostUrl()}/hub/${t}/${r}/${i.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,r=>r.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&t.append("is_public",e.isPublic.toString()),e!=null&&e.query&&t.append("query",e.query);for await(const r of this._getPaginated("/repos",t,i=>i.repos))yield*r}async getPrompt(e){const[t,r,i]=Vt(e),s=await this.caller.call(N(),`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(s.status===404)return null;await z(s,"get prompt");const a=await s.json();return a.repo?a.repo:null}async createPrompt(e,t){const r=await this._getSettings();if(t!=null&&t.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[i,s,a]=Vt(e);if(!await this._currentTenantIsOwner(i))throw await this._ownerConflictError("create a prompt",i);const o={repo_handle:s,...(t==null?void 0:t.description)&&{description:t.description},...(t==null?void 0:t.readme)&&{readme:t.readme},...(t==null?void 0:t.tags)&&{tags:t.tags},is_public:!!(t!=null&&t.isPublic)},c=await this.caller.call(N(),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(c,"create prompt");const{repo:u}=await c.json();return u}async createCommit(e,t,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[i,s,a]=Vt(e),o=(r==null?void 0:r.parentCommitHash)==="latest"||!(r!=null&&r.parentCommitHash)?await this._getLatestCommitHash(`${i}/${s}`):r==null?void 0:r.parentCommitHash,c={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},u=await this.caller.call(N(),`${this.apiUrl}/commits/${i}/${s}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(u,"create commit");const l=await u.json();return this._getPromptUrl(`${i}/${s}${l.commit_hash?`:${l.commit_hash}`:""}`)}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,i]=Vt(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);const s={};if((t==null?void 0:t.description)!==void 0&&(s.description=t.description),(t==null?void 0:t.readme)!==void 0&&(s.readme=t.readme),(t==null?void 0:t.tags)!==void 0&&(s.tags=t.tags),(t==null?void 0:t.isPublic)!==void 0&&(s.is_public=t.isPublic),(t==null?void 0:t.isArchived)!==void 0&&(s.is_archived=t.isArchived),Object.keys(s).length===0)throw new Error("No valid update options provided");const a=await this.caller.call(N(),`${this.apiUrl}/repos/${r}/${i}`,{method:"PATCH",body:JSON.stringify(s),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await z(a,"update prompt"),a.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,r,i]=Vt(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call(N(),`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){const[r,i,s]=Vt(e),a=await this._getServerInfo(),o=J$(a.version,"0.5.23");let c=s;if(!o&&s==="latest"){const d=await this._getLatestCommitHash(`${r}/${i}`);if(d)c=d;else throw new Error("No commits found")}const u=await this.caller.call(N(),`${this.apiUrl}/commits/${r}/${i}/${c}${t!=null&&t.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await z(u,"pull prompt commit");const l=await u.json();return{owner:r,repo:i,commit_hash:l.commit_hash,manifest:l.manifest,examples:l.examples}}async _pullPrompt(e,t){const r=await this.pullPromptCommit(e,{includeModel:t==null?void 0:t.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(i=>i!=="object")&&await this.updatePrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}):await this.createPrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}),t!=null&&t.object?await this.createCommit(e,t==null?void 0:t.object,{parentCommitHash:t==null?void 0:t.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:r=this.apiUrl,datasetName:i}=t,[s,a]=this.parseTokenOrUrl(e,r),o=new qr({apiUrl:s,apiKey:"placeholder"}),c=await o.readSharedDataset(a),u=i||c.name;try{if(await this.hasDataset({datasetId:u})){console.log(`Dataset ${u} already exists in your tenant. Skipping.`);return}}catch{}const l=await o.listSharedExamples(a),d=await this.createDataset(u,{description:c.description,dataType:c.data_type||"kv",inputsSchema:c.inputs_schema_definition??void 0,outputsSchema:c.outputs_schema_definition??void 0});try{await this.createExamples({inputs:l.map(f=>f.inputs),outputs:l.flatMap(f=>f.outputs?[f.outputs]:[]),datasetId:d.id})}catch(f){throw console.error(`An error occurred while creating dataset ${u}. You should delete it manually.`),f}}parseTokenOrUrl(e,t,r=2,i="dataset"){try{return q(e),[t,e]}catch{}try{const a=new URL(e).pathname.split("/").filter(o=>o!=="");if(a.length>=r){const o=a[a.length-r];return[t,o]}else throw new Error(`Invalid public ${i} URL: ${e}`)}catch{throw new Error(`Invalid public ${i} URL or token: ${e}`)}}awaitPendingTraceBatches(){return Promise.all(this.autoBatchQueue.items.map(({itemPromise:e})=>e))}}const kg="0.1.68";let It;const lM=()=>typeof window<"u"&&typeof window.document<"u",dM=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",fM=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),Dg=()=>typeof Deno<"u",pM=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!Dg(),hM=()=>It||(lM()?It="browser":pM()?It="node":dM()?It="webworker":fM()?It="jsdom":Dg()?It="deno":It="other",It);let mo;function Fg(){if(mo===void 0){const n=hM(),e=_M();mo={library:"langsmith",runtime:n,sdk:"langsmith-js",sdk_version:kg,...e}}return mo}function mM(){const n=gM()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(const[r,i]of Object.entries(n))r.startsWith("LANGCHAIN_")&&typeof i=="string"&&!t.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=i:e[r]=i);return e}function gM(){try{return typeof process<"u"&&process.env?Object.entries(process.env).reduce((n,[e,t])=>(n[e]=String(t),n),{}):void 0}catch{return}}function mn(n){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[n]:void 0}catch{return}}function fn(n){return mn(`LANGSMITH_${n}`)||mn(`LANGCHAIN_${n}`)}let go;function _M(){if(go!==void 0)return go;const n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of n){const r=mn(t);r!==void 0&&(e[t]=r)}return go=e,e}const yM=n=>n!==void 0?n:!!["TRACING_V2","TRACING"].find(t=>fn(t)==="true"),_o=Symbol.for("lc:context_variables");function bM(n){return n.replace(/[-:.]/g,"")}function vM(n,e,t=1){const r=t.toFixed(0).slice(0,3).padStart(3,"0");return bM(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}class bs{constructor(e,t){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t}static fromHeader(e){const t=e.split(",");let r={},i=[];for(const s of t){const[a,o]=s.split("="),c=decodeURIComponent(o);a==="langsmith-metadata"?r=JSON.parse(c):a==="langsmith-tags"&&(i=c.split(","))}return new bs(r,i)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),e.join(",")}}class Be{constructor(e){var o;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),jg(e)){Object.assign(this,{...e});return}const t=Be.getDefaultConfig(),{metadata:r,...i}=e,s=i.client??Be.getSharedClient(),a={...r,...(o=i==null?void 0:i.extra)==null?void 0:o.metadata};if(i.extra={...i.extra,metadata:a},Object.assign(this,{...t,...i,client:s}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const c=vM(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+c:this.dotted_order=c}}static getDefaultConfig(){return{id:Wn.v4(),run_type:"chain",project_name:mn("LANGCHAIN_PROJECT")??mn("LANGCHAIN_SESSION")??"default",child_runs:[],api_url:mn("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:mn("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return Be.sharedClient||(Be.sharedClient=new qr),Be.sharedClient}createChild(e){var c,u,l,d,f,p;const t=this.child_execution_order+1,r=new Be({...e,parent_run:this,project_name:this.project_name,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});_o in this&&(r[_o]=this[_o]);const i=Symbol.for("lc:child_config"),s=((c=e.extra)==null?void 0:c[i])??this.extra[i];if(wM(s)){const h={...s},m=EM(h.callbacks)?(l=(u=h.callbacks).copy)==null?void 0:l.call(u):void 0;m&&(Object.assign(m,{_parentRunId:r.id}),(p=(f=(d=m.handlers)==null?void 0:d.find(Ug))==null?void 0:f.updateFromRunTree)==null||p.call(f,r),h.callbacks=m),r.extra[i]=h}const a=new Set;let o=this;for(;o!=null&&!a.has(o.id);)a.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(r),r}async end(e,t,r=Date.now(),i){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,i&&Object.keys(i).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...i}}:{metadata:i})}_convertToCreate(e,t,r=!0){var c;const i=e.extra??{};if(i.runtime||(i.runtime={}),t)for(const[u,l]of Object.entries(t))i.runtime[u]||(i.runtime[u]=l);let s,a;return r?(a=(c=e.parent_run)==null?void 0:c.id,s=[]):(s=e.child_runs.map(u=>this._convertToCreate(u,t,r)),a=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:i,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:s,parent_run_id:a,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags}}async postRun(e=!0){try{const t=Fg(),r=await this._convertToCreate(this,t,!0);if(await this.client.createRun(r),!e){Mg("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const i of this.child_runs)await i.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){var e;try{const t={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags};await this.client.updateRun(this.id,t)}catch(t){console.error(`Error in patchRun for run ${this.id}`,t)}}toJSON(){return this._convertToCreate(this,void 0,!1)}static fromRunnableConfig(e,t){var u,l,d,f;const r=e==null?void 0:e.callbacks;let i,s,a,o=yM();if(r){const p=((u=r==null?void 0:r.getParentRunId)==null?void 0:u.call(r))??"",h=(l=r==null?void 0:r.handlers)==null?void 0:l.find(m=>(m==null?void 0:m.name)=="langchain_tracer");i=(d=h==null?void 0:h.getRun)==null?void 0:d.call(h,p),s=h==null?void 0:h.projectName,a=h==null?void 0:h.client,o=o||!!h}return i?new Be({name:i.name,id:i.id,trace_id:i.trace_id,dotted_order:i.dotted_order,client:a,tracingEnabled:o,project_name:s,tags:[...new Set(((i==null?void 0:i.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(f=i==null?void 0:i.extra)==null?void 0:f.metadata,...e==null?void 0:e.metadata}}}).createChild(t):new Be({...t,client:a,tracingEnabled:o,project_name:s})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){var u;const r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,i=r["langsmith-trace"];if(!i||typeof i!="string")return;const s=i.trim(),a=s.split(".").map(l=>{const[d,f]=l.split("Z");return{strTime:d,time:Date.parse(d+"Z"),uuid:f}}),o=a[0].uuid,c={...t,name:(t==null?void 0:t.name)??"parent",run_type:(t==null?void 0:t.run_type)??"chain",start_time:(t==null?void 0:t.start_time)??Date.now(),id:(u=a.at(-1))==null?void 0:u.uuid,trace_id:o,dotted_order:s};if(r.baggage&&typeof r.baggage=="string"){const l=bs.fromHeader(r.baggage);c.metadata=l.metadata,c.tags=l.tags}return new Be(c)}toHeaders(e){var r;const t={"langsmith-trace":this.dotted_order,baggage:new bs((r=this.extra)==null?void 0:r.metadata,this.tags).toHeader()};if(e)for(const[i,s]of Object.entries(t))e.set(i,s);return t}}Object.defineProperty(Be,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function jg(n){return n!==void 0&&typeof n.createChild=="function"&&typeof n.postRun=="function"}function Ug(n){return typeof n=="object"&&n!=null&&typeof n.name=="string"&&n.name==="langchain_tracer"}function jf(n){return Array.isArray(n)&&n.some(e=>Ug(e))}function EM(n){return typeof n=="object"&&n!=null&&Array.isArray(n.handlers)}function wM(n){var e;return n!==void 0&&typeof n.callbacks=="object"&&(jf((e=n.callbacks)==null?void 0:e.handlers)||jf(n.callbacks))}let SM=class{getStore(){}run(e,t){return t()}};const yo=Symbol.for("ls:tracing_async_local_storage"),TM=new SM;let AM=class{getInstance(){return globalThis[yo]??TM}initializeGlobalInstance(e){globalThis[yo]===void 0&&(globalThis[yo]=e)}};const OM=new AM,RM=()=>{const n=OM.getInstance().getStore();if(!jg(n))throw new Error(["Could not get the current run tree.","","Please make sure you are calling this method within a traceable function or the tracing is enabled."].join(`
`));return n};function Ju(n){return typeof n=="function"&&"langsmith:traceable"in n}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const IM=Object.prototype.hasOwnProperty;function PM(n,e){return IM.call(n,e)}function CM(n){if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(n);let e=[];for(let t in n)PM(n,t)&&e.push(t);return e}function or(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function Ec(n){let e=0;const t=n.length;let r;for(;e<t;){if(r=n.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function NM(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function wc(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(wc(n[t]))return!0}else if(typeof n=="object"){const t=CM(n),r=t.length;for(var e=0;e<r;e++)if(wc(n[t[e]]))return!0}}return!1}function Uf(n,e){const t=[n];for(const r in e){const i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&t.push(`${r}: ${i}`)}return t.join(`
`)}class LM extends Error{constructor(e,t,r,i,s){super(Uf(e,{name:t,index:r,operation:i,tree:s})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.setPrototypeOf(this,new.target.prototype),this.message=Uf(e,{name:t,index:r,operation:i,tree:s})}}const ye=LM,Gn={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var r=n[e];return delete n[e],{newDocument:t,removed:r}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:function(n,e,t){let r=Sc(t,this.path);r&&(r=or(r));const i=kr(t,{op:"remove",path:this.from}).removed;return kr(t,{op:"add",path:this.path,value:i}),{newDocument:t,removed:r}},copy:function(n,e,t){const r=Sc(t,this.from);return kr(t,{op:"add",path:this.path,value:or(r)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:Es(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}};var xM={add:function(n,e,t){return Ec(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var r=n.splice(e,1);return{newDocument:t,removed:r[0]}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:Gn.move,copy:Gn.copy,test:Gn.test,_get:Gn._get};function Sc(n,e){if(e=="")return n;var t={op:"_get",path:e};return kr(n,t),t.value}function kr(n,e,t=!1,r=!0,i=!0,s=0){if(t&&(typeof t=="function"?t(e,0,n,e.path):Tc(e,0)),e.path===""){let a={newDocument:n};if(e.op==="add")return a.newDocument=e.value,a;if(e.op==="replace")return a.newDocument=e.value,a.removed=n,a;if(e.op==="move"||e.op==="copy")return a.newDocument=Sc(n,e.from),e.op==="move"&&(a.removed=n),a;if(e.op==="test"){if(a.test=Es(n,e.value),a.test===!1)throw new ye("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return a.newDocument=n,a}else{if(e.op==="remove")return a.removed=n,a.newDocument=null,a;if(e.op==="_get")return e.value=n,a;if(t)throw new ye("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,e,n);return a}}else{r||(n=or(n));const o=(e.path||"").split("/");let c=n,u=1,l=o.length,d,f,p;for(typeof t=="function"?p=t:p=Tc;;){if(f=o[u],f&&f.indexOf("~")!=-1&&(f=NM(f)),i&&(f=="__proto__"||f=="prototype"&&u>0&&o[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&d===void 0&&(c[f]===void 0?d=o.slice(0,u).join("/"):u==l-1&&(d=e.path),d!==void 0&&p(e,0,n,d)),u++,Array.isArray(c)){if(f==="-")f=c.length;else{if(t&&!Ec(f))throw new ye("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,e,n);Ec(f)&&(f=~~f)}if(u>=l){if(t&&e.op==="add"&&f>c.length)throw new ye("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,e,n);const h=xM[e.op].call(e,c,f,n);if(h.test===!1)throw new ye("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return h}}else if(u>=l){const h=Gn[e.op].call(e,c,f,n);if(h.test===!1)throw new ye("Test operation failed","TEST_OPERATION_FAILED",s,e,n);return h}if(c=c[f],t&&u<l&&(!c||typeof c!="object"))throw new ye("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,e,n)}}}function vs(n,e,t,r=!0,i=!0){if(t&&!Array.isArray(e))throw new ye("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(n=or(n));const s=new Array(e.length);for(let a=0,o=e.length;a<o;a++)s[a]=kr(n,e[a],t,!0,i,a),n=s[a].newDocument;return s.newDocument=n,s}function Tc(n,e,t,r){if(typeof n!="object"||n===null||Array.isArray(n))throw new ye("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(Gn[n.op]){if(typeof n.path!="string")throw new ye("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new ye('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new ye("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new ye("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&wc(n.value))throw new ye("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var i=n.path.split("/").length,s=r.split("/").length;if(i!==s+1&&i!==s)throw new ye("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==r)throw new ye("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var a={op:"_get",path:n.from,value:void 0},o=$M([a],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new ye("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new ye("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function $M(n,e,t){try{if(!Array.isArray(n))throw new ye("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)vs(or(e),or(n),t||!0);else{t=t||Tc;for(var r=0;r<n.length;r++)t(n[r],r,e,void 0)}}catch(i){if(i instanceof ye)return i;throw i}}function Es(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),r=Array.isArray(e),i,s,a;if(t&&r){if(s=n.length,s!=e.length)return!1;for(i=s;i--!==0;)if(!Es(n[i],e[i]))return!1;return!0}if(t!=r)return!1;var o=Object.keys(n);if(s=o.length,s!==Object.keys(e).length)return!1;for(i=s;i--!==0;)if(!e.hasOwnProperty(o[i]))return!1;for(i=s;i--!==0;)if(a=o[i],!Es(n[a],e[a]))return!1;return!0}return n!==n&&e!==e}var MM=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()};const kM=Ws(MM);var Bg={exports:{}};const DM=/[\p{Lu}]/u,FM=/[\p{Ll}]/u,Bf=/^[\p{Lu}](?![\p{Lu}])/gu,Gg=/([\p{Alpha}\p{N}_]|$)/u,Hg=/[_.\- ]+/,jM=new RegExp("^"+Hg.source),Gf=new RegExp(Hg.source+Gg.source,"gu"),Hf=new RegExp("\\d+"+Gg.source,"gu"),UM=(n,e,t)=>{let r=!1,i=!1,s=!1;for(let a=0;a<n.length;a++){const o=n[a];r&&DM.test(o)?(n=n.slice(0,a)+"-"+n.slice(a),r=!1,s=i,i=!0,a++):i&&s&&FM.test(o)?(n=n.slice(0,a-1)+"-"+n.slice(a-1),s=i,i=!1,r=!0):(r=e(o)===o&&t(o)!==o,s=i,i=t(o)===o&&e(o)!==o)}return n},BM=(n,e)=>(Bf.lastIndex=0,n.replace(Bf,t=>e(t))),GM=(n,e)=>(Gf.lastIndex=0,Hf.lastIndex=0,n.replace(Gf,(t,r)=>e(r)).replace(Hf,t=>e(t))),Wg=(n,e)=>{if(!(typeof n=="string"||Array.isArray(n)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(n)?n=n.map(s=>s.trim()).filter(s=>s.length).join("-"):n=n.trim(),n.length===0)return"";const t=e.locale===!1?s=>s.toLowerCase():s=>s.toLocaleLowerCase(e.locale),r=e.locale===!1?s=>s.toUpperCase():s=>s.toLocaleUpperCase(e.locale);return n.length===1?e.pascalCase?r(n):t(n):(n!==t(n)&&(n=UM(n,t,r)),n=n.replace(jM,""),e.preserveConsecutiveUppercase?n=BM(n,t):n=t(n),e.pascalCase&&(n=r(n.charAt(0))+n.slice(1)),GM(n,r))};Bg.exports=Wg;Bg.exports.default=Wg;function HM(n,e){return(e==null?void 0:e[n])||kM(n)}function WM(n,e,t){const r={};for(const i in n)Object.hasOwn(n,i)&&(r[e(i,t)]=n[i]);return r}function Wf(n){return Array.isArray(n)?[...n]:{...n}}function VM(n,e){const t=Wf(n);for(const[r,i]of Object.entries(e)){const[s,...a]=r.split(".").reverse();let o=t;for(const c of a.reverse()){if(o[c]===void 0)break;o[c]=Wf(o[c]),o=o[c]}o[s]!==void 0&&(o[s]={lc:1,type:"secret",id:[i]})}return t}function Vg(n){const e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}class cr{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Vg(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof cr||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce((i,s)=>(i[s]=s in this?this[s]:this.lc_kwargs[s],i),{});for(let i=Object.getPrototypeOf(this);i;i=Object.getPrototypeOf(i))Object.assign(e,Reflect.get(i,"lc_aliases",this)),Object.assign(t,Reflect.get(i,"lc_secrets",this)),Object.assign(r,Reflect.get(i,"lc_attributes",this));return Object.keys(t).forEach(i=>{let s=this,a=r;const[o,...c]=i.split(".").reverse();for(const u of c.reverse()){if(!(u in s)||s[u]===void 0)return;(!(u in a)||a[u]===void 0)&&(typeof s[u]=="object"&&s[u]!=null?a[u]={}:Array.isArray(s[u])&&(a[u]=[])),s=s[u],a=a[u]}o in s&&s[o]!==void 0&&(a[o]=a[o]||s[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:WM(Object.keys(t).length?VM(r,t):r,HM,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}const zM=()=>typeof window<"u"&&typeof window.document<"u",qM=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",ZM=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),zg=()=>typeof Deno<"u",XM=()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"&&!zg(),YM=()=>{let n;return zM()?n="browser":XM()?n="node":qM()?n="webworker":ZM()?n="jsdom":zg()?n="deno":n="other",n};let bo;async function KM(){return bo===void 0&&(bo={library:"langchain-js",runtime:YM()}),bo}function ur(n){var e;try{return typeof process<"u"?(e=process.env)==null?void 0:e[n]:void 0}catch{return}}class JM{}class hi extends JM{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Vg(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:ur("LANGCHAIN_CALLBACKS_BACKGROUND")!=="true"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return cr.prototype.toJSON.call(this)}toJSONNotImplemented(){return cr.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends hi{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Wn.v4()}),Object.assign(this,e)}}return new t}}function vo(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}function QM(n){return n.replace(/[-:.]/g,"")}function ek(n,e,t){const r=t.toFixed(0).slice(0,3).padStart(3,"0");return QM(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}function Rr(n){return typeof n._addRunToRunMap=="function"}class mi extends hi{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const t=ek(e.start_time,e.id,e.execution_order),r={...e};if(r.parent_run_id!==void 0){const i=this.runMap.get(r.parent_run_id);i&&(this._addChildRun(i,r),i.child_execution_order=Math.max(i.child_execution_order,r.child_execution_order),r.trace_id=i.trace_id,i.dotted_order!==void 0&&(r.dotted_order=[i.dotted_order,t].join(".")))}else r.trace_id=r.id,r.dotted_order=t;return this.runMap.set(r.id,r),r}async _endTrace(e){var r;const t=e.parent_run_id!==void 0&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await((r=this.onRunUpdate)==null?void 0:r.call(this,e))}_getExecutionOrder(e){const t=e!==void 0&&this.runMap.get(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,i,s,a,o,c){const u=this._getExecutionOrder(i),l=Date.now(),d=o?{...s,metadata:o}:s,f={id:r,name:c??e.id[e.id.length-1],parent_run_id:i,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{prompts:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:a||[]};return this._addRunToRunMap(f)}async handleLLMStart(e,t,r,i,s,a,o,c){var l,d;const u=this.runMap.get(r)??this._createRunForLLMStart(e,t,r,i,s,a,o,c);return await((l=this.onRunCreate)==null?void 0:l.call(this,u)),await((d=this.onLLMStart)==null?void 0:d.call(this,u)),u}_createRunForChatModelStart(e,t,r,i,s,a,o,c){const u=this._getExecutionOrder(i),l=Date.now(),d=o?{...s,metadata:o}:s,f={id:r,name:c??e.id[e.id.length-1],parent_run_id:i,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{messages:t},execution_order:u,child_runs:[],child_execution_order:u,run_type:"llm",extra:d??{},tags:a||[]};return this._addRunToRunMap(f)}async handleChatModelStart(e,t,r,i,s,a,o,c){var l,d;const u=this.runMap.get(r)??this._createRunForChatModelStart(e,t,r,i,s,a,o,c);return await((l=this.onRunCreate)==null?void 0:l.call(this,u)),await((d=this.onLLMStart)==null?void 0:d.call(this,u)),u}async handleLLMEnd(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((i=this.onLLMEnd)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleLLMError(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="llm")throw new Error("No LLM run to end.");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((i=this.onLLMError)==null?void 0:i.call(this,r)),await this._endTrace(r),r}_createRunForChainStart(e,t,r,i,s,a,o,c){const u=this._getExecutionOrder(i),l=Date.now(),d={id:r,name:c??e.id[e.id.length-1],parent_run_id:i,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:t,execution_order:u,child_execution_order:u,run_type:o??"chain",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return this._addRunToRunMap(d)}async handleChainStart(e,t,r,i,s,a,o,c){var l,d;const u=this.runMap.get(r)??this._createRunForChainStart(e,t,r,i,s,a,o,c);return await((l=this.onRunCreate)==null?void 0:l.call(this,u)),await((d=this.onChainStart)==null?void 0:d.call(this,u)),u}async handleChainEnd(e,t,r,i,s){var o;const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.outputs=vo(e,"output"),a.events.push({name:"end",time:new Date(a.end_time).toISOString()}),(s==null?void 0:s.inputs)!==void 0&&(a.inputs=vo(s.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,a)),await this._endTrace(a),a}async handleChainError(e,t,r,i,s){var o;const a=this.runMap.get(t);if(!a)throw new Error("No chain run to end.");return a.end_time=Date.now(),a.error=this.stringifyError(e),a.events.push({name:"error",time:new Date(a.end_time).toISOString()}),(s==null?void 0:s.inputs)!==void 0&&(a.inputs=vo(s.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,a)),await this._endTrace(a),a}_createRunForToolStart(e,t,r,i,s,a,o){const c=this._getExecutionOrder(i),u=Date.now(),l={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{input:t},execution_order:c,child_execution_order:c,run_type:"tool",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return this._addRunToRunMap(l)}async handleToolStart(e,t,r,i,s,a,o){var u,l;const c=this.runMap.get(r)??this._createRunForToolStart(e,t,r,i,s,a,o);return await((u=this.onRunCreate)==null?void 0:u.call(this,c)),await((l=this.onToolStart)==null?void 0:l.call(this,c)),c}async handleToolEnd(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((i=this.onToolEnd)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleToolError(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((i=this.onToolError)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleAgentAction(e,t){var s;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const i=r;i.actions=i.actions||[],i.actions.push(e),i.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((s=this.onAgentAction)==null?void 0:s.call(this,r))}async handleAgentEnd(e,t){var i;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentEnd)==null?void 0:i.call(this,r)))}_createRunForRetrieverStart(e,t,r,i,s,a,o){const c=this._getExecutionOrder(i),u=Date.now(),l={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{query:t},execution_order:c,child_execution_order:c,run_type:"retriever",child_runs:[],extra:a?{metadata:a}:{},tags:s||[]};return this._addRunToRunMap(l)}async handleRetrieverStart(e,t,r,i,s,a,o){var u,l;const c=this.runMap.get(r)??this._createRunForRetrieverStart(e,t,r,i,s,a,o);return await((u=this.onRunCreate)==null?void 0:u.call(this,c)),await((l=this.onRetrieverStart)==null?void 0:l.call(this,c)),c}async handleRetrieverEnd(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((i=this.onRetrieverEnd)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleRetrieverError(e,t){var i;const r=this.runMap.get(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((i=this.onRetrieverError)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleText(e,t){var i;const r=this.runMap.get(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((i=this.onText)==null?void 0:i.call(this,r)))}async handleLLMNewToken(e,t,r,i,s,a){var c;const o=this.runMap.get(r);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:a==null?void 0:a.chunk}}),await((c=this.onLLMNewToken)==null?void 0:c.call(this,o,e,{chunk:a==null?void 0:a.chunk})),o}}var Qu={exports:{}};Qu.exports;(function(n){const t=(s=0)=>a=>`\x1B[${38+s};5;${a}m`,r=(s=0)=>(a,o,c)=>`\x1B[${38+s};2;${a};${o};${c}m`;function i(){const s=new Map,a={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};a.color.gray=a.color.blackBright,a.bgColor.bgGray=a.bgColor.bgBlackBright,a.color.grey=a.color.blackBright,a.bgColor.bgGrey=a.bgColor.bgBlackBright;for(const[o,c]of Object.entries(a)){for(const[u,l]of Object.entries(c))a[u]={open:`\x1B[${l[0]}m`,close:`\x1B[${l[1]}m`},c[u]=a[u],s.set(l[0],l[1]);Object.defineProperty(a,o,{value:c,enumerable:!1})}return Object.defineProperty(a,"codes",{value:s,enumerable:!1}),a.color.close="\x1B[39m",a.bgColor.close="\x1B[49m",a.color.ansi256=t(),a.color.ansi16m=r(),a.bgColor.ansi256=t(10),a.bgColor.ansi16m=r(10),Object.defineProperties(a,{rgbToAnsi256:{value:(o,c,u)=>o===c&&c===u?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(c/255*5)+Math.round(u/255*5),enumerable:!1},hexToRgb:{value:o=>{const c=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!c)return[0,0,0];let{colorString:u}=c.groups;u.length===3&&(u=u.split("").map(d=>d+d).join(""));const l=Number.parseInt(u,16);return[l>>16&255,l>>8&255,l&255]},enumerable:!1},hexToAnsi256:{value:o=>a.rgbToAnsi256(...a.hexToRgb(o)),enumerable:!1}}),a}Object.defineProperty(n,"exports",{enumerable:!0,get:i})})(Qu);var tk=Qu.exports;const qg=Ws(tk);function Ce(n,e){return`${n.open}${e}${n.close}`}function Xe(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function Vf(n){return typeof n=="string"?n.trim():n==null?n:Xe(n,n.toString())}function zt(n){if(!n.end_time)return"";const e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:Fe}=qg;class zf extends mi{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const i=this.runMap.get(r.parent_run_id);if(i)t.push(i),r=i;else break}return t}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((i,s,a)=>{const o=`${i.execution_order}:${i.run_type}:${i.name}`;return s===a.length-1?Ce(qg.bold,o):o}).join(" > ");return Ce(Fe.grey,r)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Xe(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.cyan,"[chain/end]")} [${t}] [${zt(e)}] Exiting Chain run with output: ${Xe(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.red,"[chain/error]")} [${t}] [${zt(e)}] Chain run errored with error: ${Xe(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(i=>i.trim())}:e.inputs;console.log(`${Ce(Fe.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Xe(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.cyan,"[llm/end]")} [${t}] [${zt(e)}] Exiting LLM run with output: ${Xe(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.red,"[llm/error]")} [${t}] [${zt(e)}] LLM run errored with error: ${Xe(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.green,"[tool/start]")} [${t}] Entering Tool run with input: "${Vf(e.inputs.input)}"`)}onToolEnd(e){var r;const t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.cyan,"[tool/end]")} [${t}] [${zt(e)}] Exiting Tool run with output: "${Vf((r=e.outputs)==null?void 0:r.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.red,"[tool/error]")} [${t}] [${zt(e)}] Tool run errored with error: ${Xe(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Xe(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.cyan,"[retriever/end]")} [${t}] [${zt(e)}] Exiting Retriever run with output: ${Xe(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${Ce(Fe.red,"[retriever/error]")} [${t}] [${zt(e)}] Retriever run errored with error: ${Xe(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${Ce(Fe.blue,"[agent/action]")} [${r}] Agent selected action: ${Xe(t.actions[t.actions.length-1],"[action]")}`)}}function nk(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="tool_call")}class rk extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function ik(n){if(typeof n>"u")return null;try{return JSON.parse(n)}catch{}let e="";const t=[];let r=!1,i=!1;for(let s of n){if(r)s==='"'&&!i?r=!1:s===`
`&&!i?s="\\n":s==="\\"?i=!i:i=!1;else if(s==='"')r=!0,i=!1;else if(s==="{")t.push("}");else if(s==="[")t.push("]");else if(s==="}"||s==="]")if(t&&t[t.length-1]===s)t.pop();else return null;e+=s}r&&(e+='"');for(let s=t.length-1;s>=0;s-=1)e+=t[s];try{return JSON.parse(e)}catch{return null}}function sk(n,e){return typeof n=="string"?typeof e=="string"?n+e:[{type:"text",text:n},...e]:Array.isArray(e)?el(n,e)??[...n,...e]:[...n,{type:"text",text:e}]}function ak(n,e){function t(r,i){if(typeof r!="object"||r===null||r===void 0)return r;if(i>=e)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(a=>t(a,i+1));const s={};for(const a of Object.keys(r))s[a]=t(r[a],i+1);return s}return JSON.stringify(t(n,0),null,2)}class ok extends cr{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:""}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const t=ak(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}}function ws(n,e){const t={...n};for(const[r,i]of Object.entries(e))if(t[r]==null)t[r]=i;else{if(i==null)continue;if(typeof t[r]!=typeof i||Array.isArray(t[r])!==Array.isArray(i))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof t[r]=="string"){if(r==="type")continue;t[r]+=i}else if(typeof t[r]=="object"&&!Array.isArray(t[r]))t[r]=ws(t[r],i);else if(Array.isArray(t[r]))t[r]=el(t[r],i);else{if(t[r]===i)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return t}function el(n,e){if(!(n===void 0&&e===void 0)){if(n===void 0||e===void 0)return n||e;{const t=[...n];for(const r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){const i=t.findIndex(s=>s.index===r.index);i!==-1?t[i]=ws(t[i],r):t.push(r)}else{if(typeof r=="object"&&"text"in r&&r.text==="")continue;t.push(r)}return t}}}class ck extends ok{}class da extends ck{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[]};else{const r=[],i=[];for(const s of e.tool_call_chunks){let a={};try{if(a=ik(s.args||"{}"),a===null||typeof a!="object"||Array.isArray(a))throw new Error("Malformed tool call chunk args.");r.push({name:s.name??"",args:a,id:s.id,type:"tool_call"})}catch{i.push({name:s.name,args:s.args,id:s.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:r,invalid_tool_calls:i}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){const t={content:sk(this.content,e.content),additional_kwargs:ws(this.additional_kwargs,e.additional_kwargs),response_metadata:ws(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const r=el(this.tool_call_chunks,e.tool_call_chunks);r!==void 0&&r.length>0&&(t.tool_call_chunks=r)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const r=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},i=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},s={input_tokens:r.input_tokens+i.input_tokens,output_tokens:r.output_tokens+i.output_tokens,total_tokens:r.total_tokens+i.total_tokens};t.usage_metadata=s}return new da(t)}}function uk(n,e="Human",t="AI"){const r=[];for(const i of n){let s;if(i._getType()==="human")s=e;else if(i._getType()==="ai")s=t;else if(i._getType()==="system")s="System";else if(i._getType()==="function")s="Function";else if(i._getType()==="tool")s="Tool";else if(i._getType()==="generic")s=i.role;else throw new Error(`Got unsupported message type: ${i._getType()}`);const a=i.name?`${i.name}, `:"",o=typeof i.content=="string"?i.content:JSON.stringify(i.content,null,2);r.push(`${s}: ${a}${o}`)}return r.join(`
`)}class Dr extends mi{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{exampleId:t,projectName:r,client:i}=e;this.projectName=r??ur("LANGCHAIN_PROJECT")??ur("LANGCHAIN_SESSION"),this.exampleId=t,this.client=i??new qr({});const s=Dr.getTraceableRunTree();s&&this.updateFromRunTree(s)}async _convertToCreate(e,t=void 0){return{...e,extra:{...e.extra,runtime:await KM()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){const t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){const t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}updateFromRunTree(e){let t=e;const r=new Set;for(;t.parent_run&&!(r.has(t.id)||(r.add(t.id),!t.parent_run));)t=t.parent_run;r.clear();const i=[t];for(;i.length>0;){const s=i.shift();!s||r.has(s.id)||(r.add(s.id),this.runMap.set(s.id,s),s.child_runs&&i.push(...s.child_runs))}this.client=e.client??this.client,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}convertToRunTree(e){const t={},r=[];for(const[i,s]of this.runMap){const a=new Be({...s,child_runs:[],parent_run:void 0,client:this.client,project_name:this.projectName,reference_example_id:this.exampleId,tracingEnabled:!0});t[i]=a,r.push([i,s.dotted_order])}r.sort((i,s)=>!i[1]||!s[1]?0:i[1].localeCompare(s[1]));for(const[i]of r){const s=this.runMap.get(i),a=t[i];if(!(!s||!a)&&s.parent_run_id){const o=t[s.parent_run_id];o&&(o.child_runs.push(a),a.parent_run=o)}}return t[e]}static getTraceableRunTree(){try{return RM()}catch{return}}}let Eo;function lk(){const n="default"in $t?$t.default:$t;return new n({autoStart:!0,concurrency:1})}async function we(n,e){e===!0?await n():(typeof Eo>"u"&&(Eo=lk()),Eo.add(n))}const dk=n=>n!==void 0?n:!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>ur(t)==="true");class fk{setHandler(e){return this.setHandlers([e])}}class fa{constructor(e,t,r,i,s,a,o,c){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:c})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>we(async()=>{var r;try{await((r=t.handleText)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}async handleCustomEvent(e,t,r,i,s){await Promise.all(this.handlers.map(a=>we(async()=>{var o;try{await((o=a.handleCustomEvent)==null?void 0:o.call(a,e,t,this.runId,this.tags,this.metadata))}catch(c){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${c}`),a.raiseError)throw c}},a.awaitHandlers)))}}class pk extends fa{getChild(e){const t=new wt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>we(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw i}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>we(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${i}`),t.raiseError)throw e}},t.awaitHandlers)))}}class qf extends fa{async handleLLMNewToken(e,t,r,i,s,a){await Promise.all(this.handlers.map(o=>we(async()=>{var c;if(!o.ignoreLLM)try{await((c=o.handleLLMNewToken)==null?void 0:c.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,a))}catch(u){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${u}`),o.raiseError)throw u}},o.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>we(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMError: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>we(async()=>{var r;if(!t.ignoreLLM)try{await((r=t.handleLLMEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleLLMEnd: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}}class hk extends fa{getChild(e){const t=new wt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,i,s){await Promise.all(this.handlers.map(a=>we(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainError)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,s))}catch(c){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainError: ${c}`),a.raiseError)throw c}},a.awaitHandlers)))}async handleChainEnd(e,t,r,i,s){await Promise.all(this.handlers.map(a=>we(async()=>{var o;if(!a.ignoreChain)try{await((o=a.handleChainEnd)==null?void 0:o.call(a,e,this.runId,this._parentRunId,this.tags,s))}catch(c){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleChainEnd: ${c}`),a.raiseError)throw c}},a.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>we(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentAction)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>we(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}}class mk extends fa{getChild(e){const t=new wt(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>we(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>we(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}}class wt extends fk{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(t==null?void 0:t.handlers)??this.handlers,this.inheritableHandlers=(t==null?void 0:t.inheritableHandlers)??this.inheritableHandlers,this.tags=(t==null?void 0:t.tags)??this.tags,this.inheritableTags=(t==null?void 0:t.inheritableTags)??this.inheritableTags,this.metadata=(t==null?void 0:t.metadata)??this.metadata,this.inheritableMetadata=(t==null?void 0:t.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r=void 0,i=void 0,s=void 0,a=void 0,o=void 0,c=void 0){return Promise.all(t.map(async(u,l)=>{const d=l===0&&r?r:Ke.v4();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Rr(f)&&f._createRunForLLMStart(e,[u],d,this._parentRunId,s,this.tags,this.metadata,c),we(async()=>{var p;try{await((p=f.handleLLMStart)==null?void 0:p.call(f,e,[u],d,this._parentRunId,s,this.tags,this.metadata,c))}catch(h){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${h}`),f.raiseError)throw h}},f.awaitHandlers)})),new qf(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r=void 0,i=void 0,s=void 0,a=void 0,o=void 0,c=void 0){return Promise.all(t.map(async(u,l)=>{const d=l===0&&r?r:Ke.v4();return await Promise.all(this.handlers.map(f=>{if(!f.ignoreLLM)return Rr(f)&&f._createRunForChatModelStart(e,[u],d,this._parentRunId,s,this.tags,this.metadata,c),we(async()=>{var p,h;try{if(f.handleChatModelStart)await((p=f.handleChatModelStart)==null?void 0:p.call(f,e,[u],d,this._parentRunId,s,this.tags,this.metadata,c));else if(f.handleLLMStart){const m=uk(u);await((h=f.handleLLMStart)==null?void 0:h.call(f,e,[m],d,this._parentRunId,s,this.tags,this.metadata,c))}}catch(m){if((f.raiseError?console.error:console.warn)(`Error in handler ${f.constructor.name}, handleLLMStart: ${m}`),f.raiseError)throw m}},f.awaitHandlers)})),new qf(d,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=Ke.v4(),i=void 0,s=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(c=>{if(!c.ignoreChain)return Rr(c)&&c._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,i,o),we(async()=>{var u;try{await((u=c.handleChainStart)==null?void 0:u.call(c,e,t,r,this._parentRunId,this.tags,this.metadata,i,o))}catch(l){if((c.raiseError?console.error:console.warn)(`Error in handler ${c.constructor.name}, handleChainStart: ${l}`),c.raiseError)throw l}},c.awaitHandlers)})),new hk(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=Ke.v4(),i=void 0,s=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(c=>{if(!c.ignoreAgent)return Rr(c)&&c._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),we(async()=>{var u;try{await((u=c.handleToolStart)==null?void 0:u.call(c,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(l){if((c.raiseError?console.error:console.warn)(`Error in handler ${c.constructor.name}, handleToolStart: ${l}`),c.raiseError)throw l}},c.awaitHandlers)})),new mk(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=Ke.v4(),i=void 0,s=void 0,a=void 0,o=void 0){return await Promise.all(this.handlers.map(c=>{if(!c.ignoreRetriever)return Rr(c)&&c._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),we(async()=>{var u;try{await((u=c.handleRetrieverStart)==null?void 0:u.call(c,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(l){if((c.raiseError?console.error:console.warn)(`Error in handler ${c.constructor.name}, handleRetrieverStart: ${l}`),c.raiseError)throw l}},c.awaitHandlers)})),new pk(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,i,s){await Promise.all(this.handlers.map(a=>we(async()=>{var o;if(!a.ignoreCustomEvent)try{await((o=a.handleCustomEvent)==null?void 0:o.call(a,e,t,r,this.tags,this.metadata))}catch(c){if((a.raiseError?console.error:console.warn)(`Error in handler ${a.constructor.name}, handleCustomEvent: ${c}`),a.raiseError)throw c}},a.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new wt(this._parentRunId);for(const i of this.handlers){const s=this.inheritableHandlers.includes(i);r.addHandler(i,s)}for(const i of this.tags){const s=this.inheritableTags.includes(i);r.addTags([i],s)}for(const i of Object.keys(this.metadata)){const s=Object.keys(this.inheritableMetadata).includes(i);r.addMetadata({[i]:this.metadata[i]},s)}for(const i of e)r.handlers.filter(s=>s.name==="console_callback_handler").some(s=>s.name===i.name)||r.addHandler(i,t);return r}static fromHandlers(e){class t extends hi{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Ke.v4()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static async configure(e,t,r,i,s,a,o){return this._configureSync(e,t,r,i,s,a,o)}static _configureSync(e,t,r,i,s,a,o){var f,p;let c;(e||t)&&(Array.isArray(e)||!e?(c=new wt,c.setHandlers((e==null?void 0:e.map(Ss))??[],!0)):c=e,c=c.copy(Array.isArray(t)?t.map(Ss):t==null?void 0:t.handlers,!1));const u=ur("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),l=((f=Dr.getTraceableRunTree())==null?void 0:f.tracingEnabled)||dk(),d=l||(ur("LANGCHAIN_TRACING")??!1);if(u||d){if(c||(c=new wt),u&&!c.handlers.some(h=>h.name===zf.prototype.name)){const h=new zf;c.addHandler(h,!0)}if(d&&!c.handlers.some(h=>h.name==="langchain_tracer")&&l){const h=new Dr;c.addHandler(h,!0),c._parentRunId=((p=Dr.getTraceableRunTree())==null?void 0:p.id)??c._parentRunId}}return(r||i)&&c&&(c.addTags(r??[]),c.addTags(i??[],!1)),(s||a)&&c&&(c.addMetadata(s??{}),c.addMetadata(a??{},!1)),c}}function Ss(n){return"name"in n?n:hi.fromMethods(n)}class gk{getStore(){}run(e,t){return t()}}const _k=new gk,wo=Symbol.for("ls:tracing_async_local_storage"),Zf=Symbol.for("lc:child_config");class yk{getInstance(){return globalThis[wo]??_k}getRunnableConfig(){var t,r;return(r=(t=this.getInstance().getStore())==null?void 0:t.extra)==null?void 0:r[Zf]}runWithConfig(e,t,r){var u;const i=wt._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),s=this.getInstance(),a=i==null?void 0:i.getParentRunId(),o=(u=i==null?void 0:i.handlers)==null?void 0:u.find(l=>(l==null?void 0:l.name)==="langchain_tracer");let c;return o&&a?c=o.convertToRunTree(a):r||(c=new Be({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra={...c.extra,[Zf]:e}),s.run(c,t)}initializeGlobalInstance(e){globalThis[wo]===void 0&&(globalThis[wo]=e)}}const An=new yk;async function tn(n,e){if(e===void 0)return n;let t;return Promise.race([n.catch(r=>{if(!(e!=null&&e.aborted))throw r}),new Promise((r,i)=>{t=()=>{i(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&i(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}class ze extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const t=e.getReader();return new ze({start(r){return i();function i(){return t.read().then(({done:s,value:a})=>{if(s){r.close();return}return r.enqueue(a),i()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new ze({async pull(t){const{value:r,done:i}=await e.next();i&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}}function Zg(n,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(i){for(;;)if(i.length===0){const s=await n.next();for(const a of t)a.push(s)}else{if(i[0].done)return;yield i.shift().value}})}function Mt(n,e){if(Array.isArray(n)&&Array.isArray(e))return n.concat(e);if(typeof n=="string"&&typeof e=="string")return n+e;if(typeof n=="number"&&typeof e=="number")return n+e;if("concat"in n&&typeof n.concat=="function")return n.concat(e);if(typeof n=="object"&&typeof e=="object"){const t={...n};for(const[r,i]of Object.entries(e))r in t&&!Array.isArray(t[r])?t[r]=Mt(t[r],i):t[r]=i;return t}else throw new Error(`Cannot concat ${typeof n} and ${typeof e}`)}class _r{constructor(e){var t;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((t=this.config)==null?void 0:t.signal),this.setup=new Promise((r,i)=>{An.runWithConfig(e.config,async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(r,i):this.firstResult.then(s=>r(void 0),i)},!0)})}async next(...e){var t;return(t=this.signal)==null||t.throwIfAborted(),this.firstResultUsed?An.runWithConfig(this.config,this.signal?async()=>tn(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function bk(n,e,t,r,...i){const s=new _r({generator:e,startSetup:t,signal:r}),a=await s.setup;return{output:n(s,a,...i),setup:a}}class Xt{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),r=vs({},t);return new Zr({ops:t,state:r[r.length-1].newDocument})}}class Zr extends Xt{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),r=vs(this.state,e.ops);return new Zr({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){const t=vs({},e.ops);return new Zr({ops:e.ops,state:t[t.length-1].newDocument})}}const vk=n=>n.name==="log_stream_tracer";async function Xf(n,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=n;if(["retriever","llm","prompt"].includes(n.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function Yf(n,e){const{outputs:t}=n;return e==="original"||["retriever","llm","prompt"].includes(n.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function Ek(n){return n!==void 0&&n.message!==void 0}class Kf extends mi{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=ze.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||t.find(i=>{var s;return(s=this.includeTags)==null?void 0:s.includes(i)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&t.every(i=>{var s;return!((s=this.excludeTags)!=null&&s.includes(i))})),r}async*tapOutputIterable(e,t){for await(const r of t){if(e!==this.rootId){const i=this.keyMapByRunId[e];i&&await this.writer.write(new Xt({ops:[{op:"add",path:`/logs/${i}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){var i;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Xt({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await Xf(e,this._schemaFormat)),await this.writer.write(new Xt({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await Xf(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await Yf(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const i=new Xt({ops:r});await this.writer.write(i)}finally{if(e.id===this.rootId){const t=new Xt({ops:[{op:"replace",path:"/final_output",value:await Yf(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){const i=this.keyMapByRunId[e.id];if(i===void 0)return;const s=e.inputs.messages!==void 0;let a;s?Ek(r==null?void 0:r.chunk)?a=r==null?void 0:r.chunk:a=new da({id:`run-${e.id}`,content:t}):a=t;const o=new Xt({ops:[{op:"add",path:`/logs/${i}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${i}/streamed_output/-`,value:a}]});await this.writer.write(o)}}class Ts{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new Ts({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}function zi({name:n,serialized:e}){return n!==void 0?n:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const wk=n=>n.name==="event_stream_tracer";class Sk extends mi{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=ze.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||t.find(i=>{var s;return(s=this.includeTags)==null?void 0:s.includes(i)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&t.every(i=>{var s;return!((s=this.excludeTags)!=null&&s.includes(i))})),r}async*tapOutputIterable(e,t){const r=await t.next();if(r.done)return;const i=this.runInfoMap.get(e);if(i===void 0){yield r.value;return}function s(o,c){return o==="llm"&&typeof c=="string"?new Ts({text:c}):c}let a=this.tappedPromises.get(e);if(a===void 0){let o;a=new Promise(c=>{o=c}),this.tappedPromises.set(e,a);try{const c={event:`on_${i.runType}_stream`,run_id:e,name:i.name,tags:i.tags,metadata:i.metadata,data:{}};await this.send({...c,data:{chunk:s(i.runType,r.value)}},i),yield r.value;for await(const u of t)i.runType!=="tool"&&i.runType!=="retriever"&&await this.send({...c,data:{chunk:s(i.runType,u)}},i),yield u}finally{o()}}else{yield r.value;for await(const o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){var a,o;const t=zi(e),r=e.inputs.messages!==void 0?"chat_model":"llm",i={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,i);const s=`on_${r}_start`;await this.send({event:s,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},i)}async onLLMNewToken(e,t,r){const i=this.runInfoMap.get(e.id);let s,a;if(i===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(i.runType==="chat_model")a="on_chat_model_stream",(r==null?void 0:r.chunk)===void 0?s=new da({content:t,id:`run-${e.id}`}):s=r.chunk.message;else if(i.runType==="llm")a="on_llm_stream",(r==null?void 0:r.chunk)===void 0?s=new Ts({text:t}):s=r.chunk;else throw new Error(`Unexpected run type ${i.runType}`);await this.send({event:a,data:{chunk:s},run_id:e.id,name:i.name,tags:i.tags,metadata:i.metadata},i)}}async onLLMEnd(e){var a,o,c;const t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const i=(a=e.outputs)==null?void 0:a.generations;let s;if(t.runType==="chat_model"){for(const u of i??[]){if(s!==void 0)break;s=(o=u[0])==null?void 0:o.message}r="on_chat_model_end"}else if(t.runType==="llm")s={generations:i==null?void 0:i.map(u=>u.map(l=>({text:l.text,generationInfo:l.generationInfo}))),llmOutput:((c=e.outputs)==null?void 0:c.llmOutput)??{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:r,data:{output:s,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){var a,o;const t=zi(e),r=e.run_type??"chain",i={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:e.run_type};let s={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(s={},i.inputs={}):e.inputs.input!==void 0?(s.input=e.inputs.input,i.inputs=e.inputs.input):(s.input=e.inputs,i.inputs=e.inputs),this.runInfoMap.set(e.id,i),await this.send({event:`on_${r}_start`,data:s,name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},i)}async onChainEnd(e){var o;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const r=`on_${e.run_type}_end`,i=e.inputs??t.inputs??{},a={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:i};i.input&&Object.keys(i).length===1&&(a.input=i.input,t.inputs=i.input),await this.sendEndEvent({event:r,data:a,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){var i,s;const t=zi(e),r={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{}},r)}async onToolEnd(e){var i;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const r=((i=e.outputs)==null?void 0:i.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){var s,a;const t=zi(e),r="retriever",i={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:r,inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,i),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:((a=e.extra)==null?void 0:a.metadata)??{}},i)}async onRetrieverEnd(e){var r;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((r=e.outputs)==null?void 0:r.documents)??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){const i=this.runInfoMap.get(r);if(i===void 0)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:i.tags,metadata:i.metadata,data:t},i)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const So=25;async function ct(n){return wt._configureSync(n==null?void 0:n.callbacks,void 0,n==null?void 0:n.tags,void 0,n==null?void 0:n.metadata)}function Jf(...n){const e={};for(const t of n.filter(r=>!!r))for(const r of Object.keys(t))if(r==="metadata")e[r]={...e[r],...t[r]};else if(r==="tags"){const i=e[r]??[];e[r]=[...new Set(i.concat(t[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...t[r]};else if(r==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(r==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(r==="callbacks"){const i=e.callbacks,s=t.callbacks;if(Array.isArray(s))if(!i)e.callbacks=s;else if(Array.isArray(i))e.callbacks=i.concat(s);else{const a=i.copy();for(const o of s)a.addHandler(Ss(o),!0);e.callbacks=a}else if(s)if(!i)e.callbacks=s;else if(Array.isArray(i)){const a=s.copy();for(const o of i)a.addHandler(Ss(o),!0);e.callbacks=a}else e.callbacks=new wt(s._parentRunId,{handlers:i.handlers.concat(s.handlers),inheritableHandlers:i.inheritableHandlers.concat(s.inheritableHandlers),tags:Array.from(new Set(i.tags.concat(s.tags))),inheritableTags:Array.from(new Set(i.inheritableTags.concat(s.inheritableTags))),metadata:{...i.metadata,...s.metadata}})}else{const i=r;e[i]=t[i]??e[i]}return e}const Tk=new Set(["string","number","boolean"]);function ie(n){var r;const e=An.getRunnableConfig();let t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:i,runName:s,...a}=e;t=Object.entries(a).reduce((o,[c,u])=>(u!==void 0&&(o[c]=u),o),t)}if(n&&(t=Object.entries(n).reduce((i,[s,a])=>(a!==void 0&&(i[s]=a),i),t)),t!=null&&t.configurable)for(const i of Object.keys(t.configurable))Tk.has(typeof t.configurable[i])&&!((r=t.metadata)!=null&&r[i])&&(t.metadata||(t.metadata={}),t.metadata[i]=t.configurable[i]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");const i=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,i])):t.signal=i,delete t.timeout}return t}function Ie(n={},{callbacks:e,maxConcurrency:t,recursionLimit:r,runName:i,configurable:s,runId:a}={}){const o=ie(n);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),t!==void 0&&(o.maxConcurrency=t),i!==void 0&&(o.runName=i),s!==void 0&&(o.configurable={...o.configurable,...s}),a!==void 0&&delete o.runId,o}const Ak=[400,401,402,403,404,405,406,407,409],Ok=n=>{var t,r;if(n.message.startsWith("Cancel")||n.message.startsWith("AbortError")||n.name==="AbortError"||(n==null?void 0:n.code)==="ECONNABORTED")throw n;const e=((t=n==null?void 0:n.response)==null?void 0:t.status)??(n==null?void 0:n.status);if(e&&Ak.includes(+e))throw n;if(((r=n==null?void 0:n.error)==null?void 0:r.code)==="insufficient_quota"){const i=new Error(n==null?void 0:n.message);throw i.name="InsufficientQuotaError",i}};class Rk{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??Ok;const t="default"in $t?$t.default:$t;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>_s(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((i,s)=>{var a;(a=e.signal)==null||a.addEventListener("abort",()=>{s(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}class Xg extends mi{constructor({config:e,onStart:t,onEnd:r,onError:i}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=i}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&(this.argOnStart.length===1?await this.argOnStart(e):this.argOnStart.length===2&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(this.argOnError.length===1?await this.argOnError(e):this.argOnError.length===2&&await this.argOnError(e,this.config)):this.argOnEnd&&(this.argOnEnd.length===1?await this.argOnEnd(e):this.argOnEnd.length===2&&await this.argOnEnd(e,this.config)))}}function tl(n){return n?n.lc_runnable:!1}class Ik{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const i=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(t)),this.includeTags!==void 0&&(r=r||i.some(s=>{var a;return(a=this.includeTags)==null?void 0:a.includes(s)})),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(r=r&&i.every(s=>{var a;return!((a=this.excludeTags)!=null&&a.includes(s))})),r}}const Pk=Symbol("Let zodToJsonSchema decide on which parser to use"),Qf={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Ck=n=>typeof n=="string"?{...Qf,name:n}:{...Qf,...n},Nk=n=>{const e=Ck(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,i])=>[i._def,{def:i._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function Yg(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function ne(n,e,t,r,i){n[e]=t,Yg(n,e,r,i)}function Lk(){return{}}function xk(n,e){var r,i,s;const t={type:"array"};return(r=n.type)!=null&&r._def&&((s=(i=n.type)==null?void 0:i._def)==null?void 0:s.typeName)!==$.ZodFirstPartyTypeKind.ZodAny&&(t.items=ee(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&ne(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&ne(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(ne(t,"minItems",n.exactLength.value,n.exactLength.message,e),ne(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function $k(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?ne(t,"minimum",r.value,r.message,e):ne(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),ne(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?ne(t,"maximum",r.value,r.message,e):ne(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),ne(t,"maximum",r.value,r.message,e));break;case"multipleOf":ne(t,"multipleOf",r.value,r.message,e);break}return t}function Mk(){return{type:"boolean"}}function Kg(n,e){return ee(n.type._def,e)}const kk=(n,e)=>ee(n.innerType._def,e);function Jg(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((i,s)=>Jg(n,e,i))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Dk(n,e)}}const Dk=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":ne(t,"minimum",r.value,r.message,e);break;case"max":ne(t,"maximum",r.value,r.message,e);break}return t};function Fk(n,e){return{...ee(n.innerType._def,e),default:n.defaultValue()}}function jk(n,e){return e.effectStrategy==="input"?ee(n.schema._def,e):{}}function Uk(n){return{type:"string",enum:Array.from(n.values)}}const Bk=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function Gk(n,e){const t=[ee(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),ee(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const i=[];return t.forEach(s=>{if(Bk(s))i.push(...s.allOf),s.unevaluatedProperties===void 0&&(r=void 0);else{let a=s;if("additionalProperties"in s&&s.additionalProperties===!1){const{additionalProperties:o,...c}=s;a=c}else r=void 0;i.push(a)}}),i.length?{allOf:i,...r}:void 0}function Hk(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let To;const nt={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(To===void 0&&(To=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),To),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Qg(n,e){const t={type:"string"};if(n.checks)for(const r of n.checks)switch(r.kind){case"min":ne(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e);break;case"max":ne(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":rt(t,"email",r.message,e);break;case"format:idn-email":rt(t,"idn-email",r.message,e);break;case"pattern:zod":Ne(t,nt.email,r.message,e);break}break;case"url":rt(t,"uri",r.message,e);break;case"uuid":rt(t,"uuid",r.message,e);break;case"regex":Ne(t,r.regex,r.message,e);break;case"cuid":Ne(t,nt.cuid,r.message,e);break;case"cuid2":Ne(t,nt.cuid2,r.message,e);break;case"startsWith":Ne(t,RegExp(`^${Ao(r.value,e)}`),r.message,e);break;case"endsWith":Ne(t,RegExp(`${Ao(r.value,e)}$`),r.message,e);break;case"datetime":rt(t,"date-time",r.message,e);break;case"date":rt(t,"date",r.message,e);break;case"time":rt(t,"time",r.message,e);break;case"duration":rt(t,"duration",r.message,e);break;case"length":ne(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e),ne(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"includes":{Ne(t,RegExp(Ao(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&rt(t,"ipv4",r.message,e),r.version!=="v4"&&rt(t,"ipv6",r.message,e);break}case"base64url":Ne(t,nt.base64url,r.message,e);break;case"jwt":Ne(t,nt.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&Ne(t,nt.ipv4Cidr,r.message,e),r.version!=="v4"&&Ne(t,nt.ipv6Cidr,r.message,e);break}case"emoji":Ne(t,nt.emoji(),r.message,e);break;case"ulid":{Ne(t,nt.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{rt(t,"binary",r.message,e);break}case"contentEncoding:base64":{ne(t,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{Ne(t,nt.base64,r.message,e);break}}break}case"nanoid":Ne(t,nt.nanoid,r.message,e)}return t}function Ao(n,e){return e.patternStrategy==="escape"?Vk(n):n}const Wk=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Vk(n){let e="";for(let t=0;t<n.length;t++)Wk.has(n[t])||(e+="\\"),e+=n[t];return e}function rt(n,e,t,r){var i;n.format||(i=n.anyOf)!=null&&i.some(s=>s.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):ne(n,"format",e,t,r)}function Ne(n,e,t,r){var i;n.pattern||(i=n.allOf)!=null&&i.some(s=>s.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:ep(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):ne(n,"pattern",ep(e,r),t,r)}function ep(n,e){var c;if(!e.applyRegexFlags||!n.flags)return n.source;const t={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},r=t.i?n.source.toLowerCase():n.source;let i="",s=!1,a=!1,o=!1;for(let u=0;u<r.length;u++){if(s){i+=r[u],s=!1;continue}if(t.i){if(a){if(r[u].match(/[a-z]/)){o?(i+=r[u],i+=`${r[u-2]}-${r[u]}`.toUpperCase(),o=!1):r[u+1]==="-"&&((c=r[u+2])!=null&&c.match(/[a-z]/))?(i+=r[u],o=!0):i+=`${r[u]}${r[u].toUpperCase()}`;continue}}else if(r[u].match(/[a-z]/)){i+=`[${r[u]}${r[u].toUpperCase()}]`;continue}}if(t.m){if(r[u]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(r[u]==="$"){i+=`($|(?=[\r
]))`;continue}}if(t.s&&r[u]==="."){i+=a?`${r[u]}\r
`:`[${r[u]}\r
]`;continue}i+=r[u],r[u]==="\\"?s=!0:a&&r[u]==="]"?a=!1:!a&&r[u]==="["&&(a=!0)}try{new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return i}function e_(n,e){var r,i,s,a,o,c;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===$.ZodFirstPartyTypeKind.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((u,l)=>({...u,[l]:ee(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",l]})??{}}),{}),additionalProperties:e.rejectedAdditionalProperties};const t={type:"object",additionalProperties:ee(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(((i=n.keyType)==null?void 0:i._def.typeName)===$.ZodFirstPartyTypeKind.ZodString&&((s=n.keyType._def.checks)!=null&&s.length)){const{type:u,...l}=Qg(n.keyType._def,e);return{...t,propertyNames:l}}else{if(((a=n.keyType)==null?void 0:a._def.typeName)===$.ZodFirstPartyTypeKind.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};if(((o=n.keyType)==null?void 0:o._def.typeName)===$.ZodFirstPartyTypeKind.ZodBranded&&n.keyType._def.type._def.typeName===$.ZodFirstPartyTypeKind.ZodString&&((c=n.keyType._def.type._def.checks)!=null&&c.length)){const{type:u,...l}=Kg(n.keyType._def,e);return{...t,propertyNames:l}}}return t}function zk(n,e){if(e.mapStrategy==="record")return e_(n,e);const t=ee(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=ee(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function qk(n){const e=n.values,r=Object.keys(n.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),i=Array.from(new Set(r.map(s=>typeof s)));return{type:i.length===1?i[0]==="string"?"string":"number":["string","number"],enum:r}}function Zk(){return{not:{}}}function Xk(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const As={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function Yk(n,e){if(e.target==="openApi3")return tp(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in As&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((i,s)=>{const a=As[s._def.typeName];return a&&!i.includes(a)?[...i,a]:i},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((i,s)=>{const a=typeof s._def.value;switch(a){case"string":case"number":case"boolean":return[...i,a];case"bigint":return[...i,"integer"];case"object":if(s._def.value===null)return[...i,"null"];case"symbol":case"undefined":case"function":default:return i}},[]);if(r.length===t.length){const i=r.filter((s,a,o)=>o.indexOf(s)===a);return{type:i.length>1?i:i[0],enum:t.reduce((s,a)=>s.includes(a._def.value)?s:[...s,a._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,i)=>[...r,...i._def.values.filter(s=>!r.includes(s))],[])};return tp(n,e)}const tp=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,i)=>ee(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${i}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function Kk(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:As[n.innerType._def.typeName],nullable:!0}:{type:[As[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=ee(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=ee(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function Jk(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",Yg(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?ne(t,"minimum",r.value,r.message,e):ne(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),ne(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?ne(t,"maximum",r.value,r.message,e):ne(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),ne(t,"maximum",r.value,r.message,e));break;case"multipleOf":ne(t,"multipleOf",r.value,r.message,e);break}return t}function Qk(n,e){const t=e.target==="openAi",r={type:"object",properties:{}},i=[],s=n.shape();for(const o in s){let c=s[o];if(c===void 0||c._def===void 0)continue;let u=tD(c);u&&t&&(c instanceof $.ZodOptional&&(c=c._def.innerType),c.isNullable()||(c=c.nullable()),u=!1);const l=ee(c._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});l!==void 0&&(r.properties[o]=l,u||i.push(o))}i.length&&(r.required=i);const a=eD(n,e);return a!==void 0&&(r.additionalProperties=a),r}function eD(n,e){if(n.catchall._def.typeName!=="ZodNever")return ee(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(n.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function tD(n){try{return n.isOptional()}catch{return!0}}const nD=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return ee(n.innerType._def,e);const t=ee(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},rD=(n,e)=>{if(e.pipeStrategy==="input")return ee(n.in._def,e);if(e.pipeStrategy==="output")return ee(n.out._def,e);const t=ee(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=ee(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(i=>i!==void 0)}};function iD(n,e){return ee(n.type._def,e)}function sD(n,e){const r={type:"array",uniqueItems:!0,items:ee(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&ne(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&ne(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function aD(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>ee(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:ee(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>ee(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function oD(){return{not:{}}}function cD(){return{}}const uD=(n,e)=>ee(n.innerType._def,e),lD=(n,e,t)=>{switch(e){case $.ZodFirstPartyTypeKind.ZodString:return Qg(n,t);case $.ZodFirstPartyTypeKind.ZodNumber:return Jk(n,t);case $.ZodFirstPartyTypeKind.ZodObject:return Qk(n,t);case $.ZodFirstPartyTypeKind.ZodBigInt:return $k(n,t);case $.ZodFirstPartyTypeKind.ZodBoolean:return Mk();case $.ZodFirstPartyTypeKind.ZodDate:return Jg(n,t);case $.ZodFirstPartyTypeKind.ZodUndefined:return oD();case $.ZodFirstPartyTypeKind.ZodNull:return Xk(t);case $.ZodFirstPartyTypeKind.ZodArray:return xk(n,t);case $.ZodFirstPartyTypeKind.ZodUnion:case $.ZodFirstPartyTypeKind.ZodDiscriminatedUnion:return Yk(n,t);case $.ZodFirstPartyTypeKind.ZodIntersection:return Gk(n,t);case $.ZodFirstPartyTypeKind.ZodTuple:return aD(n,t);case $.ZodFirstPartyTypeKind.ZodRecord:return e_(n,t);case $.ZodFirstPartyTypeKind.ZodLiteral:return Hk(n,t);case $.ZodFirstPartyTypeKind.ZodEnum:return Uk(n);case $.ZodFirstPartyTypeKind.ZodNativeEnum:return qk(n);case $.ZodFirstPartyTypeKind.ZodNullable:return Kk(n,t);case $.ZodFirstPartyTypeKind.ZodOptional:return nD(n,t);case $.ZodFirstPartyTypeKind.ZodMap:return zk(n,t);case $.ZodFirstPartyTypeKind.ZodSet:return sD(n,t);case $.ZodFirstPartyTypeKind.ZodLazy:return()=>n.getter()._def;case $.ZodFirstPartyTypeKind.ZodPromise:return iD(n,t);case $.ZodFirstPartyTypeKind.ZodNaN:case $.ZodFirstPartyTypeKind.ZodNever:return Zk();case $.ZodFirstPartyTypeKind.ZodEffects:return jk(n,t);case $.ZodFirstPartyTypeKind.ZodAny:return Lk();case $.ZodFirstPartyTypeKind.ZodUnknown:return cD();case $.ZodFirstPartyTypeKind.ZodDefault:return Fk(n,t);case $.ZodFirstPartyTypeKind.ZodBranded:return Kg(n,t);case $.ZodFirstPartyTypeKind.ZodReadonly:return uD(n,t);case $.ZodFirstPartyTypeKind.ZodCatch:return kk(n,t);case $.ZodFirstPartyTypeKind.ZodPipeline:return rD(n,t);case $.ZodFirstPartyTypeKind.ZodFunction:case $.ZodFirstPartyTypeKind.ZodVoid:case $.ZodFirstPartyTypeKind.ZodSymbol:return;default:return(r=>{})()}};function ee(n,e,t=!1){var o;const r=e.seen.get(n);if(e.override){const c=(o=e.override)==null?void 0:o.call(e,n,e,r,t);if(c!==Pk)return c}if(r&&!t){const c=dD(r,e);if(c!==void 0)return c}const i={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,i);const s=lD(n,n.typeName,e),a=typeof s=="function"?ee(s(),e):s;if(a&&pD(n,e,a),e.postProcess){const c=e.postProcess(a,n,e);return i.jsonSchema=a,c}return i.jsonSchema=a,a}const dD=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:fD(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},fD=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},pD=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),hD=(n,e)=>{const t=Nk(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((c,[u,l])=>({...c,[u]:ee(l._def,{...t,currentPath:[...t.basePath,t.definitionPath,u]},!0)??{}}),{}):void 0,i=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,s=ee(n._def,i===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,i]},!1)??{},a=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;a!==void 0&&(s.title=a);const o=i===void 0?r?{...s,[t.definitionPath]:r}:s:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,i].join("/"),[t.definitionPath]:{...r,[i]:s}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o};function Oo(n){return n.replace(/[^a-zA-Z-_0-9]/g,"_")}function mD(n,e){const t=e[n.source]??n.source,r=e[n.target]??n.target;return[t,r]}function gD(n){let e="";for(const[t,r]of Object.entries(n))e+=`	classDef ${t}class fill:${r};
`;return e}function _D(n,e,t){const{firstNodeLabel:r,lastNodeLabel:i,nodeColors:s,withStyles:a=!0,curveStyle:o="linear",wrapLabelNWords:c=9}=t??{};let u=a?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(a){const d="default",f={[d]:"{0}([{1}]):::otherclass"};r!==void 0&&(f[r]="{0}[{0}]:::startclass"),i!==void 0&&(f[i]="{0}[{0}]:::endclass");for(const p of Object.values(n)){const h=f[p]??f[d],m=Oo(p),g=p.split(":"),y=g[g.length-1];u+=`	${h.replace(/\{0\}/g,m).replace(/\{1\}/g,y)};
`}}let l="";for(const d of e){const f=d.source.includes(":")?d.source.split(":")[0]:void 0,p=d.target.includes(":")?d.target.split(":")[0]:void 0;l!==""&&(l!==f||l!==p)&&(u+=`	end
`,l=""),l===""&&f!==void 0&&f===p&&(u=`	subgraph ${f}
`,l=f);const[h,m]=mD(d,n);let g="";if(d.data!==void 0){let y=d.data;const E=y.split(" ");E.length>c&&(y=E.reduce((b,S,v)=>(v%c===0&&b.push(""),b[b.length-1]+=` ${S}`,b),[]).join("<br>")),d.conditional?g=` -. ${y} .-> `:g=` -- ${y} --> `}else d.conditional?g=" -.-> ":g=" --> ";u+=`	${Oo(h)}${g}${Oo(m)};
`}return l!==""&&(u+=`end
`),a&&s!==void 0&&(u+=gD(s)),u}async function yD(n,e){let{backgroundColor:t="white"}=e??{};const r=btoa(n);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));const i=`https://mermaid.ink/img/${r}?bgColor=${t}`,s=await fetch(i);if(!s.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${s.status}`,`Status text: ${s.statusText}`].join(`
`));return await s.blob()}const np=42;function Ro(n){if(Ke.validate(n.id))if(tl(n.data))try{let e=n.data.getName();return e=e.startsWith("Runnable")?e.slice(8):e,e.length>np&&(e=`${e.substring(0,np)}...`),e}catch{return n.data.getName()}else return n.data.name??"UnknownSchema";else return n.id}function bD(n){return tl(n.data)?{type:"runnable",data:{id:n.data.lc_id,name:n.data.getName()}}:{type:"schema",data:{...hD(n.data.schema),title:n.data.name}}}class t_{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){const e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=Ke.validate(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...bD(t)})),edges:this.edges.map(t=>{const r={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(r.data=t.data),typeof t.conditional<"u"&&(r.conditional=t.conditional),r})}}addNode(e,t){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const r=t||Ke.v4(),i={id:r,data:e};return this.nodes[r]=i,i}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,i){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const s={source:e.id,target:t.id,data:r,conditional:i};return this.edges.push(s),s}firstNode(){const e=new Set(this.edges.map(r=>r.target)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}lastNode(){const e=new Set(this.edges.map(r=>r.source)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}extend(e,t=""){let r=t;Object.values(e.nodes).map(u=>u.id).every(Ke.validate)&&(r="");const s=u=>r?`${r}:${u}`:u;Object.entries(e.nodes).forEach(([u,l])=>{this.nodes[s(u)]={...l,id:s(u)}});const a=e.edges.map(u=>({...u,source:s(u.source),target:s(u.target)}));this.edges=[...this.edges,...a];const o=e.firstNode(),c=e.lastNode();return[o?{id:s(o.id),data:o.data}:void 0,c?{id:s(c.id),data:c.data}:void 0]}trimFirstNode(){const e=this.firstNode();if(e){const t=this.edges.filter(r=>r.source===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}trimLastNode(){const e=this.lastNode();if(e){const t=this.edges.filter(r=>r.target===e.id);(Object.keys(this.nodes).length===1||t.length===1)&&this.removeNode(e)}}drawMermaid(e){const{withStyles:t,curveStyle:r,nodeColors:i={start:"#ffdfba",end:"#baffc9",other:"#fad7de"},wrapLabelNWords:s}=e??{},a={};for(const d of Object.values(this.nodes))a[d.id]=Ro(d);const o=this.firstNode(),c=o?Ro(o):void 0,u=this.lastNode(),l=u?Ro(u):void 0;return _D(a,this.edges,{firstNodeLabel:c,lastNodeLabel:l,withStyles:t,curveStyle:r,nodeColors:i,wrapLabelNWords:s})}async drawMermaidPng(e){const t=this.drawMermaid(e);return yD(t,{backgroundColor:e==null?void 0:e.backgroundColor})}}function vD(n){const e=new TextEncoder,t=new ReadableStream({async start(r){for await(const i of n)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(i)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return ze.fromReadableStream(t)}function rp(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.iterator]=="function"&&typeof n.next=="function"}const ED=n=>n!=null&&typeof n=="object"&&"next"in n&&typeof n.next=="function";function Ac(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.asyncIterator]=="function"}function*ip(n,e){for(;;){const{value:t,done:r}=An.runWithConfig(n,e.next.bind(e),!0);if(r)break;yield t}}async function*sp(n,e){const t=e[Symbol.asyncIterator]();for(;;){const{value:r,done:i}=await An.runWithConfig(n,t.next.bind(e),!0);if(i)break;yield r}}function Se(n,e){return n&&!Array.isArray(n)&&!(n instanceof Date)&&typeof n=="object"?n:{[e]:n}}class $e extends cr{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new En({bound:this,kwargs:e,config:{}})}map(){return new Os({bound:this})}withRetry(e){return new wD({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new En({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new TD({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(ie);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(e).filter(([i])=>i!=="runId"));return Array.from({length:t},(i,s)=>ie(s===0?e:r))}return Array.from({length:t},()=>ie(e))}async batch(e,t,r){var c;const i=this._getOptionsList(t??{},e.length),s=((c=i[0])==null?void 0:c.maxConcurrency)??(r==null?void 0:r.maxConcurrency),a=new Rk({maxConcurrency:s,onFailedAttempt:u=>{throw u}}),o=e.map((u,l)=>a.call(async()=>{try{return await this.invoke(u,i[l])}catch(d){if(r!=null&&r.returnExceptions)return d;throw d}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const r=ie(t),i=new _r({generator:this._streamIterator(e,r),config:r});return await i.setup,ze.fromAsyncGenerator(i)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=ie(e):t=ie({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){const i=ie(r),s=await ct(i),a=await(s==null?void 0:s.handleChainStart(this.toJSON(),Se(t,"input"),i.runId,i==null?void 0:i.runType,void 0,void 0,(i==null?void 0:i.runName)??this.getName()));delete i.runId;let o;try{const c=e.call(this,t,i,a);o=await tn(c,r==null?void 0:r.signal)}catch(c){throw await(a==null?void 0:a.handleChainError(c)),c}return await(a==null?void 0:a.handleChainEnd(Se(o,"output"))),o}async _batchWithConfig(e,t,r,i){var u;const s=this._getOptionsList(r??{},t.length),a=await Promise.all(s.map(ct)),o=await Promise.all(a.map(async(l,d)=>{const f=await(l==null?void 0:l.handleChainStart(this.toJSON(),Se(t[d],"input"),s[d].runId,s[d].runType,void 0,void 0,s[d].runName??this.getName()));return delete s[d].runId,f}));let c;try{const l=e.call(this,t,s,o,i);c=await tn(l,(u=s==null?void 0:s[0])==null?void 0:u.signal)}catch(l){throw await Promise.all(o.map(d=>d==null?void 0:d.handleChainError(l))),l}return await Promise.all(o.map(l=>l==null?void 0:l.handleChainEnd(Se(c,"output")))),c}async*_transformStreamWithConfig(e,t,r){let i,s=!0,a,o=!0;const c=ie(r),u=await ct(c);async function*l(){for await(const f of e){if(s)if(i===void 0)i=f;else try{i=Mt(i,f)}catch{i=void 0,s=!1}yield f}}let d;try{const f=await bk(t.bind(this),l(),async()=>u==null?void 0:u.handleChainStart(this.toJSON(),{input:""},c.runId,c.runType,void 0,void 0,c.runName??this.getName()),r==null?void 0:r.signal,c);delete c.runId,d=f.setup;const p=d==null?void 0:d.handlers.find(wk);let h=f.output;p!==void 0&&d!==void 0&&(h=p.tapOutputIterable(d.runId,h));const m=d==null?void 0:d.handlers.find(vk);m!==void 0&&d!==void 0&&(h=m.tapOutputIterable(d.runId,h));for await(const g of h)if(yield g,o)if(a===void 0)a=g;else try{a=Mt(a,g)}catch{a=void 0,o=!1}}catch(f){throw await(d==null?void 0:d.handleChainError(f,void 0,void 0,void 0,{inputs:Se(i,"input")})),f}await(d==null?void 0:d.handleChainEnd(a??{},void 0,void 0,void 0,{inputs:Se(i,"input")}))}getGraph(e){const t=new t_,r=t.addNode({name:`${this.getName()}Input`,schema:$.z.any()}),i=t.addNode(this),s=t.addNode({name:`${this.getName()}Output`,schema:$.z.any()});return t.addEdge(r,i),t.addEdge(i,s),t}pipe(e){return new gn({first:this,last:_n(e)})}pick(e){return this.pipe(new OD(e))}assign(e){return this.pipe(new AD(new gi({steps:e})))}async*transform(e,t){let r;for await(const i of e)r===void 0?r=i:r=Mt(r,i);yield*this._streamIterator(r,ie(t))}async*streamLog(e,t,r){const i=new Kf({...r,autoClose:!1,_schemaFormat:"original"}),s=ie(t);yield*this._streamLog(e,i,s)}async*_streamLog(e,t,r){const{callbacks:i}=r;if(i===void 0)r.callbacks=[t];else if(Array.isArray(i))r.callbacks=i.concat([t]);else{const c=i.copy();c.addHandler(t,!0),r.callbacks=c}const s=this.stream(e,r);async function a(){try{const c=await s;for await(const u of c){const l=new Xt({ops:[{op:"add",path:"/streamed_output/-",value:u}]});await t.writer.write(l)}}finally{await t.writer.close()}}const o=a();try{for await(const c of t)yield c}finally{await o}}streamEvents(e,t,r){let i;if(t.version==="v1")i=this._streamEventsV1(e,t,r);else if(t.version==="v2")i=this._streamEventsV2(e,t,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?vD(i):ze.fromAsyncGenerator(i)}async*_streamEventsV2(e,t,r){var p;const i=new Sk({...r,autoClose:!1}),s=ie(t),a=s.runId??Ke.v4();s.runId=a;const o=s.callbacks;if(o===void 0)s.callbacks=[i];else if(Array.isArray(o))s.callbacks=o.concat(i);else{const h=o.copy();h.addHandler(i,!0),s.callbacks=h}const c=this;async function u(){try{const h=await c.stream(e,s),m=i.tapOutputIterable(a,h);for await(const g of m);}finally{await i.finish()}}const l=u();let d=!1,f;try{for await(const h of i){if(!d){h.data.input=e,d=!0,f=h.run_id,yield h;continue}h.run_id===f&&h.event.endsWith("_end")&&(p=h.data)!=null&&p.input&&delete h.data.input,yield h}}finally{await l}}async*_streamEventsV1(e,t,r){let i,s=!1;const a=ie(t),o=a.tags??[],c=a.metadata??{},u=a.runName??this.getName(),l=new Kf({...r,autoClose:!1,_schemaFormat:"streaming_events"}),d=new Ik({...r}),f=this._streamLog(e,l,a);for await(const h of f){if(i?i=i.concat(h):i=Zr.fromRunLogPatch(h),i.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!s){s=!0;const E={...i.state},b={run_id:E.id,event:`on_${E.type}_start`,name:u,tags:o,metadata:c,data:{input:e}};d.includeEvent(b,E.type)&&(yield b)}const m=h.ops.filter(E=>E.path.startsWith("/logs/")).map(E=>E.path.split("/")[2]),g=[...new Set(m)];for(const E of g){let b,S={};const v=i.state.logs[E];if(v.end_time===void 0?v.streamed_output.length>0?b="stream":b="start":b="end",b==="start")v.inputs!==void 0&&(S.input=v.inputs);else if(b==="end")v.inputs!==void 0&&(S.input=v.inputs),S.output=v.final_output;else if(b==="stream"){const D=v.streamed_output.length;if(D!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${D} instead. Encountered in: "${v.name}"`);S={chunk:v.streamed_output[0]},v.streamed_output=[]}yield{event:`on_${v.type}_${b}`,name:v.name,run_id:v.id,tags:v.tags,metadata:v.metadata,data:S}}const{state:y}=i;if(y.streamed_output.length>0){const E=y.streamed_output.length;if(E!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${E} instead. Encountered in: "${y.name}"`);const b={chunk:y.streamed_output[0]};y.streamed_output=[];const S={event:`on_${y.type}_stream`,run_id:y.id,tags:o,metadata:c,name:u,data:b};d.includeEvent(S,y.type)&&(yield S)}}const p=i==null?void 0:i.state;if(p!==void 0){const h={event:`on_${p.type}_end`,name:u,run_id:p.id,tags:o,metadata:c,data:{output:p.final_output}};d.includeEvent(h,p.type)&&(yield h)}}static isRunnable(e){return tl(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new En({bound:this,config:{},configFactories:[i=>({callbacks:[new Xg({config:i,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){return RD(this,e)}}class En extends $e{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=Jf(this.config,...e);return Jf(t,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(ie(t),this.kwargs))}async batch(e,t,r){const i=Array.isArray(t)?await Promise.all(t.map(async s=>this._mergeConfig(ie(s),this.kwargs))):await this._mergeConfig(ie(t),this.kwargs);return this.bound.batch(e,i,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(ie(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(ie(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(ie(t),this.kwargs))}streamEvents(e,t,r){const i=this,s=async function*(){yield*i.bound.streamEvents(e,{...await i._mergeConfig(ie(t),i.kwargs),version:t.version},r)};return ze.fromAsyncGenerator(s())}static isRunnableBinding(e){return e.bound&&$e.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new En({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[i=>({callbacks:[new Xg({config:i,onStart:e,onEnd:t,onError:r})]})]})}}class Os extends $e{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new Os({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,r){return this.bound.batch(e,Ie(t,{callbacks:r==null?void 0:r.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new Os({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class wD extends En{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){const i=e>1?`retry:attempt:${e}`:void 0;return Ie(t,{callbacks:r==null?void 0:r.getChild(i)})}async _invoke(e,t,r){return _s(i=>super.invoke(e,this._patchConfigForRetry(i,t,r)),{onFailedAttempt:i=>this.onFailedAttempt(i,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,i){const s={};try{await _s(async a=>{const o=e.map((f,p)=>p).filter(f=>s[f.toString()]===void 0||s[f.toString()]instanceof Error),c=o.map(f=>e[f]),u=o.map(f=>this._patchConfigForRetry(a,t==null?void 0:t[f],r==null?void 0:r[f])),l=await super.batch(c,u,{...i,returnExceptions:!0});let d;for(let f=0;f<l.length;f+=1){const p=l[f],h=o[f];p instanceof Error&&d===void 0&&(d=p,d.input=c[f]),s[h.toString()]=p}if(d)throw d;return l},{onFailedAttempt:a=>this.onFailedAttempt(a,a.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if((i==null?void 0:i.returnExceptions)!==!0)throw a}return Object.keys(s).sort((a,o)=>parseInt(a,10)-parseInt(o,10)).map(a=>s[parseInt(a,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class gn extends $e{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){var c;const r=ie(t),i=await ct(r),s=await(i==null?void 0:i.handleChainStart(this.toJSON(),Se(e,"input"),r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;let a=e,o;try{const u=[this.first,...this.middle];for(let l=0;l<u.length;l+=1){const f=u[l].invoke(a,Ie(r,{callbacks:s==null?void 0:s.getChild(`seq:step:${l+1}`)}));a=await tn(f,t==null?void 0:t.signal)}if((c=t==null?void 0:t.signal)!=null&&c.aborted)throw new Error("Aborted");o=await this.last.invoke(a,Ie(r,{callbacks:s==null?void 0:s.getChild(`seq:step:${this.steps.length}`)}))}catch(u){throw await(s==null?void 0:s.handleChainError(u)),u}return await(s==null?void 0:s.handleChainEnd(Se(o,"output"))),o}async batch(e,t,r){var c;const i=this._getOptionsList(t??{},e.length),s=await Promise.all(i.map(ct)),a=await Promise.all(s.map(async(u,l)=>{const d=await(u==null?void 0:u.handleChainStart(this.toJSON(),Se(e[l],"input"),i[l].runId,void 0,void 0,void 0,i[l].runName));return delete i[l].runId,d}));let o=e;try{for(let u=0;u<this.steps.length;u+=1){const d=this.steps[u].batch(o,a.map((f,p)=>{const h=f==null?void 0:f.getChild(`seq:step:${u+1}`);return Ie(i[p],{callbacks:h})}),r);o=await tn(d,(c=i[0])==null?void 0:c.signal)}}catch(u){throw await Promise.all(a.map(l=>l==null?void 0:l.handleChainError(u))),u}return await Promise.all(a.map(u=>u==null?void 0:u.handleChainEnd(Se(o,"output")))),o}async*_streamIterator(e,t){var d;const r=await ct(t),{runId:i,...s}=t??{},a=await(r==null?void 0:r.handleChainStart(this.toJSON(),Se(e,"input"),i,void 0,void 0,void 0,s==null?void 0:s.runName)),o=[this.first,...this.middle,this.last];let c=!0,u;async function*l(){yield e}try{let f=o[0].transform(l(),Ie(s,{callbacks:a==null?void 0:a.getChild("seq:step:1")}));for(let p=1;p<o.length;p+=1)f=await o[p].transform(f,Ie(s,{callbacks:a==null?void 0:a.getChild(`seq:step:${p+1}`)}));for await(const p of f)if((d=t==null?void 0:t.signal)==null||d.throwIfAborted(),yield p,c)if(u===void 0)u=p;else try{u=Mt(u,p)}catch{u=void 0,c=!1}}catch(f){throw await(a==null?void 0:a.handleChainError(f)),f}await(a==null?void 0:a.handleChainEnd(Se(u,"output")))}getGraph(e){const t=new t_;let r=null;return this.steps.forEach((i,s)=>{const a=i.getGraph(e);s!==0&&a.trimFirstNode(),s!==this.steps.length-1&&a.trimLastNode(),t.extend(a);const o=a.firstNode();if(!o)throw new Error(`Runnable ${i} has no first node`);r&&t.addEdge(r,o),r=a.lastNode()}),t}pipe(e){return gn.isRunnableSequence(e)?new gn({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new gn({first:this.first,middle:[...this.middle,this.last],last:_n(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&$e.isRunnable(e)}static from([e,...t],r){return new gn({first:_n(e),middle:t.slice(0,-1).map(_n),last:_n(t[t.length-1]),name:r})}}class gi extends $e{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=_n(r)}static from(e){return new gi({steps:e})}async invoke(e,t){const r=ie(t),i=await ct(r),s=await(i==null?void 0:i.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;const a={};try{const o=Object.entries(this.steps).map(async([c,u])=>{a[c]=await u.invoke(e,Ie(r,{callbacks:s==null?void 0:s.getChild(`map:key:${c}`)}))});await tn(Promise.all(o),t==null?void 0:t.signal)}catch(o){throw await(s==null?void 0:s.handleChainError(o)),o}return await(s==null?void 0:s.handleChainEnd(a)),a}async*_transform(e,t,r){const i={...this.steps},s=Zg(e,Object.keys(i).length),a=new Map(Object.entries(i).map(([o,c],u)=>{const l=c.transform(s[u],Ie(r,{callbacks:t==null?void 0:t.getChild(`map:key:${o}`)}));return[o,l.next().then(d=>({key:o,gen:l,result:d}))]}));for(;a.size;){const o=Promise.race(a.values()),{key:c,result:u,gen:l}=await tn(o,r==null?void 0:r.signal);a.delete(c),u.done||(yield{[c]:u.value},a.set(c,l.next().then(d=>({key:c,gen:l,result:d}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=ie(t),s=new _r({generator:this.transform(r(),i),config:i});return await s.setup,ze.fromAsyncGenerator(s)}}class nl extends $e{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!Ju(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[r]=this._getOptionsList(t??{},1),i=await ct(r),s=this.func(Ie(r,{callbacks:i}),e);return tn(s,r==null?void 0:r.signal)}async*_streamIterator(e,t){var s,a;const[r]=this._getOptionsList(t??{},1),i=await this.invoke(e,t);if(Ac(i)){for await(const o of i)(s=r==null?void 0:r.signal)==null||s.throwIfAborted(),yield o;return}if(ED(i)){for(;;){(a=r==null?void 0:r.signal)==null||a.throwIfAborted();const o=i.next();if(o.done)break;yield o.value}return}yield i}static from(e){return new nl({func:e})}}function SD(n){if(Ju(n))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class pa extends $e{static lc_name(){return"RunnableLambda"}constructor(e){if(Ju(e.func))return nl.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),SD(e.func),this.func=e.func}static from(e){return new pa({func:e})}async _invoke(e,t,r){return new Promise((i,s)=>{const a=Ie(t,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((t==null?void 0:t.recursionLimit)??So)-1});An.runWithConfig(a,async()=>{var o,c;try{let u=await this.func(e,{...a,config:a});if(u&&$e.isRunnable(u)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");u=await u.invoke(e,{...a,recursionLimit:(a.recursionLimit??So)-1})}else if(Ac(u)){let l;for await(const d of sp(a,u))if((o=t==null?void 0:t.signal)==null||o.throwIfAborted(),l===void 0)l=d;else try{l=Mt(l,d)}catch{l=d}u=l}else if(rp(u)){let l;for(const d of ip(a,u))if((c=t==null?void 0:t.signal)==null||c.throwIfAborted(),l===void 0)l=d;else try{l=Mt(l,d)}catch{l=d}u=l}i(u)}catch(u){s(u)}})})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async*_transform(e,t,r){var o,c;let i;for await(const u of e)if(i===void 0)i=u;else try{i=Mt(i,u)}catch{i=u}const s=Ie(r,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((r==null?void 0:r.recursionLimit)??So)-1}),a=await new Promise((u,l)=>{An.runWithConfig(s,async()=>{try{const d=await this.func(i,{...s,config:s});u(d)}catch(d){l(d)}})});if(a&&$e.isRunnable(a)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");const u=await a.stream(i,s);for await(const l of u)yield l}else if(Ac(a))for await(const u of sp(s,a))(o=r==null?void 0:r.signal)==null||o.throwIfAborted(),yield u;else if(rp(a))for(const u of ip(s,a))(c=r==null?void 0:r.signal)==null||c.throwIfAborted(),yield u;else yield a}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=ie(t),s=new _r({generator:this.transform(r(),i),config:i});return await s.setup,ze.fromAsyncGenerator(s)}}class TD extends $e{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){var u;const r=ie(t),i=await ct(t),{runId:s,...a}=r,o=await(i==null?void 0:i.handleChainStart(this.toJSON(),Se(e,"input"),s,void 0,void 0,void 0,a==null?void 0:a.runName));let c;for(const l of this.runnables()){(u=r==null?void 0:r.signal)==null||u.throwIfAborted();try{const d=await l.invoke(e,Ie(a,{callbacks:o==null?void 0:o.getChild()}));return await(o==null?void 0:o.handleChainEnd(Se(d,"output"))),d}catch(d){c===void 0&&(c=d)}}throw c===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(c)),c)}async*_streamIterator(e,t){var d;const r=ie(t),i=await ct(t),{runId:s,...a}=r,o=await(i==null?void 0:i.handleChainStart(this.toJSON(),Se(e,"input"),s,void 0,void 0,void 0,a==null?void 0:a.runName));let c,u;for(const f of this.runnables()){(d=r==null?void 0:r.signal)==null||d.throwIfAborted();const p=Ie(a,{callbacks:o==null?void 0:o.getChild()});try{u=await f.stream(e,p);break}catch(h){c===void 0&&(c=h)}}if(u===void 0){const f=c??new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(f)),f}let l;try{for await(const f of u){yield f;try{l=l===void 0?l:Mt(l,f)}catch{l=void 0}}}catch(f){throw await(o==null?void 0:o.handleChainError(f)),f}await(o==null?void 0:o.handleChainEnd(Se(l,"output")))}async batch(e,t,r){var c;if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");const i=this._getOptionsList(t??{},e.length),s=await Promise.all(i.map(u=>ct(u))),a=await Promise.all(s.map(async(u,l)=>{const d=await(u==null?void 0:u.handleChainStart(this.toJSON(),Se(e[l],"input"),i[l].runId,void 0,void 0,void 0,i[l].runName));return delete i[l].runId,d}));let o;for(const u of this.runnables()){(c=i[0].signal)==null||c.throwIfAborted();try{const l=await u.batch(e,a.map((d,f)=>Ie(i[f],{callbacks:d==null?void 0:d.getChild()})),r);return await Promise.all(a.map((d,f)=>d==null?void 0:d.handleChainEnd(Se(l[f],"output")))),l}catch(l){o===void 0&&(o=l)}}throw o?(await Promise.all(a.map(u=>u==null?void 0:u.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function _n(n){if(typeof n=="function")return new pa({func:n});if($e.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=_n(r);return new gi({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class AD extends $e{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof gi&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const r=await this.mapper.invoke(e,t);return{...e,...r}}async*_transform(e,t,r){const i=this.mapper.getStepsKeys(),[s,a]=Zg(e),o=this.mapper.transform(a,Ie(r,{callbacks:t==null?void 0:t.getChild()})),c=o.next();for await(const u of s){if(typeof u!="object"||Array.isArray(u))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof u}`);const l=Object.fromEntries(Object.entries(u).filter(([d])=>!i.includes(d)));Object.keys(l).length>0&&(yield l)}yield(await c).value;for await(const u of o)yield u}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=ie(t),s=new _r({generator:this.transform(r(),i),config:i});return await s.setup,ze.fromAsyncGenerator(s)}}class OD extends $e{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const r=await this._pick(t);r!==void 0&&(yield r)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=ie(t),s=new _r({generator:this.transform(r(),i),config:i});return await s.setup,ze.fromAsyncGenerator(s)}}class ap extends En{constructor(e){const t=gn.from([pa.from(async r=>{let i;if(nk(r))try{i=await this.schema.parseAsync(r.args)}catch{throw new rk("Received tool input did not match expected schema",JSON.stringify(r.args))}else i=r;return i}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function RD(n,e){var i;const t=e.name??n.getName(),r=e.description??((i=e.schema)==null?void 0:i.description);return e.schema.constructor===$.z.ZodString?new ap({name:t,description:r,schema:$.z.object({input:$.z.string()}).transform(s=>s.input),bound:n}):new ap({name:t,description:r,schema:e.schema,bound:n})}class ID extends $e{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","documents","transformers"]})}invoke(e,t){return this.transformDocuments(e)}}var ha={};ha.byteLength=ND;ha.toByteArray=xD;ha.fromByteArray=kD;var bt=[],Ye=[],PD=typeof Uint8Array<"u"?Uint8Array:Array,Io="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var kn=0,CD=Io.length;kn<CD;++kn)bt[kn]=Io[kn],Ye[Io.charCodeAt(kn)]=kn;Ye["-".charCodeAt(0)]=62;Ye["_".charCodeAt(0)]=63;function n_(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function ND(n){var e=n_(n),t=e[0],r=e[1];return(t+r)*3/4-r}function LD(n,e,t){return(e+t)*3/4-t}function xD(n){var e,t=n_(n),r=t[0],i=t[1],s=new PD(LD(n,r,i)),a=0,o=i>0?r-4:r,c;for(c=0;c<o;c+=4)e=Ye[n.charCodeAt(c)]<<18|Ye[n.charCodeAt(c+1)]<<12|Ye[n.charCodeAt(c+2)]<<6|Ye[n.charCodeAt(c+3)],s[a++]=e>>16&255,s[a++]=e>>8&255,s[a++]=e&255;return i===2&&(e=Ye[n.charCodeAt(c)]<<2|Ye[n.charCodeAt(c+1)]>>4,s[a++]=e&255),i===1&&(e=Ye[n.charCodeAt(c)]<<10|Ye[n.charCodeAt(c+1)]<<4|Ye[n.charCodeAt(c+2)]>>2,s[a++]=e>>8&255,s[a++]=e&255),s}function $D(n){return bt[n>>18&63]+bt[n>>12&63]+bt[n>>6&63]+bt[n&63]}function MD(n,e,t){for(var r,i=[],s=e;s<t;s+=3)r=(n[s]<<16&16711680)+(n[s+1]<<8&65280)+(n[s+2]&255),i.push($D(r));return i.join("")}function kD(n){for(var e,t=n.length,r=t%3,i=[],s=16383,a=0,o=t-r;a<o;a+=s)i.push(MD(n,a,a+s>o?o:a+s));return r===1?(e=n[t-1],i.push(bt[e>>2]+bt[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],i.push(bt[e>>10]+bt[e>>4&63]+bt[e<<2&63]+"=")),i.join("")}var DD=Object.defineProperty,FD=(n,e,t)=>e in n?DD(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,jD=(n,e,t)=>(FD(n,typeof e!="symbol"?e+"":e,t),t);function UD(n,e){let t=Array.from({length:n.length},(r,i)=>({start:i,end:i+1}));for(;t.length>1;){let r=null;for(let i=0;i<t.length-1;i++){const s=n.slice(t[i].start,t[i+1].end),a=e.get(s.join(","));a!=null&&(r==null||a<r[0])&&(r=[a,i])}if(r!=null){const i=r[1];t[i]={start:t[i].start,end:t[i+1].end},t.splice(i+1,1)}else break}return t}function BD(n,e){return n.length===1?[e.get(n.join(","))]:UD(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function GD(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Oc=class{constructor(n,e){ue(this,"specialTokens");ue(this,"inverseSpecialTokens");ue(this,"patStr");ue(this,"textEncoder",new TextEncoder);ue(this,"textDecoder",new TextDecoder("utf-8"));ue(this,"rankMap",new Map);ue(this,"textMap",new Map);this.patStr=n.pat_str;const t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,i)=>{const[s,a,...o]=i.split(" "),c=Number.parseInt(a,10);return o.forEach((u,l)=>r[u]=c+l),r},{});for(const[r,i]of Object.entries(t)){const s=ha.toByteArray(r);this.rankMap.set(s.join(","),i),this.textMap.set(i,s)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[i,s])=>(r[s]=this.textEncoder.encode(i),r),{})}encode(n,e=[],t="all"){const r=new RegExp(this.patStr,"ug"),i=Oc.specialTokenRegex(Object.keys(this.specialTokens)),s=[],a=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(u=>!a.has(u)):t);if(o.size>0){const u=Oc.specialTokenRegex([...o]),l=n.match(u);if(l!=null)throw new Error(`The text contains a special token that is not allowed: ${l[0]}`)}let c=0;for(;;){let u=null,l=c;for(;i.lastIndex=l,u=i.exec(n),!(u==null||a.has(u[0]));)l=u.index+1;const d=(u==null?void 0:u.index)??n.length;for(const p of n.substring(c,d).matchAll(r)){const h=this.textEncoder.encode(p[0]),m=this.rankMap.get(h.join(","));if(m!=null){s.push(m);continue}s.push(...BD(h,this.rankMap))}if(u==null)break;let f=this.specialTokens[u[0]];s.push(f),c=u.index+u[0].length}return s}decode(n){const e=[];let t=0;for(let s=0;s<n.length;++s){const a=n[s],o=this.textMap.get(a)??this.inverseSpecialTokens[a];o!=null&&(e.push(o),t+=o.length)}const r=new Uint8Array(t);let i=0;for(const s of e)r.set(s,i),i+=s.length;return this.textDecoder.decode(r)}},HD=Oc;jD(HD,"specialTokenRegex",n=>new RegExp(n.map(e=>GD(e)).join("|"),"g"));class WD extends ID{constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","document_transformers","text_splitters"]}),Object.defineProperty(this,"chunkSize",{enumerable:!0,configurable:!0,writable:!0,value:1e3}),Object.defineProperty(this,"chunkOverlap",{enumerable:!0,configurable:!0,writable:!0,value:200}),Object.defineProperty(this,"keepSeparator",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lengthFunction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.chunkSize=(e==null?void 0:e.chunkSize)??this.chunkSize,this.chunkOverlap=(e==null?void 0:e.chunkOverlap)??this.chunkOverlap,this.keepSeparator=(e==null?void 0:e.keepSeparator)??this.keepSeparator,this.lengthFunction=(e==null?void 0:e.lengthFunction)??(t=>t.length),this.chunkOverlap>=this.chunkSize)throw new Error("Cannot have chunkOverlap >= chunkSize")}async transformDocuments(e,t={}){return this.splitDocuments(e,t)}splitOnSeparator(e,t){let r;if(t)if(this.keepSeparator){const i=t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&");r=e.split(new RegExp(`(?=${i})`))}else r=e.split(t);else r=e.split("");return r.filter(i=>i!=="")}async createDocuments(e,t=[],r={}){const i=t.length>0?t:[...Array(e.length)].map(()=>({})),{chunkHeader:s="",chunkOverlapHeader:a="(cont'd) ",appendChunkOverlapHeader:o=!1}=r,c=new Array;for(let u=0;u<e.length;u+=1){const l=e[u];let d=1,f=null,p=-1;for(const h of await this.splitText(l)){let m=s;const g=l.indexOf(h,p+1);if(f===null){const S=this.numberOfNewLines(l,0,g);d+=S}else{const S=p+await this.lengthFunction(f);if(S<g){const v=this.numberOfNewLines(l,S,g);d+=v}else if(S>g){const v=this.numberOfNewLines(l,g,S);d-=v}o&&(m+=a)}const y=this.numberOfNewLines(h),E=i[u].loc&&typeof i[u].loc=="object"?{...i[u].loc}:{};E.lines={from:d,to:d+y};const b={...i[u],loc:E};m+=h,c.push(new P$({pageContent:m,metadata:b})),d+=y,f=h,p=g}}return c}numberOfNewLines(e,t,r){return(e.slice(t,r).match(/\n/g)||[]).length}async splitDocuments(e,t={}){const r=e.filter(a=>a.pageContent!==void 0),i=r.map(a=>a.pageContent),s=r.map(a=>a.metadata);return this.createDocuments(i,s,t)}joinDocs(e,t){const r=e.join(t).trim();return r===""?null:r}async mergeSplits(e,t){const r=[],i=[];let s=0;for(const o of e){const c=await this.lengthFunction(o);if(s+c+i.length*t.length>this.chunkSize&&(s>this.chunkSize&&console.warn(`Created a chunk of size ${s}, +
which is longer than the specified ${this.chunkSize}`),i.length>0)){const u=this.joinDocs(i,t);for(u!==null&&r.push(u);s>this.chunkOverlap||s+c+i.length*t.length>this.chunkSize&&s>0;)s-=await this.lengthFunction(i[0]),i.shift()}i.push(o),s+=c}const a=this.joinDocs(i,t);return a!==null&&r.push(a),r}}class Rs extends WD{static lc_name(){return"RecursiveCharacterTextSplitter"}constructor(e){super(e),Object.defineProperty(this,"separators",{enumerable:!0,configurable:!0,writable:!0,value:[`

`,`
`," ",""]}),this.separators=(e==null?void 0:e.separators)??this.separators,this.keepSeparator=(e==null?void 0:e.keepSeparator)??!0}async _splitText(e,t){const r=[];let i=t[t.length-1],s;for(let u=0;u<t.length;u+=1){const l=t[u];if(l===""){i=l;break}if(e.includes(l)){i=l,s=t.slice(u+1);break}}const a=this.splitOnSeparator(e,i);let o=[];const c=this.keepSeparator?"":i;for(const u of a)if(await this.lengthFunction(u)<this.chunkSize)o.push(u);else{if(o.length){const l=await this.mergeSplits(o,c);r.push(...l),o=[]}if(!s)r.push(u);else{const l=await this._splitText(u,s);r.push(...l)}}if(o.length){const u=await this.mergeSplits(o,c);r.push(...u)}return r}async splitText(e){return this._splitText(e,this.separators)}static fromLanguage(e,t){return new Rs({...t,separators:Rs.getSeparatorsForLanguage(e)})}static getSeparatorsForLanguage(e){if(e==="cpp")return[`
class `,`
void `,`
int `,`
float `,`
double `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="go")return[`
func `,`
var `,`
const `,`
type `,`
if `,`
for `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="java")return[`
class `,`
public `,`
protected `,`
private `,`
static `,`
if `,`
for `,`
while `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="js")return[`
function `,`
const `,`
let `,`
var `,`
class `,`
if `,`
for `,`
while `,`
switch `,`
case `,`
default `,`

`,`
`," ",""];if(e==="php")return[`
function `,`
class `,`
if `,`
foreach `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="proto")return[`
message `,`
service `,`
enum `,`
option `,`
import `,`
syntax `,`

`,`
`," ",""];if(e==="python")return[`
class `,`
def `,`
	def `,`

`,`
`," ",""];if(e==="rst")return[`
===
`,`
---
`,`
***
`,`
.. `,`

`,`
`," ",""];if(e==="ruby")return[`
def `,`
class `,`
if `,`
unless `,`
while `,`
for `,`
do `,`
begin `,`
rescue `,`

`,`
`," ",""];if(e==="rust")return[`
fn `,`
const `,`
let `,`
if `,`
while `,`
for `,`
loop `,`
match `,`
const `,`

`,`
`," ",""];if(e==="scala")return[`
class `,`
object `,`
def `,`
val `,`
var `,`
if `,`
for `,`
while `,`
match `,`
case `,`

`,`
`," ",""];if(e==="swift")return[`
func `,`
class `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do `,`
switch `,`
case `,`

`,`
`," ",""];if(e==="markdown")return[`
## `,`
### `,`
#### `,`
##### `,`
###### `,"```\n\n",`

***

`,`

---

`,`

___

`,`

`,`
`," ",""];if(e==="latex")return[`
\\chapter{`,`
\\section{`,`
\\subsection{`,`
\\subsubsection{`,`
\\begin{enumerate}`,`
\\begin{itemize}`,`
\\begin{description}`,`
\\begin{list}`,`
\\begin{quote}`,`
\\begin{quotation}`,`
\\begin{verse}`,`
\\begin{verbatim}`,`
\\begin{align}`,"$$","$",`

`,`
`," ",""];if(e==="html")return["<body>","<div>","<p>","<br>","<li>","<h1>","<h2>","<h3>","<h4>","<h5>","<h6>","<span>","<table>","<tr>","<td>","<th>","<ul>","<ol>","<header>","<footer>","<nav>","<head>","<style>","<script>","<meta>","<title>"," ",""];if(e==="sol")return[`
pragma `,`
using `,`
contract `,`
interface `,`
library `,`
constructor `,`
type `,`
function `,`
event `,`
modifier `,`
error `,`
struct `,`
enum `,`
if `,`
for `,`
while `,`
do while `,`
assembly `,`

`,`
`," ",""];throw new Error(`Language ${e} is not supported.`)}}const VD=new up,op=VD.get(T.ChunkSize);function zD(n){const e=n.split(`
`),t=[];let r=[];return e.forEach(i=>{i.startsWith("#")&&r.length&&(t.push(r.join(`
`)),r=[]),r.push(i)}),r.length&&t.push(r.join(`
`)),t}const qD=async(n,e,t)=>(await new Rs({chunkSize:e,chunkOverlap:t}).createDocuments(n)).map(a=>a.pageContent),r_=async n=>{const t=zD(n),r=[],i=[];t.forEach(a=>{a.length>op?r.push(a):i.push(a)});const s=await qD(r,op,20);return i.concat(s)},ZD=async n=>{const e=wg(n.path);return(await r_(e)).map((i,s)=>({notepath:n.path,content:i,subnoteindex:s,timeadded:new Date,filemodified:n.dateModified,filecreated:n.dateCreated}))},XD=async(n,e,t,r)=>{var i,s;(i=n.watcher)==null||i.unwatch(e.vaultDirectoryForWindow);try{throw await R_.access(t.newFilePath),new Error(`A file already exists at destination: ${t.newFilePath}`)}catch(a){if(a.code!=="ENOENT")throw a}process.platform==="win32"?(await((s=n.watcher)==null?void 0:s.close()),await new Promise((a,o)=>{W.rename(t.oldFilePath,t.newFilePath,c=>{if(c){o(c);return}const u=_.BrowserWindow.fromWebContents(r);u&&(n.watcher=Eg(u,e.vaultDirectoryForWindow),Xu(u,e.vaultDirectoryForWindow)),a()})})):await new Promise((a,o)=>{W.rename(t.oldFilePath,t.newFilePath,c=>{var u;if(c){o(c);return}(u=n.watcher)==null||u.add(e.vaultDirectoryForWindow),a()})}),await e.dbTableClient.updateDBItemsWithNewFilePath(t.oldFilePath,t.newFilePath)},YD=async n=>{const e=n.map(ZD);return await Promise.all(e)},KD=async n=>(await n.lanceTable.filter(`${Yt.NOTE_PATH} != ''`).select([Yt.NOTE_PATH,Yt.FILE_MODIFIED]).execute()).map(yc),JD=(n,e)=>{if(n.length===0||n[0].content==="")return!1;const{notepath:t}=n[0],r=e.filter(i=>i.notepath===t);return r.length===0?!0:n[0].filemodified>r[0].filemodified},QD=async(n,e)=>(await YD(n)).filter(i=>JD(i,e)),eF=async(n,e)=>e.filter(r=>!n.some(i=>i.path===r.notepath)),tF=async(n,e)=>{await n.deleteDBItemsByFilePaths([e]);const t=wg(e),r=await r_(t),i=W.statSync(e),s=r.map((a,o)=>({notepath:e,content:a,subnoteindex:o,timeadded:new Date,filemodified:i.mtime,filecreated:i.birthtime}));await n.add(s)},nF=async(n,e,t)=>{const r=Zx(e),i=await KD(n),a=(await eF(r,i)).map(u=>u.notepath);await n.deleteDBItemsByFilePaths(a);const o=await QD(r,i);if(o.length===0){t&&t(1);return}const c=o.flat();await n.add(c,t),t&&t(1)};class Zn{constructor(e,t){ue(this,"storageDir");ue(this,"metadataFile");ue(this,"mediaType");this.storageDir=B.join(e,t),this.metadataFile=B.join(e,`${t}Metadata.json`),this.mediaType=t,this.initStorage()}initStorage(){W.existsSync(this.storageDir)||W.mkdirSync(this.storageDir,{recursive:!0}),W.existsSync(this.metadataFile)||W.writeFileSync(this.metadataFile,JSON.stringify({}))}getMetadata(){const e=W.readFileSync(this.metadataFile,"utf8");return JSON.parse(e)}saveMetadata(e){W.writeFileSync(this.metadataFile,JSON.stringify(e))}static generateFileName(e){const t=Date.now();return I_.createHash("md5").update(`${e}${t}`).digest("hex")}static async checkFileType(e){const{fileTypeFromBuffer:t}=await import("file-type");return await t(e)}validateFileType(e){return this.mediaType==="images"?["image/png","image/jpeg","image/gif","image/svg+xml"].includes(e):["video/mp4","video/webm","video/quicktime"].includes(e)}async storeMedia(e,t,r){const i=e.replace(/^data:[^;]+;base64,/,""),s=Buffer.from(i,"base64"),a=await Zn.checkFileType(s);if(!a||!this.validateFileType(a.mime))throw new Error(`Invalid ${this.mediaType.slice(0,-1)} file type`);const o=`${Zn.generateFileName(t)}.${a.ext}`,c=B.join(this.storageDir,o);await W.promises.writeFile(c,s);const u=this.getMetadata();return u[r]={id:r,fileName:o,originalName:t,mimeType:a.mime,createdAt:new Date().toISOString(),fileSize:s.length},this.saveMetadata(u),`local://${o}`}async deleteMedia(e){const t=e.replace("local://",""),r=B.join(this.storageDir,t);if(W.existsSync(r))await W.promises.unlink(r);else throw new Error(`File not found: ${r}`)}async getMedia(e){try{const t=e.replace("local://",""),r=B.join(this.storageDir,t);if(!W.existsSync(r))return null;const i=await W.promises.readFile(r),s=await Zn.checkFileType(i);if(!s||!this.validateFileType(s.mime))throw new Error(`Invalid ${this.mediaType.slice(0,-1)} file type`);return`data:${s.mime};base64,${i.toString("base64")}`}catch{return null}}}class rF extends Zn{constructor(e){super(e,"images")}}class iF extends Zn{constructor(e){super(e,"videos")}}const Po=new rF(_.app.getPath("userData")),cp=new iF(_.app.getPath("userData")),sF=(n,e)=>{const t=e;_.ipcMain.handle("get-files-tree-for-window",async r=>{const i=t.getVaultDirectoryForWinContents(r.sender);return i?pi(i):[]}),_.ipcMain.handle("read-file",async(r,i,s="utf-8")=>await W.promises.readFile(i,s)),_.ipcMain.handle("check-file-exists",async(r,i)=>{try{return await W.promises.access(i,W.constants.F_OK),!0}catch{return!1}}),_.ipcMain.handle("delete-file",async(r,i)=>{W.stat(i,async(s,a)=>{if(!s)if(a.isDirectory()){W.rm(i,{recursive:!0},()=>{});const o=t.getWindowInfoForContents(r.sender);if(!o)throw new Error("Window info not found.");await o.dbTableClient.deleteDBItemsByFilePaths([i])}else{W.unlink(i,()=>{});const o=t.getWindowInfoForContents(r.sender);if(!o)throw new Error("Window info not found.");await o.dbTableClient.deleteDBItemsByFilePaths([i])}})}),_.ipcMain.handle("write-file",async(r,i)=>{W.existsSync(B.dirname(i.filePath))||W.mkdirSync(B.dirname(i.filePath),{recursive:!0}),W.writeFileSync(i.filePath,i.content,"utf-8")}),_.ipcMain.handle("store-image",async(r,i,s,a)=>{try{return await Po.storeMedia(i,s,a)}catch(o){throw new Error(`Failed to store image: ${o}`)}}),_.ipcMain.handle("delete-image",async(r,i)=>{try{return await Po.deleteMedia(i),!0}catch(s){throw new Error(`Failed to delete image: ${s}`)}}),_.ipcMain.handle("get-image",async(r,i)=>{try{return await Po.getMedia(i)}catch(s){throw new Error(`Failed to get image: ${s}`)}}),_.ipcMain.handle("store-video",async(r,i,s,a)=>{try{return await cp.storeMedia(i,s,a)}catch(o){throw new Error(`Failed to store video: ${o}`)}}),_.ipcMain.handle("get-video",async(r,i)=>{try{return await cp.getMedia(i)}catch(s){throw new Error(`Failed to get video: ${s}`)}}),_.ipcMain.handle("is-directory",(r,i)=>W.statSync(i).isDirectory()),_.ipcMain.handle("rename-file",async(r,i)=>{const s=t.getWindowInfoForContents(r.sender);if(!s)throw new Error("Window info not found.");await XD(t,s,i,r.sender)}),_.ipcMain.handle("index-file-in-database",async(r,i)=>{const s=t.getWindowInfoForContents(r.sender);if(!s)throw new Error("Window info not found.");await tF(s.dbTableClient,i)}),_.ipcMain.handle("create-file",async(r,i,s)=>{Yx(i,s,"utf-8")}),_.ipcMain.handle("create-directory",async(r,i)=>{const s=a=>{const o=B.dirname(a);W.existsSync(o)||s(o),W.existsSync(a)||W.mkdirSync(a)};W.existsSync(i)||s(i)}),_.ipcMain.handle("get-files",async(r,i)=>{const s=Xx(i),a=s.map(o=>W.readFileSync(o.path,"utf-8"));return s.map((o,c)=>({...o,content:a[c]}))}),_.ipcMain.handle("get-files-in-directory",(r,i)=>W.readdirSync(i).filter(a=>!es(a))),_.ipcMain.handle("open-directory-dialog",async()=>{const r=await _.dialog.showOpenDialog({properties:["openDirectory","createDirectory"]});return r.canceled?null:r.filePaths}),_.ipcMain.handle("open-file-dialog",async(r,i)=>{const s=i&&i.length>0?[{name:"Files",extensions:i}]:[],a=await _.dialog.showOpenDialog({properties:["openFile","multiSelections","showHiddenFiles"],filters:s});return a.canceled?[]:a.filePaths}),_.ipcMain.handle("open-img-file-dialog",async()=>(await _.dialog.showOpenDialog({properties:["openFile"],filters:[{name:"Images",extensions:["jpg","png","gif"]}]})).filePaths),_.ipcMain.handle("open-video-file-dialog",async()=>(await _.dialog.showOpenDialog({properties:["openFile"],filters:[{name:"Videos",extensions:["mp4","mkv"]}]})).filePaths)},Hn=new h$,aF=n=>{_.ipcMain.handle("set-default-llm",(e,t)=>{n.set(T.DefaultLLM,t),e.sender.send("llm-configs-changed")}),_.ipcMain.handle("get-default-llm-name",()=>n.get(T.DefaultLLM)),_.ipcMain.handle("get-llm-configs",async()=>Og(n,Hn)),_.ipcMain.handle("get-llm-api-configs",async()=>n.get(T.LLMAPIs)),_.ipcMain.handle("add-or-update-llm-config",async(e,t)=>{await bc(n,t),e.sender.send("llm-configs-changed")}),_.ipcMain.handle("add-or-update-llm-api-config",async(e,t)=>{await m$(n,t),e.sender.send("llm-configs-changed")}),_.ipcMain.handle("remove-llm",async(e,t)=>{await _$(n,Hn,t),e.sender.send("llm-configs-changed")}),_.ipcMain.handle("pull-ollama-model",async(e,t)=>{const r=i=>{e.sender.send("ollamaDownloadProgress",t,i)};await Hn.pullModel(t,r),e.sender.send("llm-configs-changed")}),_.ipcMain.handle("delete-llm",async(e,t)=>{await Hn.deleteModel(t),e.sender.send("llm-configs-changed")})},oF=()=>{_.ipcMain.handle("path-basename",(n,e)=>X.basename(e)),_.ipcMain.handle("path-sep",()=>X.sep),_.ipcMain.handle("join-path",(n,...e)=>X.join(...e)),_.ipcMain.handle("path-dirname",(n,e)=>X.dirname(e)),_.ipcMain.handle("path-relative",(n,e,t)=>X.relative(e,t)),_.ipcMain.handle("path-absolute",(n,e)=>X.isAbsolute(e)),_.ipcMain.handle("add-extension-if-no-extension-present",(n,e)=>bg(e,ca,".md")),_.ipcMain.handle("path-ext-name",(n,e)=>X.extname(e))},cF=(n,e)=>{let t;const r=e;_.ipcMain.handle("search",async(i,s,a,o)=>{const c=r.getWindowInfoForContents(i.sender);if(!c)throw new Error("Window info not found.");return await c.dbTableClient.search(s,a,o)}),_.ipcMain.handle("index-files-in-directory",async i=>{const s=r.getWindowInfoForContents(i.sender);if(!s)throw new Error("No window info found");const a=R$(n),o=B.join(_.app.getPath("userData"),"vectordb");t=await O_.connect(o),await s.dbTableClient.initialize(t,s.vaultDirectoryForWindow,a),await nF(s.dbTableClient,s.vaultDirectoryForWindow,u=>{i.sender.send("indexing-progress",u)});const c=_.BrowserWindow.fromWebContents(i.sender);c&&(r.watcher=Eg(c,s.vaultDirectoryForWindow),Xu(c,s.vaultDirectoryForWindow)),i.sender.send("indexing-progress",1)}),_.ipcMain.handle("search-with-reranking",async(i,s,a,o)=>{const c=r.getWindowInfoForContents(i.sender);if(!c)throw new Error("Window info not found.");const u=await c.dbTableClient.search(s,a,o);return await i$(s,u)}),_.ipcMain.handle("get-database-fields",()=>Yt)};process.env.NODE_ENV==="production"&&Wx({dsn:"https://a764a6135d25ba91f0b25c0252be52f3@o4507840138903552.ingest.us.sentry.io/4507840140410880"});const Pn=new up,an=new d$;process.env.DIST_ELECTRON=Kt.join(__dirname,"../");process.env.DIST=Kt.join(process.env.DIST_ELECTRON,"../dist");process.env.VITE_PUBLIC=process.env.VITE_DEV_SERVER_URL?Kt.join(process.env.DIST_ELECTRON,"../public"):process.env.DIST;Rc.release().startsWith("6.1")&&_.app.disableHardwareAcceleration();process.platform==="darwin"&&Rc.release().startsWith("21.6")&&_.app.disableHardwareAcceleration();process.platform==="win32"&&_.app.setAppUserModelId(_.app.getName());_.app.requestSingleInstanceLock()||(_.app.quit(),process.exit(0));const rl=Kt.join(__dirname,"../preload/index.js"),il=process.env.VITE_DEV_SERVER_URL,sl=Kt.join(process.env.DIST,"index.html");_.app.whenReady().then(async()=>{await Hn.init(),an.createWindow(Pn,rl,il,sl)});_.app.on("window-all-closed",()=>{process.platform!=="darwin"&&_.app.quit()});_.app.on("before-quit",async()=>{Hn.stop()});_.app.on("activate",()=>{const n=_.BrowserWindow.getAllWindows();n.length?n[0].focus():an.createWindow(Pn,rl,il,sl)});process.on("uncaughtException",n=>{an.appendNewErrorToDisplayInWindow(qu(n)),process.env.NODE_ENV==="production"&&Ds(n)});process.on("unhandledRejection",n=>{an.appendNewErrorToDisplayInWindow(qu(n)),process.env.NODE_ENV==="production"&&Ds(n)});aF(Pn);cF(Pn,an);O$(Pn,an);sF(Pn,an);I$(Pn,an,rl,il,sl);oF();
//# sourceMappingURL=index.js.map
